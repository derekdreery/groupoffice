if(Ext.version=="2.3.0"){Ext.isFunction=function(a){return typeof(a)=="function"};Ext.override(Ext.grid.ColumnModel,{setConfig:Ext.grid.ColumnModel.prototype.setConfig.createSequence(function(){if(this.defaults&&this.defaults.sortable==true){this.defaultSortable=true}})});Ext.lib.Event.resolveTextNode=Ext.isGecko?function(b){if(!b){return}var a=HTMLElement.prototype.toString.call(b);if(a=="[xpconnect wrapped native prototype]"||a=="[object XULElement]"){return}return b.nodeType==3?b.parentNode:b}:function(a){return a&&a.nodeType==3?a.parentNode:a};if(Ext.isIE7||Ext.isIE6){Ext.override(Ext.Element,{getHeight:function(b){var a=Math.max(this.dom.offsetHeight,this.dom.clientHeight)||0;a=this.dom.offsetHeight||0;a=b!==true?a:a-this.getBorderWidth("tb")-this.getPadding("tb");return a<0?0:a},getWidth:function(b){var a=Math.max(this.dom.offsetWidth,this.dom.clientWidth)||0;a=this.dom.offsetWidth||0;a=b!==true?a:a-this.getBorderWidth("lr")-this.getPadding("lr");return a<0?0:a}})}}Ext.override(Ext.menu.Menu,{showAt:function(d,b,a){this.parentMenu=b;if(!this.el){this.render()}if(a!==false){this.fireEvent("beforeshow",this);d=this.el.adjustForConstraints(d)}this.el.setXY(d);var c=Ext.getBody().getHeight()-d[1];if(!this.el.origHeight){this.el.origHeight=this.el.getHeight()}if(this.el.origHeight>c){this.el.setHeight(c);this.el.applyStyles("overflow-y: auto;")}else{}this.el.show();this.hidden=false;this.focus();this.fireEvent("show",this)}});Ext.override(Ext.grid.GridView,{scrollOffset:20});Ext.apply(Ext.form.VTypes,{password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:GO.lang.passwordMatchError});Ext.Window.override({constrainHeader:true,animCollapse:false});Ext.MessageBox.buttonText.yes=GO.lang.cmdYes;Ext.MessageBox.buttonText.no=GO.lang.cmdNo;Ext.MessageBox.buttonText.ok=GO.lang.cmdOk;Ext.MessageBox.buttonText.cancel=GO.lang.cmdCancel;if(GO.settings.date_format){Ext.override(Ext.DatePicker,{startDay:parseInt(GO.settings.first_weekday)});Ext.override(Ext.form.DateField,{format:GO.settings.date_format});Ext.override(Ext.form.DateField,{format:GO.settings.date_format,altFormats:GO.settings.date_format+"|"+GO.settings.date_format.replace("Y","y")})}Ext.override(Ext.Element,{printCSS:"",printStyle:false,printTitle:document.title,print:function(f){f=f||{};Ext.apply(this,f);var d=Ext.get(this.id).dom;var n=document.getElementById("printcontainer");var e=document.getElementById("printframe");var j='<HTML><HEAD>{0}<TITLE>{1}</TITLE></HEAD><BODY onload="{2}" style="background-color:white;">{3}</BODY></HTML>';var b="";var o;var l;if(e!=null){n.removeChild(e)}if(n!=null){d.removeChild(n)}for(var g=0;g<d.attributes.length;g++){if(Ext.isEmpty(d.attributes[g].value)||d.attributes[g].value.toLowerCase()!="null"){o=Ext.isEmpty(d.attributes[g].value)?'{0}="true" ':'{0}="{1}" ';if(this.printStyle?this.printStyle:d.attributes[g].name.toLowerCase()!="style"){b+=String.format(o,d.attributes[g].name,d.attributes[g].value)}}}for(var g=0;g<document.styleSheets.length;g++){this.printCSS+='<link rel="stylesheet" type="text/css" href="'+document.styleSheets[g].href+'"/>'}this.printCSS+="<style>body{overflow:visible !important;}</style>";var k=d.innerHTML;if(f.title){k='<h1 style="margin-left:5px;font-size:16px;margin:10px 5px;">'+f.title+"</h1>"+k}l=String.format(j,Ext.isEmpty(this.printCSS)?"#":this.printCSS,this.printTitle,Ext.isIE?"document.execCommand('print');":"window.print();",k);var a=window.open("about:blank");if(!a.opener){a.opener=self}a.document.write(l);a.document.close();a.focus()}});Ext.override(Ext.Component,{printEl:function(a){this.el.print(Ext.isEmpty(a)?this.initialConfig:a)},printBody:function(a){this.body.print(Ext.isEmpty(a)?this.initialConfig:a)}});Ext.decode=Ext.util.JSON.decode=function(json){try{return eval("("+json+")")}catch(e){switch(json.trim()){case"NOTLOGGEDIN":document.location=BaseHref;break;case"UNAUTHORIZED":Ext.Msg.alert(GO.lang.strUnauthorized,GO.lang.strUnauthorizedText);break;default:json+="<br /><br />Ext.decode exception occurred";GO.errorDialog.show(GO.lang.serverError,json);break}}};GO.ModuleManager=Ext.extend(function(){this.addEvents({moduleReady:true,moduleconstructed:true,languageLoaded:true});this.resumeEvents()},Ext.util.Observable,{modules:{},modulePanels:{},panelConfigs:{},sortOrder:Array(),adminModulePanels:{},adminPanelConfigs:{},adminSortOrder:Array(),settingsPanels:{},settingsPanelConfigs:{},settingsSortOrder:Array(),readyFunctions:{},addSettingsPanel:function(b,a,c){this.settingsPanels[b]=a;this.settingsPanelConfigs[b]=c;this.settingsSortOrder.push(b)},getSettingsPanel:function(a){if(this.settingsPanels[a]){return new this.settingsPanels[a](this.settingsPanelConfigs[a])}else{return false}},getAllSettingsPanels:function(){var a=[];for(var b=0;b<this.settingsSortOrder.length;b++){a.push(this.getSettingsPanel(this.settingsSortOrder[b]))}return a},addModule:function(b,a,c){if(a){c.moduleName=b;c.id="go-module-panel-"+c.moduleName;this.modulePanels[b]=a;this.panelConfigs[b]=c;this.sortOrder.push(b)}this.onAddModule(b)},onAddModule:function(a){this.modules[a]=true;if(this.readyFunctions[a]){for(var b=0;b<this.readyFunctions[a].length;b++){var d=this.readyFunctions[a][b];d.fn.call(d.fn.scope,a,this)}}},onModuleReady:function(a,c,b){b=b||window;if(!this.modules[a]){this.readyFunctions[a]=this.readyFunctions[a]||[];this.readyFunctions[a].push({fn:c,scope:b})}else{c.call(b,a,this)}},getPanel:function(a){if(this.modulePanels[a]){var b=new this.modulePanels[a](this.panelConfigs[a]);this.fireEvent("moduleconstructed",this,a,b);return b}else{return false}},getAllPanels:function(){var a=[];for(var b=0;b<this.sortOrder.length;b++){a.push(this.getPanel(this.sortOrder[b]))}return a},getAllPanelConfigs:function(){var b=[];for(var a=0;a<this.sortOrder.length;a++){b.push(this.panelConfigs[this.sortOrder[a]])}return b}});GO.moduleManager=new GO.ModuleManager();Date.prototype.getLastSunday=function(){var a=this.getDay();return this.add(Date.DAY,-a)};var deployJava={debug:null,myInterval:null,preInstallJREList:null,returnPage:null,brand:null,locale:null,installType:null,EAInstallEnabled:false,EarlyAccessURL:null,getJavaURL:"http://java.sun.com/webapps/getjava/BrowserRedirect?host=java.com",appleRedirectPage:"http://www.apple.com/support/downloads/",mimeType:"application/npruntime-scriptable-plugin;DeploymentToolkit",launchButtonPNG:"http://java.sun.com/products/jfc/tsc/articles/swing2d/webstart.png",getJREs:function(){var d=new Array();if(deployJava.isPluginInstalled()){var c=deployJava.getPlugin();for(var b=0;b<c.jvms.getLength();b++){d[b]=c.jvms.get(b).version}}else{var a=deployJava.getBrowser();if(a=="MSIE"){if(deployJava.testUsingActiveX("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingActiveX("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingActiveX("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingActiveX("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingActiveX("1.4.2")){d[0]="1.4.2"}else{if(deployJava.testForMSVM()){d[0]="1.1"}}}}}}}else{if(a=="Netscape Family"){if(deployJava.testUsingMimeTypes("1.8")){d[0]="1.8.0"}else{if(deployJava.testUsingMimeTypes("1.7")){d[0]="1.7.0"}else{if(deployJava.testUsingMimeTypes("1.6")){d[0]="1.6.0"}else{if(deployJava.testUsingMimeTypes("1.5")){d[0]="1.5.0"}else{if(deployJava.testUsingMimeTypes("1.4.2")){d[0]="1.4.2"}}}}}}else{if(a=="Safari"){if(deployJava.testUsingPluginsArray("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingPluginsArray("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingPluginsArray("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingPluginsArray("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingPluginsArray("1.4.2")){d[0]="1.4.2"}}}}}}}}}if(deployJava.debug){for(var b=0;b<d.length;++b){alert("We claim to have detected Java SE "+d[b])}}return d},installJRE:function(b){var a=false;if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installJRE(b)){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{return deployJava.installLatestJRE()}},installLatestJRE:function(){if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installLatestJRE()){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{var b=deployJava.getBrowser();var a=navigator.platform.toLowerCase();if((deployJava.EAInstallEnabled=="true")&&(a.indexOf("win")!=-1)&&(deployJava.EarlyAccessURL!=null)){deployJava.preInstallJREList=deployJava.getJREs();if(deployJava.returnPage!=null){deployJava.myInterval=setInterval("deployJava.poll()",3000)}location.href=deployJava.EarlyAccessURL;return false}else{if(b=="MSIE"){return deployJava.IEInstall()}else{if((b=="Netscape Family")&&(a.indexOf("win32")!=-1)){return deployJava.FFInstall()}else{location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")}}return false}}},runApplet:function(b,f,d){if(d=="undefined"||d==null){d="1.1"}var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(deployJava.returnPage==null){deployJava.returnPage=document.location}if(a!=null){var c=deployJava.getBrowser();if((c!="?")&&(c!="Safari")){if(deployJava.versionCheck(d+"+")){deployJava.writeAppletTag(b,f)}else{if(deployJava.installJRE(d+"+")){deployJava.refresh();location.href=document.location;deployJava.writeAppletTag(b,f)}}}else{deployJava.writeAppletTag(b,f)}}else{if(deployJava.debug){alert("Invalid minimumVersion argument to runApplet():"+d)}}},writeAppletTag:function(a,d){var b="<applet ";for(var c in a){b+=(" "+c+'="'+a[c]+'"')}b+=">";document.write(b);if(d!="undefined"&&d!=null){for(var e in d){b='<param name="'+e+'" value="'+d[e]+'">';document.write(b)}}document.write("</applet>")},versionCheck:function(j){var c=0;var f="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?(\\*|\\+)?$";var a=j.match(f);if(a!=null){var e=true;var b=new Array();for(var d=1;d<a.length;++d){if((typeof a[d]=="string")&&(a[d]!="")){b[c]=a[d];c++}}if(b[b.length-1]=="+"){e=false;b.length--}else{if(b[b.length-1]=="*"){b.length--}}var g=deployJava.getJREs();for(var d=0;d<g.length;++d){if(deployJava.compareVersionToPattern(g[d],b,e)){return true}}return false}else{alert("Invalid versionPattern passed to versionCheck: "+j);return false}},isWebStartInstalled:function(d){var c=deployJava.getBrowser();if((c=="?")||(c=="Safari")){return true}if(d=="undefined"||d==null){d="1.4.2"}var b=false;var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(a!=null){b=deployJava.versionCheck(d+"+")}else{if(deployJava.debug){alert("Invalid minimumVersion argument to isWebStartInstalled(): "+d)}b=deployJava.versionCheck("1.4.2+")}return b},createWebStartLaunchButton:function(c,b){if(deployJava.returnPage==null){deployJava.returnPage=c}var a="javascript:if (!deployJava.isWebStartInstalled(&quot;"+b+"&quot;)) {if (deployJava.installLatestJRE()) {if (deployJava.launch(&quot;"+c+"&quot;)) {}}} else {if (deployJava.launch(&quot;"+c+"&quot;)) {}}";document.write('<a href="'+a+'" onMouseOver="window.status=\'\'; return true;"><img src="'+deployJava.launchButtonPNG+'" border="0" /></a>')},launch:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().launch(a)}else{document.location=a;return true}},isPluginInstalled:function(){var a=deployJava.getPlugin();if(a&&a.jvms){return true}else{return false}},isAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().isAutoUpdateEnabled()}return false},setAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAutoUpdateEnabled()}return false},setInstallerType:function(a){deployJava.installType=a;if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setInstallerType(a)}return false},setAdditionalPackages:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAdditionalPackages(a)}return false},setEarlyAccess:function(a){deployJava.EAInstallEnabled=a},isPlugin2:function(){if(deployJava.isPluginInstalled()){try{return deployJava.getPlugin().isPlugin2()}catch(a){}}return false},getPlugin:function(){deployJava.refresh();var a=document.getElementById("deployJavaPlugin");return a},compareVersionToPattern:function(f,b,c){var g="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var j=f.match(g);if(j!=null){var e=0;var k=new Array();for(var d=1;d<j.length;++d){if((typeof j[d]=="string")&&(j[d]!="")){k[e]=j[d];e++}}var a=Math.min(k.length,b.length);if(c){for(var d=0;d<a;++d){if(k[d]!=b[d]){return false}}return true}else{for(var d=0;d<a;++d){if(k[d]<b[d]){return false}else{if(k[d]>b[d]){return true}}}return true}}else{return false}},getBrowser:function(){var a=navigator.userAgent.toLowerCase();if(deployJava.debug){alert("userAgent -> "+a)}if((navigator.vendor)&&(navigator.vendor.toLowerCase().indexOf("apple")!=-1)&&(a.indexOf("safari")!=-1)){if(deployJava.debug){alert('We claim to have detected "Safari".')}return"Safari"}else{if(a.indexOf("msie")!=-1){if(deployJava.debug){alert('We claim to have detected "IE".')}return"MSIE"}else{if((a.indexOf("mozilla")!=-1)||(a.indexOf("firefox")!=-1)){if(deployJava.debug){alert("We claim to have detected a Netscape family browser.")}return"Netscape Family"}else{if(deployJava.debug){alert("We claim to have failed to detect a browser.")}return"?"}}}},testUsingActiveX:function(a){var c="JavaWebStart.isInstalled."+a+".0";if(!ActiveXObject){if(deployJava.debug){alert("Browser claims to be IE, but no ActiveXObject object?")}return false}try{return(new ActiveXObject(c)!=null)}catch(b){return false}},testForMSVM:function(){var b="{08B0E5C0-4FCB-11CF-AAA5-00401C608500}";if(typeof oClientCaps!="undefined"){var a=oClientCaps.getComponentVersion(b,"ComponentID");if((a=="")||(a=="5,0,5000,0")){return false}else{return true}}else{return false}},testUsingMimeTypes:function(b){if(!navigator.mimeTypes){if(deployJava.debug){alert("Browser claims to be Netscape family, but no mimeTypes[] array?")}return false}for(var c=0;c<navigator.mimeTypes.length;++c){s=navigator.mimeTypes[c].type;var a=s.match(/^application\/x-java-applet\x3Bversion=(1\.8|1\.7|1\.6|1\.5|1\.4\.2)$/);if(a!=null){if(deployJava.compareVersions(a[1],b)){return true}}}return false},testUsingPluginsArray:function(a){if((!navigator.plugins)||(!navigator.plugins.length)){if(deployJava.debug){alert("Browser claims to be Safari, but no plugins[] array?")}return false}for(var b=0;b<navigator.plugins.length;++b){s=navigator.plugins[b].description;if(s.search(/^Java Switchable Plug-in/)!=-1){return true}m=s.match(/^Java (1\.4\.2|1\.5|1\.6|1\.7).* Plug-in/);if(m!=null){if(deployJava.compareVersions(m[1],a)){return true}}}return false},IEInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},done:function(b,a){},FFInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},compareVersions:function(f,g){var d=f.split(".");var c=g.split(".");for(var e=0;e<d.length;++e){d[e]=Number(d[e])}for(var e=0;e<c.length;++e){c[e]=Number(c[e])}if(d.length==2){d[2]=0}if(d[0]>c[0]){return true}if(d[0]<c[0]){return false}if(d[1]>c[1]){return true}if(d[1]<c[1]){return false}if(d[2]>c[2]){return true}if(d[2]<c[2]){return false}return true},enableAlerts:function(){deployJava.debug=true},poll:function(){deployJava.refresh();var a=deployJava.getJREs();if((deployJava.preInstallJREList.length==0)&&(a.length!=0)){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}if((deployJava.preInstallJREList.length!=0)&&(a.length!=0)&&(deployJava.preInstallJREList[0]!=a[0])){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}},writePluginTag:function(){var a=deployJava.getBrowser();if(a=="MSIE"){document.write('<object classid="clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA" id="deployJavaPlugin" width="0" height="0"></object>')}else{if(a=="Netscape Family"){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},refresh:function(){navigator.plugins.refresh(false);var a=deployJava.getBrowser();if(a=="Netscape Family"){var c=document.getElementById("deployJavaPlugin");if(c==null){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},do_initialize:function(){deployJava.writePluginTag();if(deployJava.locale==null){var b=null;if(b==null){try{b=navigator.userLanguage}catch(a){}}if(b==null){try{b=navigator.systemLanguage}catch(a){}}if(b==null){try{b=navigator.language}catch(a){}}if(b!=null){b.replace("-","_");deployJava.locale=b}}}};deployJava.do_initialize();GO.MainLayout=function(){this.addEvents({ready:true,render:true,linksDeleted:true,focus:true,blur:true});this.resumeEvents()};Ext.extend(GO.MainLayout,Ext.util.Observable,{ready:false,fullscreenPopup:false,state:false,stateSaveScheduled:false,onReady:function(b,a){if(!this.ready){this.on("ready",b,a)}else{b.call(a,this)}},launchFullscreen:function(a){this.fullscreenPopup=GO.util.popup({url:a,target:"groupoffice"})},login:function(){new Ext.Viewport();GO.loginDialog=new GO.dialog.LoginDialog({modal:false});this.createLoginCallback();this.removeLoadMask();GO.loginDialog.show();if(window.console&&window.console.firebug){this.msg(GO.lang.firebugDetected,GO.lang.firebugWarning,4,300)}if(GO.settings.config.debug){this.msg(GO.lang.debugModeDetected,GO.lang.debugModeWarning,4,300)}},saveState:function(){Ext.state.Manager.getProvider().set("open-modules",this.getOpenModules())},logout:function(a){if(Ext.Ajax.isLoading()){if(a){Ext.getBody().mask(GO.lang.waitMsgLoad)}this.logout.defer(500,this,[true])}else{document.location=GO.settings.config.host+"index.php?task=logout"}},createLoginCallback:function(){GO.loginDialog.addCallback(function(){var a=GO.afterLoginUrl?GO.afterLoginUrl:GO.settings.config.host;if(GO.loginDialog.fullscreenField.getValue()&&window.name!="groupoffice"){a=GO.util.addParamToUrl(a,"fullscreen_loaded","true");this.launchFullscreen(a);GO.loginDialog.hideDialog=false;GO.loginDialog.on("callbackshandled",this.createLoginCallback,this)}else{document.location.href=a}},this)},fireReady:function(){this.fireEvent("ready",this);this.ready=true},getOpenModules:function(){var a=[];this.tabPanel.items.each(function(b){var c=this.tabPanel.getTabEl(b);if(c.style.display!="none"){a.push(b.moduleName)}},this);return a},createTabPanel:function(a){this.tabPanel=new Ext.TabPanel({region:"center",titlebar:false,border:false,activeTab:"go-module-panel-"+GO.settings.start_module,tabPosition:"top",items:a});this.tabPanel.on("contextmenu",function(f,b,d){var g=this.getOpenModules();if(g.length>1){f.hideTabStripItem(b);b.hide();if(b==f.activeTab){var c=f.stack.next();if(c){f.setActiveTab(c)}else{if(f.items.getCount()>0){f.setActiveTab(0)}else{f.activeTab=null}}}this.saveState()}},this)},getModulePanel:function(a){var b="go-module-panel-"+a;if(this.tabPanel.items.map[b]){return this.tabPanel.items.map[b]}else{return false}},beforeRender:function(){},init:function(){window.name="groupoffice";GO.loginDialog=new GO.dialog.LoginDialog({modal:true});GO.checker=new GO.Checker();this.fireReady();Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{dismissDelay:0,maxWidth:500});var k=GO.moduleManager.getAllPanelConfigs();var g=[];this.startMenu=new Ext.menu.Menu({id:"startMenu"});if(k.length==0){g=new Ext.Panel({id:"go-module-panel-"+GO.settings.start_module,region:"center",border:false,cls:"go-form-panel",title:"No modules",html:"<h1>No modules available</h1>You have a valid account but you don't have access to any of the modules. Please contact the administrator if you feel this is an error."})}var j=[];var d;this.state=Ext.state.Manager.get("open-modules");for(var c=0;c<k.length;c++){if(this.state&&this.state.indexOf(k[c].moduleName)>-1){g.push(GO.moduleManager.getPanel(k[c].moduleName))}d={id:"go-start-menu-"+k[c].moduleName,moduleName:k[c].moduleName,text:k[c].title,iconCls:"go-menu-icon-"+k[c].moduleName,handler:function(o,p){this.openModule(o.moduleName)},scope:this};if(!k[c].admin){if(!this.state){g.push(GO.moduleManager.getPanel(k[c].moduleName))}this.startMenu.add(d)}else{j.push(d)}}if(j.length){this.startMenu.add(new Ext.menu.TextItem({id:"go-start-menu-admin-menu",text:'<div class="menu-title">'+GO.lang.adminMenu+"</div>"}));for(var c=0;c<j.length;c++){this.startMenu.add(j[c])}}this.createTabPanel(g);this.beforeRender();var e=new Ext.Panel({region:"north",contentEl:"mainNorthPanel",cls:"go-top-panel",height:28,titlebar:false,border:false});GO.viewport=new Ext.Viewport({layout:"border",border:false,items:[e,this.tabPanel]});this.startMenuLink=Ext.get("start-menu-link");this.startMenuLink.on("click",function(){var o=this.startMenuLink.getX();var p=e.el.getY()+e.el.getHeight();this.startMenu.showAt([o,p])},this);var a=Ext.get("configuration-link");if(a){a.on("click",function(){if(!this.personalSettingsDialog){this.personalSettingsDialog=new GO.PersonalSettingsDialog()}this.personalSettingsDialog.show()},this)}var f=Ext.get("help-link");if(f){var n=new Ext.menu.Menu({id:"helpMenu",items:[{iconCls:"btn-help",text:GO.lang.strHelpContents,handler:function(){var o=window.open("http://www.group-office.com/wiki/");o.focus()},scope:this},{iconCls:"btn-forum",text:GO.lang.strCommunityForum,handler:function(){var o=window.open("http://www.group-office.com/forum/");o.focus()},scope:this},"-",{iconCls:"btn-support",text:GO.lang.contactSupportDesk,handler:function(){GO.supportLink=GO.settings.config.webmaster_email;if(Ext.form.VTypes.email(GO.supportLink)){if(GO.email&&GO.settings.modules.email.read_permission){GO.email.showComposer({values:{to:GO.supportLink}})}else{document.location="mailto:"+GO.supportLink}}else{window.open(GO.supportLink)}},scope:this},{iconCls:"btn-report-bug",text:GO.lang.strReportBug,handler:function(){var o=window.open("https://sourceforge.net/tracker2/?func=add&group_id=76359&atid=547651");o.focus()},scope:this},"-",{iconCls:"btn-info",text:GO.lang.strAbout.replace("{product_name}",GO.settings.config.product_name),handler:function(){if(!this.aboutDialog){this.aboutDialog=new GO.dialog.AboutDialog()}this.aboutDialog.show()},scope:this}]});f.on("click",function(){var o=f.getX();var p=e.el.getY()+e.el.getHeight();n.showAt([o,p])},this)}var b=this.tabPanel.getLayout().activeItem;if(!b){this.tabPanel.setActiveTab(0)}GO.checker.init.defer(2000,GO.checker);GO.checker.on("alert",function(o){if(o.notification_area){Ext.get("notification-area").update(o.notification_area)}},this);var l=new Ext.form.TextField({name:"search_query",enableKeyEvents:true,emptyText:GO.lang.strSearch+"...",listeners:{scope:this,keypress:function(p,o){if(o.getKey()==Ext.EventObject.ENTER){if(!this.searchPanel){this.searchPanel=new GO.grid.SearchPanel({query:p.getValue(),id:"go-search-panel"});this.tabPanel.add(this.searchPanel)}else{this.searchPanel.query=p.getValue();this.searchPanel.load()}this.tabPanel.unhideTabStripItem(this.searchPanel);this.searchPanel.show()}},blur:function(o){o.reset()}},renderTo:"search_query"});Ext.QuickTips.register({text:GO.lang.rightClickToClose,title:GO.lang.closeApps,target:this.startMenuLink});this.fireEvent("render");this.removeLoadMask()},openModule:function(b){var c="go-module-panel-"+b;var a;if(!this.tabPanel.items.map[c]){a=GO.moduleManager.getPanel(b);a.id=c;this.tabPanel.add(a);this.saveState()}else{a=this.tabPanel.items.map[c];this.tabPanel.unhideTabStripItem(a)}a.show();return a},removeLoadMask:function(){var b=Ext.get("loading");var a=Ext.get("loading-mask");a.setOpacity(0.8);a.shift({xy:b.getXY(),width:b.getWidth(),height:b.getHeight(),remove:true,duration:1,opacity:0.3,easing:"bounceOut",callback:function(){b.fadeOut({duration:0.2,remove:true})}})},createBox:function(a,c,b){if(!b){b=250}return['<div class="msg" style="width:'+b+'px">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',a,"</h3>",c,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")},msg:function(f,e,d,c){if(!d){d=4}if(!this.msgCt){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}if(this.tabPanel){this.msgCt.alignTo(this.tabPanel.el,"tr-tr")}else{this.msgCt.alignTo(Ext.getBody(),"c-c",[350,0])}var b=String.format.apply(String,Array.prototype.slice.call(arguments,1));var a=Ext.DomHelper.append(this.msgCt,{html:this.createBox(f,b,c)},true);a.slideIn("t").pause(4).ghost("t",{remove:true})},onLinksDeletedHandler:function(a,d,b){if(a){for(var c=0;c<a.length;c++){if(b.getById(a[c])){d.on("show",function(){b.reload()},this,{single:true})}}}}});GO.mainLayout=new GO.MainLayout();GO.layout.ColumnFitLayout=Ext.extend(Ext.layout.ColumnLayout,{onLayout:function(e,j){GO.layout.ColumnFitLayout.superclass.onLayout.apply(this,arguments);var g=e.items.items,a=g.length,k,d;var b=Ext.isIE&&j.dom!=Ext.getBody().dom?j.getStyleSize():j.getViewSize();var f=b.height-j.getPadding("tb");for(d=0;d<a;d++){k=g[d];k.setHeight(f+(k.footer?k.footer.getHeight():0))}}});Ext.Container.LAYOUTS.columnfit=GO.layout.ColumnFitLayout;GO.Window=function(a){if(!a){a={}}a.maximizable=true;a.minimizable=true;if(!a.keys){a.keys=[]}GO.Window.superclass.constructor.call(this,a)};GO.Window=Ext.extend(Ext.Window,{temporaryListeners:[],addListenerTillHide:function(a,c,b){this.on(a,c,b);this.temporaryListeners.push({eventName:a,fn:c,scope:b})},beforeShow:function(){GO.Window.superclass.beforeShow.call(this);if(GO.viewport){var c=GO.viewport.getEl().getHeight();var b=GO.viewport.getEl().getWidth();var a=false;if(this.height>c){this.setHeight(c)}if(this.width>b){this.setWidth(b)}if(a){this.center()}}},hide:function(){for(var a=0;a<this.temporaryListeners.length;a++){this.un(this.temporaryListeners[a].eventName,this.temporaryListeners[a].fn,this.temporaryListeners[a].scope)}this.temporaryListeners=[];GO.Window.superclass.hide.call(this)}});GO.ExportQueryDialog=Ext.extend(Ext.Window,{customTypes:[],initComponent:function(){if(this.query&&GO.customexports[this.query]){for(var b=0;b<GO.customexports[this.query].length;b++){this.formPanelItems[0].items.push({boxLabel:GO.customexports[this.query][b].name,name:"type",inputValue:GO.customexports[this.query][b].cls})}}for(var b=0,a=this.customTypes.length;b<a;b++){this.formPanelItems[0].items.push(this.customTypes[b])}Ext.apply(this,{title:GO.lang.cmdExport,items:this.formPanel=new Ext.FormPanel({items:this.formPanelItems,bodyStyle:"padding:5px"}),autoHeight:true,closeAction:"hide",closeable:true,height:400,width:400,buttons:[{text:GO.lang.strEmail,handler:function(){this.hide();this.beforeRequest();GO.email.showComposer({loadUrl:BaseHref+"json.php",loadParams:this.loadParams})},scope:this},{text:GO.lang.download,handler:function(){this.beforeRequest();var d="";for(var c in this.loadParams){if(d==""){d=BaseHref+"export_query.php?"}else{d+="&"}d+=c+"="+encodeURIComponent(this.loadParams[c])}window.open(d);this.hide()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ExportQueryDialog.superclass.initComponent.call(this)},loadParams:{},downloadUrl:"",formPanelItems:[{autoHeight:true,xtype:"radiogroup",fieldLabel:GO.lang.strType,columns:2,items:[{boxLabel:"CSV",name:"type",inputValue:"csv_export_query",checked:true},{boxLabel:"PDF",name:"type",inputValue:"pdf_export_query"}]},{xtype:"checkbox",name:"export_hidden",hideLabel:true,boxLabel:GO.lang.exportHiddenColumns}],show:function(a){GO.ExportQueryDialog.superclass.show.call(this);var a=a||{};Ext.apply(this,a)},beforeRequest:function(){var d=[];var f=this.formPanel.form.findField("export_hidden").getValue();if(this.colModel){for(var b=0;b<this.colModel.getColumnCount();b++){var e=this.colModel.config[b];if((f||!e.hidden)&&!e.hideInExport){d.push(e.dataIndex+":"+e.header)}}}if(GO.util.empty(this.title)){this.title=this.query}Ext.apply(this.loadParams,{task:"email_export_query",query:this.query,columns:d.join(","),title:this.title});if(this.subtitle){this.loadParams.subtitle=this.subtitle}if(this.text){this.loadParams.text=this.text}var a=this.formPanel.form.getValues();Ext.apply(this.loadParams,a)}});GO.WeekPicker=function(a){a=a||{};a.cls="go-weekpicker";a.items=[{iconCls:"btn-left-arrow",text:GO.lang.cmdPrevious,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,-7))},scope:this},this.periodInfoPanel=new Ext.Panel({plain:true,border:true,cls:"cal-period"}),{iconCls:"btn-right-arrow",text:GO.lang.cmdNext,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,7))},scope:this},{text:GO.lang.today,handler:function(){this.setDate()},scope:this}];GO.WeekPicker.superclass.constructor.call(this,a);this.addEvents({change:true})};Ext.extend(GO.WeekPicker,Ext.Toolbar,{sunday:false,setDate:function(c,d){if(!c){var b=new Date();c=b.getLastSunday()}if(this.fireEvent("beforechange",this,c,this.sunday)!==false){this.sunday=c;var a=this.sunday.add(Date.DAY,1);this.goToLink.update(GO.lang.strWeek+" "+a.format("W")+" ("+a.format(GO.settings.date_format)+")");if(!d){this.fireEvent("change",this,this.sunday)}}},getDate:function(){return this.sunday},afterRender:function(){GO.WeekPicker.superclass.afterRender.call(this);this.goToLink=Ext.DomHelper.append(this.periodInfoPanel.body,{tag:"a",href:"#",html:""},true);this.goToLink.on("click",function(){if(!this.gotoWeekDialog){this.gotoWeekDialog=new GO.GoToWeekDialog()}this.gotoWeekDialog.show(this)},this);this.setDate()}});GO.GoToWeekDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.formPanel.items.items[0].focus()};b.layout="fit";b.title=GO.projects.lang.goToWeek;b.modal=false;b.width=335;b.height=135;b.resizable=false;b.closeAction="hide";b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.GoToWeekDialog.superclass.constructor.call(this,b)};Ext.extend(GO.GoToWeekDialog,Ext.Window,{show:function(b){this.wp=b;if(!this.rendered){this.render(Ext.getBody())}var d=this.wp.periodInfoPanel.getPosition();this.setPosition(d[0],d[1]+20);this.formPanel.form.reset();var a=new Date(this.wp.sunday);var c=a.format("Y");this.year.setValue(c);this.setYear(c);GO.GoToWeekDialog.superclass.show.call(this)},buildForm:function(){this.formPanel=new Ext.form.FormPanel({cls:"go-form-panel",layout:"form",waitMsgTarget:true,labelWidth:50,border:false,anchor:"95% 95%",items:[this.year=new Ext.form.TextField({name:"year",fieldLabel:GO.lang.strYear,allowBlank:false,anchor:"95%",selectOnFocus:true}),this.selectWeek=new GO.form.ComboBox({fieldLabel:GO.lang.strWeek,hiddenName:"date",emptyText:GO.lang.selectWeek,store:new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"get_weeks"},root:"results",id:"value",totalProperty:"total",fields:["value","text"],remoteSort:true}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true,allowBlank:false,anchor:"95%"})]});this.year.on("change",function(){this.setYear(this.year.getValue())},this);this.selectWeek.on("select",function(c,b){var a=new Date(this.selectWeek.getValue()*1000);this.wp.setDate(a);this.hide()},this)},setYear:function(a){this.selectWeek.store.baseParams.year=a;this.selectWeek.store.load()}});GO.users.TimeZones=[["Africa/Abidjan"],["Africa/Accra"],["Africa/Addis_Ababa"],["Africa/Algiers"],["Africa/Asmara"],["Africa/Asmera"],["Africa/Bamako"],["Africa/Bangui"],["Africa/Banjul"],["Africa/Bissau"],["Africa/Blantyre"],["Africa/Brazzaville"],["Africa/Bujumbura"],["Africa/Cairo"],["Africa/Casablanca"],["Africa/Ceuta"],["Africa/Conakry"],["Africa/Dakar"],["Africa/Dar_es_Salaam"],["Africa/Djibouti"],["Africa/Douala"],["Africa/El_Aaiun"],["Africa/Freetown"],["Africa/Gaborone"],["Africa/Harare"],["Africa/Johannesburg"],["Africa/Kampala"],["Africa/Khartoum"],["Africa/Kigali"],["Africa/Kinshasa"],["Africa/Lagos"],["Africa/Libreville"],["Africa/Lome"],["Africa/Luanda"],["Africa/Lubumbashi"],["Africa/Lusaka"],["Africa/Malabo"],["Africa/Maputo"],["Africa/Maseru"],["Africa/Mbabane"],["Africa/Mogadishu"],["Africa/Monrovia"],["Africa/Nairobi"],["Africa/Ndjamena"],["Africa/Niamey"],["Africa/Nouakchott"],["Africa/Ouagadougou"],["Africa/Porto-Novo"],["Africa/Sao_Tome"],["Africa/Timbuktu"],["Africa/Tripoli"],["Africa/Tunis"],["Africa/Windhoek"],["America/Adak"],["America/Anchorage"],["America/Anguilla"],["America/Antigua"],["America/Araguaina"],["America/Argentina/Buenos_Aires"],["America/Argentina/Catamarca"],["America/Argentina/ComodRivadavia"],["America/Argentina/Cordoba"],["America/Argentina/Jujuy"],["America/Argentina/La_Rioja"],["America/Argentina/Mendoza"],["America/Argentina/Rio_Gallegos"],["America/Argentina/San_Juan"],["America/Argentina/Tucuman"],["America/Argentina/Ushuaia"],["America/Aruba"],["America/Asuncion"],["America/Atikokan"],["America/Atka"],["America/Bahia"],["America/Barbados"],["America/Belem"],["America/Belize"],["America/Blanc-Sablon"],["America/Boa_Vista"],["America/Bogota"],["America/Boise"],["America/Buenos_Aires"],["America/Cambridge_Bay"],["America/Campo_Grande"],["America/Cancun"],["America/Caracas"],["America/Catamarca"],["America/Cayenne"],["America/Cayman"],["America/Chicago"],["America/Chihuahua"],["America/Coral_Harbour"],["America/Cordoba"],["America/Costa_Rica"],["America/Cuiaba"],["America/Curacao"],["America/Danmarkshavn"],["America/Dawson"],["America/Dawson_Creek"],["America/Denver"],["America/Detroit"],["America/Dominica"],["America/Edmonton"],["America/Eirunepe"],["America/El_Salvador"],["America/Ensenada"],["America/Fort_Wayne"],["America/Fortaleza"],["America/Glace_Bay"],["America/Godthab"],["America/Goose_Bay"],["America/Grand_Turk"],["America/Grenada"],["America/Guadeloupe"],["America/Guatemala"],["America/Guayaquil"],["America/Guyana"],["America/Halifax"],["America/Havana"],["America/Hermosillo"],["America/Indiana/Indianapolis"],["America/Indiana/Knox"],["America/Indiana/Marengo"],["America/Indiana/Petersburg"],["America/Indiana/Vevay"],["America/Indiana/Vincennes"],["America/Indiana/Winamac"],["America/Indianapolis"],["America/Inuvik"],["America/Iqaluit"],["America/Jamaica"],["America/Jujuy"],["America/Juneau"],["America/Kentucky/Louisville"],["America/Kentucky/Monticello"],["America/Knox_IN"],["America/La_Paz"],["America/Lima"],["America/Los_Angeles"],["America/Louisville"],["America/Maceio"],["America/Managua"],["America/Manaus"],["America/Martinique"],["America/Mazatlan"],["America/Mendoza"],["America/Menominee"],["America/Merida"],["America/Mexico_City"],["America/Miquelon"],["America/Moncton"],["America/Monterrey"],["America/Montevideo"],["America/Montreal"],["America/Montserrat"],["America/Nassau"],["America/New_York"],["America/Nipigon"],["America/Nome"],["America/Noronha"],["America/North_Dakota/Center"],["America/North_Dakota/New_Salem"],["America/Panama"],["America/Pangnirtung"],["America/Paramaribo"],["America/Phoenix"],["America/Port-au-Prince"],["America/Port_of_Spain"],["America/Porto_Acre"],["America/Porto_Velho"],["America/Puerto_Rico"],["America/Rainy_River"],["America/Rankin_Inlet"],["America/Recife"],["America/Regina"],["America/Resolute"],["America/Rio_Branco"],["America/Rosario"],["America/Santiago"],["America/Santo_Domingo"],["America/Sao_Paulo"],["America/Scoresbysund"],["America/Shiprock"],["America/St_Johns"],["America/St_Kitts"],["America/St_Lucia"],["America/St_Thomas"],["America/St_Vincent"],["America/Swift_Current"],["America/Tegucigalpa"],["America/Thule"],["America/Thunder_Bay"],["America/Tijuana"],["America/Toronto"],["America/Tortola"],["America/Vancouver"],["America/Virgin"],["America/Whitehorse"],["America/Winnipeg"],["America/Yakutat"],["America/Yellowknife"],["Antarctica/Casey"],["Antarctica/Davis"],["Antarctica/DumontDUrville"],["Antarctica/Mawson"],["Antarctica/McMurdo"],["Antarctica/Palmer"],["Antarctica/Rothera"],["Antarctica/South_Pole"],["Antarctica/Syowa"],["Antarctica/Vostok"],["Arctic/Longyearbyen"],["Asia/Aden"],["Asia/Almaty"],["Asia/Amman"],["Asia/Anadyr"],["Asia/Aqtau"],["Asia/Aqtobe"],["Asia/Ashgabat"],["Asia/Ashkhabad"],["Asia/Baghdad"],["Asia/Bahrain"],["Asia/Baku"],["Asia/Bangkok"],["Asia/Beirut"],["Asia/Bishkek"],["Asia/Brunei"],["Asia/Calcutta"],["Asia/Choibalsan"],["Asia/Chongqing"],["Asia/Chungking"],["Asia/Colombo"],["Asia/Dacca"],["Asia/Damascus"],["Asia/Dhaka"],["Asia/Dili"],["Asia/Dubai"],["Asia/Dushanbe"],["Asia/Gaza"],["Asia/Harbin"],["Asia/Hong_Kong"],["Asia/Hovd"],["Asia/Irkutsk"],["Asia/Istanbul"],["Asia/Jakarta"],["Asia/Jayapura"],["Asia/Jerusalem"],["Asia/Kabul"],["Asia/Kamchatka"],["Asia/Karachi"],["Asia/Kashgar"],["Asia/Katmandu"],["Asia/Krasnoyarsk"],["Asia/Kuala_Lumpur"],["Asia/Kuching"],["Asia/Kuwait"],["Asia/Macao"],["Asia/Macau"],["Asia/Magadan"],["Asia/Makassar"],["Asia/Manila"],["Asia/Muscat"],["Asia/Nicosia"],["Asia/Novosibirsk"],["Asia/Omsk"],["Asia/Oral"],["Asia/Phnom_Penh"],["Asia/Pontianak"],["Asia/Pyongyang"],["Asia/Qatar"],["Asia/Qyzylorda"],["Asia/Rangoon"],["Asia/Riyadh"],["Asia/Saigon"],["Asia/Sakhalin"],["Asia/Samarkand"],["Asia/Seoul"],["Asia/Shanghai"],["Asia/Singapore"],["Asia/Taipei"],["Asia/Tashkent"],["Asia/Tbilisi"],["Asia/Tehran"],["Asia/Tel_Aviv"],["Asia/Thimbu"],["Asia/Thimphu"],["Asia/Tokyo"],["Asia/Ujung_Pandang"],["Asia/Ulaanbaatar"],["Asia/Ulan_Bator"],["Asia/Urumqi"],["Asia/Vientiane"],["Asia/Vladivostok"],["Asia/Yakutsk"],["Asia/Yekaterinburg"],["Asia/Yerevan"],["Atlantic/Azores"],["Atlantic/Bermuda"],["Atlantic/Canary"],["Atlantic/Cape_Verde"],["Atlantic/Faeroe"],["Atlantic/Faroe"],["Atlantic/Jan_Mayen"],["Atlantic/Madeira"],["Atlantic/Reykjavik"],["Atlantic/South_Georgia"],["Atlantic/St_Helena"],["Atlantic/Stanley"],["Australia/ACT"],["Australia/Adelaide"],["Australia/Brisbane"],["Australia/Broken_Hill"],["Australia/Canberra"],["Australia/Currie"],["Australia/Darwin"],["Australia/Eucla"],["Australia/Hobart"],["Australia/LHI"],["Australia/Lindeman"],["Australia/Lord_Howe"],["Australia/Melbourne"],["Australia/North"],["Australia/NSW"],["Australia/Perth"],["Australia/Queensland"],["Australia/South"],["Australia/Sydney"],["Australia/Tasmania"],["Australia/Victoria"],["Australia/West"],["Australia/Yancowinna"],["Brazil/Acre"],["Brazil/DeNoronha"],["Brazil/East"],["Brazil/West"],["Canada/Atlantic"],["Canada/Central"],["Canada/East-Saskatchewan"],["Canada/Eastern"],["Canada/Mountain"],["Canada/Newfoundland"],["Canada/Pacific"],["Canada/Saskatchewan"],["Canada/Yukon"],["CET"],["Chile/Continental"],["Chile/EasterIsland"],["CST6CDT"],["Cuba"],["EET"],["Egypt"],["Eire"],["EST"],["EST5EDT"],["Etc/GMT"],["Etc/GMT0"],["Etc/Greenwich"],["Etc/UCT"],["Etc/Universal"],["Etc/UTC"],["Etc/Zulu"],["Europe/Amsterdam"],["Europe/Andorra"],["Europe/Athens"],["Europe/Belfast"],["Europe/Belgrade"],["Europe/Berlin"],["Europe/Bratislava"],["Europe/Brussels"],["Europe/Bucharest"],["Europe/Budapest"],["Europe/Chisinau"],["Europe/Copenhagen"],["Europe/Dublin"],["Europe/Gibraltar"],["Europe/Guernsey"],["Europe/Helsinki"],["Europe/Isle_of_Man"],["Europe/Istanbul"],["Europe/Jersey"],["Europe/Kaliningrad"],["Europe/Kiev"],["Europe/Lisbon"],["Europe/Ljubljana"],["Europe/London"],["Europe/Luxembourg"],["Europe/Madrid"],["Europe/Malta"],["Europe/Mariehamn"],["Europe/Minsk"],["Europe/Monaco"],["Europe/Moscow"],["Europe/Nicosia"],["Europe/Oslo"],["Europe/Paris"],["Europe/Podgorica"],["Europe/Prague"],["Europe/Riga"],["Europe/Rome"],["Europe/Samara"],["Europe/San_Marino"],["Europe/Sarajevo"],["Europe/Simferopol"],["Europe/Skopje"],["Europe/Sofia"],["Europe/Stockholm"],["Europe/Tallinn"],["Europe/Tirane"],["Europe/Tiraspol"],["Europe/Uzhgorod"],["Europe/Vaduz"],["Europe/Vatican"],["Europe/Vienna"],["Europe/Vilnius"],["Europe/Volgograd"],["Europe/Warsaw"],["Europe/Zagreb"],["Europe/Zaporozhye"],["Europe/Zurich"],["Factory"],["GB"],["GB-Eire"],["GMT+0"],["GMT-0"],["GMT0"],["Greenwich"],["Hongkong"],["HST"],["Iceland"],["Indian/Antananarivo"],["Indian/Chagos"],["Indian/Christmas"],["Indian/Cocos"],["Indian/Comoro"],["Indian/Kerguelen"],["Indian/Mahe"],["Indian/Maldives"],["Indian/Mauritius"],["Indian/Mayotte"],["Indian/Reunion"],["Iran"],["Israel"],["Jamaica"],["Japan"],["Kwajalein"],["Libya"],["MET"],["Mexico/BajaNorte"],["Mexico/BajaSur"],["Mexico/General"],["MST"],["MST7MDT"],["Navajo"],["NZ"],["NZ-CHAT"],["Pacific/Apia"],["Pacific/Auckland"],["Pacific/Chatham"],["Pacific/Easter"],["Pacific/Efate"],["Pacific/Enderbury"],["Pacific/Fakaofo"],["Pacific/Fiji"],["Pacific/Funafuti"],["Pacific/Galapagos"],["Pacific/Gambier"],["Pacific/Guadalcanal"],["Pacific/Guam"],["Pacific/Honolulu"],["Pacific/Johnston"],["Pacific/Kiritimati"],["Pacific/Kosrae"],["Pacific/Kwajalein"],["Pacific/Majuro"],["Pacific/Marquesas"],["Pacific/Midway"],["Pacific/Nauru"],["Pacific/Niue"],["Pacific/Norfolk"],["Pacific/Noumea"],["Pacific/Pago_Pago"],["Pacific/Palau"],["Pacific/Pitcairn"],["Pacific/Ponape"],["Pacific/Port_Moresby"],["Pacific/Rarotonga"],["Pacific/Saipan"],["Pacific/Samoa"],["Pacific/Tahiti"],["Pacific/Tarawa"],["Pacific/Tongatapu"],["Pacific/Truk"],["Pacific/Wake"],["Pacific/Wallis"],["Pacific/Yap"],["Poland"],["Portugal"],["PRC"],["PST8PDT"],["ROC"],["ROK"],["Singapore"],["Turkey"],["UCT"],["Universal"],["US/Alaska"],["US/Aleutian"],["US/Arizona"],["US/Central"],["US/East-Indiana"],["US/Eastern"],["US/Hawaii"],["US/Indiana-Starke"],["US/Michigan"],["US/Mountain"],["US/Pacific"],["US/Pacific-New"],["US/Samoa"],["W-SU"],["WET"],["Zulu"]];GO.PersonalSettingsDialog=function(a){if(!a){a={}}this.buildForm();a.layout="fit";a.modal=false;a.resizable=true;a.maxizable=true;a.width=900;a.height=520;a.closeAction="hide";a.title=GO.lang.settings;a.items=this.formPanel;a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.PersonalSettingsDialog.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.PersonalSettingsDialog,GO.Window,{reload:false,show:function(){this.reload=false;if(!this.rendered){this.render(Ext.getBody());this.tabPanel.items.items[0].languageCombo.on("change",function(){this.reload=true},this);if(this.tabPanel.items.items[1].themeCombo){this.tabPanel.items.items[1].themeCombo.on("change",function(){this.reload=true},this)}}this.formPanel.form.baseParams.user_id=GO.settings.user_id;this.user_id=GO.settings.user_id;if(!this.loaded){this.formPanel.load({url:BaseHref+"json.php",success:function(d,e){this.loaded=true;GO.PersonalSettingsDialog.superclass.show.call(this);for(var b=0;b<this.tabPanel.items.getCount();b++){var a=this.tabPanel.items.itemAt(b);if(a.onLoadSettings){var c=a.onLoadSettings.createDelegate(a,[e]);c.call()}}},failure:function(a,b){Ext.Msg.alert(GO.lang.strError,b.result.feedback)},scope:this})}else{GO.PersonalSettingsDialog.superclass.show.call(this)}},setWritePermission:function(a){this.buttons[0].setDisabled(!a);this.buttons[1].setDisabled(!a);this.linksPanel.setWritePermission(a)},submitForm:function(d){for(var c=0;c<this.tabPanel.items.getCount();c++){var b=this.tabPanel.items.itemAt(c);if(b.onBeforeSaveSettings){var e=b.onBeforeSaveSettings.createDelegate(b,[this]);var a=e.call();if(!a){this.tabPanel.setActiveTab(b);return false}}}this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_settings"},waitMsg:GO.lang.waitMsgSave,success:function(k,l){this.fireEvent("save",this);for(var g=0;g<this.tabPanel.items.getCount();g++){var f=this.tabPanel.items.itemAt(g);if(f.onSaveSettings){var j=f.onSaveSettings.createDelegate(f,[l]);j.call()}}GO.settings.mute_sound=this.formPanel.form.findField("mute_sound").getValue();GO.settings.popup_reminders=this.formPanel.form.findField("popup_reminders").getValue();if(this.reload){document.location=GO.settings.config.host}else{if(d){this.hide()}}},failure:function(f,g){if(g.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,g.result.feedback)}},scope:this})},buildForm:function(){this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,anchor:"100% 100%",enableTabScroll:true,border:false,items:GO.moduleManager.getAllSettingsPanels()});this.formPanel=new Ext.form.FormPanel({items:this.tabPanel,baseParams:{task:"settings"},waitMsgTarget:true,border:false})}});GO.users.RegionalSettingsPanel=function(d){if(!d){d={}}this.autoScroll=true;var e=new Ext.data.SimpleStore({fields:["id","date_format"],data:[["dmY",GO.users.lang.dmy],["mdY",GO.users.lang.mdy],["Ymd",GO.users.lang.jmd]]});var f=new Ext.data.SimpleStore({fields:["id","date_separator"],data:[["-","-"],[".","."],["/","/"]]});var b=new Ext.data.SimpleStore({fields:["id","time_format"],data:[["G:i",GO.users.lang.fullhourformat],["g:i a",GO.users.lang.halfhourformat]]});var c=new Ext.data.SimpleStore({fields:["id","first_weekday"],data:[["0",GO.users.lang.sunday],["1",GO.users.lang.monday]]});var a=GO.settings.date_format.substring(0,1)+GO.settings.date_format.substring(2,3)+GO.settings.date_format.substring(4,5);d.border=false;d.hideLabel=true;d.title=GO.users.lang.regionalSettings;d.layout="column";d.defaults={columnWidth:0.5,cls:"go-form-panel",border:false};d.labelWidth=190;d.items=[{columnWidth:1,items:[{border:false,layout:"form",autoHeight:true,defaults:{anchor:"100%"},items:[this.languageCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelLanguage,name:"language_id",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),displayField:"language",valueField:"id",hiddenName:"language",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.language}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTimezone,name:"timezone",store:new Ext.data.SimpleStore({fields:["timezone"],data:GO.users.TimeZones}),displayField:"timezone",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:GO.settings.timezone}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateFormat,name:"date_format",store:e,displayField:"date_format",value:a,valueField:"id",hiddenName:"date_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateSeperator,name:"date_separator_name",store:f,displayField:"date_separator",value:GO.settings.date_separator,valueField:"id",hiddenName:"date_separator",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.timeFormat,name:"time_format_name",store:b,displayField:"time_format",valueField:"id",hiddenName:"time_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,value:GO.settings.time_format,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelFirstWeekday,name:"first_weekday_name",store:c,displayField:"first_weekday",valueField:"id",hiddenName:"first_weekday",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.first_weekday})]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.numberFormat,items:[{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelThousandSeperator,name:"thousands_separator",value:GO.settings.thousands_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelDecimalSeperator,name:"decimal_separator",value:GO.settings.decimal_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelCurrency,name:"currency",value:GO.settings.currency}]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.importExport,items:[{xtype:"textfield",fieldLabel:GO.users.lang.listSeparator,name:"list_separator",value:GO.settings.list_separator},{xtype:"textfield",fieldLabel:GO.users.lang.textSeparator,name:"text_separator",value:GO.settings.text_separator}]}]}];GO.users.RegionalSettingsPanel.superclass.constructor.call(this,d)};Ext.extend(GO.users.RegionalSettingsPanel,Ext.Panel,{});GO.users.LookAndFeelPanel=function(b){if(!b){b={}}this.autoScroll=true;b.border=false;b.hideLabel=true;b.title=GO.users.lang.cmdPanelLookFeel;b.layout="form";b.defaults={anchor:"100%"};b.defaultType="textfield";b.cls="go-form-panel";b.labelWidth=190;var a=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"themes"},root:"results",totalProperty:"total",fields:["theme"],remoteSort:true});this.modulesStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"start_module",user_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});b.items=[];if(GO.settings.config.allow_themes){b.items.push(this.themeCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTheme,name:"theme",store:a,displayField:"theme",valueField:"theme",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.config.theme}))}b.items.push(this.startModuleField=new GO.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelStartModule,name:"start_module_name",hiddenName:"start_module",store:this.modulesStore,displayField:"name",valueField:"id",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.start_module}));b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelMaximunRows,store:new Ext.data.SimpleStore({fields:["value"],data:[["10"],["15"],["20"],["25"],["30"],["50"]]}),displayField:"value",valueField:"value",name:"max_rows_list",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:20});b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelSortNamesBy,store:new Ext.data.SimpleStore({fields:["value","text"],data:[["first_name",GO.users.lang.firstName],["last_name",GO.users.lang.lastName]]}),displayField:"text",valueField:"value",hiddenName:"sort_name",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.sort_name});b.items.push({xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.muteSound,name:"mute_sound"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.popupNotification,name:"popup_reminders"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.mailReminders,name:"mail_reminders"});GO.users.LookAndFeelPanel.superclass.constructor.call(this,b)};Ext.extend(GO.users.LookAndFeelPanel,Ext.Panel,{onLoadSettings:function(a){this.startModuleField.setRemoteText(a.result.data.start_module_name)}});GO.users.PasswordPanel=function(a){if(!a){a={}}var b=(a.ldap_password)?"ldap_":"";a.autoScroll=true;a.border=false;a.hideLabel=true;a.title=GO.users.lang.changePassword;a.layout="form";a.defaults={anchor:"100%"};a.defaultType="textfield";a.cls="go-form-panel";a.labelWidth=140;this.currentPasswordField=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.currentPassword,name:"current_"+b+"password"});this.passwordField1=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.newPassword,name:b+"password1"});this.passwordField2=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.confirmPassword,name:b+"password2"});a.items=[this.currentPasswordField,this.passwordField1,this.passwordField2];GO.users.PasswordPanel.superclass.constructor.call(this,a)};Ext.extend(GO.users.PasswordPanel,Ext.Panel,{onSaveSettings:function(){this.currentPasswordField.reset();this.passwordField1.reset();this.passwordField2.reset()}});GO.mainLayout.onReady(function(){GO.moduleManager.addSettingsPanel("regional",GO.users.RegionalSettingsPanel);GO.moduleManager.addSettingsPanel("look_and_feel",GO.users.LookAndFeelPanel);if(GO.settings.config.allow_profile_edit){GO.moduleManager.addSettingsPanel("profile",GO.users.ProfilePanel)}if(GO.settings.config.allow_password_change&&(!GO.ldapemail||(GO.ldapemail&&!GO.ldapemail.ldapUser))){GO.moduleManager.addSettingsPanel("password",GO.users.PasswordPanel)}});GO.users.ProfilePanel=function(a){if(!a){a={}}a.autoScroll=true;a.border=false;a.hideLabel=true;if(!a.title){a.title=GO.users.lang.profile}a.layout="form";a.labelWidth=125;a.defaults={anchor:"98%"};a.bodyStyle="padding:5px";a.items=[{xtype:"fieldset",title:GO.users.lang.personalProfile,autoHeight:true,layout:"fit",items:[new GO.users.PersonalPanel({cb_id:"user_countryCombo"})]},{xtype:"fieldset",title:GO.users.lang.companyProfile,autoHeight:true,layout:"fit",items:[new GO.users.CompanyPanel({cb_id:"user_work_countryCombo"})]}];GO.users.ProfilePanel.superclass.constructor.call(this,a)};Ext.extend(GO.users.ProfilePanel,Ext.Panel,{});GO.users.PersonalPanel=function(b){if(!b){b={}}b.border=false;b.hideLabel=true;b.layout="column";b.labelWidth=120;b.autoHeight=true;this.comboBoxId=b.cb_id;var a=[{fieldLabel:GO.lang.strAddress,name:"address"},{fieldLabel:GO.lang.strAddressNo,name:"address_no"},{fieldLabel:GO.lang.strZip,name:"zip"},{fieldLabel:GO.lang.strCity,name:"city"},{fieldLabel:GO.lang.strState,name:"state"},new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,id:this.comboBoxId,hiddenName:"country",value:GO.settings.country}),new GO.form.HtmlComponent({html:"<br />"})];a.push({fieldLabel:GO.lang.strFax,name:"fax"});a.push({fieldLabel:GO.lang.strCellular,name:"cellular"});b.items=[{columnWidth:0.5,layout:"form",border:false,bodyStyle:"padding-right:5px",waitMsgTarget:true,defaults:{anchor:"100%"},defaultType:"textfield",items:[{fieldLabel:GO.lang.strFirstName,name:"first_name",allowBlank:false},{fieldLabel:GO.lang.strMiddleName,name:"middle_name"},{fieldLabel:GO.lang.strLastName,name:"last_name",allowBlank:false},{fieldLabel:GO.lang.strTitle,name:"title"},{fieldLabel:GO.lang.strInitials,name:"initials"},new Ext.form.ComboBox({fieldLabel:GO.lang.strSex,hiddenName:"sex",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["M",GO.lang.strMale],["F",GO.lang.strFemale]]}),value:"M",valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.DateField({fieldLabel:GO.lang.strBirthday,name:"birthday",format:GO.settings.date_format}),new GO.form.HtmlComponent({html:"<br />"}),{fieldLabel:GO.lang.strEmail,name:"email",allowBlank:false,vtype:"email"},{fieldLabel:GO.lang.strPhone,name:"home_phone"}]},{columnWidth:0.5,bodyStyle:"padding-left:5px",layout:"form",border:false,waitMsgTarget:true,defaults:{anchor:"100%",allowBlank:true},defaultType:"textfield",items:a}];GO.users.PersonalPanel.superclass.constructor.call(this,b)};Ext.extend(GO.users.PersonalPanel,Ext.Panel,{});GO.users.CompanyPanel=function(a){if(!a){a={}}a.autoScroll=true;a.border=false;a.hideLabel=true;a.layout="column";a.labelWidth=120;this.comboBoxId=a.cb_id;a.items=[{columnWidth:0.5,layout:"form",border:false,bodyStyle:"padding-right:5px",waitMsgTarget:true,defaults:{anchor:"100%"},defaultType:"textfield",items:[{fieldLabel:GO.lang.strCompany,name:"company"},{fieldLabel:GO.lang.strDepartment,name:"department"},{fieldLabel:GO.lang.strFunction,name:"function"},{fieldLabel:GO.lang.strWorkAddress,name:"work_address"},{fieldLabel:GO.lang.strWorkAddressNo,name:"work_address_no"},{fieldLabel:GO.lang.strWorkZip,name:"work_zip"}]},{columnWidth:0.5,layout:"form",border:false,bodyStyle:"padding-left:5px",waitMsgTarget:true,defaults:{anchor:"100%"},defaultType:"textfield",items:[{fieldLabel:GO.lang.strWorkCity,name:"work_city"},{fieldLabel:GO.lang.strWorkState,name:"work_state"},new GO.form.SelectCountry({fieldLabel:GO.lang.strWorkCountry,id:this.comboBoxId,hiddenName:"work_country",value:GO.settings.country}),{fieldLabel:GO.lang.strWorkPhone,name:"work_phone"},{fieldLabel:GO.lang.strWorkFax,name:"work_fax"},{fieldLabel:GO.users.lang.cmdFormLabelHomepage,name:"homepage"}]}];GO.users.CompanyPanel.superclass.constructor.call(this,a)};Ext.extend(GO.users.CompanyPanel,Ext.Panel,{});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.AboutDialog=function(a){Ext.apply(this,a);GO.dialog.AboutDialog.superclass.constructor.call(this,{modal:false,layout:"fit",height:500,width:520,resizable:false,closeAction:"hide",title:GO.lang.strAbout.replace("{product_name}",GO.settings.config.product_name),items:new Ext.Panel({border:false,layout:"fit",autoLoad:"about.php",autoScroll:true}),buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.AboutDialog,Ext.Window,{});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.LoginDialog=function(b){if(!b){b={}}if(typeof(b.modal)=="undefined"){b.modal=true}Ext.apply(this,b);var a=new Ext.form.ComboBox({fieldLabel:GO.lang.strLanguage,name:"language_text",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),anchor:"100%",hiddenName:"language",displayField:"language",valueField:"id",mode:"local",triggerAction:"all",forceSelection:true,editable:false,value:GO.settings.language});a.on("select",function(){document.location=BaseHref+"index.php?SET_LANGUAGE="+a.getValue()},this);this.formPanel=new Ext.FormPanel({labelWidth:120,url:"action.php",defaultType:"textfield",waitMsgTarget:true,bodyStyle:"padding:5px 10px 5px 10px",items:[new GO.LogoComponent(),a,{fieldLabel:GO.lang.strUsername,name:"username",allowBlank:false,anchor:"100%"},{fieldLabel:GO.lang.strPassword,name:"password",inputType:"password",allowBlank:false,anchor:"100%"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.lang.remindPassword,name:"remind",height:20},this.fullscreenField=new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.lang.fullscreen,checked:GO.fullscreen,name:"fullscreen",height:20})]});GO.dialog.LoginDialog.superclass.constructor.call(this,{autoHeight:true,width:400,draggable:false,resizable:false,closeAction:"hide",title:GO.lang.strLogin,closable:false,items:[this.formPanel],buttons:[{text:GO.lang.lostPassword,handler:function(){Ext.Msg.prompt(GO.lang.lostPassword,GO.lang.lostPasswordText.replace("{product_name}",GO.settings.config.product_name),function(c,d){if(c=="ok"){this.hide();Ext.getBody().mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:"action.php",scope:this,params:{task:"lost_password",email:d},callback:function(f,j,e){Ext.getBody().unmask();this.show();if(!j){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(e.responseText);if(!g.success){Ext.MessageBox.alert(GO.lang.strError,g.feedback)}else{Ext.MessageBox.alert(GO.lang.strSuccess,g.feedback)}}}})}},this)},scope:this},{text:GO.lang.cmdOk,handler:this.doLogin,scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:this.doLogin,scope:this}]});this.addEvents({callbackshandled:true})};Ext.extend(GO.dialog.LoginDialog,GO.Window,{callbacks:new Array(),hideDialog:true,focus:function(){this.formPanel.form.findField("username").focus(true)},addCallback:function(b,a){this.callbacks.push({callback:b,scope:a})},doLogin:function(){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"login"},waitMsg:GO.lang.waitMsgLoad,success:function(a,b){if(GO.settings.user_id>0&&b.result.user_id!=GO.settings.user_id){document.location=document.location;return true}Ext.apply(GO.settings,b.result.settings);if(b.result.name==""){this.completeProfileDialog();this.profileFormPanel.form.setValues({email:b.result.email})}else{this.handleCallbacks()}if(this.hideDialog){this.hide()}},failure:function(a,b){if(b.result){Ext.MessageBox.alert(GO.lang.strError,b.result.feedback,function(){this.formPanel.form.findField("username").focus(true)},this)}},scope:this})},handleCallbacks:function(){for(var a=0;a<this.callbacks.length;a++){if(this.callbacks[a].callback){var b=this.callbacks[a].scope?this.callbacks[a].scope:this;this.callbacks[a].callback.call(b)}}this.callbacks=[];this.fireEvent("callbackshandled",this)},completeProfileDialog:function(){var a=function(){this.profileFormPanel.form.findField("first_name").focus()};this.profileFormPanel=new Ext.form.FormPanel({items:new GO.users.ProfilePanel({header:false}),baseParams:{task:"complete_profile"},url:BaseHref+"action.php",waitMsgTarget:true,border:false});this.completeProfileDialog=new Ext.Window({width:900,title:GO.lang.completeProfile,autoHeight:true,items:this.profileFormPanel,closable:false,focus:a.createDelegate(this),buttons:[{text:GO.lang.cmdOk,handler:function(){this.profileFormPanel.form.submit({waitMsg:GO.lang.waitMsgSave,success:function(c,d){this.fireEvent("save",this);if(this.profileFormPanel.onSaveSettings){var b=this.profileFormPanel.onSaveSettings.createDelegate(this.profileFormPanel,[d]);b.call()}if(this.reload){document.location=GO.settings.config.host}this.hide();this.handleCallbacks()},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},scope:this}]});this.completeProfileDialog.show()}});GO.data.JsonStore=function(a){GO.data.JsonStore.superclass.constructor.call(this,a);this.on("load",function(){this.loaded=true},this);this.on("loadexception",function(d,c,b,f){if(b.status==0){GO.errorDialog.show(GO.lang.strRequestError,"")}else{if(!this.reader.jsonData||GO.jsonAuthHandler(this.reader.jsonData,this.load,this)){switch(b.responseText.trim()){case"NOTLOGGEDIN":document.location=BaseHref;break;case"UNAUTHORIZED":Ext.Msg.alert(GO.lang.strUnauthorized,GO.lang.strUnauthorizedText);break;default:var g=GO.lang.serverError;if(this.reader.jsonData&&this.reader.jsonData.feedback){g+="<br /><br />"+this.reader.jsonData.feedback}g+="<br /><br />JsonStore load exception occurred";GO.errorDialog.show(g,b.responseText);break}}}},this)};Ext.extend(GO.data.JsonStore,Ext.data.JsonStore,{loaded:false});GO.grid.GridPanel=function(a){if(!a){a={}}if(!a.keys){a.keys=[]}if(!a.store){a.store=a.ds}a.keys.push({key:Ext.EventObject.DELETE,fn:function(b,c){if(c.target.tagName!="INPUT"){this.deleteSelected(this.deleteConfig)}},scope:this});if(a.paging){if(!a.bbar){if(typeof(a.paging)=="boolean"){a.paging=parseInt(GO.settings.max_rows_list)}a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:a.paging,displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems})}if(!a.store.baseParams){a.store.baseParams={}}a.store.baseParams.limit=parseInt(GO.settings.max_rows_list)}GO.grid.GridPanel.superclass.constructor.call(this,a);this.addEvents({delayedrowselect:true});this.on("rowcontextmenu",function(b,f,c){c.stopEvent();this.rowClicked=true;var d=this.getSelectionModel();if(d.isSelected(f)!==true){d.clearSelections();d.selectRow(f)}},this);this.on("rowclick",function(c,f,d){var b=this.getSelectionModel().getSelected();if(!d.ctrlKey&&!d.shiftKey){if(b){this.fireEvent("delayedrowselect",this,f,b)}}if(b){this.rowClicked=true}},this);this.getSelectionModel().on("rowselect",function(e,d,c){if(!this.rowClicked){var b=this.getSelectionModel().getSelected();if(b==c){this.fireEvent("delayedrowselect",this,d,c)}}this.rowClicked=false},this,{delay:250})};Ext.extend(GO.grid.GridPanel,Ext.grid.GridPanel,{deleteConfig:{},paging:false,deleteSelected:function(b){b=b||{};Ext.apply(b,this.deleteConfig);if(!b.deleteParam){b.deleteParam="delete_keys"}var c={};c[b.deleteParam]=Ext.encode(this.selModel.selections.keys);var a={store:this.store,params:c,count:this.selModel.selections.keys.length,extraWarning:b.extraWarning||"",noConfirmation:b.noConfirmation};if(b.callback){a.callback=b.callback}if(b.success){a.success=b.success}if(b.failure){a.failure=b.failure}if(b.scope){a.scope=b.scope}GO.deleteItems(a)},getGridData:function(){var d={};for(var b=0;b<this.store.data.items.length;b++){var c=this.store.data.items[b].data;d[b]={};for(var a in c){d[b][a]=c[a]}}return d},numberRenderer:function(a){return GO.util.numberFormat(a)}});GO.grid.EditorGridPanel=function(a){if(!a){a={}}if(!a.keys){a.keys=[]}if(!a.store){a.store=a.ds}a.keys.push({key:Ext.EventObject.DELETE,fn:function(b,c){if(c.target.tagName!="INPUT"){this.deleteSelected(this.deleteConfig)}},scope:this});if(a.paging){if(!a.bbar){a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems})}if(!a.store.baseParams){a.store.baseParams={}}a.store.baseParams.limit=parseInt(GO.settings.max_rows_list)}GO.grid.EditorGridPanel.superclass.constructor.call(this,a);this.addEvents({delayedrowselect:true});this.on("rowclick",function(c,f,d){if(!d.ctrlKey&&!d.shiftKey){var b=this.getSelectionModel().getSelected();this.fireEvent("delayedrowselect",this,f,b)}this.rowClicked=true},this);this.getSelectionModel().on("rowselect",function(e,d,c){if(!this.rowClicked){var b=this.getSelectionModel().getSelected();if(b==c){this.fireEvent("delayedrowselect",this,d,c)}}this.rowClicked=false},this,{delay:250})};Ext.extend(GO.grid.EditorGridPanel,Ext.grid.EditorGridPanel,{deleteConfig:{},paging:false,deleteSelected:GO.grid.GridPanel.prototype.deleteSelected,getGridData:GO.grid.GridPanel.prototype.getGridData,numberRenderer:GO.grid.GridPanel.prototype.numberRenderer,isCellValid:function(c,e){if(!this.colModel.isCellEditable(c,e)){return true}var b=this.colModel.getCellEditor(c,e);if(!b){return true}var a=this.store.getAt(e);if(!a){return true}var d=this.colModel.getDataIndex(c);b.field.setValue(a.data[d]);return b.field.isValid(true)},isValid:function(g){var e=this.colModel.getColumnCount();var d=this.store.getCount();var b,f;var a=true;for(b=0;b<d;b++){for(f=0;f<e;f++){a=this.isCellValid(f,b);if(!a){break}}if(!a){break}}if(g&&!a){this.startEditing(b,f)}return a}});GO.grid.MultiSelectGrid=function(a){a=a||{};var b=new GO.grid.CheckColumn({header:"&nbsp;",dataIndex:"checked",width:30,listeners:{scope:this,change:function(c){c.commit();this.lastRecordClicked=c;this.applyFilter()}}});if(a.allowNoSelection){this.allowNoSelection=true}Ext.apply(a,{border:false,plugins:[b],tbar:[{text:GO.lang.selectAll,handler:function(){this.applyFilter("all")},scope:this}],layout:"fit",cls:"go-grid3-hide-headers",autoScroll:true,columns:[b,{header:GO.lang.strName,dataIndex:"name",id:"name"}],listeners:{scope:this,delayedrowselect:function(c,e,d){this.applyFilter([d.id])}},autoExpandColumn:"name",sm:new Ext.grid.RowSelectionModel()});GO.grid.MultiSelectGrid.superclass.constructor.call(this,a);this.addEvents({change:true})};Ext.extend(GO.grid.MultiSelectGrid,GO.grid.GridPanel,{allowNoSelection:false,lastRecordClicked:false,lastSelectedIndex:-1,applyFilter:function(k,j){this.lastSelectedIndex=-1;var b=[],a=[],g,c,e;for(var d=0,f=this.store.data.items.length;d<f;d++){c=this.store.data.items[d].id;e=k&&k!="clear"&&(k=="all"||k.indexOf(c)>-1);if(k&&!e){g=false;if(this.store.data.items[d].data.checked){if(k!="clear"){this.store.data.items[d].set("checked","0");this.store.data.items[d].commit()}else{this.store.data.items[d].data.checked="0"}}}else{if(e){g="1";if(GO.util.empty(this.store.data.items[d].data.checked)){if(k!="all"){this.store.data.items[d].set("checked","1");this.store.data.items[d].commit()}else{this.store.data.items[d].data.checked="1"}}this.lastSelectedIndex=d}else{g=this.store.data.items[d].data.checked}}if(g=="1"){a.push(this.store.data.items[d].id);b.push(this.store.data.items[d])}}if(!this.allowNoSelection&&(a.length==0)){alert(GO.lang.noItemSelectedWarning);if(this.lastRecordClicked){this.lastRecordClicked.set("checked","1");this.lastRecordClicked.commit()}this.lastRecordClicked=false;this.store.rejectChanges()}else{if(!j){this.fireEvent("change",this,a,b)}this.store.commitChanges();if(k=="all"||k=="clear"){this.getView().refresh()}this.getSelectionModel().clearSelections()}if(this.lastSelectedIndex>-1){this.getView().focusRow(this.lastSelectedIndex)}}});Ext.grid.GroupSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div id="x-grid3-summary-row-'+this.grid.id+'" class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||l.renderer)(d.data[l.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b.summaryType){g[o.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},doGroupEnd:function(a,d,b,f,c){var e=this.calculate(d.rs,b);a.push("</div>",this.renderSummary({data:e},b),"</div>")},doWidth:function(e,b,d){var c=this.view.getGroups(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getGroups(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getGroups(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a))},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=document.getElementById(d);if(!f){return false}var b=[];this.grid.store.each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData();var j=this.calculate(b,c);var a=this.renderSummary({data:j},c);var e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){this.refreshSummaryById(a._groupId)},doRemove:function(d,a,b,c){if(!c){this.refreshSummaryById(a._groupId)}},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.layout=this.layout.createDelegate(this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("refreshRow",this.refreshSummary,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||l.renderer)(d.data[l.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="-"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b&&b.summaryType){g[o.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},layout:function(){if(!this.view.summary){this.view.summary=Ext.DomHelper.insertAfter(this.view.mainBody.dom.parentNode,{tag:"div"},true)}if(!this.view.mainBody){return}var f=this.grid;var l=f.getGridEl(),o=this.cm,b=f.autoExpandColumn,a=this.view;var d=l.getSize(true);var n=d.width;if(!n||!d.height){return}if(f.autoHeight){this.view.scroller.dom.style.overflow="visible"}else{var k=this.view.summary.getHeight();var j=this.view.mainHd.getHeight();this.view.el.setSize(d.width,d.height+k);var e=d.height-(j)-(k);this.view.scroller.setSize(n,e);this.view.innerHd.style.width=(n)+"px"}if(this.view.forceFit){if(this.view.lastViewWidth!=n){this.view.fitColumns(false,false);this.view.lastViewWidth=n}}else{this.view.autoExpand()}this.view.onLayout(n,e)},doWidth:function(e,b,d){var c=this.view.getRows(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getRows(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getRows(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(){var f=this.grid,k=f.colModel,b=f.store,o=f.stripeRows;var l=k.getColumnCount();if(b.getCount()<1){return""}var j=this.view.getColumnData();var n=n||0;var d=typeof d=="undefined"?b.getCount()-1:d;var c=b.getRange();var a=[];var e=this.calculate(c,j);a.push("</div>",this.renderSummary({data:e},j),"</div>");this.view.summary.update(a.join(""));this.view.layout()},getSummaryNode:function(){return this.view.summary},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary.Calculations={sum:function(b,a,c){return GO.util.numberFormat(GO.util.unlocalizeNumber(b)+(GO.util.unlocalizeNumber(a.data[c])||0))},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=GO.util.unlocalizeNumber(b.data[e]);var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return GO.util.numberFormat(c>a?(d[e+"max"]=c):a)},min:function(b,a,e,d){var b=GO.util.unlocalizeNumber(a.data[e]);var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return GO.util.numberFormat(b<c?(d[e+"min"]=b):c)},average:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(GO.util.unlocalizeNumber(a.data[f])||0)));return GO.util.numberFormat(d===0?0:d/g)}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(b,d){var a=this.view.getGroupField();var c=b[0].data[a];var e=this.getSummaryData(c);return e||Ext.grid.HybridSummary.superclass.calculate.call(this,b,d)},updateSummaryData:function(a,d,c){var b=this.grid.store.reader.jsonData;if(!b.summaryData){b.summaryData={}}b.summaryData[a]=d;if(!c){this.refreshSummary(a)}},getSummaryData:function(a){var b=this.grid.store.reader.jsonData;if(b&&b.summaryData){return b.summaryData[a]}return null}});GO.grid.RemoteGridTotals=function(a){Ext.apply(this,a)};Ext.extend(GO.grid.RemoteGridTotals,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.layout=this.layout.createDelegate(this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("refreshRow",this.refreshSummary,this);a.afterMethod("onColumnWidthUpdated",this.refreshSummary,this);a.afterMethod("onAllColumnWidthsUpdated",this.refreshSummary,this);a.afterMethod("onColumnHiddenUpdated",this.refreshSummary,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");a.value=!Ext.isEmpty(d.data[l.name])?d.data[l.name]:"";if(b.summaryRenderer){a.value=b.summaryRenderer(a.value,a,d)}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b&&b.summaryType){g[o.name]=GO.grid.RemoteGridTotals.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},layout:function(){if(!this.view.summary){this.view.summary=Ext.DomHelper.insertAfter(this.view.mainBody.dom.parentNode,{tag:"div"},true)}if(!this.view.mainBody){return}var f=this.grid;var l=f.getGridEl(),o=this.cm,b=f.autoExpandColumn,a=this.view;var d=l.getSize(true);var n=d.width;if(!n||!d.height){return}if(f.autoHeight){this.view.scroller.dom.style.overflow="visible"}else{var k=this.view.summary.getHeight();var j=this.view.mainHd.getHeight();this.view.el.setSize(d.width,d.height+k);var e=d.height-(j)-(k);this.view.scroller.setSize(n,e);this.view.innerHd.style.width=(n)+"px"}if(this.view.forceFit){if(this.view.lastViewWidth!=n){this.view.fitColumns(false,false);this.view.lastViewWidth=n}}else{this.view.autoExpand()}this.view.onLayout(n,e)},doWidth:function(e,b,d){var c=this.view.getRows(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getRows(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getRows(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[this.view.getRows()-1].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(){var e=this.grid,a=e.colModel,j=e.store,k=e.stripeRows;var d=a.getColumnCount();if(j.getCount()<1){return""}var c=this.view.getColumnData();var b=[];var f=j.reader.jsonData.totals;b.push("</div>",this.renderSummary({data:f},c),"</div>");this.view.summary.update(b.join(""));this.view.layout()},getSummaryNode:function(){return this.view.summary},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});GO.menu.RecordsContextMenu=Ext.extend(Ext.menu.Menu,{records:[],showAt:function(e,b){this.records=b;var a=this.records.length>1;for(var c=0;c<this.items.getCount();c++){var d=this.items.get(c);d.setDisabled(!d.multiple&&a)}GO.menu.RecordsContextMenu.superclass.showAt.call(this,e)}});GO.grid.SimpleSelectList=function(b){if(!b){b={}}if(!b.tpl){var a="";if(b.title){a+="<b>"+b.title+":</b>"}a+='<tpl for="."><div id="{dom_id}" class="go-item-wrap">{name}</div></tpl>';b.tpl=new Ext.XTemplate(a)}else{var a=b.tpl}b.singleSelect=true;b.autoHeight=true;b.overClass="go-view-over";b.itemSelector="div.go-item-wrap";b.selectedClass="go-view-selected";GO.grid.SimpleSelectList.superclass.constructor.call(this,b)};Ext.extend(GO.grid.SimpleSelectList,Ext.DataView,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-select-list"});GO.grid.SimpleSelectList.superclass.onRender.apply(this,arguments)}});GO.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.groupable=false;this.menuDisabled=true;this.renderer=this.renderer.createDelegate(this);this.addEvents({change:true});GO.grid.CheckColumn.superclass.constructor.call(this)};Ext.extend(GO.grid.CheckColumn,Ext.util.Observable,{disabled_field:"disabled",init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);var d=a.get(this.disabled_field);if(!d){var f=a.data[this.dataIndex]=="1"?"0":"1";a.set(this.dataIndex,f);this.fireEvent("change",a,f)}}},renderer:function(c,e,b){e.css+=" x-grid3-check-col-td";var d=b.get(this.disabled_field);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-check-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}});Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.ux.grid.RowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",editable:false,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visibility",widthIntercept:4,widthSlope:21,init:function(c){this.grid=c;this.id=this.id||Ext.id();var d=c.getColumnModel().lookup;delete (d[undefined]);d[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var b=c.getView();var a={scope:this};a[this.actionEvent]=this.onClick;c.afterRender=c.afterRender.createSequence(function(){b.mainBody.on(a);c.on("destroy",this.purgeListeners,this)},this);if(!this.renderer){this.renderer=function(k,e,f,l,j,g){e.css+=(e.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(k,e,f,l,j,g))}.createDelegate(this)}if(b.groupTextTpl&&this.groupActions){b.interceptMouse=b.interceptMouse.createInterceptor(function(f){if(f.getTarget(".ux-grow-action-item")){return false}});b.groupTextTpl='<div class="ux-grow-action-text">'+b.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}if(true===this.keepSelection){c.processEvent=c.processEvent.createInterceptor(function(f,g){if("mousedown"===f){return !this.getAction(g)}},this)}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(d,c){var a=[];Ext.each(d,function(e,f){if(e.iconCls&&"function"===typeof(e.callback||e.cb)){this.callbacks=this.callbacks||{};this.callbacks[e.iconCls]=e.callback||e.cb}var g={cls:e.iconIndex?"{"+e.iconIndex+"}":(e.iconCls?e.iconCls:""),qtip:e.qtipIndex?"{"+e.qtipIndex+"}":(e.tooltip||e.qtip?e.tooltip||e.qtip:""),text:e.textIndex?"{"+e.textIndex+"}":(e.text?e.text:""),hide:e.hideIndex?'<tpl if="'+e.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(e.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:e.align||"right",style:e.style?e.style:""};a.push(g)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},getAction:function(c){var b=false;var a=c.getTarget(".ux-row-action-item");if(a){b=a.className.replace(/ux-row-action-item /,"");if(b){b=b.replace(/ ux-row-action-text/,"");b=b.trim()}}return b},onClick:function(g,j){var k=this.grid.getView();var o=g.getTarget(".x-grid3-row");var a=k.findCellIndex(j.parentNode.parentNode);var c=this.getAction(g);if(false!==o&&false!==a&&false!==c){var f=this.grid.store.getAt(o.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,f,c,o.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,f,c,o.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,f,c,o.rowIndex,a)}}}t=g.getTarget(".ux-grow-action-item");if(t){var l=k.findGroup(j);var d=l?l.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var n=new RegExp(RegExp.escape(d));b=this.grid.store.queryBy(function(e){return e._groupId.match(n)});b=b?b.items:[]}c=t.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);GO.grid.RadioColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};GO.grid.RadioColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(j,f){if(f.className&&f.className.indexOf("x-grid3-cc-"+this.id)!=-1){j.stopEvent();var c=this.grid.getView().findRowIndex(f);var b=this.grid.store.getAt(c);var g=this.isDisabled(b);if(!g){if(!GO.util.empty(b.get(this.dataIndex))){return}for(var d=0,a=this.grid.store.getCount();d<a;d++){var k=this.grid.store.getAt(d);if(k.get(this.dataIndex)){k.set(this.dataIndex,false)}}b.set(this.dataIndex,true)}}},isDisabled:function(a){return false},renderer:function(c,e,b){e.css+=" x-grid3-radio-col-td";var d=this.isDisabled(b);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-radio-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}};Ext.namespace("GO.util");GO.util.empty=function(a){if(!a){return true}if(a==""){return true}if(a=="0"){return true}if(a=="undefined"){return true}if(a=="null"){return true}return false};GO.mailTo=function(a){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+a+"','');\">"+a+"</a>"}else{return'<a href="mailto:'+a+'">'+a+"</a>"}};GO.util.getFileExtension=function(a){var c=a.lastIndexOf(".");var b="";if(c){b=a.substr(c+1)}return b.toLowerCase()};GO.playAlarm=function(){if(GO.util.empty(GO.settings.mute_sound)){var a=GO.util.getFlashMovieObject("alarmSound");if(a){try{a.Play()}catch(b){}}}};GO.util.nl2br=function(a){return a.replace(/\n/g,"<br />")};GO.util.clone=function clone(c){if(c==null||typeof(c)!="object"){return c}var a=new c.constructor();for(var b in c){a[b]=clone(c[b])}return a};GO.jsonAuthHandler=function(a,c,b){if(a.authError){switch(a.authError){case"UNAUTHORIZED":alert(GO.lang.strUnauthorizedText);return false;case"NOTLOGGEDIN":if(c){GO.loginDialog.addCallback(c,b)}GO.loginDialog.show();return false}}return true};GO.deleteItems=function(a){a.extraWarning=a.extraWarning||"";switch(a.count){case 0:alert(GO.lang.noItemSelected);return false;case 1:var c=a.extraWarning+GO.lang.strDeleteSelectedItem;break;default:var b=new Ext.Template(a.extraWarning+GO.lang.strDeleteSelectedItems);var c=b.applyTemplate({count:a.count});break}if(a.noConfirmation||confirm(c)){if(a.store){for(var d in a.params){a.store.baseParams[d]=a.params[d]}a.store.reload({callback:function(){var e;if(!this.reader.jsonData.deleteSuccess){if(a.failure){e=a.failure.createDelegate(a.scope);e.call(a.scope,a)}alert(this.reader.jsonData.deleteFeedback)}else{if(a.success){e=a.success.createDelegate(a.scope);e.call(a.scope,a)}}if(a.callback){e=a.callback.createDelegate(a.scope);e.call(this,a)}}});for(var d in a.params){delete a.store.baseParams[d]}}else{Ext.Ajax.request({url:a.url,params:a.params,callback:function(f,j,e){var k;var g=Ext.decode(e.responseText);if(!g.success){if(a.failure){k=a.failure.createDelegate(a.scope);k.call(this,g)}alert(g.feedback)}else{if(a.success){k=a.success.createDelegate(a.scope);k.call(this,g)}}if(a.callback){k=a.callback.createDelegate(a.scope);k.call(this,g)}}})}}};GO.util.getFlashMovieObject=function(a){if(window.document[a]){return window.document[a]}if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[a]){return document.embeds[a]}}else{return document.getElementById(a)}};GO.util.unlocalizeNumber=function(c,a,d){if(GO.util.empty(c)){return 0}if(!a){a=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}c=c+"";var b=new RegExp("["+d+"]","g");c=c.replace(b,"");return parseFloat(c.replace(a,"."))};String.prototype.regexpEscape=function(){var a=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];var b=new RegExp("(\\"+a.join("|\\")+")","g");return this.replace(b,"\\$1")};GO.util.numberFormat=function(f,c,k,d){if(typeof(c)=="undefined"){c=2}if(!k){k=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}if(f==""){f="0"}var l=parseFloat(f);l=l.toFixed(c);if(c>0){var b=l.indexOf(".");if(!b){l=l+".";b=l.indexOf(".")}var g=l.length-b;for(i=g;i<=c;i++){l=l+"0"}var j=k+l.substring(b+1);var e=c;while(j.substring(j.length-1)=="0"&&e>c){e--;j=j.substring(0,j.length-1)}}else{var j="";var b=l.length}var a=0;for(i=b-1;i>=0;i--){if(a==3&&l.substr(i,1)!="-"){j=d+j;a=0}j=l.substr(i,1)+j;a++}if(j==",NaN"){j=GO.util.numberFormat("0",c,k,d)}return j};GO.util.popup=function(g){var d={scrollbars:"1",resizable:"1",location:"0",status:"0",target:"_blank"};Ext.apply(d,g);if(!d.width){d.width=screen.availWidth;d.height=screen.availHeight}if(typeof(d.left)=="undefined"||typeof(d.top)=="undefined"){d.position=d.position||"center";if(d.position=="center"){d.left=(screen.availWidth-d.width)/2;d.top=(screen.availHeight-d.height)/2}else{d.left=screen.availWidth-d.width;d.top=screen.availHeight-d.height}}var f=["url","position","focus","closeOnFocus","target"];var b="";for(var e in d){if(f.indexOf(e)==-1){b+=","+e+"="+d[e]}}b=b.substring(1,b.length);var a=window.open(d.url,d.target,b);if(!a){alert(GO.lang.popupBlocker);return false}if(!a.opener){a.opener=self}if(d.focus){a.focus()}if(d.closeOnFocus){GO.mainLayout.on("focus",function(){a.close()},{single:true})}return a};GO.util.get_html_translation_table=function(k,f){var d={},j={},c=0,a="";var e={},b={};var l={},g={};l=(k?k.toUpperCase():"HTML_SPECIALCHARS");g=(f?f.toUpperCase():"ENT_COMPAT");e[0]="HTML_SPECIALCHARS";e[1]="HTML_ENTITIES";b[0]="ENT_NOQUOTES";b[2]="ENT_COMPAT";b[3]="ENT_QUOTES";if(!isNaN(l)){l=e[l]}if(!isNaN(g)){g=b[g]}if(l=="HTML_SPECIALCHARS"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;"}else{if(l=="HTML_ENTITIES"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;";d["160"]="&nbsp;";d["161"]="&iexcl;";d["162"]="&cent;";d["163"]="&pound;";d["164"]="&curren;";d["165"]="&yen;";d["166"]="&brvbar;";d["167"]="&sect;";d["168"]="&uml;";d["169"]="&copy;";d["170"]="&ordf;";d["171"]="&laquo;";d["172"]="&not;";d["173"]="&shy;";d["174"]="&reg;";d["175"]="&macr;";d["176"]="&deg;";d["177"]="&plusmn;";d["178"]="&sup2;";d["179"]="&sup3;";d["180"]="&acute;";d["181"]="&micro;";d["182"]="&para;";d["183"]="&middot;";d["184"]="&cedil;";d["185"]="&sup1;";d["186"]="&ordm;";d["187"]="&raquo;";d["188"]="&frac14;";d["189"]="&frac12;";d["190"]="&frac34;";d["191"]="&iquest;";d["192"]="&Agrave;";d["193"]="&Aacute;";d["194"]="&Acirc;";d["195"]="&Atilde;";d["196"]="&Auml;";d["197"]="&Aring;";d["198"]="&AElig;";d["199"]="&Ccedil;";d["200"]="&Egrave;";d["201"]="&Eacute;";d["202"]="&Ecirc;";d["203"]="&Euml;";d["204"]="&Igrave;";d["205"]="&Iacute;";d["206"]="&Icirc;";d["207"]="&Iuml;";d["208"]="&ETH;";d["209"]="&Ntilde;";d["210"]="&Ograve;";d["211"]="&Oacute;";d["212"]="&Ocirc;";d["213"]="&Otilde;";d["214"]="&Ouml;";d["215"]="&times;";d["216"]="&Oslash;";d["217"]="&Ugrave;";d["218"]="&Uacute;";d["219"]="&Ucirc;";d["220"]="&Uuml;";d["221"]="&Yacute;";d["222"]="&THORN;";d["223"]="&szlig;";d["224"]="&agrave;";d["225"]="&aacute;";d["226"]="&acirc;";d["227"]="&atilde;";d["228"]="&auml;";d["229"]="&aring;";d["230"]="&aelig;";d["231"]="&ccedil;";d["232"]="&egrave;";d["233"]="&eacute;";d["234"]="&ecirc;";d["235"]="&euml;";d["236"]="&igrave;";d["237"]="&iacute;";d["238"]="&icirc;";d["239"]="&iuml;";d["240"]="&eth;";d["241"]="&ntilde;";d["242"]="&ograve;";d["243"]="&oacute;";d["244"]="&ocirc;";d["245"]="&otilde;";d["246"]="&ouml;";d["247"]="&divide;";d["248"]="&oslash;";d["249"]="&ugrave;";d["250"]="&uacute;";d["251"]="&ucirc;";d["252"]="&uuml;";d["253"]="&yacute;";d["254"]="&thorn;";d["255"]="&yuml;"}else{throw Error("Table: "+l+" not supported");return false}}if(g!="ENT_NOQUOTES"){d["34"]="&quot;"}if(g=="ENT_QUOTES"){d["39"]="&#039;"}for(c in d){a=String.fromCharCode(c);j[a]=d[c]}return j};GO.util.html_entity_decode=function(c,g){c+="";var f={},e="",a="",d=0;a=c.toString();if(false===(f=GO.util.get_html_translation_table("HTML_ENTITIES",g))){return false}var b;for(e in f){b=f[e];a=a.split(b).join(e)}return a};GO.util.add_slashes=function(a){return(a+"").replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")};GO.util.addParamToUrl=function(a,d,c){var b=a.indexOf("?")!=-1?"&":"?";return a+b+d+"="+encodeURIComponent(c)};GO.util.basename=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(b+1)}return a};GO.util.dirname=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(0,b)}return a};GO.util.logExtEvents=function(){var a=Ext.util.Observable.prototype;a.fireEvent=a.fireEvent.createInterceptor(function(c){var b=arguments;console.log(this," fired event ",c," with args ",Array.prototype.slice.call(b,1,b.length))})};if(GO.settings&&GO.settings.time_format){GO.date={hours:[],minutes:[]};if(GO.settings.time_format.substr(0,1)=="G"){var timeformat="G"}else{var timeformat="g a"}for(var i=0;i<24;i++){var h=Date.parseDate(i,"G");GO.date.hours.push([h.format("G"),h.format(timeformat)])}GO.date.minutes=[["00","00"],["05","05"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["35","35"],["40","40"],["45","45"],["50","50"],["55","55"]]}GO.blinkTitle={blinkTitle:false,originalDocTitle:document.title,task:{run:function(){document.title=document.title!=this.blinkTitle?this.blinkTitle:this.originalDocTitle},interval:1000},running:false,blink:function(a){if(!this.task.scope){this.task.scope=this}if(GO.util.empty(a)){if(this.running){Ext.TaskMgr.stop(this.task);document.title=this.originalDocTitle}}else{this.blinkTitle=a;if(!this.running){Ext.TaskMgr.start(this.task);this.running=true}}}};GO.state.HttpProvider=function(a){GO.state.HttpProvider.superclass.constructor.call(this);this.url=BaseHref+"state.php";Ext.apply(this,a);this.state=this.readValues()};Ext.extend(GO.state.HttpProvider,Ext.state.Provider,{changedValues:false,set:function(a,c,d,b){if(a.substr(0,4)!="ext-"){if(typeof c=="undefined"||c===null){this.clear(a);return}this.setValue(a,c,d,b);GO.state.HttpProvider.superclass.set.call(this,a,c)}},clear:function(a){this.clearValue(a);GO.state.HttpProvider.superclass.clear.call(this,a)},readValues:function(){var b={};for(var a in GO.settings.state){if(a!="remove"){b[a]=this.decodeValue(GO.settings.state[a])}}return b},setValue:function(a,c,d,b){if(!this.changedValues){this.sendRequest.defer(1000,this,[d,b]);this.changedValues={}}this.changedValues[a]=this.encodeValue(c)},sendRequest:function(b,a){Ext.Ajax.request({url:this.url,params:{task:"set",values:Ext.encode(this.changedValues)},callback:b,scope:a});this.changedValues=false},clearValue:function(a){Ext.Ajax.request({url:this.url,params:{task:"set",name:a,value:"null"}})}});Ext.ns("Ext.ux");Ext.ux.PanelCollapsedTitle=(function(){var a="x-panel-header-rotated";var c=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var b=function(){var j=((this.region=="east")||(this.region=="west"));var k="overflow: visible; padding: 0; border: none; background: none;";if(j&&c){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"});var g="http://www.w3.org/2000/svg";var f=document.createElementNS(g,"svg");this.collapsedHeader.dom.appendChild(f);f.setAttribute("width","100%");f.setAttribute("height","100%");var l=document.createElementNS(g,"text");l.setAttribute("x",6);l.setAttribute("y",1);l.setAttribute("transform","rotate(90 6 1)");l.setAttribute("class","x-panel-header "+a);f.appendChild(l);this.collapsedHeaderText=document.createTextNode(this.title);l.appendChild(this.collapsedHeaderText);var e=Ext.fly(l).getStyle("color");l.setAttribute("style",k+";fill: "+e+";")}else{var d="position: relative;";if(j){d+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;"}else{d+="top: 2px;";k+="padding-left: 4px; margin-right: 18px;"}this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:k,cls:"x-panel-header "+a,html:'<span style="'+d+'">'+this.title+"</span>"});this.collapsedHeaderText=this.collapsedHeader.first()}if(this.collapsedIconCls){this.setCollapsedIconClass(this.collapsedIconCls)}};this.init=function(e){if(e.collapsible){var d=((e.region=="east")||(e.region=="west"));e.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(f){if(this.rendered&&this.collapsedHeaderText){if(this.collapsedHeaderText.dom){this.collapsedHeaderText.dom.innerHTML=f}else{if(this.collapsedHeaderText.replaceData){this.collapsedHeaderText.nodeValue=f}}}});e.setCollapsedIconClass=function(g){var f=this.collapsedIconCls;this.collapsedIconCls=g;if(this.rendered&&this.collapsedHeader){var k=this.collapsedHeader,j=k.child("img.x-panel-inline-icon");if(j){if(this.collapsedIconCls){Ext.fly(j).replaceClass(f,this.collapsedIconCls)}else{Ext.fly(j).remove()}}else{if(this.collapsedIconCls){Ext.DomHelper.insertBefore(k.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:d?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"})}}}};e.on("render",function(){if(this.ownerCt.rendered&&this.ownerCt.layout.hasLayout){b.call(e)}else{this.ownerCt.on("afterlayout",b,e,{single:true})}},e)}};return this})();Ext.DataView.DragSelector=function(g){g=g||{};var l,d,k,o;var e,n,p=new Ext.lib.Region(0,0,0,0);var b=g.dragSafe===true;this.init=function(v){l=v;l.on("render",u)};function q(){e=[];l.all.each(function(v){e[e.length]=v.getRegion()});n=l.el.getRegion()}function f(){return false}function j(v){return !b||v.target==l.el.dom}function r(v){l.on("containerclick",f,l,{single:true});if(!k){k=l.el.createChild({cls:"x-view-selector"})}else{k.setDisplayed("block")}q();l.clearSelections()}function c(D){var E=o.startXY;var I=o.getXY();var G=Math.min(E[0],I[0]);var F=Math.min(E[1],I[1]);var H=Math.abs(E[0]-I[0]);var B=Math.abs(E[1]-I[1]);p.left=G;p.top=F;p.right=G+H;p.bottom=F+B;p.constrainTo(n);k.setRegion(p);for(var A=0,C=e.length;A<C;A++){var v=e[A],z=p.intersect(v);if(z&&!v.selected){v.selected=true;l.select(A,true)}else{if(!z&&v.selected){v.selected=false;l.deselect(A)}}}}function a(v){if(k){k.setDisplayed(false)}}function u(v){o=new Ext.dd.DragTracker({onBeforeStart:j,onStart:r,onDrag:c,onEnd:a});o.initEl(v.el)}};GO.plugins.InsertAtCursorTextareaPlugin=function(){return{init:function(a){a.insertAtCursor=function(b){if(Ext.isIE){this.el.focus();var e=document.selection.createRange();e.text=b;e.moveEnd("character",b.length);e.moveStart("character",b.length)}else{var d=this.el.dom.selectionStart;var c=this.el.dom.selectionEnd;this.el.dom.value=this.el.dom.value.substring(0,d)+b+this.el.dom.value.substring(c,this.el.dom.value.length);this.el.focus();this.el.dom.setSelectionRange(c+b.length,c+b.length)}}}}};GO.plugins.HtmlEditorImageInsert=function(a){a=a||{};Ext.apply(this,a);this.init=function(b){this.editor=b;this.editor.on("render",this.onRender,this)};this.addEvents({insert:true})};Ext.extend(GO.plugins.HtmlEditorImageInsert,Ext.util.Observable,{root_folder_id:0,folder_id:0,onRender:function(){this.editor.tb.add({itemId:"htmlEditorImage",cls:"x-btn-icon go-edit-insertimage",enableToggle:false,scope:this,handler:function(){this.showFileBrowser()},clickEvent:"mousedown",tabIndex:-1,tooltip:{title:GO.lang.image,text:GO.lang.insertImage}})},showFileBrowser:function(){if(!GO.files){alert(GO.lang.noFilesModule);return false}GO.files.createSelectFileBrowser();GO.selectFileBrowser.setFileClickHandler(this.selectImage,this);GO.selectFileBrowser.setFilesFilter(this.filesFilter);GO.selectFileBrowser.setRootID(this.root_folder_id,this.files_folder_id);GO.selectFileBrowserWindow.show();GO.selectFileBrowserWindow.show.defer(200,GO.selectFileBrowserWindow)},selectImage:function(b){this.selectedRecord=b;this.selectedPath=b.data.path;this.selectedUrl=GO.settings.modules.files.url+"download.php?id="+this.selectedRecord.get("id");var a='<img src="'+this.selectedUrl+'" border="0" />';this.fireEvent("insert",this);this.editor.focus();this.editor.insertAtCursor(a);GO.selectFileBrowserWindow.hide()}});GO.plugins.HtmlEditorSpellCheck=function(a){this.EmailComposer=a;this.init=function(b){this.editor=b;this.editor.on("render",this.onRender,this)};this.addEvents({insert:true})};Ext.extend(GO.plugins.HtmlEditorSpellCheck,Ext.util.Observable,{onRender:function(){if(!Ext.isSafari){var b=[];var c;for(var a=0;a<GO.Languages.length;a++){c={text:GO.Languages[a][1],lang:GO.Languages[a][0],handler:function(d){this.spellcheck(d.lang)},scope:this};if(GO.settings.language==c.lang){b.unshift(c,"-")}else{b.push(c)}}this.editor.tb.add({itemId:"htmlSpellCheck",cls:"x-btn-icon go-edit-spellcheck",enableToggle:false,scope:this,menu:{items:b},clickEvent:"mousedown",tabIndex:-1,tooltip:{title:GO.lang.spellcheck,text:GO.lang.spellcheckdetails}})}},spellcheck:function(b){if(this.EmailComposer.isHTML()){var a=this;Ext.Ajax.request({url:BaseHref+"HtmlEditorSpellCheck.php",success:function(c,d){a.processResults(c,d,a)},failure:this.problem,params:{tocheck:this.editor.getValue(),lang:b}});this.editor.SpellCheck=true}else{}},processResults:function(a,d,b){var c=Ext.util.JSON.decode(a.responseText);if(c.errorcount==0){Ext.Msg.alert(GO.lang.spellcheck,GO.lang.spellcheckNoError)}else{b.showSpellChecker(c.errorcount,c.text,b)}},showSpellChecker:function(d,c,a){var b=GO.lang.spellcheckNoErrors.replace(/\{1\}/ig,d);a.textarea=new Ext.Panel({title:b,region:"north",cls:"go-form-panel x-spell-checker",autoScroll:true,html:c});a.wnd=new Ext.Window({width:600,height:400,modal:true,closeAction:"close",closable:true,layout:"fit",title:GO.lang.spellcheck,items:[a.textarea],buttons:[{text:GO.lang.cmdSave,handler:function(){a.UpdateEditorValue(a)}},{text:GO.lang.cmdCancel,handler:function(){a.closeWindow(a)}}]});a.wnd.show();Ext.select("span.spelling",a.textarea).on("click",function(f){a.showSuggestions(f,this)})},UpdateEditorValue:function(a){var b=this.textarea.el.dom.childNodes[1].childNodes[0].innerHTML;var c=new RegExp('<span [\\s\\S]*?class=(")?spelling(")?[\\s\\S]*?>(\\w+)[\\s\\S]*?</span>',"mig");b=b.replace(c,"$3 ");a.editor.setValue(b);a.closeWindow(a)},closeWindow:function(a){a.wnd.destroy()},showSuggestions:function(f,b){var a=b.getElementsByTagName("li");var g=new Array();var j=this;for(var c=0;c<a.length;c++){var d=a[c].innerHTML;g.push(new Ext.Action({text:d,handler:function(e,k){j.replaceSpelling(this.text,b)}}))}this.Suggestions=new Ext.menu.Menu({items:g});this.Suggestions.showAt(f.getXY())},replaceSpelling:function(c,b){if(Ext.isIE&&b.getAttribute("ieAfterObject")==" "){var a=document.createTextNode(c+" ")}else{var a=document.createTextNode(c)}b.parentNode.replaceChild(a,b);this.Suggestions.destroy()},problem:function(a,b){Ext.Msg.show({title:GO.lang.spellcheck,msg:GO.lang.spellcheckServerError,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}});
/*
 * MIT
 */
Ext.ns("Ext.ux.form.HtmlEditor");Ext.ux.form.HtmlEditor.MidasCommand=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.btns=[];this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true})},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{mousedown:this.onEditorEvent,dblclick:this.onEditorEvent,click:this.onEditorEvent,keyup:this.onEditorEvent,buffer:100,scope:this})},onRender:function(){var c,a=this.cmp.getToolbar(),b;Ext.each(this.midasBtns,function(d){if(typeof(d)=="object"){c={tabIndex:-1,iconCls:"x-edit-"+d.cmd,handler:function(){this.cmp.relayCmd(d.cmd)},scope:this,tooltip:d.tooltip||{title:d.title},overflowText:d.overflowText||d.title}}else{c=new Ext.Toolbar.Separator()}b=a.addButton(c);if(d.enableOnSelection){b.disable()}this.btns.push(b)},this)},onEditorEvent:function(){var a=this.cmp.getDoc();Ext.each(this.btns,function(c,d){if(this.midasBtns[d].enableOnSelection||this.midasBtns[d].disableOnSelection){if(a.getSelection){if((this.midasBtns[d].enableOnSelection&&a.getSelection()!=="")||(this.midasBtns[d].disableOnSelection&&a.getSelection()==="")){c.enable()}else{c.disable()}}else{if(a.selection){if((this.midasBtns[d].enableOnSelection&&a.selection.createRange().text!=="")||(this.midasBtns[d].disableOnSelection&&a.selection.createRange().text==="")){c.enable()}else{c.disable()}}}}if(this.midasBtns[d].monitorCmdState){c.toggle(a.queryCommandState(this.midasBtns[d].cmd))}},this)}});Ext.ux.form.HtmlEditor.Divider=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){this.cmp.getToolbar().addButton([new Ext.Toolbar.Separator()])}});Ext.ux.form.HtmlEditor.IndentOutdent=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{cmd:"indent",tooltip:{title:GO.lang.indent},overflowText:GO.lang.indent},{cmd:"outdent",tooltip:{title:GO.lang.outdent},overflowText:GO.lang.outdent}]});Ext.ux.form.HtmlEditor.RemoveFormat=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"removeFormat",tooltip:{title:GO.lang.removeFormatting},overflowText:GO.lang.removeFormatting}]});Ext.ux.form.HtmlEditor.SubSuperScript=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"subscript",tooltip:{title:"Subscript"},overflowText:"Subscript"},{enableOnSelection:true,cmd:"superscript",tooltip:{title:"Superscript"},overflowText:"Superscript"}]});Ext.ux.form.HtmlEditor.SpecialCharacters=Ext.extend(Ext.util.Observable,{specialChars:[],charRange:[160,256],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-char",tabIndex:-1,handler:function(){if(this.specialChars.length){Ext.each(this.specialChars,function(e,d){this.specialChars[d]=["&#"+e+";"]},this)}for(i=this.charRange[0];i<this.charRange[1];i++){this.specialChars.push(["&#"+i+";"])}var c=new Ext.data.ArrayStore({fields:["char"],data:this.specialChars});this.charWindow=new Ext.Window({title:"Insert Special Character",width:436,autoHeight:true,layout:"fit",items:[{xtype:"dataview",store:c,ref:"../charView",autoHeight:true,multiSelect:true,tpl:new Ext.XTemplate('<tpl for="."><div class="char-item">{char}</div></tpl><div class="x-clear"></div>'),overClass:"char-over",itemSelector:"div.char-item",listeners:{dblclick:function(f,d,j,g){this.insertChar(f.getStore().getAt(d).get("char"));this.charWindow.close()},scope:this}}],buttons:[{text:"Insert",handler:function(){Ext.each(this.charWindow.charView.getSelectedRecords(),function(d){var e=d.get("char");this.insertChar(e)},this);this.charWindow.close()},scope:this},{text:"Cancel",handler:function(){this.charWindow.close()},scope:this}]});this.charWindow.show()},scope:this,tooltip:{title:"Insert Special Character"},overflowText:"Special Characters"})},insertChar:function(a){if(a){this.cmp.insertAtCursor(a)}}});Ext.ux.form.HtmlEditor.Table=Ext.extend(Ext.util.Observable,{cmd:"table",tableBorderOptions:[["none","None"],["1px solid #000","Sold Thin"],["2px solid #000","Solid Thick"],["1px dashed #000","Dashed"],["1px dotted #000","Dotted"]],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-table",tabIndex:-1,handler:function(){if(!this.tableWindow){this.tableWindow=new Ext.Window({title:"Insert Table",closeAction:"hide",items:[{itemId:"insert-table",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:60,labelAlign:"right",items:[{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:"Rows",name:"row",width:60},{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:"Columns",name:"col",width:60},{xtype:"combo",fieldLabel:"Border",name:"border",forceSelection:true,mode:"local",store:new Ext.data.ArrayStore({autoDestroy:true,fields:["spec","val"],data:this.tableBorderOptions}),triggerAction:"all",value:"none",displayField:"val",valueField:"spec",width:90}]}],buttons:[{text:"Insert",handler:function(){var g=this.tableWindow.getComponent("insert-table").getForm();if(g.isValid()){var e=g.findField("border").getValue();var c=[g.findField("row").getValue(),g.findField("col").getValue()];if(c.length==2&&c[0]>0&&c[0]<10&&c[1]>0&&c[1]<10){var f="<table>";for(var j=0;j<c[0];j++){f+="<tr>";for(var d=0;d<c[1];d++){f+="<td width='20%' style='border: "+e+";'>"+j+"-"+d+"</td>"}f+="</tr>"}f+="</table>";this.cmp.insertAtCursor(f)}this.tableWindow.hide()}else{if(!g.findField("row").isValid()){g.findField("row").getEl().frame()}else{if(!g.findField("col").isValid()){g.findField("col").getEl().frame()}}}},scope:this},{text:"Cancel",handler:function(){this.tableWindow.hide()},scope:this}]})}else{this.tableWindow.getEl().frame()}this.tableWindow.show()},scope:this,tooltip:{title:"Insert Table"},overflowText:"Table"})}});Ext.ux.form.HtmlEditor.Word=Ext.extend(Ext.util.Observable,{curLength:0,lastLength:0,lastValue:"",wordPasteEnabled:true,init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true})},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{keyup:this.checkIfPaste,scope:this});this.lastValue=this.cmp.getValue();this.curLength=this.lastValue.length;this.lastLength=this.lastValue.length},checkIfPaste:function(c){var a=0;this.curLength=this.cmp.getValue().length;if(c.V==c.getKey()&&c.ctrlKey&&this.wordPasteEnabled){this.cmp.suspendEvents();a=this.findValueDiffAt(this.cmp.getValue());var b=[this.cmp.getValue().substr(0,a),this.fixWordPaste(this.cmp.getValue().substr(a,(this.curLength-this.lastLength))),this.cmp.getValue().substr((this.curLength-this.lastLength)+a,this.curLength)];this.cmp.setValue(b.join(""));this.cmp.resumeEvents()}this.lastLength=this.cmp.getValue().length;this.lastValue=this.cmp.getValue()},findValueDiffAt:function(a){for(i=0;i<this.curLength;i++){if(this.lastValue[i]!=a[i]){return i}}},fixWordPaste:function(a){var b=[/&nbsp;/ig,/[\r\n]/g,/<(xml|style)[^>]*>.*?<\/\1>/ig,/<\/?(meta|object|span)[^>]*>/ig,/<\/?[A-Z0-9]*:[A-Z]*[^>]*>/ig,/(lang|class|type|href|name|title|id|clear)=\"[^\"]*\"/ig,/style=(\'\'|\"\")/ig,/<![\[-].*?-*>/g,/MsoNormal/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/&nbsp;/g,/<\/?SPAN[^>]*>/g,/<\/?FONT[^>]*>/g,/<\/?STRONG[^>]*>/g,/<\/?H1[^>]*>/g,/<\/?H2[^>]*>/g,/<\/?H3[^>]*>/g,/<\/?H4[^>]*>/g,/<\/?H5[^>]*>/g,/<\/?H6[^>]*>/g,/<\/?P[^>]*><\/P>/g,/<!--(.*)-->/g,/<!--(.*)>/g,/<!(.*)-->/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/style=\"[^\"]*\"/g,/style=\'[^\"]*\'/g,/lang=\"[^\"]*\"/g,/lang=\'[^\"]*\'/g,/class=\"[^\"]*\"/g,/class=\'[^\"]*\'/g,/type=\"[^\"]*\"/g,/type=\'[^\"]*\'/g,/href=\'#[^\"]*\'/g,/href=\"#[^\"]*\"/g,/name=\"[^\"]*\"/g,/name=\'[^\"]*\'/g,/ clear=\"all\"/g,/id=\"[^\"]*\"/g,/title=\"[^\"]*\"/g,/<span[^>]*>/g,/<\/?span[^>]*>/g,/class=/g];Ext.each(b,function(c){a=a.replace(c,"")});a=a.replace(/<div[^>]*>/g,"<p>");a=a.replace(/<\/?div[^>]*>/g,"</p>");return a},onRender:function(){this.cmp.getToolbar().add({iconCls:"x-edit-wordpaste",pressed:true,tabIndex:-1,handler:function(a){a.toggle(!a.pressed);this.wordPasteEnabled=!this.wordPasteEnabled},scope:this,tooltip:{text:"Cleanse text pasted from Word or other Rich Text applications"}})}});Ext.ux.form.HtmlEditor.HR=Ext.extend(Ext.util.Observable,{cmd:"hr",init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-hr",tabIndex:-1,handler:function(){if(!this.hrWindow){this.hrWindow=new Ext.Window({width:400,autoHeight:true,resizable:false,title:GO.lang.insertHorizontalRule,closeAction:"hide",focus:function(){this.items.get(0).form.findField("hrwidth").focus(true)},items:[{itemId:"insert-hr",xtype:"form",border:false,bodyStyle:"padding: 10px;",labelWidth:60,labelAlign:"right",items:[{xtype:"label",html:GO.lang.insertHRtext+"<br/>&nbsp;"},{xtype:"textfield",maskRe:/[0-9]|%/,regex:/^[1-9][0-9%]{1,3}/,fieldLabel:GO.lang.width,name:"hrwidth",value:"100%",width:60,listeners:{specialkey:function(c,d){if((d.getKey()==d.ENTER||d.getKey()==d.RETURN)&&c.isValid()){this.doInsertHR()}else{c.getEl().frame()}},scope:this}}]}],buttons:[{text:GO.lang.cmdInsert,handler:function(){var c=this.hrWindow.getComponent("insert-hr").getForm();if(c.isValid()){this.doInsertHR()}else{c.findField("hrwidth").getEl().frame()}},scope:this},{text:GO.lang.cmdCancel,handler:function(){this.hrWindow.hide()},scope:this}]})}else{this.hrWindow.getEl().frame()}this.hrWindow.show()},scope:this,tooltip:{title:GO.lang.insertHorizontalRule},overflowText:GO.lang.insertHorizontalRule})},doInsertHR:function(){var b=this.hrWindow.getComponent("insert-hr").getForm();if(b.isValid()){var a=b.findField("hrwidth").getValue();if(a){this.insertHR(a)}else{this.insertHR("100%")}b.reset();this.hrWindow.hide()}},insertHR:function(a){this.cmp.insertAtCursor('<hr width="'+a+'">')}});GO.DisplayPanel=Ext.extend(Ext.Panel,{link_id:0,link_type:0,newMenuButton:false,template:"",templateConfig:{notEmpty:function(a){if(a&&a.length){return true}}},loadParams:{},idParam:"",loadUrl:"",data:{},saveHandlerAdded:false,noFileBrowser:false,addSaveHandler:function(b,a){if(!a){a="save"}if(!this.saveHandlerAdded){b.on(a,this.onSave,this);this.saveHandlerAdded=true}},createTopToolbar:function(){this.newMenuButton=new GO.NewMenuButton({panel:this});var a=[];a.push(this.editButton=new Ext.Button({iconCls:"btn-edit",text:GO.lang.cmdEdit,cls:"x-btn-text-icon",handler:this.editHandler,scope:this,disabled:true}));a.push(this.linkBrowseButton=new Ext.Button({iconCls:"btn-link",cls:"x-btn-text-icon",text:GO.lang.cmdBrowseLinks,handler:function(){if(!GO.linkBrowser){GO.linkBrowser=new GO.LinkBrowser()}GO.linkBrowser.show({link_id:this.data.id,link_type:this.link_type,folder_id:"0"});GO.linkBrowser.on("hide",this.reload,this,{single:true})},scope:this}));if(GO.files&&!this.noFileBrowser){a.push(this.fileBrowseButton=new Ext.Button({iconCls:"btn-files",cls:"x-btn-text-icon",text:GO.files.lang.files,handler:function(){GO.files.openFolder(this.data.files_folder_id);GO.files.fileBrowserWin.on("hide",this.reload,this,{single:true})},scope:this,disabled:true}))}a.push(this.newMenuButton);a.push("-");a.push({iconCls:"btn-refresh",tooltip:GO.lang.cmdRefresh,handler:this.reload,scope:this});a.push({iconCls:"btn-print",tooltip:GO.lang.cmdPrint,handler:function(){this.body.print({title:this.getTitle()})},scope:this});return a},initTemplate:function(){},initComponent:function(){this.autoScroll=true;this.split=true;var a=this.createTopToolbar();if(a){this.tbar=a}this.initTemplate();this.xtemplate=new Ext.XTemplate(this.template,this.templateConfig);this.xtemplate.compile();GO.DisplayPanel.superclass.initComponent.call(this);this.on("expand",function(){if(this.collapsedLinkId){this.load(this.collapsedLinkId,true);delete this.collapsedLinkId}},this)},afterRender:function(){GO.DisplayPanel.superclass.afterRender.call(this);var a=this.getTopToolbar();if(a){a.setDisabled(true)}this.body.on("click",this.onBodyClick,this)},getLinkName:function(){return this.data.name},onSave:function(a,b){if(b>0){this.load(b,true)}},gridDeleteCallback:function(a){if(this.data){var c=Ext.decode(a.params.delete_keys);for(var b=0;b<c.length;b++){if(this.data.id==c[b]){this.reset()}}}},reset:function(){this.body.update("");this.data={};this.link_id=this.collapsedLinkId=0;var a=this.getTopToolbar();if(a){a.setDisabled(true)}},setData:function(a){a.link_type=this.link_type;this.data=a;var b=this.getTopToolbar();if(b){b.setDisabled(false)}this.editButton.setDisabled(!a.write_permission);if(a.write_permission){this.newMenuButton.setLinkConfig({id:this.data.id,type:this.link_type,text:this.getLinkName(),callback:this.reload,scope:this})}else{this.newMenuButton.setDisabled(true)}if(this.fileBrowseButton){this.fileBrowseButton.setDisabled(a.files_folder_id<1)}this.xtemplate.overwrite(this.body,a);this.body.scrollTo("top",0)},onBodyClick:function(f,g){if(g.tagName!="A"){g=Ext.get(g).findParent("A",10);if(!g){return false}}if(g.tagName=="A"){f.preventDefault();var a=g.attributes.href.value;if(GO.email&&a.substr(0,6)=="mailto"){var n=a.indexOf("?");if(n>0){var j=a.substr(7,n-8)}else{var j=a.substr(7)}GO.email.addressContextMenu.showAt(f.getXY(),j)}else{var k=a.indexOf("#link_");if(k>-1){var d=a.substr(k+6,a.length);var l=this.data.links[d];if(l.link_type=="folder"){GO.linkBrowser.show({link_id:l.parent_link_id,link_type:l.parent_link_type,folder_id:l.id})}else{GO.linkHandlers[l.link_type].call(this,l.id,{data:l})}}else{k=a.indexOf("#files_");if(k>-1){var d=a.substr(k+7,a.length);var b=this.data.files[d];if(b.extension=="folder"){GO.files.openFolder(this.data.files_folder_id,b.id)}else{if(GO.files){var c=new GO.files.FileRecord(b);GO.files.openFile(c)}else{window.open(GO.settings.modules.files.url+"download.php?id="+b.id)}}}else{if(a!="#"){if(a.substr(0,6)=="callto"){document.location.href=a}else{window.open(a)}}}}}}},load:function(b,a){if(this.collapsed){this.collapsedLinkId=this.link_id=b}else{if(this.link_id!=b||a){this.loadParams[this.idParam]=this.link_id=b;this.body.mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:this.loadUrl,params:this.loadParams,callback:function(d,f,c){this.body.unmask();if(!f){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var e=Ext.decode(c.responseText);this.setData(e.data)}},scope:this})}}},setTitle:function(a){if(typeof(this.title)!="undefined"){GO.DisplayPanel.superclass.setTitle.call(this,a)}else{if(this.ownerCt){this.ownerCt.setTitle(a)}}},getTitle:function(){if(typeof(this.title)!="undefined"){return this.title}else{if(this.ownerCt){this.ownerCt.title}}return false},reload:function(){if(this.data.id){this.load(this.data.id,true)}},editHandler:function(){}});GO.panel.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){if(!this.name){this.name=""}this.el=b.createChild({tag:"iframe",id:this.id,frameBorder:0,src:this.url,name:this.name})},setUrl:function(a){this.el.set({src:a})}});GO.dialog.SelectGroups=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","user_id","user_name"],remoteSort:true,baseParams:{task:"groups"}});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.grid.on("rowdblclick",function(){this.callHandler(true)},this);this.store.load();Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectGroups,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:function(){this.callHandler(true)},scope:this}]})};Ext.extend(GO.dialog.SelectGroups,Ext.Window,{callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectUsers=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","email"],remoteSort:true,baseParams:{task:"users"}});this.searchField=new GO.form.SearchField({store:this.store,width:320});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.searchField]});this.grid.on("rowdblclick",function(){this.callHandler(true)},this);var b=function(){this.searchField.focus(true)};GO.dialog.SelectUsers.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",focus:b.createDelegate(this),title:GO.lang.strSelectUsers,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectUsers,Ext.Window,{show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.dialog.SelectUsers.superclass.show.call(this)},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectEmail=function(b){Ext.apply(this,b);var a=Array();this.usersStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},id:"id",root:"results",totalProperty:"total",fields:["id","username","name","company","logins","lastlogin","registration_time","address","zip","city","state","country","phone","email","waddress","wzip","wcity","wstate","wcountry","wphone"],remoteSort:true});this.usersSearchField=new GO.form.SearchField({store:this.usersStore,width:320});this.usersGrid=new GO.grid.GridPanel({id:"select-users-grid",title:GO.lang.users,paging:true,border:false,store:this.usersStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.usersSearchField]});this.usersGrid.on("show",function(){this.usersStore.load()},this);this.usersGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.usersGrid);if(GO.addressbook){this.contactsStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts"},root:"results",id:"id",totalProperty:"total",fields:["id","name","company_name","email","home_phone","work_phone","work_fax","cellular"],remoteSort:true});this.contactsSearchField=new GO.form.SearchField({store:this.contactsStore,width:320});this.contactsGrid=new GO.grid.GridPanel({id:"select-contacts-grid",title:GO.addressbook.lang.contacts,paging:true,border:false,store:this.contactsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.contactsSearchField]});this.contactsGrid.on("show",function(){this.contactsStore.load()},this);this.contactsGrid.on("rowdblclick",function(){this.callHandler(true)},this);this.companiesStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies"},totalProperty:"total",root:"results",id:"id",fields:["id","name","city","email","phone","homepage","address","zip"],remoteSort:true});this.companySearchField=new GO.form.SearchField({store:this.companiesStore,width:320});this.companyGrid=new GO.grid.GridPanel({id:"select-companies-grid",title:GO.addressbook.lang.companies,paging:true,border:false,store:this.companiesStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.companySearchField]});this.companyGrid.on("show",function(){this.companiesStore.load()},this);this.companyGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.contactsGrid);a.push(this.companyGrid);if(GO.mailings){this.mailingsGrid=new GO.grid.GridPanel({id:"select-mailings-grid",title:GO.mailings.lang.cmdPanelMailings,paging:false,border:false,store:GO.mailings.readableMailingsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.mailingsGrid.on("show",function(){if(!GO.mailings.readableMailingsStore.loaded){GO.mailings.readableMailingsStore.load()}},this);this.mailingsGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.mailingsGrid)}}this.userGroupsStore=new GO.data.JsonStore({url:GO.settings.modules.groups.url+"non_admin_json.php",baseParams:{task:"groups"},id:"id",root:"results",fields:["id","name","user_id","user_name"],totalProperty:"total",remoteSort:true});this.userGroupsGrid=new GO.grid.GridPanel({id:"select-usergroups-grid",title:GO.lang.userGroups,paging:true,border:false,store:this.userGroupsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strOwner,dataIndex:"user_name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.userGroupsGrid.on("show",function(){this.userGroupsStore.load()},this);this.userGroupsGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.userGroupsGrid);this.tabPanel=new Ext.TabPanel({activeTab:0,items:a});Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectEmail,items:this.tabPanel,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectEmail,Ext.Window,{callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var d,c;switch(this.tabPanel.getLayout().activeItem.id){case"select-users-grid":c="users";d=this.usersGrid;break;case"select-contacts-grid":c="contacts";d=this.contactsGrid;break;case"select-usergroups-grid":c="usergroups";d=this.userGroupsGrid;break;case"select-companies-grid":c="companies";d=this.companyGrid;break;case"select-mailings-grid":c="mailings";d=this.mailingsGrid;break}var b=this.handler.createDelegate(this.scope,[d,c]);b.call()}if(a){this.hide()}}});GO.ErrorDialog=function(a){a=a||{};Ext.apply(a,{width:550,height:300,autoHeight:true,closeAction:"hide",plain:true,border:false,closable:true,title:GO.lang.strError,modal:false,items:[this.messagePanel=new Ext.FormPanel({region:"center",cls:"go-error-dialog",autoHeight:true,html:""}),this.detailPanel=new Ext.Panel({region:"south",collapsible:true,collapsed:true,height:150,title:GO.lang.errorDetails,titleCollapse:true,autoScroll:true,html:""})],buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ErrorDialog.superclass.constructor.call(this,a)};Ext.extend(GO.ErrorDialog,GO.Window,{show:function(a,b){if(!this.rendered){this.render(Ext.getBody())}this.detailPanel.collapse();this.messagePanel.body.update(a);if(GO.util.empty(b)){this.detailPanel.hide()}else{this.detailPanel.show();this.detailPanel.body.update("<pre>"+b+"</pre>")}GO.ErrorDialog.superclass.show.call(this)}});GO.errorDialog=new GO.ErrorDialog();GO.form.TreeSelect=Ext.extend(Ext.form.TriggerField,{triggerClass:"go-form-tree-select",windowConfig:{},onTriggerClick:function(){if(!this.treeSelectWindow){this.windowConfig.textfield=this;this.treeSelectWindow=new GO.form.TreeSelectWindow(this.windowConfig)}this.treeSelectWindow.show()}});GO.form.TreeSelectWindow=Ext.extend(function(a){a=a||{};a.title=a.textfield.windowTitle||"";this.treePanel=new Ext.tree.TreePanel({layout:"fit",loader:a.textfield.treeLoader,containerScroll:true,autoScroll:true,rootVisible:false,root:{nodeType:"async",id:"root"}});a.layout="fit";a.items=[this.treePanel];a.modal=true;a.width=640;a.height=400;a.closeAction="hide";a.closable=true;a.buttons=[{text:GO.lang.cmdOk,handler:function(){var d=[],b=this.treePanel.getChecked();var g=this.textfield.getValue();var c=g.split(",");for(var e=0;e<c.length;e++){if(c[e]!=""){var f=this.treePanel.getNodeById(c[e]);if(!f){d.push(c[e])}}}Ext.each(b,function(j){d.push(j.id)});this.textfield.setValue(d.join(","));this.hide()},scope:this}];GO.form.TreeSelectWindow.superclass.constructor.call(this,a);this.treePanel.on("load",function(d){var b=this.textfield.getValue();var c=b.split(",");Ext.each(d.childNodes,function(f){var e=c.indexOf(f.id);if(e>-1){f.attributes.checked=true}})},this);this.on("show",function(){var b=this.textfield.getValue();var d=b.split(",");this.clearChecked();for(var c=0;c<d.length;c++){var e=this.treePanel.getNodeById(d[c]);if(e){e.getUI().toggleCheck(true)}}},this)},GO.Window,{clearChecked:function(){var a=this.treePanel.getChecked();Ext.each(a,function(b){b.getUI().toggleCheck(false)})}});Ext.reg("treeselect",GO.form.TreeSelect);GO.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{store:false,initComponent:function(){GO.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this);this.on("focus",function(){this.focus(true)},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.load();this.el.dom.value="";this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.onTrigger1Click();return}this.store.baseParams[this.paramName]=a;this.store.load();this.hasSearch=true},afterRender:function(){GO.form.SearchField.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}},setValue:function(a){GO.form.SearchField.superclass.setValue.call(this,a);if(a!=""){this.hasSearch=true;if(this.rendered){}}}});GO.form.ComboBox=Ext.extend(Ext.form.ComboBox,{initComponent:function(){GO.form.ComboBox.superclass.initComponent.call(this);if(this.remoteText){this.setRemoteText(this.remoteText)}},setRemoteText:function(e){var d=this.findRecord(this.valueField,this.value);if(!d){var c=Ext.data.Record.create([{name:this.valueField},{name:this.displayField}]);var b={};b[this.valueField]=this.value;b[this.displayField]=e;var a=new c(b);this.store.add(a);this.setValue(this.value)}},initValue:function(){GO.form.ComboBox.superclass.initValue.call(this);if(!GO.util.empty(this.lastSelectionText)){this.setRawValue(this.lastSelectionText)}},selectFirst:function(){if(this.store.getCount()){var a=this.store.getRange(0,1);this.setValue(a[0].get(this.valueField))}},clearLastSearch:function(){this.lastQuery=false;this.hasSearch=false}});Ext.reg("combo",GO.form.ComboBox);GO.form.ColorField=Ext.extend(function(a){this.menu=new Ext.menu.ColorMenu();this.menu.palette.on("select",this.handleSelect,this);this.menu.on("show",function(){this.menu.palette.select(this.curColor)},this);this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));if(a.colors){this.menu.palette.colors=a.colors}GO.form.ColorField.superclass.constructor.call(this,a)},Ext.form.TriggerField,{showHexValue:false,defaultAutoCreate:{tag:"input",type:"text",size:"1",autocomplete:"off",maxlength:"6"},lengthText:"Color hex values must be either 3 or 6 characters.",blankText:"Must have a hexidecimal value in the format ABCDEF.",maskRe:/[a-f0-9]/i,regex:/[a-f0-9]/i,curColor:"ffffff",validateValue:function(a){if(!this.showHexValue){return true}if(a.length<1){this.el.setStyle({"background-color":"#"+this.defaultColor});if(!this.allowBlank){this.markInvalid(String.format(this.blankText,a));return false}return true}if(a.length!=3&&a.length!=6){this.markInvalid(String.format(this.lengthText,a));return false}this.setColor(a);return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},markInvalid:function(a){GO.form.ColorField.superclass.markInvalid.call(this,a);this.el.setStyle({"background-image":"url(../lib/resources/images/default/grid/invalid_line.gif)"})},setValue:function(a){GO.form.ColorField.superclass.setValue.call(this,a);this.setColor(a)},initValue:function(){GO.form.ColorField.superclass.initValue.call(this);this.setColor(this.value)},setColor:function(a){if(this.rendered){this.curColor=a;this.el.setStyle({"background-color":"#"+a,"background-image":"none"});if(!this.showHexValue){this.el.setStyle({"text-indent":"-100px"});if(Ext.isIE){this.el.setStyle({"margin-left":"100px"})}}}},menuListeners:{select:function(a,b){this.setValue(b)},show:function(){this.onFocus()},hide:function(){this.focus();var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},handleSelect:function(b,a){this.setValue(a)},onTriggerClick:function(){if(this.disabled){return}this.menu.show(this.el,"tl-bl")}});Ext.reg("colorfield",GO.form.ColorField);GO.form.ComboBoxReset=Ext.extend(GO.form.ComboBox,{initComponent:Ext.form.TwinTriggerField.prototype.initComponent,getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",onViewClick:Ext.form.ComboBox.prototype.onViewClick.createSequence(function(){}),onTrigger2Click:function(){this.onTriggerClick()},onTrigger1Click:function(){var a=this.getValue();this.clearValue();this.fireEvent("change",this,this.getValue(),a);this.fireEvent("clear",this)},setValue:function(a){GO.form.ComboBoxReset.superclass.setValue.call(this,a);if(this.rendered){}},afterRender:function(){GO.form.ComboBoxReset.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}}});Ext.reg("comboboxreset",GO.form.ComboBoxReset);GO.form.ComboBoxMulti=function(a){a.typeAhead=false;a.minChars=2;a.hideTrigger=true;a.defaultAutoCreate={tag:"textarea",autocomplete:"off"};GO.form.ComboBoxMulti.superclass.constructor.call(this,a);this.on("focus",function(){this.focused=true},this);this.on("blur",function(){this.focused=false},this)};Ext.extend(GO.form.ComboBoxMulti,GO.form.ComboBox,{sep:",",focused:false,getCursorPosition:function(){if(document.selection){var a=document.selection.createRange();if(!a){return false}var b=a.duplicate();if(!this.el.dom){return false}b.moveToElementText(this.el.dom);b.setEndPoint("EndToEnd",a);return b.text.length}else{return this.el.dom.selectionEnd}},getActiveRange:function(){var b=this.sep;var d=this.getCursorPosition();var a=this.getRawValue();var c=d;while(c>0&&a.charAt(c)!=b){--c}if(c>0){c++}return{left:c,right:d}},getActiveEntry:function(){var a=this.getActiveRange();return this.getRawValue().substring(a.left,a.right).replace(/^s+|s+$/g,"")},replaceActiveEntry:function(c){var b=this.getActiveRange();var a=this.getRawValue();if(this.preventDuplicates&&a.indexOf(c)>=0){return}var e=(this.sep==" "?"":" ");this.setValue(a.substring(0,b.left)+(b.left>0?e:"")+c+this.sep+e+a.substring(b.right));var d=b.left+c.length+2+e.length;this.selectText.defer(200,this,[d,d])},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=Ext.util.Format.htmlDecode(a.data[this.valueField||this.displayField]);if(this.sep){this.replaceActiveEntry(c)}else{this.setValue(c)}this.collapse();this.fireEvent("select",this,a,b)}},initQuery:function(){if(this.focused){this.doQuery(this.sep?this.getActiveEntry():this.getRawValue())}}});GO.form.UploadFile=function(a){if(!a.addText){a.addText=GO.lang.browse}this.inputs=new Ext.util.MixedCollection();GO.form.UploadFile.superclass.constructor.call(this,a);this.addEvents({fileAdded:true})};Ext.extend(GO.form.UploadFile,Ext.BoxComponent,{addText:"",cls:"",defaultAutoCreate:{tag:"div"},fileCls:"filetype",max:0,onRender:function(b,a){this.id=Ext.id();this.el=b.createChild({tag:"div",id:this.id,cls:this.cls})},afterRender:function(){GO.form.UploadFile.superclass.afterRender.call(this);this.createButtons();this.createUploadInput()},createUploadInput:function(){if(!this.inputName){this.inputName=Ext.id()}var b=Ext.id();var a=this.inputWrap.createChild({tag:"input",type:"file",cls:"x-uf-input",size:0,id:b,name:this.inputName+"[]"});a.on("change",this.onFileAdded,this);this.inputs.add(a);return a},createButtons:function(){this.buttonsWrap=this.el.createChild({tag:"div",cls:"x-uf-buttons-ct",id:Ext.id(),children:[{tag:"div",cls:"x-uf-input-ct",id:Ext.id(),children:[{tag:"div",cls:"x-uf-bbtn-ct",id:Ext.id()},{tag:"div",cls:"x-uf-input-wrap",id:Ext.id()}]}]});this.inputWrap=this.buttonsWrap.select("div.x-uf-input-wrap").item(0);this.addBtnCt=this.buttonsWrap.select("div.x-uf-input-ct").item(0);var a=this.buttonsWrap.select("div.x-uf-bbtn-ct").item(0);this.browseBtn=new Ext.Button({renderTo:a,text:this.addText})},onFileAdded:function(b,a){this.inputs.each(function(c){c.setDisplayed(false)});if(!this.table){this.table=this.el.createChild({tag:"table",cls:"x-uf-table",children:[{tag:"tbody"}]});this.tbody=this.table.select("tbody").item(0);this.table.on({click:{scope:this,fn:this.onDeleteFile,delegate:"a"}})}var a=this.inputs.itemAt(this.inputs.getCount()-1);a.un("change",this.onFileAdded,this);this.appendRow(a);this.createUploadInput();if(this.max>0&&this.max<=this.inputs.getCount()){this.setDisabled(true)}this.fireEvent("filesChanged",this,this.inputs)},appendRow:function(c){var a=c.getValue();var d={id:c.id,fileCls:this.getFileCls(a),fileName:Ext.util.Format.ellipsis(a.split(/[\/\\]/).pop(),this.maxNameLength),fileQtip:a};var b=new Ext.Template(['<tr id="r-{id}">','<td class="x-unselectable">','<span class="filetype-link {fileCls}" unselectable="on" qtip="{fileQtip}">{fileName}</span>',"</td>",'<td id="m-{id}" class="x-uf-filedelete"><a id="d-{id}" href="#"><div class="go-icon btn-delete"></div></a>',"</td>","</tr>"]);c.row=b.append(this.tbody,d,true)},onDeleteFile:function(b,a){this.removeFile(a.id.substr(2))},removeFile:function(b){if(this.uploading){return}var a=this.inputs.get(b);if(a&&a.row){a.row.remove()}if(a){a.remove()}this.inputs.removeKey(b);this.setDisabled(false);this.fireEvent("filesChanged",this,this.inputs)},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop()}},clearQueue:function(){this.inputs.each(function(a){if(!a.isVisible()){this.removeFile(a.id,true)}},this)},setDisabled:function(a){if(a){this.addBtnCt.mask()}else{this.addBtnCt.unmask()}}});GO.form.PlainField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div",cls:"x-form-plainfield"},initComponent:function(){GO.form.PlainField.superclass.initComponent.call(this);if(this.boxLabel&&GO.util.empty(this.fieldLabel)){this.fieldLabel=this.boxLabel;this.hideLabel=false}this.addEvents("load")},getName:function(){return this.name},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setValue(this.el.dom.value)}}this.originalValue=this.getValue()},getValue:function(){return this.value},setValue:function(a){if(this.boxLabel){if(a=="1"){a=GO.lang.cmdYes}else{a=GO.lang.cmdNo}}this.value=a;if(this.rendered){this.el.update(a)}}});Ext.reg("plainfield",GO.form.PlainField);GO.form.SelectUser=function(a){a=a||{};if(typeof(a.allowBlank)=="undefined"){a.allowBlank=false}Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","username","company","first_name","middle_name","last_name","address","address_no","zip","city","state","country"],remoteSort:true});this.store.setDefaultSort("name","asc");if(!this.hiddenName){this.hiddenName="user_id"}if(!a.startBlank){this.setRemoteValue(GO.settings.user_id,GO.settings.name);this.value=GO.settings.user_id}GO.form.SelectUser.superclass.constructor.call(this,{displayField:"name",valueField:"id",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectUser,GO.form.ComboBoxReset,{setRemoteValue:function(a,b){var c=this.findRecord("id",a);if(!c){var e=Ext.data.Record.create([{name:"id"},{name:"name"}]);var d=new e({id:a,name:b});this.store.add(d)}this.setValue(a)}});Ext.reg("selectuser",GO.form.SelectUser);GO.form.SelectGroup=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.groups.url+"non_admin_json.php",baseParams:{task:"groups"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","groupname"],remoteSort:true});this.store.setDefaultSort("name","asc");this.setRemoteValue(GO.settings.group_id,GO.settings.name);GO.form.SelectGroup.superclass.constructor.call(this,{displayField:"name",hiddenName:"group_id",value:GO.settings.group_id,valueField:"id",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectGroup,GO.form.ComboBox,{setRemoteValue:function(c,b){var d=Ext.data.Record.create([{name:"id"},{name:"name"}]);var a=new d({id:c,name:b});this.store.add(a);this.setValue(c)}});Ext.reg("selectgroup",GO.form.SelectGroup);GO.form.SelectCountry=function(b){if(!GO.countriesStore){var a=[];for(var d in GO.lang.countries){a.push([d,GO.lang.countries[d]])}GO.countriesStore=new Ext.data.SimpleStore({fields:["iso","name"],data:a,sortInfo:{field:"name",direction:"ASC"}})}Ext.apply(this,b);GO.form.SelectCountry.superclass.constructor.call(this,{store:GO.countriesStore,valueField:"iso",displayField:"name",triggerAction:"all",editable:true,mode:"local",selectOnFocus:true,forceSelection:true,emptyText:GO.lang.strNoCountrySelected})};Ext.extend(GO.form.SelectCountry,Ext.form.ComboBox);GO.addressFormatStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"select_address_format"},root:"results",totalProperty:"total",id:"iso",fields:["iso","address_format_id","country_name"],remoteSort:true});GO.addressFormatStore.setDefaultSort("country_name","ASC");GO.form.SelectAddressFormat=function(a){Ext.apply(this,a);this.store=GO.addressFormatStore;GO.form.SelectAddressFormat.superclass.constructor.call(this,{valueField:"iso",triggerAction:"all",selectOnFocus:true,forceSelection:true,editable:true,mode:"local",lazyInit:false})};Ext.extend(GO.form.SelectAddressFormat,GO.form.ComboBox,{afterRender:function(){if(!this.store.loaded){this.store.load({callback:function(){var a=this.getValue();if(a){this.setValue(a)}},scope:this})}GO.form.SelectAddressFormat.superclass.afterRender.call(this)}});Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:false,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.fileInput.on("change",function(){var d=this.fileInput.dom.value;this.setValue(d);this.fireEvent("fileselected",this,d)},this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);GO.form.TriggerIdField=Ext.extend(Ext.form.TriggerField,{onRender:function(b,a){GO.form.TriggerIdField.superclass.onRender.call(this,b,a);this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.name},"before",true);this.el.dom.removeAttribute("name")},initValue:function(){GO.form.TriggerIdField.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},setValue:function(a){if(this.hiddenField){this.hiddenField.value=a}},setText:function(a){this.setRawValue(a)}});GO.form.HtmlComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",html:this.html,cls:this.cls,style:this.style})}});Ext.reg("htmlcomponent",GO.form.HtmlComponent);GO.form.NumberField=Ext.extend(Ext.form.TextField,{decimals:2,initComponent:function(){GO.form.NumberField.superclass.initComponent.call(this);this.style="text-align:right";this.on("focus",function(a){this.fixPrecision();a.focus(true)})},beforeBlur:function(){this.fixPrecision()},fixPrecision:function(){var a=GO.util.unlocalizeNumber(this.getValue());this.setValue(GO.util.numberFormat(a,this.decimals))}});Ext.reg("numberfield",GO.form.NumberField);GO.grid.PermissionsPanel=Ext.extend(Ext.Panel,{changed:false,loaded:false,initComponent:function(){if(!this.title){this.title=GO.lang.strPermissions}var c={store:new Ext.data.SimpleStore({id:0,fields:["value","text"],data:[[1,GO.lang.permissionRead],[2,GO.lang.permissionWrite],[3,GO.lang.permissionDelete],[4,GO.lang.permissionManage]]}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true};var d=new GO.form.ComboBox(c);var b=new GO.form.ComboBox(c);this.header=false;this.layout="anchor";this.border=false;this.anchor="100% 100%";this.disabled=true;this.aclGroupsStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"groups_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name","level"],remoteSort:true});this.aclGroupsStore.setDefaultSort("name","ASC");var a=function(e){var f=c.store.getById(e);return f.get("text")};this.aclGroupsGrid=new GO.grid.EditorGridPanel({anchor:"100% 50%",title:GO.lang.strAuthorizedGroups,store:this.aclGroupsStore,border:false,columns:[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true},{header:GO.lang.permissionsLevel,dataIndex:"level",menuDisabled:true,editor:d,renderer:a}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddGroupsDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclGroupsGrid.deleteSelected()},scope:this}]});this.aclGroupsGrid.on("afteredit",function(f){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"update_level",acl_id:this.store.baseParams.acl_id,group_id:f.record.get("id"),level:f.record.get("level")},success:function(e,g){var j=Ext.decode(e.responseText);if(!j.success){alert(j.feedback);this.store.rejectChanges()}else{this.store.commitChanges()}},scope:this})},this.aclGroupsGrid);this.aclUsersStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"users_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name","level"],remoteSort:true});this.aclUsersStore.setDefaultSort("name","ASC");this.aclUsersGrid=new GO.grid.EditorGridPanel({anchor:"100% 50%",title:GO.lang.strAuthorizedUsers,store:this.aclUsersStore,border:false,columns:[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true},{header:GO.lang.permissionsLevel,dataIndex:"level",menuDisabled:true,editor:b,renderer:a}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddUsersDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclUsersGrid.deleteSelected()},scope:this}]});this.aclUsersGrid.on("afteredit",function(f){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"update_level",acl_id:this.store.baseParams.acl_id,user_id:f.record.get("id"),level:f.record.get("level")},success:function(e,g){var j=Ext.decode(e.responseText);if(!j.success){alert(j.feedback);this.store.rejectChanges()}else{this.store.commitChanges()}},scope:this})},this.aclUsersGrid);this.items=[this.aclGroupsGrid,this.aclUsersGrid];GO.grid.PermissionsPanel.superclass.initComponent.call(this)},setAcl:function(a){this.acl_id=a?a:0;this.loaded=false;this.aclGroupsStore.baseParams.acl_id=a;this.aclUsersStore.baseParams.acl_id=a;this.setDisabled(a==0);if(this.isVisible()){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},onShow:function(){GO.grid.PermissionsPanel.superclass.onShow.call(this);if(!this.loaded){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},afterRender:function(){GO.grid.PermissionsPanel.superclass.afterRender.call(this);if(this.isVisible()&&!this.loaded){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},showAddGroupsDialog:function(){if(!this.addGroupsDialog){this.addGroupsDialog=new GO.dialog.SelectGroups({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclGroupsStore.baseParams.add_groups=Ext.encode(a.selModel.selections.keys);this.aclGroupsStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclGroupsStore.baseParams.add_groups}},scope:this})}this.addGroupsDialog.show()},showAddUsersDialog:function(){if(!this.addUsersDialog){this.addUsersDialog=new GO.dialog.SelectUsers({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclUsersStore.baseParams.add_users=Ext.encode(a.selModel.selections.keys);this.aclUsersStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclUsersStore.baseParams.add_users}},scope:this})}this.addUsersDialog.show()}});GO.NewMenuButton=Ext.extend(Ext.Button,{panel:false,initComponent:function(){this.menu=new Ext.menu.Menu({items:GO.newMenuItems,panel:this.panel});this.text=GO.lang.cmdNew;this.iconCls="btn-add";this.disabled=true;this.hidden=GO.newMenuItems.length==0;GO.NewMenuButton.superclass.initComponent.call(this)},setLinkConfig:function(a){this.menu.link_config=a;this.menu.link_config.type_id=a.type+":"+a.id;if(!this.menu.link_config.scope){this.menu.link_config.scope=this}if(this.menu.link_config.callback){this.menu.link_config.callback=this.menu.link_config.callback.createDelegate(this.menu.link_config.scope)}this.setDisabled(false)}});GO.LinkFolderWindow=function(a){if(!a){a={}}var b=function(){this.newFolderNameField.focus(true)};this.newFolderNameField=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name",value:GO.lang.newFolder,allowBlank:false,anchor:"100%"});this.formPanel=new Ext.form.FormPanel({defaultType:"textfield",labelWidth:75,cls:"go-form-panel",waitMsgTarget:true,items:this.newFolderNameField,autoHeight:true,baseParams:{task:"link_folder",folder_id:0}});a.layout="fit";a.modal=false;a.resizable=false;a.width=400;a.autHeight=true;a.closeAction="hide";a.title=GO.lang.newFolder;a.items=this.formPanel;a.focus=b.createDelegate(this);a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.LinkFolderWindow.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.LinkFolderWindow,Ext.Window,{show:function(a){if(!this.rendered){this.render(Ext.getBody())}if(!a.folder_id){a.folder_id=0}this.link_id=a.link_id?a.link_id:0;this.link_type=a.link_type?a.link_type:0;this.parent_id=a.parent_id?a.parent_id:0;this.setLinkFolderId(a.folder_id);if(this.folder_id>0){this.formPanel.load({url:BaseHref+"json.php",success:function(b,c){this.setLinkFolderId(c.result.data.id);this.link_id=c.result.data.link_id;this.link_type=c.result.data.link_type;this.parent_id=c.result.data.parent_id;GO.LinkFolderWindow.superclass.show.call(this)},failure:function(b,c){Ext.Msg.alert(GO.lang.strError,c.result.feedback)},scope:this})}else{this.formPanel.form.reset();GO.LinkFolderWindow.superclass.show.call(this)}},setLinkFolderId:function(a){if(!a){a=0}this.formPanel.form.baseParams.folder_id=a;this.folder_id=a},submitForm:function(a){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_link_folder",link_id:this.link_id,link_type:this.link_type,parent_id:this.parent_id},waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.fireEvent("save",this);if(a){this.hide()}else{if(c.result.folder_id){this.setLinkFolderId(c.result.folder_id)}}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})}});GO.form.SelectLink=function(a){a=a||{};a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{query:"",task:"links"},root:"results",totalProperty:"total",fields:["link_id","link_type","link_and_type","type_name"],remoteSort:true});a.forceSelection=true;a.displayField="type_name";a.valueField="link_and_type",a.hiddenName="link";a.triggerAction="all";a.width=400;a.selectOnFocus=false;a.fieldLabel=GO.lang.cmdLink;a.pageSize=parseInt(GO.settings.max_rows_list);GO.form.SelectLink.superclass.constructor.call(this,a)};Ext.extend(GO.form.SelectLink,GO.form.ComboBox);GO.LinksTree=function(a){if(!a){a={}}a.layout="fit";a.split=true;a.autoScroll=true;a.animate=true;a.loader=new Ext.tree.TreeLoader({dataUrl:BaseHref+"json.php",baseParams:{task:"link_folders_tree",link_type:0,link_id:0},preloadChildren:true});a.collapsed=a.treeCollapsed;a.containerScroll=true;a.rootVisible=true;a.collapsible=true;a.header=false;a.collapseMode="mini";a.ddAppendOnly=true;a.containerScroll=true;a.ddGroup="LinksDD";a.enableDD=true;GO.LinksTree.superclass.constructor.call(this,a);this.rootNode=new Ext.tree.AsyncTreeNode({text:GO.lang.root,draggable:false,iconCls:"folder-default",expanded:false});this.setRootNode(this.rootNode)};Ext.extend(GO.LinksTree,Ext.tree.TreePanel,{loadLinks:function(c,d,a,b){this.loader.baseParams.link_id=c;this.loader.baseParams.link_type=d;if(a){if(b){a=a.createDelegate(b)}}else{a=function(){}}if(this.rootNode.isExpanded()){this.rootNode.reload(a)}else{this.rootNode.expand(false,true,a)}}});GO.grid.LinksGrid=function(a){var b;if(!a){a={}}if(!a.link_id){a.link_id=0}if(!a.link_type){a.link_type=0}if(!a.folder_id){a.folder_id=0}a.hideMode="offsets";a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id,type_filter:"true"},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls","link_description"],remoteSort:true});a.store.setDefaultSort("mtime","desc");if(!a.noSearchField){this.searchField=new GO.form.SearchField({store:a.store,width:240});a.tbar=[GO.lang.strSearch+": "," ",this.searchField]}a.clicksToEdit=1;a.enableDragDrop=true;a.ddGroup="LinksDD";a.columns=[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(d,e,c){return'<div class="go-grid-icon '+c.data.iconCls+'">'+d+"</div>"}},{header:GO.lang.strDescription,dataIndex:"link_description",sortable:true,editor:new GO.form.LinkDescriptionField()},{header:GO.lang.strType,dataIndex:"type",sortable:true,hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:80}];a.paging=true;a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItemsShort,emptyMsg:GO.lang.strNoItems});a.layout="fit";a.view=new Ext.grid.GridView({enableRowBody:true,showPreview:true,autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems,getRowClass:function(c,f,e,d){if(this.showPreview&&c.data.description.length){e.body='<div class="go-links-panel-description">'+c.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}});a.loadMask={msg:GO.lang.waitMsgLoad};a.sm=new Ext.grid.RowSelectionModel({});GO.grid.LinksGrid.superclass.constructor.call(this,a);this.addEvents({folderOpened:true,folderDrop:true})};Ext.extend(GO.grid.LinksGrid,GO.grid.EditorGridPanel,{write_permission:false,afterRender:function(){GO.grid.LinksGrid.superclass.afterRender.call(this);var a=new Ext.dd.DropTarget(this.getView().mainBody,{ddGroup:"LinksDD",copy:false,notifyOver:this.onGridNotifyOver,notifyDrop:this.onGridNotifyDrop.createDelegate(this)});this.on("afteredit",function(b){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"updatelink",link_id1:this.store.baseParams.link_id,link_type1:this.store.baseParams.link_type,link_id2:b.record.get("id"),link_type2:b.record.get("link_type"),description:b.record.get("link_description")},success:function(c,d){var e=Ext.decode(c.responseText);if(!e.success){alert(e.feedback)}else{this.store.commitChanges()}},scope:this})},this)},onGridNotifyOver:function(a,f,c){var d=a.getDragData(f);if(c.grid&&this.write_permission){var b=c.grid.store.data.items[d.rowIndex];if(b){if(b.data.link_type=="folder"){return this.dropAllowed}}}return false},onGridNotifyDrop:function(a,g,d){if(d.grid&&this.write_permission){var j=d.grid.getSelectionModel();var c=j.getSelections();var f=a.getDragData(g);var b=d.grid.store.data.items[f.rowIndex];if(b.data.link_type=="folder"){this.fireEvent("folderDrop",this,d.selections,b)}}else{return false}},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.dialog.LinksDialog=function(a){Ext.apply(this,a);this.grid=new GO.grid.SearchPanel({noTitle:true,noOpenLinks:true,dontLoadOnRender:true});this.grid.searchGrid.on("rowdblclick",this.linkItems,this);var b=function(){this.grid.searchField.focus(true)};GO.dialog.LinksDialog.superclass.constructor.call(this,{layout:"fit",focus:b.createDelegate(this),modal:false,minWidth:300,minHeight:300,height:500,width:700,border:false,plain:true,closeAction:"hide",title:GO.lang.strLinkItems,items:this.grid,listeners:{show:function(){this.grid.load()},scope:this},buttons:[{text:GO.lang.cmdOk,handler:function(){this.linkItems()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({link:true})};Ext.extend(GO.dialog.LinksDialog,Ext.Window,{folder_id:0,setLinkRecords:function(b){this.fromLinks=[];for(var a=0;a<b.length;a++){this.fromLinks.push({link_id:b[a].data.link_id,link_type:b[a].data.link_type})}},setSingleLink:function(a,b){this.fromLinks=[{link_id:a,link_type:b}]},selectFolder:function(a){},linkItems:function(){var a=this.grid.searchGrid.getSelectionModel();var c=a.getSelections();var b=[];for(var d=0;d<c.length;d++){b.push({link_id:c[d].data.id,link_type:c[d].data.link_type})}if(b.length==1){if(!this.selectFolderWindow){this.selectFolderTree=new GO.LinksTree();this.selectFolderTree.on("dblclick",function(f){var e=parseInt(f.id.replace("lt-folder-",""));this.sendLinkRequest(b,e);this.selectFolderWindow.hide()},this);this.selectFolderWindow=new GO.Window({layout:"fit",title:GO.lang.selectFolder,items:this.selectFolderTree,closeAction:"hide",width:400,height:400,modal:true,closable:true,buttons:[{text:GO.lang.cmdOk,handler:function(){var f=this.selectFolderTree.getSelectionModel().getSelectedNode();if(!f){alert(GO.lang.selectFolder)}var e=parseInt(f.id.replace("lt-folder-",""));this.sendLinkRequest(b,e);this.selectFolderWindow.hide()},scope:this}]})}this.selectFolderWindow.show();this.selectFolderTree.loadLinks(b[0]["link_id"],b[0]["link_type"],function(e){if(!e.childNodes.length){this.selectFolderWindow.hide();this.sendLinkRequest(b)}},this)}else{this.sendLinkRequest(b)}},sendLinkRequest:function(b,a){var a=a||0;Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"link",fromLinks:Ext.encode(this.fromLinks),toLinks:Ext.encode(b),description:this.grid.linkDescriptionField.getValue(),folder_id:this.folder_id,to_folder_id:a},callback:function(d,e,c){if(!e){Ext.MessageBox.alert(GO.lang.strError,c.result.errors)}else{this.fireEvent("link");this.grid.searchGrid.getSelectionModel().clearSelections();this.hide()}},scope:this})}});GO.grid.LinksPanel=function(a){if(!a){a={}}if(!this.link_id){this.link_id=0}if(!this.link_type){this.link_type=0}if(!this.folder_id){this.folder_id=0}if(!a.id){a.id="go-links-panel"}this.linksDialog=new GO.dialog.LinksDialog({linksStore:a.store});this.linksDialog.on("link",function(){this.linksGrid.store.reload()},this);this.linksTree=new GO.LinksTree({id:a.id+"_tree",region:"center",split:true});this.linksTree.on("click",function(b){this.setFolder(b.id.substr(10))},this);this.linksTree.on("contextmenu",function(d,g){g.stopEvent();var c=this.linksTree.getSelectionModel();if(!c.isSelected(d)){c.clearSelections();c.select(d)}var b=d.id.substr(10);if(b!=""){var f=g.getXY();this.linksContextMenu.showAt([f[0],f[1]],["folder:"+b],"folder")}},this);this.linksTree.on("beforenodedrop",function(j){if(!this.write_permission){return false}var g={folder_id:j.target.id.substr(10),link_id:this.link_id,link_type:this.link_type};var c=[];if(j.data.selections){for(var b=0;b<j.data.selections.length;b++){if(j.data.selections[b].data.link_and_type.substr(0,6)=="folder"){var k=j.data.selections[b].data.link_and_type.substr(7);var d=this.linksTree.getNodeById("lt-folder-"+k);var f=this.linksTree.getNodeById("lt-folder-"+g.folder_id);f.appendChild(d)}c.push(j.data.selections[b].data.link_and_type)}}else{c=["folder:"+j.data.node.id.substr(10)]}this.moveSelections(c,g)},this);this.linksGrid=new GO.grid.LinksGrid({region:"center",id:a.id+"_grid",deleteConfig:{scope:this,success:this.onDelete}});this.linksGrid.store.on("load",function(){var c=this.linksTree.getSelectionModel();var b=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b){c.select(b)}else{c.select(this.linksTree.getRootNode())}},this);this.linksGrid.on("folderDrop",function(d,e,b){var g={folder_id:b.data.id,link_id:this.link_id,link_type:this.link_type};var f=[];for(var c=0;c<e.length;c++){f.push(e[c].data.link_and_type)}this.moveSelections(f,g)},this);this.linksGrid.on("rowcontextmenu",function(b,g,d){d.stopEvent();var f=b.getSelectionModel();if(f.isSelected(g)!==true){f.clearSelections();f.selectRow(g)}var c=d.getXY();this.linksContextMenu.showAt([c[0],c[1]],f.selections.keys)},this);this.linksGrid.store.on("load",function(){this.setWritePermission(this.linksGrid.store.reader.jsonData.write_permission)},this);this.folderWindow=new GO.LinkFolderWindow();this.folderWindow.on("save",function(b){this.linksGrid.store.reload();var c=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b.folder_id==this.folder_id&&c){c=c.parentNode}if(c){delete c.attributes.children;c.reload()}else{this.linksTree.rootNode.reload()}},this);this.linkPreviewPanels[0]=new Ext.Panel({bodyStyle:"padding:5px"});this.previewPanel=new Ext.Panel({id:a.id+"_preview",region:"east",width:420,split:true,layout:"card",items:[this.linkPreviewPanels[0]]});this.linkTypeFilter=new GO.LinkTypeFilterPanel({region:"south",height:300});this.linkTypeFilter.on("change",function(c,b){this.linksGrid.store.baseParams.types=Ext.encode(b);this.linksGrid.store.load();delete this.linksGrid.store.baseParams.types},this);a.items=[{region:"west",width:160,layout:"border",id:a.id+"_west",items:[this.linksTree,this.linkTypeFilter]},this.linksGrid,this.previewPanel];this.linksContextMenu=new GO.LinksContextMenu();this.linksContextMenu.on("properties",function(e,c){var d=c[0].indexOf(":");var b=c[0].substr(d+1);this.folderWindow.show({folder_id:b})},this);this.linksContextMenu.on("delete",function(d,b){if(b.indexOf("folder:"+this.folder_id)>-1){this.setFolder(0,true)}var c={store:this.linksGrid.store,params:{delete_keys:Ext.encode(b)},count:b.length,callback:this.onDelete,scope:this};GO.deleteItems(c)},this);this.linksContextMenu.on("unlink",function(c,b){this.unlinkSelected()},this);a.layout="border";a.border=false;a.hideMode="offsets";a.tbar=[this.linkButton=new Ext.Button({iconCls:"btn-link",text:GO.lang.cmdLink,cls:"x-btn-text-icon",handler:function(){this.linksDialog.show()},scope:this}),this.newFolderButton=new Ext.Button({iconCls:"btn-add",text:GO.lang.newFolder,cls:"x-btn-text-icon",handler:function(){this.folderWindow.show({link_id:this.link_id,link_type:this.link_type,parent_id:this.folder_id})},scope:this}),this.unlinkButton=new Ext.Button({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.unlinkSelected()},scope:this}),"-",{iconCls:"btn-refresh",text:GO.lang.cmdRefresh,cls:"x-btn-text-icon",handler:function(){this.linksGrid.store.load();this.linksTree.getRootNode().reload()},scope:this},"-",this.deleteButton=new Ext.Button({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.linksGrid.deleteSelected()},scope:this})];if(GO.links&&GO.links.SettingsDialog){a.tbar.push("-");a.tbar.push({text:GO.lang.cmdSettings,scope:this,iconCls:"btn-settings",handler:function(){if(!this.settingsWindow){this.settingsWindow=new GO.links.SettingsDialog()}this.settingsWindow.show()}})}this.linksGrid.on("rowdblclick",this.rowDoulbleClicked,this);this.linksGrid.on("delayedrowselect",this.rowClicked,this);GO.grid.LinksPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.LinksPanel,Ext.Panel,{linkPreviewPanels:[],onDelete:function(j){var f=Ext.decode(j.params.delete_keys);var g,c,d;for(var e=0;e<f.length;e++){g=f[e].indexOf(":");c=f[e].substr(g+1);d=this.linksTree.getNodeById("lt-folder-"+c);if(d){d.remove()}}var b={};for(var e=0;e<f.length;e++){var a=f[e].split(":");if(!b[a[0]]){b[a[0]]=[]}b[a[0]].push(a[1])}GO.mainLayout.fireEvent("linksDeleted",j,b)},afterRender:function(){GO.grid.LinksPanel.superclass.afterRender.call(this);if(this.isVisible()){this.onShow()}},unlinkSelected:function(){var a=this.linksGrid.getSelectionModel();var b=a.getSelections();if(b.length>0){this.linksGrid.store.baseParams.unlinks=Ext.encode(a.selections.keys);this.linksGrid.store.reload();delete this.linksGrid.store.baseParams.unlinks}},moveSelections:function(a,b){Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"move_links",selections:Ext.encode(a),target:Ext.encode(b)},callback:function(e,j,d){if(!j){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(d.responseText);if(g.moved_links){for(var f=0;f<g.moved_links.length;f++){var c=this.linksGrid.store.getById(g.moved_links[f]);if(c){this.linksGrid.store.remove(c)}}}}},scope:this})},rowDoulbleClicked:function(b,c,d){var a=b.store.getAt(c);if(a.data.link_type=="folder"){this.setFolder(a.data.id)}else{this.previewPanel.getLayout().activeItem.editHandler()}},rowClicked:function(c,d,a){this.previewPanel.getLayout().setActiveItem(0);var b="link_pp_"+a.data.link_type;if(a.data.link_type!="folder"){if(!GO.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels[0].body.update("Sorry, the preview of this type not implemented yet.")}else{if(!this.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels[a.data.link_type]=GO.linkPreviewPanels[a.data.link_type].call(this,{id:b});this.previewPanel.add(this.linkPreviewPanels[a.data.link_type])}this.previewPanel.getLayout().setActiveItem(b);this.linkPreviewPanels[a.data.link_type].load(a.data.id)}}},onShow:function(){GO.grid.LinksPanel.superclass.onShow.call(this);this.previewPanel.getLayout().setActiveItem(0);if(!this.loaded&&this.link_id>0){this.linksGrid.store.load();var a=this.linksTree.getRootNode();if(a.isExpanded()){a.reload()}else{a.expand()}this.loaded=true}},setWritePermission:function(a){this.linkButton.setDisabled(!a);this.unlinkButton.setDisabled(!a);this.newFolderButton.setDisabled(!a);this.deleteButton.setDisabled(!a);this.write_permission=a;this.linksGrid.write_permission=a},setFolder:function(a,b){var c=this.linksTree.getNodeById("lt-folder-"+a);if(c){c.expand()}this.linksDialog.folder_id=a;this.folder_id=a;this.linksGrid.store.baseParams.folder_id=a;if(!b){this.linksGrid.store.load()}},loadLinks:function(b,c,a){if(b>0){this.setDisabled(false)}else{this.setDisabled(true)}if(this.link_id!=b||this.link_type!=c){this.link_id=this.linksGrid.store.baseParams.link_id=b;this.link_type=this.linksGrid.store.baseParams.link_type=c;this.linksGrid.store.baseParams.folder_id=a;this.linksTree.loadLinks(b,c);this.linksDialog.setSingleLink(this.link_id,this.link_type);this.loaded=false}}});GO.linksTemplate='<tpl if="links.length"><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="4" class="display-panel-heading">'+GO.lang.latestLinks+'</td></tr><tr><td style="width:16px" class="display-panel-links-header">&nbsp;</td><td style="width: 100%" class="table_header_links">'+GO.lang.strName+'</td><td class="table_header_links" style="white-space:nowrap">'+GO.lang.strMtime+'</td></tr><tpl for="links"><tr class="display-panel-link"><td><div class="go-icon {iconCls}" ext:qtip="{type}"></div></td><td><a href="#link_{[xindex-1]}">{name}</a><tpl if="link_description.length"><br />{link_description}</tpl></td><td style="white-space:nowrap">{mtime}</td></tr><tpl if="description.length"><tr class="display-panel-link-description"><td>&nbsp;</td><td colspan="3">{description}</td></tr></tpl></tpl></tpl>';GO.linksTemplateConfig={};GO.LinksContextMenu=function(a){if(!a){a={}}a.shadow="frame";a.minWidth=180;this.deleteButton=new Ext.menu.Item({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.fireEvent("delete",this,this.selected)},scope:this});this.unlinkButton=new Ext.menu.Item({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.fireEvent("unlink",this,this.selected)},scope:this});this.propertiesButton=new Ext.menu.Item({iconCls:"btn-properties",text:GO.lang.strProperties,handler:function(){this.fireEvent("properties",this,this.selected)},scope:this});a.items=[this.propertiesButton,this.deleteButton,this.unlinkButton];GO.LinksContextMenu.superclass.constructor.call(this,a);this.addEvents({properties:true,unlink:true,"delete":true})};Ext.extend(GO.LinksContextMenu,Ext.menu.Menu,{clickedAt:"grid",showAt:function(d,a){this.link_type=c;this.selected=a;if(this.selected.length>1){c="mixed"}else{var b=a[0].indexOf(":");var c=a[0].substr(0,b)}switch(c){case"folder":this.propertiesButton.show();this.unlinkButton.hide();break;default:this.propertiesButton.hide();this.unlinkButton.show();break}GO.LinksContextMenu.superclass.showAt.call(this,d)}});GO.LinkBrowser=function(a){Ext.apply(this,a);this.linksPanel=new GO.grid.LinksPanel();if(!this.id){this.id="go-link-browser"}GO.LinkBrowser.superclass.constructor.call(this,{layout:"fit",modal:false,minWidth:300,minHeight:300,height:500,width:950,border:false,plain:true,maximizable:true,collapsible:true,closeAction:"hide",title:GO.lang.cmdBrowseLinks,items:this.linksPanel});this.addEvents({link:true})};Ext.extend(GO.LinkBrowser,GO.Window,{show:function(a){this.linksPanel.loadLinks(a.link_id,a.link_type);if(a.folder_id){this.linksPanel.setFolder(a.folder_id)}GO.LinkBrowser.superclass.show.call(this)}});GO.LinkViewWindow=function(a){if(!a){a={}}a.collapsible=true;a.maximizable=true;a.layout="fit";a.modal=false;a.resizable=true;if(!a.width){a.width=500}if(!a.height){a.height=500}GO.LinkViewWindow.superclass.constructor.call(this,a);this.render(Ext.getBody())};Ext.extend(GO.LinkViewWindow,Ext.Window);GO.LinkTypeFilterPanel=function(a){if(!a){a={}}a.split=true;a.resizable=true;a.autoScroll=true;a.collapsible=true;a.header=false;a.collapseMode="mini";var b=new GO.grid.CheckColumn({header:"&nbsp;",dataIndex:"checked",width:30});if(!GO.linkTypesStore){GO.linkTypesStore=new Ext.data.JsonStore({root:"results",data:{results:GO.linkTypes},fields:["id","name","checked"],id:"id"})}this.filterGrid=new GO.grid.GridPanel({cls:"go-grid3-hide-headers",autoHeight:true,border:false,loadMask:true,store:GO.linkTypesStore,columns:[b,{header:GO.lang.strName,dataIndex:"name",id:"name"}],plugins:[b],autoExpandColumn:"name",listeners:{scope:this,delayedrowselect:function(c,e,d){this.applyFilter(d.id)}}});a.tbar=[{iconCls:"btn-save",text:GO.lang.cmdApply,handler:function(){this.applyFilter(-1)},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdReset,handler:function(){this.applyFilter(0)},scope:this}];a.items=[this.filterGrid];GO.LinkTypeFilterPanel.superclass.constructor.call(this,a);this.addEvents({change:true})};Ext.extend(GO.LinkTypeFilterPanel,Ext.Panel,{applyFilter:function(e){var c=[],d,a;for(var b=0;b<this.filterGrid.store.data.items.length;b++){a=this.filterGrid.store.data.items[b].get("id");if(e>-1&&e!=a){d=false;this.filterGrid.store.data.items[b].set("checked","0")}else{if(e==a){d="1";this.filterGrid.store.data.items[b].set("checked","1")}else{d=this.filterGrid.store.data.items[b].get("checked")}}if(d=="1"){c.push(this.filterGrid.store.data.items[b].get("id"))}}this.fireEvent("change",this,c);this.filterGrid.store.commitChanges();this.filterGrid.getSelectionModel().clearSelections()}});GO.form.LinkDescriptionField=Ext.extend(function(a){a=a||{};a.store=new GO.data.JsonStore({url:GO.settings.config.host+"json.php",baseParams:{task:"link_descriptions"},root:"results",id:"id",totalProperty:"total",fields:["id","description"],remoteSort:true});a.displayField="description";a.triggerAction="all";a.selectOnFocus=false;a.pageSize=parseInt(GO.settings.max_rows_list);GO.form.LinkDescriptionField.superclass.constructor.call(this,a)},GO.form.ComboBoxReset,{hiddenName:"description",maxLength:100});GO.LinksAccordion=Ext.extend(Ext.Panel,{link_id:0,link_type:0,title:GO.lang.strLinks,disabled:true,initComponent:function(){this.layout="accordion";this.items=[];if(GO.calendar){var a=new GO.grid.LinksGrid({title:GO.calendar.lang.appointments,noSearchField:true});a.store.baseParams.types=Ext.encode([1]);this.items.push(a)}if(GO.tasks){var b=new GO.grid.LinksGrid({title:GO.tasks.lang.tasks,noSearchField:true});b.store.baseParams.types=Ext.encode([12]);this.items.push(b)}if(GO.notes){var d=new GO.grid.LinksGrid({title:GO.notes.lang.notes,noSearchField:true});d.store.baseParams.types=Ext.encode([4]);this.items.push(d)}var e;for(var c=0;c<this.items.length;c++){e=this.items[c];e.store.baseParams.no_filter_save=true;e.on("expand",function(){if(!e.store.loaded){e.store.load()}},this)}this.on("show",this.loadActivePanel,this);GO.LinksAccordion.superclass.initComponent.call(this)},setLinkID:function(a,b){this.setDisabled(GO.util.empty(a));this.link_id=a;this.items.each(function(c){c.store.loaded=false;c.store.baseParams.link_id=a;c.store.baseParams.link_type=b;c.store.baseParams.type_filter=true});if(this.isVisible()){this.loadActivePanel()}},loadActivePanel:function(){var a=this.layout.activeItem;if(!a.store.loaded){a.store.load()}}});GO.grid.SearchPanel=function(a){a=a||{};if(!this.query){this.query=""}if(!a.id){a.id=Ext.id()}a.border=false;if(!a.noTitle){a.title=GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.query)+'"'}a.iconCls="go-search-icon-tab";a.layout="border";this.filterPanel=new GO.LinkTypeFilterPanel({region:"west",split:true,border:true,width:160});this.filterPanel.on("change",function(d,c){this.searchGrid.store.baseParams.types=Ext.encode(c);this.searchGrid.store.load();delete this.searchGrid.store.baseParams.types},this);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id,type_filter:"true"},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls"],remoteSort:true});this.searchField=new GO.form.SearchField({store:this.store,width:320});var b={border:true,region:"center",tbar:[GO.lang.strSearch+": "," ",this.searchField,"-",{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.searchGrid.deleteSelected()},scope:this}],store:this.store,columns:[{id:"name",header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(d,e,c){return'<div class="go-grid-icon '+c.data.iconCls+'">'+d+"</div>"}},{header:GO.lang.strType,dataIndex:"type",sortable:true,width:100},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:100}],autoExpandMax:2500,autoExpandColumn:"name",paging:true,layout:"fit",view:new Ext.grid.GridView({enableRowBody:true,showPreview:true,emptyText:GO.lang.strNoItems,getRowClass:function(c,f,e,d){if(this.showPreview&&c.data.description.length){e.body='<div class="go-links-panel-description">'+c.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({})};this.searchGrid=new GO.grid.GridPanel(b);this.searchGrid.store.setDefaultSort("mtime","desc");if(!a.noTitle){this.searchGrid.store.on("load",function(){this.setTitle(GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.searchGrid.store.baseParams.query)+'"')},this)}a.items=[this.filterPanel,this.searchGrid];if(!a.noOpenLinks){this.searchGrid.on("rowdblclick",function(c,d,f){this.previewPanel.getLayout().activeItem.editHandler()},this);this.linkPreviewPanels.search_pp_0=new Ext.Panel({bodyStyle:"padding:5px"});this.previewPanel=new Ext.Panel({id:a.id+"_preview",region:"east",width:420,split:true,layout:"card",items:[this.linkPreviewPanels.search_pp_0]});a.items.push(this.previewPanel);this.searchGrid.on("delayedrowselect",this.rowClicked,this)}if(a.noOpenLinks){a.items.push({region:"south",height:34,layout:"form",cls:"go-form-panel",split:true,items:this.linkDescriptionField=new GO.form.LinkDescriptionField({name:"description",fieldLabel:GO.lang.strDescription,anchor:"100%"})})}GO.grid.SearchPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.SearchPanel,Ext.Panel,{linkPreviewPanels:[],rowClicked:function(c,d,a){this.previewPanel.getLayout().setActiveItem(0);var b="search_pp_"+a.data.link_type;if(a.data.link_type!="folder"){if(!GO.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels.search_pp_0.body.update("Sorry, the preview of this type not implemented yet.")}else{if(!this.linkPreviewPanels[b]){this.linkPreviewPanels[b]=GO.linkPreviewPanels[a.data.link_type].call(this,{id:b});this.previewPanel.add(this.linkPreviewPanels[b])}this.previewPanel.getLayout().setActiveItem(b);this.linkPreviewPanels[b].load(a.data.id)}}},afterRender:function(){GO.grid.SearchPanel.superclass.afterRender.call(this);if(!this.dontLoadOnRender){this.load()}},load:function(){this.searchField.setValue(this.query);this.searchGrid.store.baseParams.query=this.query;this.searchGrid.store.load()},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.CheckerWindow=function(b){if(!b){b={}}b.title=GO.lang.reminders;b.maximizable=true;b.layout="fit";b.modal=false;b.resizable=true;b.closeAction="hide";if(!b.width){b.width=400}if(!b.height){b.height=500}b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var a=new Ext.menu.Menu({items:[{text:"5 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"10 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"20 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"30 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"1 "+GO.lang.strHour,handler:function(){this.doTask("snooze_reminders",3600)},scope:this},{text:"2 "+GO.lang.strHours,handler:function(){this.doTask("snooze_reminders",7200)},scope:this},{text:"3 "+GO.lang.strHours,handler:function(){this.doTask("snooze_reminders",10800)},scope:this},{text:"1 "+GO.lang.strDay,handler:function(){this.doTask("snooze_reminders",86400)},scope:this},{text:"2 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",2*86400)},scope:this},{text:"3 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",3*86400)},scope:this},{text:"4 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",4*86400)},scope:this},{text:"5 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",5*86400)},scope:this},{text:"6 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",6*86400)},scope:this},{text:"7 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",7*86400)},scope:this}]});b.tbar=[{iconCls:"btn-delete",text:GO.lang.dismiss,handler:function(){this.doTask("dismiss_reminders")},scope:this},{iconCls:"btn-dismiss",text:GO.lang.snooze,menu:a},"-",{iconCls:"btn-select-all",text:GO.lang.selectAll,handler:function(){this.checkerGrid.getSelectionModel().selectAll()},scope:this}];this.checkerGrid=new GO.CheckerPanel();b.items=this.checkerGrid;b.listeners={scope:this,show:function(){},hide:function(){}};GO.CheckerWindow.superclass.constructor.call(this,b);this.addEvents({changed:true})};Ext.extend(GO.CheckerWindow,Ext.Window,{doTask:function(a,e){var d=this.checkerGrid.selModel.getSelections();if(!d.length){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noItemSelected)}else{var b=[];for(var c=0;c<d.length;c++){b.push(d[c].get("id"))}Ext.Ajax.request({url:BaseHref+"action.php",params:{task:a,snooze_time:e,reminders:Ext.encode(b)},callback:function(){for(var f=0;f<d.length;f++){this.checkerGrid.store.remove(d[f])}if(!this.checkerGrid.store.getRange().length){this.hide()}},scope:this})}}});GO.CheckerPanel=Ext.extend(function(a){if(!a){a={}}a.layout="fit";a.id="go-checker-panel";a.store=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({totalProperty:"count",root:"results",id:"id",fields:["id","name","description","link_id","link_type","link_type_name","local_time","iconCls","time"]}),groupField:"link_type_name",sortInfo:{field:"time",direction:"ASC"}});a.cm=new Ext.grid.ColumnModel([{dataIndex:"link_type_name",hideable:false},{header:"",width:28,dataIndex:"icon",renderer:this.iconRenderer,hideable:false},{header:GO.lang.strTime,dataIndex:"local_time",width:50},{header:GO.lang.strName,dataIndex:"name"}]);a.view=new Ext.grid.GroupingView({hideGroupedColumn:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+GO.lang.items+'" : "'+GO.lang.item+'"]})',emptyText:GO.lang.strNoItems,showGroupName:false});a.selModel=new Ext.grid.RowSelectionModel();a.loadMask=true;a.autoExpandColumn=3;GO.grid.GridPanel.superclass.constructor.call(this,a);this.on("rowdblclick",function(e,d){var b=e.getSelectionModel();var c=b.getSelected();if(GO.linkHandlers[c.data.link_type]){GO.linkHandlers[c.data.link_type].call(this,c.data.link_id)}else{Ext.Msg.alert(GO.lang.strError,"No handler definded for link type: "+c.data.link_type)}},this)},GO.grid.GridPanel,{iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.Checker=function(){this.addEvents({alert:true,startcheck:true,endcheck:true});this.checkerWindow=new GO.CheckerWindow();this.reminderIcon=Ext.get("reminder-icon");this.reminderIcon.setDisplayed(false);this.reminderIcon.on("click",function(){this.checkerWindow.show()},this)};Ext.extend(GO.Checker,Ext.util.Observable,{lastCount:0,init:function(){Ext.TaskMgr.start({run:function(){Ext.Ajax.request({url:BaseHref+"json.php",params:{task:"checker"},callback:function(b,d,a){if(!d){}else{var c=Ext.decode(a.responseText);if(c){c.reminderText="";c.alarm=false;this.fireEvent("check",this,c);if(c.reminders){this.checkerWindow.checkerGrid.store.loadData({results:c.reminders});if(this.lastCount!=this.checkerWindow.checkerGrid.store.getCount()){this.lastCount=this.checkerWindow.checkerGrid.store.getCount();this.checkerWindow.show();this.reminderIcon.setDisplayed(true);c.alarm=true}}else{this.reminderIcon.setDisplayed(false)}if(c.alarm){GO.playAlarm();if(!GO.hasFocus&&!GO.util.empty(GO.settings.popup_reminders)){GO.reminderPopup=GO.util.popup({width:400,height:300,url:BaseHref+"reminder.php?count="+this.lastCount+"&reminder_text="+encodeURIComponent(c.reminderText),target:"groupofficeReminderPopup",position:"br",closeOnFocus:false})}}}}},scope:this})},scope:this,interval:120000})}});if(Ext.version=="3.0"){Ext.override(Ext.grid.GridView,{ensureVisible:function(x,f,e){var v=this.resolveCell(x,f,e);if(!v||!v.row){return}var l=v.row,g=v.cell,q=this.scroller.dom,w=0,d=l,r=this.el.dom;var d=l,r=this.el.dom;while(d&&d!=r){w+=d.offsetTop;d=d.offsetParent}w-=this.mainHd.dom.offsetHeight;var u=w+l.offsetHeight;var a=q.clientHeight;var r=parseInt(q.scrollTop,10);var o=r+a;if(w<r){q.scrollTop=w}else{if(u>o){q.scrollTop=u-a}}if(e!==false){var n=parseInt(g.offsetLeft,10);var k=n+g.offsetWidth;var j=parseInt(q.scrollLeft,10);var b=j+q.clientWidth;if(n<j){q.scrollLeft=n}else{if(k>b){q.scrollLeft=k-q.clientWidth}}}return this.getResolvedXY(v)}})}Ext.namespace("Ext.ux.maximgb.tg");Ext.ux.maximgb.tg.AbstractTreeStore=Ext.extend(Ext.data.Store,{leaf_field_name:"_is_leaf",page_offset:0,active_node:null,constructor:function(a){Ext.ux.maximgb.tg.AbstractTreeStore.superclass.constructor.call(this,a);if(!this.paramNames.active_node){this.paramNames.active_node="anode"}this.addEvents("beforeexpandnode","expandnode","expandnodefailed","beforecollapsenode","collapsenode","beforeactivenodechange","activenodechange")},remove:function(a){if(a===this.active_node){this.setActiveNode(null)}this.removeNodeDescendants(a);Ext.ux.maximgb.tg.AbstractTreeStore.superclass.remove.call(this,a)},removeNodeDescendants:function(d){var c,a,b=this.getNodeChildren(d);for(c=0,a=b.length;c<a;c++){this.remove(b[c])}},load:function(a){if(a){if(a.params){if(a.params[this.paramNames.active_node]===undefined){a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a.params={};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}}else{a={params:{}};a.params[this.paramNames.active_node]=this.active_node?this.active_node.id:null}if(a.params[this.paramNames.active_node]!==null){a.add=true}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.load.call(this,a)},loadRecords:function(b,u,k){if(!b||k===false){if(k!==false){this.fireEvent("load",this,[],u)}if(u.callback){u.callback.call(u.scope||this,[],u,false)}return}var a=b.records,q=b.totalRecords||a.length,l=this.getPageOffsetFromOptions(u),p=this.getLoadedNodeIdFromOptions(u),j,c,f,e,g,d,n=this;if(!u||u.add!==true){if(this.pruneModifiedRecords){this.modified=[]}for(var c=0,f=a.length;c<f;c++){a[c].join(this)}if(this.snapshot){this.data=this.snapshot;delete this.snapshot}this.data.clear();this.data.addAll(a);this.page_offset=l;this.totalLength=q;this.applySort();this.fireEvent("datachanged",this)}else{if(p){j=this.getById(p)}if(j){this.setNodeChildrenOffset(j,l);this.setNodeChildrenTotalCount(j,Math.max(q,a.length));this.removeNodeDescendants(j)}this.suspendEvents();d={};for(c=0,f=a.length;c<f;c++){e=a[c];g=this.indexOfId(e.id);if(g==-1){d[e.id]=false}else{d[e.id]=true;this.setNodeExpanded(e,this.isExpandedNode(this.getAt(g)))}this.add(e)}this.applySort();this.resumeEvents();a.sort(function(w,o){var x=n.data.indexOf(w),v=n.data.indexOf(o),y;if(x>v){y=1}else{y=-1}return y});for(c=0,f=a.length;c<f;c++){e=a[c];if(d[e.id]==true){this.fireEvent("update",this,e,Ext.data.Record.COMMIT)}else{this.fireEvent("add",this,[e],this.data.indexOf(e))}}}this.fireEvent("load",this,a,u);if(u.callback){u.callback.call(u.scope||this,a,u,true)}},sort:function(b,a){if(this.remoteSort){this.setActiveNode(null);if(this.lastOptions){this.lastOptions.add=false;if(this.lastOptions.params){this.lastOptions.params[this.paramNames.active_node]=null}}}return Ext.ux.maximgb.tg.AbstractTreeStore.superclass.sort.call(this,b,a)},applySort:function(){if(this.sortInfo&&!this.remoteSort){var a=this.sortInfo,b=a.field;this.sortData(b,a.direction)}else{this.applyTreeSort()}},sortData:function(c,d){d=d||"ASC";var a=this.fields.get(c).sortType;var b=function(f,e){var j=a(f.data[c]),g=a(e.data[c]);return j>g?1:(j<g?-1:0)};this.data.sort(d,b);if(this.snapshot&&this.snapshot!=this.data){this.snapshot.sort(d,b)}this.applyTreeSort()},applyTreeSort:function(){var e,a,d,f,c=[],b=this.getRootNodes();for(e=0,a=b.length;e<a;e++){f=b[e];c.push(f);this.collectNodeChildrenTreeSorted(c,f)}if(c.length>0){this.data.clear();this.data.addAll(c)}if(this.snapshot&&this.snapshot!==this.data){d=this.data;this.data=this.snapshot;this.snapshot=null;this.applyTreeSort();this.snapshot=this.data;this.data=d}},collectNodeChildrenTreeSorted:function(b,e){var d,a,f,c=this.getNodeChildren(e);for(d=0,a=c.length;d<a;d++){f=c[d];b.push(f);this.collectNodeChildrenTreeSorted(b,f)}},getActiveNode:function(){return this.active_node},setActiveNode:function(a){if(this.active_node!==a){if(a){if(this.data.indexOf(a)!=-1){if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}else{throw"Given record is not from the store."}}else{if(this.fireEvent("beforeactivenodechange",this,this.active_node,a)!==false){this.active_node=a;this.fireEvent("activenodechange",this,this.active_node,a)}}}},isExpandedNode:function(a){return a.ux_maximgb_tg_expanded===true},setNodeExpanded:function(b,a){b.ux_maximgb_tg_expanded=a},isVisibleNode:function(e){var c,b,d=this.getNodeAncestors(e),a=true;for(c=0,b=d.length;c<b;c++){a=a&&this.isExpandedNode(d[c]);if(!a){break}}return a},isLeafNode:function(a){return a.get(this.leaf_field_name)==true},isLoadedNode:function(b){var a;if(b.ux_maximgb_tg_loaded!==undefined){a=b.ux_maximgb_tg_loaded}else{if(this.isLeafNode(b)||this.hasChildNodes(b)){a=true}else{a=false}}return a},setNodeLoaded:function(b,a){b.ux_maximgb_tg_loaded=a},getNodeChildrenOffset:function(a){return a.ux_maximgb_tg_offset||0},setNodeChildrenOffset:function(b,a){b.ux_maximgb_tg_offset=a},getNodeChildrenTotalCount:function(a){return a.ux_maximgb_tg_total||0},setNodeChildrenTotalCount:function(b,a){b.ux_maximgb_tg_total=a},collapseNode:function(a){if(this.isExpandedNode(a)&&this.fireEvent("beforecollapsenode",this,a)!==false){this.setNodeExpanded(a,false);this.fireEvent("collapsenode",this,a)}},expandNode:function(a){var b;if(!this.isExpandedNode(a)&&this.fireEvent("beforeexpandnode",this,a)!==false){if(this.isLoadedNode(a)){this.setNodeExpanded(a,true);this.fireEvent("expandnode",this,a)}else{b={};b[this.paramNames.active_node]=a.id;this.load({add:true,params:b,callback:this.expandNodeCallback,scope:this})}}},expandNodeCallback:function(b,a,d){var c=this.getById(a.params[this.paramNames.active_node]);if(d&&c){this.setNodeLoaded(c,true);this.setNodeExpanded(c,true);this.fireEvent("expandnode",this,c)}else{this.fireEvent("expandnodefailed",this,a.params[this.paramNames.active_node],c)}},expandAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(!this.isExpandedNode(d)){this.expandNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},collapseAll:function(){var d,c,a,b=this.data.getRange();this.suspendEvents();for(c=0,a=b.length;c<a;c++){d=b[c];if(this.isExpandedNode(d)){this.collapseNode(d)}}this.resumeEvents();this.fireEvent("datachanged",this)},getLoadedNodeIdFromOptions:function(b){var a=null;if(b&&b.params&&b.params[this.paramNames.active_node]){a=b.params[this.paramNames.active_node]}return a},getPageOffsetFromOptions:function(b){var a=0;if(b&&b.params&&b.params[this.paramNames.start]){a=parseInt(b.params[this.paramNames.start],10);if(isNaN(a)){a=0}}return a},hasNextSiblingNode:function(a){return this.getNodeNextSibling(a)!==null},hasPrevSiblingNode:function(a){return this.getNodePrevSibling(a)!==null},hasChildNodes:function(a){return this.getNodeChildrenCount(a)>0},getNodeAncestors:function(c){var b=[],a;a=this.getNodeParent(c);while(a){b.push(a);a=this.getNodeParent(a)}return b},getNodeChildrenCount:function(a){return this.getNodeChildren(a).length},getNodeNextSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b<e.length-1){a=e[b+1]}return a},getNodePrevSibling:function(d){var e,c,b,a=null;c=this.getNodeParent(d);if(c){e=this.getNodeChildren(c)}else{e=this.getRootNodes()}b=e.indexOf(d);if(b>0){a=e[b-1]}return a},getRootNodes:function(){throw"Abstract method call"},getNodeDepth:function(a){throw"Abstract method call"},getNodeParent:function(a){throw"Abstract method call"},getNodeChildren:function(a){throw"Abstract method call"},addToNode:function(a,b){throw"Abstract method call"},removeFromNode:function(a,b){throw"Abstract method call"},getPageOffset:function(){return this.page_offset},getActiveNodePageOffset:function(){var a;if(this.active_node){a=this.getNodeChildrenOffset(this.active_node)}else{a=this.getPageOffset()}return a},getActiveNodeCount:function(){var a;if(this.active_node){a=this.getNodeChildrenCount(this.active_node)}else{a=this.getRootNodes().length}return a},getActiveNodeTotalCount:function(){var a;if(this.active_node){a=this.getNodeChildrenTotalCount(this.active_node)}else{a=this.getTotalCount()}return a}});Ext.ux.maximgb.tg.AdjacencyListStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{parent_id_field_name:"_parent",getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==null){a.push(c[d])}}return a},getNodeDepth:function(a){return this.getNodeAncestors(a).length},getNodeParent:function(a){return this.getById(a.get(this.parent_id_field_name))},getNodeChildren:function(e){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.parent_id_field_name)==e.id){a.push(c[d])}}return a},addToNode:function(a,b){b.set(this.parent_id_field_name,a.id);this.addSorted(b)},removeFromNode:function(a,b){this.remove(b)}});Ext.reg("Ext.ux.maximgb.tg.AdjacencyListStore",Ext.ux.maximgb.tg.AdjacencyListStore);Ext.ux.maximgb.tg.NestedSetStore=Ext.extend(Ext.ux.maximgb.tg.AbstractTreeStore,{left_field_name:"_lft",right_field_name:"_rgt",level_field_name:"_level",root_node_level:1,getRootNodes:function(){var d,b,a=[],c=this.data.getRange();for(d=0,b=c.length;d<b;d++){if(c[d].get(this.level_field_name)==this.root_node_level){a.push(c[d])}}return a},getNodeDepth:function(a){return a.get(this.level_field_name)-this.root_node_level},getNodeParent:function(a){var o=null,g,f=this.data.getRange(),j,k,n,e,l,d,c,b;n=a.get(this.left_field_name);l=a.get(this.right_field_name);c=a.get(this.level_field_name);for(j=0,k=f.length;j<k;j++){g=f[j];e=g.get(this.left_field_name);d=g.get(this.right_field_name);b=g.get(this.level_field_name);if(b==c-1&&e<n&&d>l){o=g;break}}return o},getNodeChildren:function(a){var k,e,j,d,b,c,f,g,l=[];f=this.data.getRange();k=a.get(this.left_field_name);j=a.get(this.right_field_name);b=a.get(this.level_field_name);for(i=0,len=f.length;i<len;i++){g=f[i];e=g.get(this.left_field_name);d=g.get(this.right_field_name);c=g.get(this.level_field_name);if(c==b+1&&e>k&&d<j){l.push(g)}}return l}});Ext.ux.maximgb.tg.GridView=Ext.extend(Ext.grid.GridView,{expanded_icon_class:"ux-maximgb-tg-elbow-minus",last_expanded_icon_class:"ux-maximgb-tg-elbow-end-minus",collapsed_icon_class:"ux-maximgb-tg-elbow-plus",last_collapsed_icon_class:"ux-maximgb-tg-elbow-end-plus",skip_width_update_class:"ux-maximgb-tg-skip-width-update",initTemplates:function(){var a=this.templates||{};if(!a.row){a.row=new Ext.Template('<div class="x-grid3-row ux-maximgb-tg-level-{level} {alt}" style="{tstyle} {display_style}">','<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody>","</table>","</div>")}if(!a.mastercell){a.mastercell=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="ux-maximgb-tg-mastercell-wrap">',"{treeui}",'<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</div>","</td>")}if(!a.treeui){a.treeui=new Ext.Template('<div class="ux-maximgb-tg-uiwrap" style="width: {wrap_width}px">',"{elbow_line}",'<div style="left: {left}px" class="{cls}">&#160;</div>',"</div>")}if(!a.elbow_line){a.elbow_line=new Ext.Template('<div style="left: {left}px" class="{cls}">&#160;</div>')}this.templates=a;Ext.ux.maximgb.tg.GridView.superclass.initTemplates.call(this)},doRender:function(g,l,w,a,v,A){var b=this.templates,f=b.cell,k=b.row,n=v-1;var d="width:"+this.getTotalWidth()+";";var D=[],x,E,y={},o={tstyle:d},u;for(var z=0,C=l.length;z<C;z++){u=l[z];x=[];var q=(z+a);var e=this.renderRow(u,q,v,w,this.cm.getTotalWidth());if(e===false){for(var B=0;B<v;B++){E=g[B];y.id=E.id;y.css=B==0?"x-grid3-cell-first ":(B==n?"x-grid3-cell-last ":"");y.attr=y.cellAttr="";y.value=E.renderer(u.data[E.name],y,u,q,B,w);y.style=E.style;if(Ext.isEmpty(y.value)){y.value="&#160;"}if(this.markDirty&&u.dirty&&typeof u.modified[E.name]!=="undefined"){y.css+=" x-grid3-dirty-cell"}if(E.id==this.grid.master_column_id){y.treeui=this.renderCellTreeUI(u,w);f=b.mastercell}else{f=b.cell}x[x.length]=f.apply(y)}}else{x.push(e)}var F=[];if(A&&((q+1)%2==0)){F[0]="x-grid3-row-alt"}if(u.dirty){F[1]=" x-grid3-dirty-row"}o.cols=v;if(this.getRowClass){F[2]=this.getRowClass(u,q,o,w)}o.alt=F.join(" ");o.cells=x.join("");if(!w.isVisibleNode(u)){o.display_style="display: none;"}else{o.display_style=""}o.level=w.getNodeDepth(u);D[D.length]=k.apply(o)}return D.join("")},renderCellTreeUI:function(a,b){var c=this.templates.treeui,j=this.templates.elbow_line,e={},g,d,f=level=b.getNodeDepth(a);e.wrap_width=(f+1)*16;if(level>0){e.elbow_line="";g=a;left=0;while(level--){d=b.getNodeParent(g);if(d){if(b.hasNextSiblingNode(d)){e.elbow_line=j.apply({left:level*16,cls:"ux-maximgb-tg-elbow-line"})+e.elbow_line}else{e.elbow_line=j.apply({left:level*16,cls:"ux-maximgb-tg-elbow-empty"})+e.elbow_line}}else{throw ["Tree inconsistency can't get level ",level+1," node(id=",g.id,") parent."].join("")}g=d}}if(b.isLeafNode(a)){if(b.hasNextSiblingNode(a)){e.cls="ux-maximgb-tg-elbow"}else{e.cls="ux-maximgb-tg-elbow-end"}}else{e.cls="ux-maximgb-tg-elbow-active ";if(b.isExpandedNode(a)){if(b.hasNextSiblingNode(a)){e.cls+=this.expanded_icon_class}else{e.cls+=this.last_expanded_icon_class}}else{if(b.hasNextSiblingNode(a)){e.cls+=this.collapsed_icon_class}else{e.cls+=this.last_collapsed_icon_class}}}e.left=1+f*16;return c.apply(e)},renderRow:function(a,b,e,d,c){return false},afterRender:function(){Ext.ux.maximgb.tg.GridView.superclass.afterRender.call(this);this.updateAllColumnWidths()},updateAllColumnWidths:function(){var d=this.getTotalWidth(),l=this.cm.getColumnCount(),f=[],e,b;for(b=0;b<l;b++){f[b]=this.getColumnWidth(b)}this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;for(b=0;b<l;b++){var c=this.getHeaderCell(b);c.style.width=f[b]}var k=this.getRows(),n,g;for(b=0,e=k.length;b<e;b++){n=k[b];n.style.width=d;if(n.firstChild){n.firstChild.style.width=d;g=n.firstChild.rows[0];for(var a=0;a<l&&a<g.childNodes.length;a++){if(!Ext.fly(g.childNodes[a]).hasClass(this.skip_width_update_class)){g.childNodes[a].style.width=f[a]}}}}this.onAllColumnWidthsUpdated(f,d)},updateColumnWidth:function(b,a){var j=this.getColumnWidth(b);var e=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=e;this.mainBody.dom.style.width=e;var d=this.getHeaderCell(b);d.style.width=j;var g=this.getRows(),k;for(var c=0,f=g.length;c<f;c++){k=g[c];k.style.width=e;if(k.firstChild){k.firstChild.style.width=e;if(b<k.firstChild.rows[0].childNodes.length){if(!Ext.fly(k.firstChild.rows[0].childNodes[b]).hasClass(this.skip_width_update_class)){k.firstChild.rows[0].childNodes[b].style.width=j}}}}this.onColumnWidthUpdated(b,j,e)},updateColumnHidden:function(a,e){var d=this.getTotalWidth();this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=d;this.mainBody.dom.style.width=d;var g=e?"none":"";var c=this.getHeaderCell(a);c.style.display=g;var j=this.getRows(),l,k;for(var b=0,f=j.length;b<f;b++){l=j[b];l.style.width=d;if(l.firstChild){l.firstChild.style.width=d;if(a<l.firstChild.rows[0].childNodes.length){if(!Ext.fly(l.firstChild.rows[0].childNodes[a]).hasClass(this.skip_width_update_class)){l.firstChild.rows[0].childNodes[a].style.display=g}}}}this.onColumnHiddenUpdated(a,e,d);delete this.lastViewWidth;this.layout()},processRows:function(a,d){var b=0;if(this.ds.getCount()<1){return}d=!this.grid.stripeRows;a=a||0;var c=this.getRows();var b=0;Ext.each(c,function(f,e){f.rowIndex=e;f.className=f.className.replace(this.rowClsRe," ");if(f.style.display!="none"){if(!d&&((b+1)%2===0)){f.className+=" x-grid3-row-alt"}b++}},this);Ext.fly(c[0]).addClass(this.firstRowCls);Ext.fly(c[c.length-1]).addClass(this.lastRowCls)},ensureVisible:function(e,b,d){var c,a=this.ds.getAt(e);if(!this.ds.isVisibleNode(a)){c=this.ds.getNodeAncestors(a);while(c.length>0){a=c.shift();if(!this.ds.isExpandedNode(a)){this.ds.expandNode(a)}}}return Ext.ux.maximgb.tg.GridView.superclass.ensureVisible.call(this,e,b,d)},expandRow:function(d,f){var b=this.ds,c,g,l,j,a,e,k;if(typeof d=="number"){e=d;d=b.getAt(e)}else{e=b.indexOf(d)}f=f||false;l=this.getRow(e);j=Ext.fly(l).child(".ux-maximgb-tg-elbow-active");if(j){if(b.hasNextSiblingNode(d)){j.removeClass(this.collapsed_icon_class);j.removeClass(this.last_collapsed_icon_class);j.addClass(this.expanded_icon_class)}else{j.removeClass(this.collapsed_icon_class);j.removeClass(this.last_collapsed_icon_class);j.addClass(this.last_expanded_icon_class)}}if(b.isVisibleNode(d)){a=b.getNodeChildren(d);for(c=0,g=a.length;c<g;c++){k=b.indexOf(a[c]);l=this.getRow(k);l.style.display="block";if(b.isExpandedNode(a[c])){this.expandRow(k,true)}}}if(!f){this.processRows(0)}},collapseRow:function(d,e){var b=this.ds,c,g,a,k,f,j;if(typeof d=="number"){f=d;d=b.getAt(f)}else{f=b.indexOf(d)}e=e||false;k=this.getRow(f);pmel=Ext.fly(k).child(".ux-maximgb-tg-elbow-active");if(pmel){if(b.hasNextSiblingNode(d)){pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.collapsed_icon_class)}else{pmel.removeClass(this.expanded_icon_class);pmel.removeClass(this.last_expanded_icon_class);pmel.addClass(this.last_collapsed_icon_class)}}a=b.getNodeChildren(d);for(c=0,g=a.length;c<g;c++){j=b.indexOf(a[c]);k=this.getRow(j);if(k.style.display!="none"){k.style.display="none";this.collapseRow(j,true)}}if(!e){this.processRows(0)}},initData:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.initData.call(this,b,a);if(this.ds){this.ds.un("expandnode",this.onStoreExpandNode,this);this.ds.un("collapsenode",this.onStoreCollapseNode,this)}if(b){b.on("expandnode",this.onStoreExpandNode,this);b.on("collapsenode",this.onStoreCollapseNode,this)}},onLoad:function(b,a,c){var d;if(c&&c.params&&(c.params[b.paramNames.active_node]===null||b.indexOfId(c.params[b.paramNames.active_node])==-1)){Ext.ux.maximgb.tg.GridView.superclass.onLoad.call(this,b,a,c)}},onAdd:function(c,a,b){Ext.ux.maximgb.tg.GridView.superclass.onAdd.call(this,c,a,b);if(this.mainWrap){this.processRows(0)}},onRemove:function(d,a,b,c){Ext.ux.maximgb.tg.GridView.superclass.onRemove.call(this,d,a,b,c);if(c!==true){if(this.mainWrap){this.processRows(0)}}},onUpdate:function(b,a){Ext.ux.maximgb.tg.GridView.superclass.onUpdate.call(this,b,a);if(this.mainWrap){this.processRows(0)}},onStoreExpandNode:function(a,b){this.expandRow(b)},onStoreCollapseNode:function(a,b){this.collapseRow(b)}});Ext.ux.maximgb.tg.GridPanel=Ext.extend(Ext.grid.GridPanel,{master_column_id:0,tg_cls:"ux-maximgb-tg-panel",initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.GridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.GridPanel.superclass.onRender.call(this,b,a);this.el.addClass(this.tg_cls)},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),l=g.findRowIndex(d),j=this.getStore(),a=this.getSelectionModel(),b,f,k=true;if(l!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=j.getAt(l);if(j.isExpandedNode(b)){j.collapseNode(b)}else{j.expandNode(b)}k=false}}if(k){Ext.ux.maximgb.tg.GridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.GridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.EditorGridPanel=Ext.extend(Ext.grid.EditorGridPanel,{master_column_id:0,initComponent:function(){this.initComponentPreOverride();Ext.ux.maximgb.tg.EditorGridPanel.superclass.initComponent.call(this);this.getSelectionModel().on("selectionchange",this.onTreeGridSelectionChange,this);this.initComponentPostOverride()},initComponentPreOverride:Ext.emptyFn,initComponentPostOverride:Ext.emptyFn,onRender:function(b,a){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onRender.call(this,b,a);this.el.addClass("ux-maximgb-tg-panel")},getView:function(){if(!this.view){this.view=new Ext.ux.maximgb.tg.GridView(this.viewConfig)}return this.view},onClick:function(c){var d=c.getTarget(),g=this.getView(),l=g.findRowIndex(d),j=this.getStore(),a=this.getSelectionModel(),b,f,k=true;if(l!==false){if(Ext.fly(d).hasClass("ux-maximgb-tg-elbow-active")){b=j.getAt(l);if(j.isExpandedNode(b)){j.collapseNode(b)}else{j.expandNode(b)}k=false}}if(k){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onClick.call(this,c)}},onMouseDown:function(b){var a=b.getTarget();if(!Ext.fly(a).hasClass("ux-maximgb-tg-elbow-active")){Ext.ux.maximgb.tg.EditorGridPanel.superclass.onMouseDown.call(this,b)}},onTreeGridSelectionChange:function(e,d){var a,c,b=this.getStore();if(e.getSelected){a=e.getSelected();b.setActiveNode(a)}else{if(e.getSelectedCell&&d){a=d.record;b.setActiveNode(a)}}if(a){if(!b.isVisibleNode(a)){c=b.getNodeAncestors(a);while(c.length>0){b.expandNode(c.pop())}}}}});Ext.ux.maximgb.tg.PagingToolbar=Ext.extend(Ext.PagingToolbar,{onRender:function(b,a){Ext.ux.maximgb.tg.PagingToolbar.superclass.onRender.call(this,b,a);this.updateUI()},getPageData:function(){var a=0,b=0;if(this.store){b=this.store.getActiveNodePageOffset();a=this.store.getActiveNodeTotalCount()}return{total:a,activePage:Math.ceil((b+this.pageSize)/this.pageSize),pages:a<this.pageSize?1:Math.ceil(a/this.pageSize)}},updateInfo:function(){var b=0,d=0,a=0,c;if(this.displayItem){if(this.store){d=this.store.getActiveNodePageOffset();b=this.store.getActiveNodeCount();a=this.store.getActiveNodeTotalCount()}c=b==0?this.emptyMsg:String.format(this.displayMsg,d+1,d+b,a);this.displayItem.setText(c)}},updateUI:function(){var c=this.getPageData(),a=c.activePage,b=c.pages;this.afterTextItem.setText(String.format(this.afterPageText,c.pages));this.inputItem.setValue(a);this.first.setDisabled(a==1);this.prev.setDisabled(a==1);this.next.setDisabled(a==b);this.last.setDisabled(a==b);this.refresh.enable();this.updateInfo()},bindStore:function(a,b){if(!b&&this.store){this.store.un("activenodechange",this.onStoreActiveNodeChange,this)}if(a){a.on("activenodechange",this.onStoreActiveNodeChange,this)}Ext.ux.maximgb.tg.PagingToolbar.superclass.bindStore.call(this,a,b)},beforeLoad:function(a,b){var c=this.getParams();Ext.ux.maximgb.tg.PagingToolbar.superclass.beforeLoad.call(this,a,b);if(b&&b.params){if(b.params[c.start]===undefined){b.params[c.start]=0}if(b.params[c.limit]===undefined){b.params[c.limit]=this.pageSize}}},moveFirst:function(){this.doLoad(0)},movePrevious:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(Math.max(0,b-this.pageSize))},moveNext:function(){var a=this.store,b=a?a.getActiveNodePageOffset():0;this.doLoad(b+this.pageSize)},moveLast:function(){var b=this.store,d=b?b.getActiveNodePageOffset():0,c=b?b.getActiveNodeTotalCount():0,a=c%this.pageSize;this.doLoad(a?(c-a):c-this.pageSize)},onStoreActiveNodeChange:function(b,c,a){if(this.rendered){this.updateUI()}}});Ext.reg("Ext.ux.maximgb.tg.GridPanel",Ext.ux.maximgb.tg.GridPanel);Ext.reg("Ext.ux.maximgb.tg.EditorGridPanel",Ext.ux.maximgb.tg.EditorGridPanel);Ext.reg("Ext.ux.maximgb.tg.PagingToolbar",Ext.ux.maximgb.tg.PagingToolbar);GO.grid.RowExpander=function(a){Ext.apply(this,a);GO.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={};this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true})};Ext.extend(GO.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",function(){a.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){if(a.className=="x-grid3-row-expander"){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)}},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforcollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.GroupTab=Ext.extend(Ext.Container,{mainItem:0,expanded:true,deferredRender:true,activeTab:null,idDelimiter:"__",headerAsText:false,frame:false,hideBorders:true,initComponent:function(a){Ext.apply(this,a);this.frame=false;Ext.ux.GroupTab.superclass.initComponent.call(this);this.addEvents("activate","deactivate","changemainitem","beforetabchange","tabchange");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));if(!this.stack){this.stack=Ext.TabPanel.AccessStack()}this.initItems();this.on("beforerender",function(){this.groupEl=this.ownerCt.getGroupEl(this)},this);this.on("add",this.onAdd,this,{target:this});this.on("remove",this.onRemove,this,{target:this});if(this.mainItem!==undefined){var b=(typeof this.mainItem=="object")?this.mainItem:this.items.get(this.mainItem);delete this.mainItem;this.setMainItem(b)}},setActiveTab:function(c){c=this.getComponent(c);if(!c){return false}if(!this.rendered){this.activeTab=c;return true}if(this.activeTab!=c&&this.fireEvent("beforetabchange",this,c,this.activeTab)!==false){if(this.activeTab&&this.activeTab!=this.mainItem){var a=this.getTabEl(this.activeTab);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}}var b=this.getTabEl(c);Ext.fly(b).addClass("x-grouptabs-strip-active");this.activeTab=c;this.stack.add(c);this.layout.setActiveItem(c);if(this.layoutOnTabChange&&c.doLayout){c.doLayout()}if(this.scrolling){this.scrollToTab(c,this.animScroll)}this.fireEvent("tabchange",this,c);return true}return false},getTabEl:function(a){if(a==this.mainItem){return this.groupEl}return Ext.TabPanel.prototype.getTabEl.call(this,a)},onRender:function(b,a){Ext.ux.GroupTab.superclass.onRender.call(this,b,a);this.strip=Ext.fly(this.groupEl).createChild({tag:"ul",cls:"x-grouptabs-sub"});this.tooltip=new Ext.ToolTip({target:this.groupEl,delegate:"a.x-grouptabs-text",trackMouse:true,renderTo:document.body,listeners:{beforeshow:function(e){var d=(e.triggerElement.parentNode===this.mainItem.tabEl)?this.mainItem:this.findById(e.triggerElement.parentNode.id.split(this.idDelimiter)[1]);if(!d.tabTip){return false}e.body.dom.innerHTML=d.tabTip},scope:this}});if(!this.itemTpl){var c=new Ext.Template('<li class="{cls}" id="{id}">','<a onclick="return false;" class="x-grouptabs-text {iconCls}">{text}</a>',"</li>");c.disableFormats=true;c.compile();Ext.ux.GroupTab.prototype.itemTpl=c}this.items.each(this.initTab,this)},afterRender:function(){Ext.ux.GroupTab.superclass.afterRender.call(this);if(this.activeTab!==undefined){var a=(typeof this.activeTab=="object")?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(a)}},initTab:function(c,a){var d=this.strip.dom.childNodes[a];var e=Ext.TabPanel.prototype.getTemplateArgs.call(this,c);if(c===this.mainItem){c.tabEl=this.groupEl;e.cls+=" x-grouptabs-main-item"}var b=d?this.itemTpl.insertBefore(d,e):this.itemTpl.append(this.strip,e);c.tabEl=c.tabEl||b;c.on("disable",this.onItemDisabled,this);c.on("enable",this.onItemEnabled,this);c.on("titlechange",this.onItemTitleChanged,this);c.on("iconchange",this.onItemIconChanged,this);c.on("beforeshow",this.onBeforeShowItem,this)},setMainItem:function(a){a=this.getComponent(a);if(!a||this.fireEvent("changemainitem",this,a,this.mainItem)===false){return}this.mainItem=a},getMainItem:function(){return this.mainItem||null},onBeforeShowItem:function(a){if(a!=this.activeTab){this.setActiveTab(a);return false}},onAdd:function(a,c,b){if(this.rendered){this.initTab.call(this,c,b)}},onRemove:function(c,b){Ext.destroy(Ext.get(this.getTabEl(b)));this.stack.remove(b);b.un("disable",this.onItemDisabled,this);b.un("enable",this.onItemEnabled,this);b.un("titlechange",this.onItemTitleChanged,this);b.un("iconchange",this.onItemIconChanged,this);b.un("beforeshow",this.onBeforeShowItem,this);if(b==this.activeTab){var a=this.stack.next();if(a){this.setActiveTab(a)}else{if(this.items.getCount()>0){this.setActiveTab(0)}else{this.activeTab=null}}}},onBeforeAdd:function(b){var a=b.events?(this.items.containsKey(b.getItemId())?b:null):this.items.get(b);if(a){this.setActiveTab(b);return false}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var c=b.elements;b.elements=c?c.replace(",header",""):c;b.border=(b.border===true)},onItemDisabled:Ext.TabPanel.prototype.onItemDisabled,onItemEnabled:Ext.TabPanel.prototype.onItemEnabled,onItemTitleChanged:function(b){var a=this.getTabEl(b);if(a){Ext.fly(a).child("a.x-grouptabs-text",true).innerHTML=b.title}},onItemIconChanged:function(d,a,c){var b=this.getTabEl(d);if(b){Ext.fly(b).child("a.x-grouptabs-text").replaceClass(c,a)}},beforeDestroy:function(){Ext.TabPanel.prototype.beforeDestroy.call(this);this.tooltip.destroy()}});Ext.reg("grouptab",Ext.ux.GroupTab);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle)}if(this.alternateColor){this.addClass(this.alternateCls)}this.on("beforeadd",function(b,c,a){this.initGroup(c,a)})},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this)},onRender:function(c,a){Ext.TabPanel.superclass.onRender.call(this,c,a);if(this.plain){var f=this.tabPosition=="top"?"header":"footer";this[f].addClass("x-tab-panel-"+f+"-plain")}var b=this[this.stripTarget];this.stripWrap=b.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var e=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.groupTpl){var d=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");d.disableFormats=true;d.compile();Ext.ux.GroupTabPanel.prototype.groupTpl=d}this.items.each(this.initGroup,this)},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var a=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(a);a.setActiveTab(a.getMainItem())}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(c){var b=null,a=c.getTarget("li",this.strip);if(a){b=this.findById(a.id.split(this.idDelimiter)[1]);if(b.disabled){return{expand:null,item:null,el:null}}}return{expand:c.getTarget(".x-grouptabs-expand",this.strip),isGroup:!c.getTarget("ul.x-grouptabs-sub",this.strip),item:b,el:a}},onStripMouseDown:function(b){if(b.button!=0){return}b.preventDefault();var a=this.findTargets(b);if(a.expand){this.toggleGroup(a.el)}else{if(a.item){if(a.isGroup){a.item.setActiveTab(a.item.getMainItem())}else{a.item.ownerCt.setActiveTab(a.item)}}}},expandGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).addClass("x-grouptabs-expanded");this.syncTabJoint()},toggleGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).toggleClass("x-grouptabs-expanded");this.syncTabJoint()},collapseGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).removeClass("x-grouptabs-expanded");this.syncTabJoint()},syncTabJoint:function(b){if(!this.tabJoint){return}b=b||this.getGroupEl(this.activeGroup);if(b){this.tabJoint.setHeight(Ext.fly(b).getHeight()-2);var a=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(b,"tl-tr",[-2,a])}else{this.tabJoint.alignTo(b,"tr-tl",[1,a])}}else{this.tabJoint.hide()}},getActiveTab:function(){if(!this.activeGroup){return null}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint()},createCorner:function(a,b){return Ext.fly(a).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+b})},initGroup:function(f,b){var d=this.strip.dom.childNodes[b],e=this.getTemplateArgs(f);if(b===0){e.cls+=" x-tab-first"}e.cls+=" x-grouptabs-main";e.text=f.getMainItem().title;var c=d?this.groupTpl.insertBefore(d,e):this.groupTpl.append(this.strip,e),a=this.createCorner(c,"top-"+this.tabPosition),g=this.createCorner(c,"bottom-"+this.tabPosition);f.tabEl=c;if(f.expanded){this.expandGroup(c)}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){g.setLeft("-10px");g.setBottom("-5px");a.setLeft("-10px");a.setTop("-5px")}this.mon(f,{scope:this,changemainitem:this.onGroupChangeMainItem,beforetabchange:this.onGroupBeforeTabChange})},setActiveGroup:function(b){b=this.getComponent(b);if(!b){return false}if(!this.rendered){this.activeGroup=b;return true}if(this.activeGroup!=b&&this.fireEvent("beforegroupchange",this,b,this.activeGroup)!==false){if(this.activeGroup){this.activeGroup.activeTab=null;var a=this.getGroupEl(this.activeGroup);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}}var c=this.getGroupEl(b);Ext.fly(c).addClass("x-grouptabs-strip-active");this.activeGroup=b;this.stack.add(b);this.layout.setActiveItem(b);this.syncTabJoint(c);this.fireEvent("groupchange",this,b);return true}return false},onGroupBeforeTabChange:function(a,c,b){if(a!==this.activeGroup||c!==b){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active")}this.expandGroup(this.getGroupEl(a));if(a!==this.activeGroup){return this.setActiveGroup(a)}},getFrameHeight:function(){var a=this.el.getFrameWidth("tb");a+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return a},adjustBodyWidth:function(a){return a-this.tabWidth}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,j,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:j,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(z,x,A){var f=x.getXY(),a=this.portal,q=z.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,n=this.grid.columnX,o=false;for(var w=n.length;d<w;d++){if(f[0]<(n[d].x+n[d].w)){o=true;break}}if(!o){d--}var u,l=false,j=0,y=a.items.itemAt(d),r=y.items.items,k=false;for(var w=r.length;j<w;j++){u=r[j];var v=u.el.getHeight();if(v===0){k=true}else{if((u.el.getY()+(v/2))>f[1]){l=true;break}}}j=(l&&u?j:y.items.getCount())+(k?-1:0);var g=this.createEvent(z,x,A,d,y,j);if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){q.getProxy().setWidth("auto");if(u){q.moveProxy(u.el.dom.parentNode,l?u.el.dom:null)}else{q.moveProxy(y.el.dom,null)}this.lastPos={c:y,col:d,p:k||(l&&u)?j:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(n,g,f){delete this.grid;if(!this.lastPos){return}var k=this.lastPos.c,b=this.lastPos.col,l=this.lastPos.p;var a=this.createEvent(n,g,f,b,k,l!==false?l:k.items.getCount());if(this.portal.fireEvent("validatedrop",a)!==false&&this.portal.fireEvent("beforedrop",a)!==false){n.proxy.getProxy().remove();n.panel.el.dom.parentNode.removeChild(n.panel.el.dom);if(l!==false){if(k==n.panel.ownerCt&&(k.items.items.indexOf(n.panel)<=l)){l++}k.insert(l,n.panel)}else{k.add(n.panel)}k.doLayout();this.portal.fireEvent("drop",a);var o=this.scrollPos.top;if(o){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=o},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);