GO.copytag.MainPanel=function(a){this.tagGrid=new GO.copytag.TagGrid();if(!a){a={}}a.labelWidth=150;a.border=false;a.padding=10;a.items=[this.tagGrid];a.tbar=new Ext.Toolbar({cls:"go-head-tb",items:[{iconCls:"btn-save",text:GO.lang.cmdSave,cls:"x-btn-text-icon",handler:function(){this.saveGrid()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdCancel,cls:"x-btn-text-icon",handler:function(){this.tagGrid.store.load()},scope:this}]});GO.copytag.MainPanel.superclass.constructor.call(this,a)};Ext.extend(GO.copytag.MainPanel,Ext.Panel,{saveGrid:function(){this.tagGrid.saveGridData(GO.settings.modules.copytag.url+"action.php")}});GO.moduleManager.addModule("copytag",GO.copytag.MainPanel,{title:GO.copytag.lang.userTags,iconCls:"go-tab-icon-copytag",admin:true});GO.copytag.TagGrid=function(a){if(!a){a={}}a.height=200,a.layout="fit";a.autoScroll=true;a.store=new GO.data.JsonStore({url:GO.settings.modules.copytag.url+"json.php",baseParams:{task:"grid"},root:"results",id:"id",totalProperty:"total",fields:["id","userid","user","tag"],remoteSort:true});var b=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:GO.copytag.lang.user,dataIndex:"user"},{header:GO.copytag.lang.tag,dataIndex:"tag",editor:new Ext.form.TextField()}]});a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});a.sm=new Ext.grid.RowSelectionModel();GO.copytag.TagGrid.superclass.constructor.call(this,a)};Ext.extend(GO.copytag.TagGrid,Ext.grid.EditorGridPanel,{afterRender:function(){GO.copytag.TagGrid.superclass.afterRender.call(this);this.store.load()},getGridData:function(){var d={};for(var b=0;b<this.store.data.items.length;b++){var c=this.store.data.items[b].data;d[b]={};for(var a in c){d[b][a]=c[a]}}return d},setIds:function(b){for(var a in b){if(a!="remove"){this.store.getAt(a).set("id",b[a])}}},saveGridData:function(a){Ext.Ajax.request({url:a,params:{task:"save_tag_grid",gridData:Ext.encode(this.getGridData())},callback:function(c,e,b){if(!e){alert(GO.lang.strRequestError)}else{var d=Ext.decode(b.responseText);this.store.load()}},scope:this})}});