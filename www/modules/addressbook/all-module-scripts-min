GO.addressbook.SelectCompany=function(a){Ext.apply(this,a);this.displayField="name";this.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies",addressbook_id:this.addressbook_id},root:"results",id:"id",totalProperty:"total",fields:["id","name","post_address","post_address_no","post_zip","post_city","post_state","post_country","vat_no","email"],remoteSort:true});this.store.setDefaultSort("name","asc");GO.addressbook.SelectCompany.superclass.constructor.call(this,{valueField:"id",triggerAction:"all",selectOnFocus:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectCompany,GO.form.ComboBoxReset);GO.addressbook.SelectContact=function(a){Ext.apply(this,a);this.displayField="name";this.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts",addressbook_id:this.addressbook_id},root:"results",id:"id",totalProperty:"total",fields:["id","name","salutation","email","first_name","last_name","home_phone","work_phone","cellular"],remoteSort:true});this.store.setDefaultSort("name","asc");GO.addressbook.SelectContact.superclass.constructor.call(this,{valueField:"id",triggerAction:"all",selectOnFocus:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectContact,GO.form.ComboBoxReset);GO.addressbook.readableAddressbooksStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"addressbooks",auth_type:"read"},root:"results",totalProperty:"total",id:"id",fields:["id","name","owner"],remoteSort:true});GO.addressbook.writableAddressbooksStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"addressbooks",auth_type:"write"},root:"results",totalProperty:"total",id:"id",fields:["id","name","owner","acl_read","acl_write","user_id","default_iso_address_format","default_salutation"],remoteSort:true});GO.addressbook.writableAddressbooksStore.on("load",function(){GO.addressbook.writableAddressbooksStore.on("load",function(){GO.addressbook.readableAddressbooksStore.load()},this)},this,{single:true});GO.addressbook.ManageDialog=function(b){if(!b){b={}}this.addressbooksGrid=new GO.addressbook.ManageAddressbooksGrid();var a=[this.addressbooksGrid];if(GO.mailings){this.templatesGrid=new GO.mailings.TemplatesGrid();this.mailingsGrid=new GO.mailings.MailingsGrid();a.push(this.templatesGrid);a.push(this.mailingsGrid)}b.layout="fit";b.modal=false;b.shadow=false;b.border=false;b.height=450;b.width=800;b.closeAction="hide";b.title=GO.addressbook.lang.cmdManageDialog;b.items=[{xtype:"tabpanel",activeTab:0,border:true,items:a}];b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.ManageDialog.superclass.constructor.call(this,b)};Ext.extend(GO.addressbook.ManageDialog,Ext.Window,{});GO.addressbook.ManageAddressbooksGrid=function(a){if(!a){a={}}a.title=GO.addressbook.lang.addressbooks;a.layout="fit";a.autoScroll=true;a.split=true;a.store=GO.addressbook.writableAddressbooksStore;a.paging=false;var b=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.addressbook.lang.cmdOwner,dataIndex:"owner",sortable:false}]);b.defaultSortable=true;a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.addressbook.lang.noAddressbooks}),a.sm=new Ext.grid.RowSelectionModel();a.loadMask=true;this.addressbookDialog=new GO.addressbook.AddressbookDialog();this.addressbookDialog.on("save",function(){GO.addressbook.writableAddressbooksStore.load();GO.addressbook.readableAddressbooksStore.load()});a.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.addressbookDialog.show()},disabled:!GO.settings.modules.addressbook.write_permission,scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},disabled:!GO.settings.modules.addressbook.write_permission,scope:this}];GO.addressbook.ManageAddressbooksGrid.superclass.constructor.call(this,a);this.on("rowdblclick",function(d,e){var c=d.getStore().getAt(e);this.addressbookDialog.show(c)},this)};Ext.extend(GO.addressbook.ManageAddressbooksGrid,GO.grid.GridPanel,{afterRender:function(){GO.addressbook.ManageAddressbooksGrid.superclass.afterRender.call(this);if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load()}},onShow:function(){GO.addressbook.ManageAddressbooksGrid.superclass.onShow.call(this);if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load()}}});GO.addressbook.AddressbookDialog=function(b){if(!b){b={}}this.salutation=GO.addressbook.lang.cmdSalutation+" ["+GO.addressbook.lang.cmdSir+"/"+GO.addressbook.lang.cmdMadam+"] {middle_name} {last_name}";this.buildForm();var a=function(){this.propertiesPanel.items.items[0].focus()};b.layout="fit";b.modal=false;b.shadow=false;b.border=false;b.height=450;b.width=800;b.closeAction="hide";b.title=GO.addressbook.lang.addressbook;b.items=this.tabPanel;this.buttons=[{text:GO.addressbook.lang.cmdUpload,handler:function(){this.uploadFile();if("csv"==this.addressbookImportPanel.form.items.items[0].getValue()){this.importDataSelectionWindow()}},hidden:true,scope:this},{text:GO.addressbook.lang.cmdExport,handler:function(){this.exportData()},hidden:true,scope:this},{text:GO.lang.cmdOk,handler:function(){this.saveAddressbook(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.saveAddressbook()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.AddressbookDialog.superclass.constructor.call(this,b)};Ext.extend(GO.addressbook.AddressbookDialog,Ext.Window,{buildForm:function(a){this.propertiesPanel=new Ext.FormPanel({waitMsgTarget:true,title:GO.addressbook.lang.cmdPanelProperties,labelWidth:140,defaultType:"textfield",border:false,bodyStyle:"padding:5px",waitMsgTarget:true,items:[{fieldLabel:GO.lang.strName,name:"name",allowBlank:false,anchor:"100%"},this.selectUser=new GO.form.SelectUser({fieldLabel:GO.lang.strUser,disabled:!GO.settings.modules.addressbook["write_permission"],allowBlank:false,anchor:"100%"}),this.formAddressFormat=new GO.form.SelectAddressFormat({fieldLabel:GO.addressbook.lang.defaultAddressFormat,name:"default_iso_address_format",displayField:"country_name",hiddenName:"default_iso_address_format",allowBlank:false,anchor:"100%",value:GO.settings.country}),{xtype:"panel",border:false,layout:"column",items:[{border:false,layout:"form",columnWidth:0.8,items:{xtype:"textfield",fieldLabel:GO.addressbook.lang.defaultSalutation,name:"default_salutation",allowBlank:false,anchor:"100%",value:this.salutation}},{columnWidth:0.2,border:false,bodyStyle:"padding-left:5px",items:{xtype:"button",handler:function(){this.propertiesPanel.form.findField("default_salutation").setValue(this.salutation)},scope:this,text:GO.lang.cmdReset}}]},{xtype:"fieldset",title:GO.addressbook.lang.explanationVariables,border:true,layout:"column",autoHeight:true,items:[{border:false,columnWidth:0.2,html:"["+GO.addressbook.lang.cmdSir+"/"+GO.addressbook.lang.cmdMadam+"]<br />{title}<br />{initials}<br />{first_name}<br />{middle_name}<br />{last_name}"},{columnWidth:0.8,border:false,html:GO.addressbook.lang.explanationSex+"<br />"+GO.lang.strTitle+"<br />"+GO.lang.strInitials+"<br />"+GO.lang.strFirstName+"<br />"+GO.lang.strMiddleName+"<br />"+GO.lang.strLastName}]}]});this.importfileTypeCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelFileType,value:"csv",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["csv","CSV (Comma Separated Values)"],["vcf","VCF (vCard)"]]}),displayField:"text",valueField:"value",hiddenName:"import_filetype",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.importfileTypeCombo.on("select",function(){switch(this.importfileTypeCombo.getValue()){case"vcf":this.importContactsCompaniesCombo.setDisabled(true);this.importValueSeperator.setDisabled(true);this.importValueIncluded.setDisabled(true);break;default:this.importContactsCompaniesCombo.setDisabled(false);this.importValueSeperator.setDisabled(false);this.importValueIncluded.setDisabled(false);break}},this);this.importfileInput=new Ext.form.TextField({autoCreate:{tag:"input",type:"file",size:"25",autocomplete:"off"},fieldLabel:GO.lang.strSelectFile,name:"import_file",inputType:"file",cls:"x-form-file x-form-field"});this.exportfileTypeCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelFileType,value:"csv",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["csv","CSV (Comma Separated Values)"],["vcf","VCF (vCard)"]]}),displayField:"text",valueField:"value",hiddenName:"export_filetype",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.exportfileTypeCombo.on("select",function(){switch(this.exportfileTypeCombo.getValue()){case"vcf":this.exportContactsCompaniesCombo.setDisabled(true);this.exportValueSeperator.setDisabled(true);this.exportValueIncluded.setDisabled(true);this.exportLinesEnded.setDisabled(true);break;default:this.exportContactsCompaniesCombo.setDisabled(false);this.exportValueSeperator.setDisabled(false);this.exportValueIncluded.setDisabled(false);this.exportLinesEnded.setDisabled(false);break}},this);this.importContactsCompaniesCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdImport,value:"contacts",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["contacts",GO.addressbook.lang.contacts],["companies",GO.addressbook.lang.companies]]}),displayField:"text",valueField:"value",hiddenName:"import_type",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.exportContactsCompaniesCombo=new Ext.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdExport,value:"contacts",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["contacts",GO.addressbook.lang.contacts],["companies",GO.addressbook.lang.companies]]}),displayField:"text",valueField:"value",hiddenName:"export_type",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.addressbookImportPanel=new Ext.FormPanel({waitMsgTarget:true,title:GO.addressbook.lang.cmdImport,labelWidth:150,defaultType:"textfield",fileUpload:true,border:false,defaults:{anchor:"100%"},cls:"go-form-panel",waitMsgTarget:true,items:[this.importfileTypeCombo,this.importfileInput,this.importContactsCompaniesCombo,this.importValueSeperator=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueSeperated,name:"separator",anchor:"",width:100,value:",",allowBlank:false}),this.importValueIncluded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueIncluded,name:"quote",anchor:"",width:100,value:'"',allowBlank:false})]});this.addressbookExportPanel=new Ext.FormPanel({onSubmit:Ext.emptyFn,submit:function(){this.getEl().dom.submit()},title:GO.addressbook.lang.cmdExport,labelWidth:150,defaultType:"textfield",border:false,defaults:{anchor:"100%",allowBlank:false},cls:"go-form-panel",waitMsgTarget:true,items:[this.exportfileTypeCombo,this.exportContactsCompaniesCombo,this.exportValueSeperator=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueSeperated,name:"separator",anchor:"",width:100,value:",",allowBlank:false}),this.exportValueIncluded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelValueIncluded,name:"quote",anchor:"",width:100,value:'"',allowBlank:false}),this.exportLinesEnded=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelLinesEnded,name:"crlf",anchor:"",width:100,value:"\\r\\n",allowBlank:false})]});this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:[this.propertiesPanel,this.addressbookImportPanel,this.addressbookExportPanel,this.readPermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strReadPermissions}),this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions})]});this.propertiesPanel.on("show",this.syncButtons,this);this.addressbookImportPanel.on("show",this.syncButtons,this);this.addressbookExportPanel.on("show",this.syncButtons,this);this.readPermissionsTab.on("show",this.syncButtons,this);this.writePermissionsTab.on("show",this.syncButtons,this)},syncButtons:function(){this.buttons[0].setVisible(this.addressbookImportPanel.isVisible());this.buttons[1].setVisible(this.addressbookExportPanel.isVisible());this.buttons[2].setVisible(this.propertiesPanel.isVisible());this.buttons[3].setVisible(this.propertiesPanel.isVisible())},show:function(a){if(!this.rendered){this.render(Ext.getBody())}if(a){this.record=a;this.addressbook_id=a.data.id}else{this.addressbook_id=0}this.tabPanel.setActiveTab(0);if(this.addressbook_id==0){this.propertiesPanel.form.reset();this.addressbookImportPanel.setDisabled(true);this.addressbookExportPanel.setDisabled(true);this.readPermissionsTab.setAcl(0);this.writePermissionsTab.setAcl(0)}else{this.propertiesPanel.form.setValues(this.record.data);this.selectUser.setRemoteText(this.record.data.owner);this.addressbookImportPanel.setDisabled(false);this.addressbookExportPanel.setDisabled(false);this.readPermissionsTab.setAcl(this.record.data.acl_read);this.writePermissionsTab.setAcl(this.record.data.acl_write)}GO.addressbook.AddressbookDialog.superclass.show.call(this);this.propertiesPanel.form.clearInvalid();this.syncButtons()},importDataSelectionWindow:function(){switch(this.addressbookImportPanel.form.items.items[2].getValue()){case"contacts":var c="2";this.defaultCSVField={title:GO.lang.strTitle,first_name:GO.lang.strFirstName,middle_name:GO.lang.strMiddleName,last_name:GO.lang.strLastName,initials:GO.lang.strInitials,sex:GO.lang.strSex,birthday:GO.lang.strBirthday,address:GO.lang.strAddress,address_no:GO.lang.strAddressNo,zip:GO.lang.strZip,city:GO.lang.strCity,state:GO.lang.strState,country:GO.lang.strCountry,email:GO.lang.strEmail,email2:GO.lang.strEmail+" 2",email3:GO.lang.strEmail+" 3",home_phone:GO.lang.strPhone,fax:GO.lang.strFax,work_phone:GO.lang.strWorkPhone,work_fax:GO.lang.strWorkFax,cellular:GO.lang.strCellular,company_name:GO.lang.strCompany,department:GO.lang.strDepartment,"function":GO.lang.strFunction,salutation:GO.lang.strSalutation,comment:GO.lang.strComment};break;case"companies":var c="3";this.defaultCSVField={name:GO.lang.strName,email:GO.lang.strEmail,phone:GO.lang.strPhone,fax:GO.lang.strFax,country:GO.lang.strCountry,state:GO.lang.strState,city:GO.lang.strCity,zip:GO.lang.strZip,address:GO.lang.strAddress,address_no:GO.lang.strAddressNo,post_country:GO.lang.strPostCountry,post_state:GO.lang.strPostState,post_city:GO.lang.strPostCity,post_zip:GO.lang.strPostZip,post_address:GO.lang.strPostAddress,post_address_no:GO.lang.strPostAddressNo,homepage:GO.lang.strHomepage,bank_no:GO.addressbook.lang.cmdFormLabelBankNo,vat_no:GO.addressbook.lang.cmdFormLabelVatNo};break}if(GO.customfields&&GO.customfields.types[c]&&GO.customfields.types[c].panels){for(var h=0;h<GO.customfields.types[c].panels.length;h++){var a=GO.customfields.types[c].panels[h].customfields;for(var e=0;e<a.length;e++){if(a[e].datatype!="heading"&&a[e].datatype!="function"){this.defaultCSVField[a[e].name]=a[e].label}}}}this.addressbookImportData=new Ext.form.FormPanel({waitMsgTarget:true,id:"addressbook-default-import-data-window",labelWidth:125,border:false,defaults:{anchor:"-20"},cls:"go-form-panel",autoScroll:true});this.csvFieldStore=new Ext.data.JsonStore({fields:["id","name"],root:"list_keys",id:"id"});this.csvFieldStore.on("load",function(){var f=this.addressbookImportData.items.items;for(var m=0;m<f.length;m++){var n=true;for(var l=0;l<f[m].store.data.items.length;l++){var o=f[m].store.data.items[l].data.name;var k=f[m].fieldLabel;if(o==k){f[m].setValue(f[m].store.data.items[l].data.id);n=false}}if(n){f[m].setValue(f[m].store.data.items[0].data.id)}}},this);for(var b in this.defaultCSVField){var g=new Ext.form.ComboBox({fieldLabel:this.defaultCSVField[b],id:"export_combo_"+b,store:this.csvFieldStore,displayField:"name",valueField:"id",hiddenName:b,mode:"local",triggerAction:"all",editable:false});this.addressbookImportData.add(g)}var d=[{text:GO.addressbook.lang.cmdImport,handler:this.importData,scope:this},{text:GO.lang.cmdClose,handler:function(){this.csvFieldDialog.close()},scope:this}];this.csvFieldDialog=new Ext.Window({layout:"fit",height:400,width:400,title:GO.addressbook.lang.matchFields,items:[this.addressbookImportData],buttons:d});this.csvFieldDialog.show()},saveAddressbook:function(a){this.propertiesPanel.form.submit({waitMsg:GO.lang.waitMsgSave,url:GO.settings.modules.addressbook.url+"action.php",params:{task:"save_addressbook",addressbook_id:this.addressbook_id},success:function(b,c){GO.addressbook.writableAddressbooksStore.reload();if(c.result.addressbook_id){this.addressbook_id=c.result.addressbook_id;this.addressbookImportPanel.setDisabled(false);this.addressbookExportPanel.setDisabled(false);this.readPermissionsTab.setAcl(c.result.acl_read);this.writePermissionsTab.setAcl(c.result.acl_write)}if(a){this.hide()}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},uploadFile:function(){this.addressbookImportPanel.form.submit({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"upload",addressbook_id:this.addressbook_id},success:function(a,b){if(this.addressbookImportPanel.form.items.items[0].getValue()=="csv"){this.csvFieldStore.loadData(b.result)}else{Ext.MessageBox.alert(GO.lang.strSuccess,GO.addressbook.lang.importSuccess)}},failure:function(b,a){if(a.failureType!="client"){Ext.MessageBox.alert(GO.lang.strError,a.result.feedback)}},scope:this})},importData:function(){this.addressbookImportData.form.submit({url:GO.settings.modules.addressbook.url+"action.php",waitMsg:GO.lang.waitMsgSave,params:{task:"import",addressbook_id:this.addressbook_id,separator:this.addressbookImportPanel.form.findField("separator").getValue(),quote:this.addressbookImportPanel.form.findField("quote").getValue(),import_type:this.addressbookImportPanel.form.items.items[2].getValue(),import_filetype:this.addressbookImportPanel.form.items.items[0].getValue()},success:function(a,b){if(this.csvFieldDialog){this.csvFieldDialog.close()}Ext.MessageBox.alert(GO.lang.strSuccess,GO.addressbook.lang.importSuccess)},failure:function(a,b){if(task.failureType!="client"){Ext.MessageBox.alert(GO.lang.strError,b.result.feedback)}},scope:this})},exportData:function(){this.addressbookExportPanel.form.el.set({action:GO.settings.modules.addressbook.url+"export.php?addressbook_id="+this.addressbook_id});this.addressbookExportPanel.form.submit()}});GO.addressbook.AddresbooksGrid=function(a){if(!a){a={}}a.title=GO.addressbook.lang.cmdPanelAddressbook;a.layout="fit";a.autoScroll=true;a.split=true;a.store=GO.addressbook.readableAddressbooksStore;a.ddGroup="AddressBooksDD";a.enableDD=true;a.paging=false;var b=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"}]);b.defaultSortable=true;a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.addressbook.lang.noAddressbooks}),a.sm=new Ext.grid.RowSelectionModel({singleSelect:true});a.loadMask=true;GO.addressbook.AddresbooksGrid.superclass.constructor.call(this,a)};Ext.extend(GO.addressbook.AddresbooksGrid,GO.grid.GridPanel,{type:"",afterRender:function(){GO.addressbook.AddresbooksGrid.superclass.afterRender.call(this);var a=new Ext.dd.DropTarget(this.getView().mainBody,{ddGroup:"AddressBooksDD",notifyDrop:this.onNotifyDrop.createDelegate(this)})},setType:function(a){this.type=a},onNotifyDrop:function(a,j,g){var b=a.dragData.selections;var c=this.getView().findRowIndex(j.target);var h=this.getView().grid.store.data.items[c].id;var k=false;var d=[];for(var f=0;f<b.length;f++){d.push(b[f].id);if(b[f].json.company_id>0){k=true;company_id=b[f].json.company_id}}if(!k&&this.type=="company"){k=true}if(h>0&&(!k||confirm(GO.addressbook.lang.moveAll))){Ext.Ajax.request({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"drop_"+this.type,book_id:h,items:Ext.encode(d)}});this.fireEvent("drop",this.type);return true}else{return false}}});GO.addressbook.ContactReadPanel=Ext.extend(GO.DisplayPanel,{link_type:2,loadParams:{task:"load_contact_with_items"},idParam:"contact_id",loadUrl:GO.settings.modules.addressbook.url+"json.php",editHandler:function(){GO.addressbook.contactDialog.show(this.data.id);this.addSaveHandler(GO.addressbook.contactDialog)},initComponent:function(){this.template='<table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdContactDetailsFor+' <b>{full_name}</b></td></tr><tr><td valign="top"><table cellpadding="0" cellspacing="0" border="0"><tr><td><tpl if="this.notEmpty(title)">{title} </tpl>{full_name}<br /><tpl if="this.notEmpty(google_maps_link)"><a href="{google_maps_link}" target="_blank"></tpl>{formatted_address}<tpl if="this.notEmpty(google_maps_link)"></a></tpl></td></tr></table></td><td valign="top" class="contactCompanyDetailsPanelKolom"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(initials)"><tr><td>'+GO.lang.strInitials+':</td><td> {initials}</td></tr></tpl><tpl if="this.notEmpty(birthday)"><tr><td>'+GO.lang.strBirthday+':</td><td> {birthday}</td></tr></tpl></table></td></tr><tpl if="this.isContactFieldset(values)"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdFieldsetContact+'</td></tr><tr><td valign="top" class="contactCompanyDetailsPanelKolom60"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(email)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+':</td><td>{[this.mailTo(values.email, values.full_name)]}</td></tr></tpl><tpl if="this.notEmpty(email2)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+' 2:</td><td>{[this.mailTo(values.email2, values.full_name)]}</td></tr></tpl><tpl if="this.notEmpty(email3)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+' 3:</td><td>{[this.mailTo(values.email3, values.full_name)]}</td></tr></tpl><tpl if="this.isPhoneFieldset(values)"><tr><td colspan="2">&nbsp;</td></tr><tpl if="this.notEmpty(home_phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strPhone+':</td><td><a href="callto:{home_phone}+type=phone">{home_phone}</a></td></tr></tpl><tpl if="this.notEmpty(cellular)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strCellular+':</td><td><a href="callto:{cellular}+type=phone">{cellular}</a></td></tr></tpl><tpl if="this.notEmpty(fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFax+':</td><td>{fax}</td></tr></tpl></tpl></table></td><tpl if="this.isWorkPhoneFieldset(values)"><td valign="top" class="contactCompanyDetailsPanelKolom40"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(work_phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strWorkPhone+':</td><td><a href="callto:{work_phone}+type=phone">{work_phone}</a></td></tr></tpl><tpl if="this.notEmpty(work_fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strWorkFax+':</td><td>{work_fax}</td></tr></tpl></table></td></tpl></tr></tpl><tpl if="this.isWorkFieldset(values)"><tr><td colspan="2" class="display-panel-heading">'+GO.addressbook.lang.cmdFieldsetWork+'</td></tr><tr><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom60"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(company_name)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strCompany+':</td><td><a href="#" onclick="GO.linkHandlers[3].call(this,{company_id});">{company_name}</a></td></tr></tpl><tpl if="this.notEmpty(values[\'function\'])"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFunction+':</td><td>{function}</td></tr></tpl><tpl if="this.notEmpty(department)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strDepartment+':</td><td>{department}</td></tr></tpl></table></td></tr></tpl><tpl if="this.notEmpty(values[\'comment\'])"><tr><td class="display-panel-heading" colspan="2">'+GO.addressbook.lang.cmdFormLabelComment+'</td></tr><tr><td colspan="2">{comment}</td></tr></tpl></table>'+GO.linksTemplate;if(GO.customfields){this.template+=GO.customfields.displayPanelTemplate}Ext.apply(this.templateConfig,{addSlashes:function(a){a=GO.util.html_entity_decode(a,"ENT_QUOTES");a=GO.util.add_slashes(a);return a},mailTo:function(b,a){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+this.addSlashes(b)+"','"+this.addSlashes(a)+"');\">"+b+"</a>"}else{return'<a href="mailto:'+b+'">'+b+"</a>"}},isContactFieldset:function(a){if(this.notEmpty(a.email)||this.notEmpty(a.email2)||this.notEmpty(a.email3)||this.notEmpty(a.home_phone)||this.notEmpty(a.fax)||this.notEmpty(a.cellular)||this.notEmpty(a.work_phone)||this.notEmpty(a.work_fax)){return true}else{return false}},isPhoneFieldset:function(a){if(this.notEmpty(a.home_phone)||this.notEmpty(a.fax)||this.notEmpty(a.cellular)){return true}else{return false}},isWorkPhoneFieldset:function(a){if(this.notEmpty(a.work_phone)||this.notEmpty(a.work_fax)){return true}else{return false}},isWorkFieldset:function(a){if(this.notEmpty(a.company_name)||this.notEmpty(a["function"])||this.notEmpty(a.department)){return true}else{return false}},GoogleMapsCityStreet:function(a){var b="http://maps.google.com/maps?q=";if(this.notEmpty(a.address)&&this.notEmpty(a.city)){if(this.notEmpty(a.address_no)){return'<a href="'+b+a.address+"+"+a.address_no+"+"+a.city+'" target="_blank" >'+a.address+" "+a.address_no+"</a>"}else{return'<a href="'+b+a.address+"+"+a.city+'" target="_blank" >'+a.address+"</a>"}}else{return a.address+" "+a.address_no}}});Ext.apply(this.templateConfig,GO.linksTemplateConfig);if(GO.files){Ext.apply(this.templateConfig,GO.files.filesTemplateConfig);this.template+=GO.files.filesTemplate}if(GO.comments){this.template+=GO.comments.displayPanelTemplate}GO.addressbook.ContactReadPanel.superclass.initComponent.call(this);if(GO.mailings){this.newOODoc=new GO.mailings.NewOODocumentMenuItem();this.newOODoc.on("create",function(){this.reload()},this);this.newMenuButton.menu.add(this.newOODoc);GO.mailings.ooTemplatesStore.on("load",function(){this.newOODoc.setDisabled(GO.mailings.ooTemplatesStore.getCount()==0)},this)}if(GO.tasks){this.scheduleCallItem=new GO.tasks.ScheduleCallMenuItem();this.newMenuButton.menu.add(this.scheduleCallItem)}},getLinkName:function(){return this.data.full_name},setData:function(b){GO.addressbook.ContactReadPanel.superclass.setData.call(this,b);if(GO.mailings&&!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}if(b.write_permission){if(this.scheduleCallItem){var a=this.data.full_name;if(this.data.work_phone!=""){a+=" ("+this.data.work_phone+")"}else{if(this.data.cellular!=""){a+=" ("+this.data.cellular+")"}else{if(this.data.home_phone!=""){a+=" ("+this.data.home_phone+")"}}}this.scheduleCallItem.setLinkConfig({name:a,links:[{link_id:this.data.id,link_type:2}],callback:this.reload,scope:this})}}}});GO.addressbook.CompanyReadPanel=Ext.extend(GO.DisplayPanel,{link_type:3,loadParams:{task:"load_company_with_items"},idParam:"company_id",loadUrl:GO.settings.modules.addressbook.url+"json.php",editHandler:function(){GO.addressbook.companyDialog.show(this.data.id);this.addSaveHandler(GO.addressbook.companyDialog)},initComponent:function(){this.template='<div><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><tpl if="this.isCompanySecondColumn(values)"><td colspan="2" valign="top" class="display-panel-heading"></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="display-panel-heading"></tpl>'+GO.addressbook.lang.cmdCompanyDetailsFor+' <b>{name}</b></td></tr><tr><tpl if="this.isCompanySecondColumn(values)"><tpl if="this.isBankVat(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isBankVat(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(phone)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strPhone+':</td><td><a href="callto:{phone}+type=phone">{phone}</a></td></tr></tpl><tpl if="this.notEmpty(fax)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strFax+':</td><td>{fax}</td></tr></tpl><tpl if="this.notEmpty(email)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strEmail+':</td><td>{[this.mailTo(values.email, values.full_name)]}</td></tr></tpl><tr><td colspan="2">&nbsp;</td></tr><tpl if="this.notEmpty(homepage)"><tr><td class="contactCompanyLabelWidth">'+GO.lang.strHomepage+':</td><td>&nbsp;<a href="{homepage}" target="_blank">{homepage}</a></td></tr></tpl></table></td><tpl if="this.isBankVat(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"><table cellpadding="0" cellspacing="0" border="0"><tpl if="this.notEmpty(bank_no)"><tr><td>'+GO.addressbook.lang.cmdFormLabelBankNo+':</td><td>&nbsp;{bank_no}</td></tr></tpl><tpl if="this.notEmpty(vat_no)"><tr><td>'+GO.addressbook.lang.cmdFormLabelVatNo+':</td><td> {vat_no}</td></tr></tpl></table></td></tpl></tr><tpl if="this.isAddress(values)"><tr><tpl if="this.isCompanySecondColumn(values)"><td colspan="2" valign="top" class="display-panel-heading"></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="display-panel-heading"></tpl>'+GO.addressbook.lang.cmdFieldsetContact+'</td></tr><tr><tpl if="this.isAddressVisit(values)"><tpl if="this.isCompanySecondColumn(values)"><tpl if="this.isAddressPost(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isAddressPost(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl></tpl><tpl if="this.isCompanySecondColumn(values) == false"><td valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="readPanelSubHeading">'+GO.addressbook.lang.cmdFieldsetVisitAddress+'</td></tr><tr><td><tpl if="this.notEmpty(google_maps_link)"><a href="{google_maps_link}" target="_blank"></tpl>{formatted_address}<tpl if="this.notEmpty(google_maps_link)"></a></tpl></table></td></tpl><tpl if="this.isAddressPost(values)"><tpl if="this.isAddressVisit(values)"><td valign="top" class="contactCompanyDetailsPanelKolom"></tpl><tpl if="this.isAddressVisit(values) == false"><td colspan="2" valign="top" class="contactCompanyDetailsPanelKolom100"></tpl><table cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="readPanelSubHeading">'+GO.addressbook.lang.cmdFieldsetPostAddress+'</td></tr><tr><td><tpl if="this.notEmpty(post_google_maps_link)"><a href="{post_google_maps_link}" target="_blank"></tpl>{post_formatted_address}<tpl if="this.notEmpty(post_google_maps_link)"></a></tpl></table></td></tpl></tr></tpl></table><tpl if="this.notEmpty(comment)"><table cellpadding="0" cellspacing="0" border="0" class="display-panel"><tr><td class="display-panel-heading">'+GO.addressbook.lang.cmdFormLabelComment+'</td></tr><tr><td>{comment}</td></tr></table></tpl><tpl if="employees.length"><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="4" class="display-panel-heading">'+GO.addressbook.lang.cmdPanelEmployees+'</td></tr><tr><td width="16" class="display-panel-links-header">&nbsp;</td><td class="table_header_links">'+GO.lang.strName+'</td><td class="table_header_links">'+GO.lang.strEmail+'</td></tr><tpl for="employees"><tr><td><div class="go-icon go-link-icon-2"></div></td><td><a href="#" onclick="GO.linkHandlers[2].call(this, {id});">{name}</a></td><td>{[this.mailTo(values.email, values.name)]}</td></tr></tpl></tpl>'+GO.linksTemplate;if(GO.customfields){this.template+=GO.customfields.displayPanelTemplate}Ext.apply(this.templateConfig,{addSlashes:function(a){a=GO.util.html_entity_decode(a,"ENT_QUOTES");a=GO.util.add_slashes(a);return a},mailTo:function(b,a){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+this.addSlashes(b)+"','"+this.addSlashes(a)+"');\">"+b+"</a>"}else{return'<a href="mailto:'+b+'">'+b+"</a>"}},isCompanySecondColumn:function(a){if(this.isBankVat(a)||this.isAddressPost(a)){return true}else{return false}},isBankVat:function(a){if(this.notEmpty(a.bank_no)||this.notEmpty(a.vat_no)){return true}else{return false}},isAddress:function(a){if(this.notEmpty(a.address)||this.notEmpty(a.address_no)||this.notEmpty(a.zip)||this.notEmpty(a.city)||this.notEmpty(a.state)||this.notEmpty(a.country)||this.notEmpty(a.post_address)||this.notEmpty(a.post_address_no)||this.notEmpty(a.post_zip)||this.notEmpty(a.post_city)||this.notEmpty(a.post_state)||this.notEmpty(a.post_country)){return true}else{return false}},isAddressVisit:function(a){if(this.notEmpty(a.address)||this.notEmpty(a.address_no)||this.notEmpty(a.zip)||this.notEmpty(a.city)||this.notEmpty(a.state)||this.notEmpty(a.country)){return true}else{return false}},isAddressPost:function(a){if(this.notEmpty(a.post_address)||this.notEmpty(a.post_address_no)||this.notEmpty(a.post_zip)||this.notEmpty(a.post_city)||this.notEmpty(a.post_state)||this.notEmpty(a.post_country)){return true}else{return false}},GoogleMapsCityStreet:function(a){var b="http://maps.google.com/maps?q=";if(this.notEmpty(a.address)&&this.notEmpty(a.city)){if(this.notEmpty(a.address_no)){return'<a href="'+b+a.address+"+"+a.address_no+"+"+a.city+'" target="_blank" >'+a.address+" "+a.address_no+"</a>"}else{return'<a href="'+b+a.address+"+"+a.city+'" target="_blank" >'+a.address+"</a>"}}else{return a.address+" "+a.address_no}}});Ext.apply(this.templateConfig,GO.linksTemplateConfig);if(GO.files){Ext.apply(this.templateConfig,GO.files.filesTemplateConfig);this.template+=GO.files.filesTemplate}if(GO.comments){this.template+=GO.comments.displayPanelTemplate}this.template+="</div>";GO.addressbook.CompanyReadPanel.superclass.initComponent.call(this);if(GO.mailings){this.newOODoc=new GO.mailings.NewOODocumentMenuItem();this.newOODoc.on("create",function(){this.reload()},this);this.newMenuButton.menu.add(this.newOODoc);GO.mailings.ooTemplatesStore.on("load",function(){this.newOODoc.setDisabled(GO.mailings.ooTemplatesStore.getCount()==0)},this)}if(GO.tasks){this.scheduleCallItem=new GO.tasks.ScheduleCallMenuItem();this.newMenuButton.menu.add(this.scheduleCallItem)}},setData:function(b){GO.addressbook.CompanyReadPanel.superclass.setData.call(this,b);if(GO.mailings&&!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}if(b.write_permission){if(this.scheduleCallItem){var a=this.data.name;if(this.data.phone!=""){a+=" ("+this.data.phone+")"}this.scheduleCallItem.setLinkConfig({name:a,links:[{link_id:this.data.id,link_type:3}],callback:this.reload,scope:this})}}}});GO.addressbook.ContactDialog=function(c){Ext.apply(this,c);this.personalPanel=new GO.addressbook.ContactProfilePanel();this.commentPanel=new Ext.Panel({title:GO.addressbook.lang.cmdPanelComments,layout:"fit",border:false,items:[new Ext.form.TextArea({name:"comment",fieldLabel:"",hideLabel:true,anchor:"100% 100%"})]});this.personalPanel.on("show",function(){var e=Ext.get("first_name");if(e){e.focus()}},this);this.commentPanel.on("show",function(){this.formPanel.form.findField("comment").focus()},this);var a=[this.personalPanel,this.commentPanel];if(GO.mailings){a.push(new GO.mailings.SelectMailingsPanel())}if(GO.customfields&&GO.customfields.types["2"]){for(var d=0;d<GO.customfields.types["2"].panels.length;d++){a.push(GO.customfields.types["2"].panels[d])}}this.formPanel=new Ext.FormPanel({waitMsgTarget:true,url:GO.settings.modules.addressbook.url+"json.php",baseParams:{},border:false,items:[this.tabPanel=new Ext.TabPanel({border:false,activeTab:0,hideLabel:true,deferredRender:false,anchor:"100% 100%",items:a})]});this.collapsible=true;this.layout="fit";this.modal=false;this.shadow=false;this.border=false;this.height=570;this.width=820;this.plain=true;this.closeAction="hide";this.title=GO.addressbook.lang.cmdContactDialog;this.items=this.formPanel;this.buttons=[{text:GO.lang.cmdOk,handler:function(){this.saveContact(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.saveContact()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var b=function(){this.formPanel.form.findField("first_name").focus(true)};this.focus=b.createDelegate(this);GO.addressbook.ContactDialog.superclass.constructor.call(this);this.addEvents({save:true})};Ext.extend(GO.addressbook.ContactDialog,Ext.Window,{show:function(b){if(!this.rendered){this.render(Ext.getBody())}if(GO.mailings&&!GO.mailings.writableMailingsStore.loaded){GO.mailings.writableMailingsStore.load({callback:function(){var d=GO.util.empty(b)?this.formPanel.form.getValues():{};this.show(b);delete d.addressbook_id;delete d.iso_address_format;delete d.salutation;this.formPanel.form.setValues(d)},scope:this})}else{if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load({callback:function(){var d=GO.util.empty(b)?this.formPanel.form.getValues():{};this.show(b);delete d.addressbook_id;delete d.iso_address_format;delete d.salutation;this.formPanel.form.setValues(d)},scope:this})}else{var a=this.personalPanel.formAddressBooks.getValue();this.formPanel.form.reset();this.personalPanel.formAddressBooks.setValue(a);if(b){this.contact_id=b}else{this.contact_id=0}if(!GO.util.empty(GO.addressbook.defaultAddressbook)){this.personalPanel.formAddressBooks.setValue(GO.addressbook.defaultAddressbook)}else{this.personalPanel.formAddressBooks.selectFirst()}if(this.contact_id>0){this.loadContact(b)}else{GO.addressbook.ContactDialog.superclass.show.call(this)}var c=this.personalPanel.formAddressBooks.store.getById(this.personalPanel.formAddressBooks.getValue());this.personalPanel.formAddressFormat.setValue(c.get("default_iso_address_format"));this.tabPanel.setActiveTab(0)}}},loadContact:function(a){this.formPanel.form.load({url:GO.settings.modules.addressbook.url+"json.php",params:{contact_id:a,task:"load_contact"},success:function(b,c){if(!c.result.data.write_permission){Ext.Msg.alert(GO.lang.strError,GO.lang.strNoWritePermissions)}else{this.personalPanel.setAddressbookID(c.result.data.addressbook_id);this.formPanel.form.findField("company_id").setRemoteText(c.result.data.company_name);GO.addressbook.ContactDialog.superclass.show.call(this)}},scope:this})},saveContact:function(b){var a=this.personalPanel.formCompany.getRawValue();this.formPanel.form.submit({url:GO.settings.modules.addressbook.url+"action.php",waitMsg:GO.lang.waitMsgSave,params:{task:"save_contact",contact_id:this.contact_id,company:a},success:function(c,d){if(d.result.contact_id){this.contact_id=d.result.contact_id}this.fireEvent("save",this,this.contact_id);if(b){this.hide()}},failure:function(c,d){if(d.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,d.result.feedback)}},scope:this})}});GO.addressbook.CompanyDialog=function(c){Ext.apply(this,c);this.personalPanel=new GO.addressbook.CompanyProfilePanel();this.commentPanel=new Ext.Panel({title:GO.addressbook.lang.cmdPanelComments,layout:"fit",border:false,items:[new Ext.form.TextArea({name:"comment",fieldLabel:"",hideLabel:true})]});this.commentPanel.on("show",function(){this.companyForm.form.findField("comment").focus()},this);this.employeePanel=new GO.addressbook.EmployeesPanel();var a=[this.personalPanel,this.commentPanel];if(GO.mailings){a.push(new GO.mailings.SelectMailingsPanel())}a.push(this.employeePanel);if(GO.customfields&&GO.customfields.types["3"]){for(var d=0;d<GO.customfields.types["3"].panels.length;d++){a.push(GO.customfields.types["3"].panels[d])}}this.companyForm=new Ext.FormPanel({waitMsgTarget:true,border:false,baseParams:{},items:[this.tabPanel=new Ext.TabPanel({border:false,activeTab:0,deferredRender:false,hideLabel:true,anchor:"100% 100%",items:a})]});this.id="addressbook-window-new-company";this.layout="fit";this.modal=false;this.shadow=false;this.border=false;this.height=550;this.width=820;this.plain=true;this.closeAction="hide";this.collapsible=true;this.title=GO.addressbook.lang.cmdCompanyDialog;this.items=this.companyForm;this.buttons=[{id:"ok",text:GO.lang.cmdOk,handler:function(){this.saveCompany(true)},scope:this},{id:"apply",text:GO.lang.cmdApply,handler:function(){this.saveCompany()},scope:this},{id:"close",text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var b=function(){this.companyForm.form.findField("name").focus(true)};this.focus=b.createDelegate(this);GO.addressbook.CompanyDialog.superclass.constructor.call(this);this.addEvents({save:true})};Ext.extend(GO.addressbook.CompanyDialog,Ext.Window,{show:function(a){if(!GO.addressbook.writableAddressbooksStore.loaded){GO.addressbook.writableAddressbooksStore.load({callback:function(){this.show(a)},scope:this})}else{if(GO.mailings&&!GO.mailings.writableMailingsStore.loaded){GO.mailings.writableMailingsStore.load({callback:function(){this.show(a)},scope:this})}else{if(!this.rendered){this.render(Ext.getBody())}if(a){this.company_id=a}else{this.company_id=0}if(!GO.util.empty(GO.addressbook.defaultAddressbook)){this.personalPanel.formAddressBooks.setValue(GO.addressbook.defaultAddressbook)}else{this.personalPanel.formAddressBooks.selectFirst()}this.tabPanel.setActiveTab(0);if(this.company_id>0){this.loadCompany(a)}else{this.employeePanel.setCompanyId(0);var b=this.personalPanel.formAddressBooks.getValue();this.companyForm.form.reset();this.personalPanel.formAddressBooks.setValue(b);this.personalPanel.setCompanyId(0);var c=this.personalPanel.formAddressBooks.store.getById(b);this.personalPanel.formAddressFormat.setValue(c.get("default_iso_address_format"));this.personalPanel.formPostAddressFormat.setValue(c.get("default_iso_address_format"));GO.addressbook.CompanyDialog.superclass.show.call(this)}}}},loadCompany:function(a){this.companyForm.form.load({url:GO.settings.modules.addressbook.url+"json.php",params:{company_id:a,task:"load_company"},success:function(b,c){if(!c.result.data.write_permission){Ext.Msg.alert(GO.lang.strError,GO.lang.strNoWritePermissions)}else{this.employeePanel.setCompanyId(c.result.data.id);this.personalPanel.setCompanyId(c.result.data.id);GO.addressbook.CompanyDialog.superclass.show.call(this)}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},saveCompany:function(a){this.companyForm.form.submit({url:GO.settings.modules.addressbook.url+"action.php",params:{task:"save_company",company_id:this.company_id},waitMsg:GO.lang.waitMsgSave,success:function(b,c){if(c.result.company_id){this.company_id=c.result.company_id;this.employeePanel.setCompanyId(c.result.company_id)}this.fireEvent("save",this,this.company_id);if(a){this.hide()}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})}});GO.addressbook.SelectContactDialog=function(a){Ext.apply(this,a);this.searchField=new GO.form.SearchField({width:320});this.grid=new GO.addressbook.ContactsGrid({tbar:[GO.lang.strSearch+": "," ",this.searchField]});delete this.grid.store.baseParams.enable_mailings_filter;this.searchField.store=this.grid.store;var b=function(){this.searchField.focus(true)};GO.addressbook.SelectContactDialog.superclass.constructor.call(this,{layout:"fit",modal:false,focus:b.createDelegate(this),height:400,width:600,closeAction:"hide",title:GO.addressbook.lang.strSelectContact,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.addressbook.SelectContactDialog,Ext.Window,{show:function(){GO.addressbook.SelectContactDialog.superclass.show.call(this);this.grid.store.load()},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.addressbook.SelectCompanyDialog=function(a){Ext.apply(this,a);this.searchField=new GO.form.SearchField({width:320});this.grid=new GO.addressbook.CompaniesGrid({tbar:[GO.lang.strSearch+": "," ",this.searchField]});delete this.grid.store.baseParams.enable_mailings_filter;this.searchField.store=this.grid.store;var b=function(){this.searchField.focus(true)};GO.addressbook.SelectCompanyDialog.superclass.constructor.call(this,{layout:"fit",focus:b.createDelegate(this),modal:false,height:400,width:600,closeAction:"hide",title:GO.addressbook.lang.strSelectCompany,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.addressbook.SelectCompanyDialog,Ext.Window,{show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.addressbook.SelectCompanyDialog.superclass.show.call(this)},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.addressbook.ContactsGrid=function(b){if(!b){b={}}b.paging=true;b.border=false;var a={fields:["id","name","company_name","first_name","middle_name","last_name","title","initials","sex","birthday","email","email2","email3","home_phone","work_phone","work_fax","cellular","fax","address","address_no","zip","city","state","country","function","department","salutation","ctime","mtime"],columns:[{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strCompany,dataIndex:"company_name"},{header:GO.lang.strFirstName,dataIndex:"first_name",hidden:true},{header:GO.lang.strMiddleName,dataIndex:"middle_name",hidden:true},{header:GO.lang.strLastName,dataIndex:"last_name",hidden:true},{header:GO.lang.strTitle,dataIndex:"title",hidden:true},{header:GO.lang.strInitials,dataIndex:"initials",hidden:true},{header:GO.lang.strSex,dataIndex:"sex",hidden:true},{header:GO.lang.strBirthday,dataIndex:"birthday",hidden:true},{header:GO.lang.strEmail,dataIndex:"email",width:150,hidden:true},{header:GO.lang.strEmail+" 2",dataIndex:"email2",width:150,hidden:true},{header:GO.lang.strEmail+" 3",dataIndex:"email3",width:150,hidden:true},{header:GO.lang.strPhone,dataIndex:"home_phone",width:100,hidden:true},{header:GO.lang.strWorkPhone,dataIndex:"work_phone",width:100,hidden:true},{header:GO.lang.strWorkFax,dataIndex:"work_fax",width:100,hidden:true},{header:GO.lang.strCellular,dataIndex:"cellular",width:100,hidden:true},{header:GO.lang.strFax,dataIndex:"fax",width:100,hidden:true},{header:GO.lang.strAddress,dataIndex:"address",hidden:true},{header:GO.lang.strAddressNo,dataIndex:"address_no",hidden:true},{header:GO.lang.strZip,dataIndex:"zip",hidden:true},{header:GO.lang.strCity,dataIndex:"city",hidden:true},{header:GO.lang.strState,dataIndex:"state",hidden:true},{header:GO.lang.strCountry,dataIndex:"country",hidden:true},{header:GO.lang.strFunction,dataIndex:"function",hidden:true},{header:GO.lang.strDepartment,dataIndex:"department",hidden:true},{header:GO.lang.strSalutation,dataIndex:"salutation",hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",hidden:true,width:80},{header:GO.lang.strCtime,dataIndex:"ctime",hidden:true,width:80}]};if(GO.customfields){GO.customfields.addColumns(2,a)}b.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts",enable_mailings_filter:true},root:"results",id:"id",totalProperty:"total",fields:a.fields,remoteSort:true});var c=new Ext.grid.ColumnModel(a.columns);c.defaultSortable=true;b.cm=c;b.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems}),b.sm=new Ext.grid.RowSelectionModel();b.loadMask=true;b.enableDragDrop=true;b.ddGroup="AddressBooksDD";GO.addressbook.ContactsGrid.superclass.constructor.call(this,b);this.on("rowdblclick",function(e,f){var d=e.getStore().getAt(f);GO.addressbook.contactDialog.show(d.data.id)},this)};Ext.extend(GO.addressbook.ContactsGrid,GO.grid.GridPanel,{loaded:false,afterRender:function(){GO.addressbook.ContactsGrid.superclass.afterRender.call(this);if(this.isVisible()){this.onGridShow()}},onGridShow:function(){if(!this.loaded&&this.rendered){this.store.load();this.loaded=true}}});GO.addressbook.CompaniesGrid=function(b){if(!b){b={}}b.border=false;b.paging=true;var a={fields:["id","name","homepage","email","phone","fax","address","address_no","zip","city","state","country","post_address","post_address_no","post_city","post_state","post_country","post_zip","bank_no","vat_no","ctime","mtime"],columns:[{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strEmail,dataIndex:"email",width:150,hidden:true},{header:GO.lang.strHomepage,dataIndex:"homepage",width:100,hidden:true},{header:GO.lang.strPhone,dataIndex:"phone",width:100},{header:GO.lang.strFax,dataIndex:"fax",width:80,hidden:true},{header:GO.lang.strAddress,dataIndex:"address",hidden:true},{header:GO.lang.strAddressNo,dataIndex:"address_no",hidden:true},{header:GO.lang.strZip,dataIndex:"zip",hidden:true},{header:GO.lang.strCity,dataIndex:"city",hidden:true},{header:GO.lang.strState,dataIndex:"state",width:80,hidden:true},{header:GO.lang.strCountry,dataIndex:"country",hidden:true},{header:GO.lang.strPostAddress,dataIndex:"post_address",hidden:true},{header:GO.lang.strPostAddressNo,dataIndex:"post_address_no",hidden:true},{header:GO.lang.strPostZip,dataIndex:"post_zip",hidden:true},{header:GO.lang.strPostCity,dataIndex:"post_city",hidden:true},{header:GO.lang.strPostState,dataIndex:"post_state",width:80,hidden:true},{header:GO.lang.strPostCountry,dataIndex:"post_country",hidden:true},{header:GO.addressbook.lang.cmdFormLabelBankNo,dataIndex:"bank_no",hidden:true},{header:GO.addressbook.lang.cmdFormLabelVatNo,dataIndex:"vat_no",hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",hidden:true,width:80},{header:GO.lang.strCtime,dataIndex:"ctime",hidden:true,width:80}]};if(GO.customfields){GO.customfields.addColumns(3,a)}b.store=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies",enable_mailings_filter:true},root:"results",id:"id",totalProperty:"total",fields:a.fields,remoteSort:true});var c=new Ext.grid.ColumnModel(a.columns);c.defaultSortable=true;b.cm=c;b.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems}),b.sm=new Ext.grid.RowSelectionModel();b.loadMask=true;b.enableDragDrop=true;b.ddGroup="AddressBooksDD";GO.addressbook.CompaniesGrid.superclass.constructor.call(this,b);this.on("rowdblclick",function(e,f){var d=e.getStore().getAt(f);GO.addressbook.companyDialog.show(d.data.id)},this)};Ext.extend(GO.addressbook.CompaniesGrid,GO.grid.GridPanel,{loaded:false,afterRender:function(){GO.addressbook.CompaniesGrid.superclass.afterRender.call(this);if(this.isVisible()){this.onGridShow()}},onGridShow:function(){if(!this.loaded&&this.rendered){this.store.load();this.loaded=true}}});GO.addressbook.SearchPanel=function(b){if(!b){b={}}b.layout="table";b.split=true;b.height=40;b.keys=[{key:Ext.EventObject.ENTER,fn:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.fireQueryEvent()},scope:this}];this.alphabetArray=GO.addressbook.lang.alphabet.split(",");var d=new Array();d.push({value:"[0-9]"});for(var c=0;c<this.alphabetArray.length;c++){d.push({value:this.alphabetArray[c]})}var a=new Ext.XTemplate('<tpl for=".">','<span class="letter" onclick="">{value}</span>',"</tpl>");this.selectedLetter=0;this.alphabetView=new Ext.DataView({height:30,store:new Ext.data.JsonStore({fields:["value"],data:d}),tpl:a,autoHeight:true,singleSelect:true,cls:"alphabet-view",overClass:"alphabet-view-over",selectedClass:"alphabet-view-selected",itemSelector:"span.letter"});this.alphabetView.on("selectionchange",function(f,e){if(e[0]){this.selectedLetter=e[0].innerHTML;this.queryField.setValue("");this.fireQueryEvent()}},this);this.alphabetView.on("containerclick",function(f,g){return false},this);this.queryField=new Ext.form.TextField({name:"query",width:200,emptyText:GO.lang.strSearch+" "+GO.addressbook.lang.cmdFormSearchFourth});b.defaults={border:false,cls:"ab-search-form-panel"};b.items=[{items:this.alphabetView},{items:this.queryField},{items:new Ext.Button({handler:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.fireQueryEvent()},text:GO.lang.strSearch,scope:this})},{items:new Ext.Button({handler:function(){if(!this.advancedSearchWindow){this.advancedSearchWindow=new GO.addressbook.AdvancedSearchWindow();this.advancedSearchWindow.on("ok",function(f){this.fireEvent("queryChange",{advancedQuery:Ext.encode(f.getGridData())})},this)}var e=this.ab.tabPanel.getActiveTab().id=="ab-contacts-grid"?"contacts":"companies";this.advancedSearchWindow.show(e)},text:GO.addressbook.lang.advancedSearch,scope:this})},{items:new Ext.Button({handler:function(){this.selectedLetter="";this.alphabetView.clearSelections();this.queryField.setValue("");this.fireQueryEvent()},text:GO.lang.cmdReset,scope:this})}];GO.addressbook.SearchPanel.superclass.constructor.call(this,b);this.addEvents({queryChange:true})};Ext.extend(GO.addressbook.SearchPanel,Ext.Panel,{selectedLetter:"",fireQueryEvent:function(){var a={clicked_letter:this.selectedLetter,query:this.queryField.getValue(),advancedQuery:""};this.fireEvent("queryChange",a)}});GO.addressbook.ContactProfilePanel=function(a){Ext.apply(a);this.formFirstName=new Ext.form.TextField({fieldLabel:GO.lang.strFirstName,name:"first_name",panel:this,validateValue:function(c){var b=(c!=""||this.panel.formLastName.getValue()!="");if(!b){this.markInvalid(this.blankText)}else{this.panel.formLastName.clearInvalid()}return b}});this.formMiddleName=new Ext.form.TextField({fieldLabel:GO.lang.strMiddleName,name:"middle_name"});this.formLastName=new Ext.form.TextField({fieldLabel:GO.lang.strLastName,name:"last_name",panel:this,validateValue:function(c){var b=(c!=""||this.panel.formFirstName.getValue()!="");if(!b){this.markInvalid(this.blankText)}else{this.panel.formFirstName.clearInvalid()}return b}});this.formTitle=new Ext.form.TextField({fieldLabel:GO.lang.strTitle,name:"title"});this.formInitials=new Ext.form.TextField({fieldLabel:GO.lang.strInitials,name:"initials"});this.sexCombo=new GO.form.ComboBox({fieldLabel:GO.lang.strSex,hiddenName:"sex",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["M",GO.lang.strMale],["F",GO.lang.strFemale]]}),value:"M",valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true});this.formSalutation=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelSalutation,name:"salutation"});this.formBirthday=new Ext.form.DateField({fieldLabel:GO.lang.strBirthday,name:"birthday",format:GO.settings.date_format});this.formEmail=new Ext.form.TextField({fieldLabel:GO.lang.strEmail,name:"email"});this.formEmail2=new Ext.form.TextField({fieldLabel:GO.lang.strEmail+" 2",name:"email2"});this.formEmail3=new Ext.form.TextField({fieldLabel:GO.lang.strEmail+" 3",name:"email3"});this.formHomePhone=new Ext.form.TextField({fieldLabel:GO.lang.strPhone,name:"home_phone"});this.formFax=new Ext.form.TextField({fieldLabel:GO.lang.strFax,name:"fax"});this.formCellular=new Ext.form.TextField({fieldLabel:GO.lang.strCellular,name:"cellular"});this.formAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"address"});this.formAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"address_no"});this.formPostal=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"zip"});this.formCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"city"});this.formState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"state"});this.formCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"country_text",hiddenName:"country",listeners:{select:function(d,b){var c=this.formAddressFormat.store.getById(b.get("iso"));if(!c){var e=this.formAddressBooks.store.getById(this.formAddressBooks.getValue());c=e.get("default_iso_address_format")}else{c=c.id}this.formAddressFormat.setValue(c)},scope:this}});this.formAddressFormat=new GO.form.SelectAddressFormat({fieldLabel:GO.lang.strAddressFormat,name:"iso_address_format",displayField:"country_name",hiddenName:"iso_address_format",allowBlank:false});this.formCompany=new GO.addressbook.SelectCompany({fieldLabel:GO.lang.strCompany,name:"company",hiddenName:"company_id",emptyText:GO.addressbook.lang.cmdFormCompanyEmptyText,addressbook_id:this.addressbook_id});this.formDepartment=new Ext.form.TextField({fieldLabel:GO.lang.strDepartment,name:"department"});this.formFunction=new Ext.form.TextField({fieldLabel:GO.lang.strFunction,name:"function"});this.formWorkPhone=new Ext.form.TextField({fieldLabel:GO.lang.strWorkPhone,name:"work_phone"});this.formWorkFax=new Ext.form.TextField({fieldLabel:GO.lang.strWorkFax,name:"work_fax"});this.formAddressBooks=new GO.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelAddressBooks,store:GO.addressbook.writableAddressbooksStore,displayField:"name",valueField:"id",hiddenName:"addressbook_id",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,allowBlank:false,anchor:"100%"});this.formAddressBooks.on("beforeselect",function(d,b){if(this.formCompany.getValue()==0||confirm(GO.addressbook.lang.moveAll)){this.setAddressbookID(b.data.id);var c=this.formAddressFormat.store.getById(b.get("default_iso_address_format"));if(c){this.formAddressFormat.setValue(c.id);this.setSalutation()}return true}else{return false}},this);this.formAddressBooks.on("select",function(){this.setSalutation(true)},this);this.formFirstName.on("blur",function(){this.setSalutation(false)},this);this.formMiddleName.on("blur",function(){this.setSalutation(false)},this);this.formLastName.on("blur",function(){this.setSalutation(false)},this);this.formInitials.on("blur",function(){this.setSalutation(false)},this);this.formTitle.on("blur",function(){this.setSalutation(false)},this);this.sexCombo.on("change",function(){this.setSalutation(true)},this);this.formFirstName.on("change",function(){this.setSalutation(true)},this);this.formMiddleName.on("change",function(){this.setSalutation(true)},this);this.formLastName.on("change",function(){this.setSalutation(true)},this);this.formInitials.on("change",function(){this.setSalutation(true)},this);this.formTitle.on("change",function(){this.setSalutation(true)},this);this.addressbookFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetSelectAddressbook,autoHeight:true,collapsed:false,items:this.formAddressBooks};this.personalFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetPersonalDetails,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formFirstName,this.formMiddleName,this.formLastName,this.formTitle,this.formInitials,this.sexCombo,this.formSalutation,this.formBirthday]};this.addressFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetAddress,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formAddress,this.formAddressNo,this.formPostal,this.formCity,this.formState,this.formCountry,this.formAddressFormat]};this.contactFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetContact,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formEmail,this.formEmail2,this.formEmail3,this.formHomePhone,this.formFax,this.formCellular,this.formWorkPhone,this.formWorkFax]};this.workFieldset={xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetWork,autoHeight:true,collapsed:false,defaults:{border:false,anchor:"100%"},items:[this.formCompany,this.formDepartment,this.formFunction]};this.title=GO.addressbook.lang.cmdPanelContact;this.bodyStyle="padding:5px";this.layout="column";this.labelWidth=125;this.defaults={border:false};this.items=[{columnWidth:0.5,autoScroll:true,items:[this.addressbookFieldset,this.personalFieldset,this.workFieldset]},{columnWidth:0.5,style:"margin-left: 5px;",items:[this.contactFieldset,this.addressFieldset]}];GO.addressbook.ContactProfilePanel.superclass.constructor.call(this)};Ext.extend(GO.addressbook.ContactProfilePanel,Ext.Panel,{setSalutation:function(e){if(e||this.formSalutation.getValue()==""){var j=this.formFirstName.getValue();var b=this.formMiddleName.getValue();var k=this.formLastName.getValue();var a=this.formInitials.getValue();var i=this.formTitle.getValue();var c=this.formAddressBooks.store.getById(this.formAddressBooks.getValue());var d=c.get("default_salutation");var g=d.slice(d.indexOf("[")+1,d.indexOf("]"));var f=g.split("/");var h=(this.sexCombo.getValue()=="M")?f[0]:f[1];d=d.replace("["+g+"]",h);d=d.replace("{first_name}",j);d=d.replace("{middle_name}",b);d=d.replace("{last_name}",k);d=d.replace("{initials}",a);d=d.replace("{title}",i);d=d.replace("  "," ");this.formSalutation.setValue(d)}},setAddressbookID:function(a){this.formAddressBooks.setValue(a);this.formCompany.store.baseParams.addressbook_id=a;this.formCompany.clearLastSearch()}});GO.addressbook.CompanyProfilePanel=function(a){Ext.apply(a);this.formAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"address",listeners:{change:function(c,b){if(this.formPostAddress.getValue()==""){this.formPostAddress.setValue(b)}},scope:this}});this.formAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"address_no",listeners:{change:function(c,b){if(this.formPostAddressNo.getValue()==""){this.formPostAddressNo.setValue(b)}},scope:this}});this.formZip=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"zip",listeners:{change:function(c,b){if(this.formPostZip.getValue()==""){this.formPostZip.setValue(b)}},scope:this}});this.formCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"city",listeners:{change:function(c,b){if(this.formPostCity.getValue()==""){this.formPostCity.setValue(b)}},scope:this}});this.formState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"state",listeners:{change:function(c,b){if(this.formPostState.getValue()==""){this.formPostState.setValue(b)}},scope:this}});this.formCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"country_text",hiddenName:"country",listeners:{select:function(d,b){var c=this.formAddressFormat.store.getById(b.get("iso"));if(!c){var e=this.formAddressBooks.store.getById(this.formAddressBooks.getValue());c=e.get("default_iso_address_format")}else{c=c.id}this.formAddressFormat.setValue(c)},change:function(d,b){if(this.formPostCountry.getValue()==""){this.formPostCountry.setValue(b);var c=this.formPostAddressFormat.store.getById(b);if(!c){var e=this.formAddressBooks.store.getById(this.formAddressBooks.getValue());c=e.get("default_iso_address_format")}else{c=c.id}this.formPostAddressFormat.setValue(c)}},scope:this}});this.formAddressFormat=new GO.form.SelectAddressFormat({fieldLabel:GO.lang.strAddressFormat,name:"iso_address_format",displayField:"country_name",hiddenName:"iso_address_format",allowBlank:false});this.formPostAddress=new Ext.form.TextField({fieldLabel:GO.lang.strAddress,name:"post_address"});this.formPostAddressNo=new Ext.form.TextField({fieldLabel:GO.lang.strAddressNo,name:"post_address_no"});this.formPostZip=new Ext.form.TextField({fieldLabel:GO.lang.strZip,name:"post_zip"});this.formPostCity=new Ext.form.TextField({fieldLabel:GO.lang.strCity,name:"post_city"});this.formPostState=new Ext.form.TextField({fieldLabel:GO.lang.strState,name:"post_state"});this.formPostCountry=new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,name:"post_country_text",hiddenName:"post_country",listeners:{select:function(d,b){var c=this.formPostAddressFormat.store.getById(b.get("iso"));if(!c){var e=this.formAddressBooks.store.getById(this.formAddressBooks.getValue());c=e.get("default_iso_address_format")}else{c=c.id}this.formPostAddressFormat.setValue(c)},scope:this}});this.formPostAddressFormat=new GO.form.SelectAddressFormat({fieldLabel:GO.lang.strAddressFormat,name:"post_iso_address_format",displayField:"country_name",hiddenName:"post_iso_address_format"});this.formName=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name"});this.formPhone=new Ext.form.TextField({fieldLabel:GO.lang.strPhone,name:"phone",allowBlank:true,labelSeparator:this.separator,width:this.widthLeftColumn});this.formFax=new Ext.form.TextField({fieldLabel:GO.lang.strFax,name:"fax"});this.formEmail=new Ext.form.TextField({fieldLabel:GO.lang.strEmail,name:"email"});this.formHomepage=new Ext.form.TextField({fieldLabel:GO.lang.strHomepage,name:"homepage"});this.formBankNo=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelBankNo,name:"bank_no"});this.formVatNo=new Ext.form.TextField({fieldLabel:GO.addressbook.lang.cmdFormLabelVatNo,name:"vat_no"});this.formAddressBooks=new GO.form.ComboBox({fieldLabel:GO.addressbook.lang.cmdFormLabelAddressBooks,store:GO.addressbook.writableAddressbooksStore,displayField:"name",valueField:"id",hiddenName:"addressbook_id",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,anchor:"100%"});this.formAddressBooks.on("beforeselect",function(c,b){if(this.company_id>0){return confirm(GO.addressbook.lang.moveAll)}},this);this.title=GO.addressbook.lang.cmdPanelCompany;this.labelWidth=120;this.bodyStyle="padding: 5px";this.layout="column";this.defaults={border:false};this.items=[{columnWidth:0.5,defaults:{border:false},items:[{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetSelectAddressbook,autoHeight:true,border:true,collapsed:false,items:this.formAddressBooks},{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetCompanyDetails,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formName,this.formPhone,this.formFax,this.formEmail,this.formHomepage,this.formBankNo,this.formVatNo]}]},{columnWidth:0.5,defaults:{border:false},style:"margin-left: 5px;",items:[{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetVisitAddress,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formAddress,this.formAddressNo,this.formZip,this.formCity,this.formState,this.formCountry,this.formAddressFormat]},{xtype:"fieldset",title:GO.addressbook.lang.cmdFieldsetPostAddress,autoHeight:true,collapsed:false,border:true,defaults:{border:false,anchor:"100%"},items:[this.formPostAddress,this.formPostAddressNo,this.formPostZip,this.formPostCity,this.formPostState,this.formPostCountry,this.formPostAddressFormat]}]}];GO.addressbook.CompanyProfilePanel.superclass.constructor.call(this)};Ext.extend(GO.addressbook.CompanyProfilePanel,Ext.Panel,{setCompanyId:function(a){this.company_id=a}});GO.addressbook.EmployeesPanel=function(a){if(!a){a={}}a.store=new Ext.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{company_id:this.company_id,task:"load_employees"},id:"id",root:"results",fields:[{name:"id"},{name:"name"},{name:"function"},{name:"department"},{name:"phone"},{name:"email"}],remoteSort:true});a.store.on("load",function(){this.loaded=true},this);a.cm=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strEmail,dataIndex:"email",width:200},{header:GO.lang.strPhone,dataIndex:"phone",width:100},{header:GO.lang.strFunction,dataIndex:"function",width:150},{header:GO.lang.strDepartment,dataIndex:"department",width:150}]);a.cm.defaultSortable=true;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true});a.layout="fit";a.paging=true;a.title=GO.addressbook.lang.cmdPanelEmployees;a.id="ab-employees-grid";a.sm=new Ext.grid.RowSelectionModel({singleSelect:true});a.autoScroll=false;a.trackMouseOver=true;a.collapsible=false;a.disabled=true;a.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){if(!this.selectContactDialog){this.selectContactDialog=new GO.addressbook.SelectContactDialog({handler:function(b){var c=b.selModel.selections.keys;this.store.baseParams.add_contacts=Ext.encode(c);this.store.load();delete this.store.baseParams.add_contacts},scope:this})}this.selectContactDialog.grid.store.baseParams.addressbook_id=this.ownerCt.ownerCt.ownerCt.companyForm.form.findField("addressbook_id").getValue();this.selectContactDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.addressbook.EmployeesPanel.superclass.constructor.call(this,a);this.on("rowdblclick",function(d,c){var b=d.getStore().getAt(c);GO.addressbook.contactDialog.show(b.data.id)},this)};Ext.extend(GO.addressbook.EmployeesPanel,GO.grid.GridPanel,{setCompanyId:function(a){if(a!=this.store.baseParams.company_id){this.loaded=false;this.store.baseParams.company_id=a;this.setDisabled(a==0)}},onShow:function(){if(!this.loaded){this.store.load()}GO.addressbook.CompanyProfilePanel.superclass.onShow.call(this)}});GO.addressbook.AdvancedSearchWindow=function(c){if(!c){c={}}var a=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"fields",type:""},root:"results",id:"field",fields:["field","label","value","type","options"],remoteSort:true});var b=new Ext.grid.ColumnModel({columns:[{header:GO.lang.field,dataIndex:"label"},{header:GO.lang.value,dataIndex:"value",editable:true}],editors:{text:new Ext.grid.GridEditor(new Ext.form.TextField({})),textarea:new Ext.grid.GridEditor(new Ext.form.TextArea({})),number:new Ext.grid.GridEditor(new GO.form.NumberField({})),date:new Ext.grid.GridEditor(new Ext.form.DateField({format:GO.settings.date_format})),checkbox:new Ext.grid.GridEditor(new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value","text"],data:[["",GO.lang.strNA],["1",GO.lang.on],["0",GO.lang.off]]}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true})),country:new Ext.grid.GridEditor(new GO.form.SelectCountry({}))},getCellEditor:function(d,f){var e=a.getAt(f);if(!this.editors[e.get("type")]&&e.get("options")){this.editors[e.get("type")]=new Ext.grid.GridEditor(new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["text"],data:e.get("options")}),displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true}))}return this.editors[e.get("type")]||this.editors.text}});this.grid=new Ext.grid.EditorGridPanel({cm:b,layout:"fit",view:new Ext.grid.GridView({autoFill:true}),loadMask:{msg:GO.lang.waitMsgLoad},clicksToEdit:1,store:a});c.items=this.grid;c.collapsible=true;c.layout="fit";c.modal=false;c.resizable=true;c.width=500;c.height=400;c.closeAction="hide";c.title=GO.addressbook.lang.advancedSearch;c.buttons=[{text:GO.lang.cmdOk,handler:function(){this.fireEvent("ok",this);this.hide()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.addressbook.AdvancedSearchWindow.superclass.constructor.call(this,c);this.addEvents({ok:true})};Ext.extend(GO.addressbook.AdvancedSearchWindow,GO.Window,{editor:new Ext.form.TextField(),getCellEditor:function(a,b){console.log(this);return this.editor},show:function(a){if(a!=this.grid.store.baseParams.type){this.grid.store.baseParams.type=a;this.grid.store.load()}GO.addressbook.AdvancedSearchWindow.superclass.show.call(this)},getGridData:function(){var c={};for(var a=0;a<this.grid.store.data.items.length;a++){var b=this.grid.store.data.items[a];if(!GO.util.empty(b.get("value"))){c[b.get("field")]=b.get("value")}}return c}});GO.addressbook.MainPanel=function(a){if(!a){a={}}this.contactsGrid=new GO.addressbook.ContactsGrid({layout:"fit",region:"center",id:"ab-contacts-grid-panel"});this.contactsGrid.on("delayedrowselect",function(d,f,e){this.contactEastPanel.load(e.get("id"))},this);this.contactsGrid.store.on("load",function(){this.setAdvancedSearchNotification(this.contactsGrid.store)},this);this.companiesGrid=new GO.addressbook.CompaniesGrid({layout:"fit",region:"center",id:"ab-company-grid-panel"});this.companiesGrid.on("delayedrowselect",function(d,f,e){this.companyEastPanel.load(e.get("id"))},this);this.companiesGrid.store.on("load",function(){this.setAdvancedSearchNotification(this.companiesGrid.store)},this);this.searchPanel=new GO.addressbook.SearchPanel({region:"north",ab:this});this.searchPanel.on("queryChange",function(d){this.setSearchParams(d)},this);this.contactEastPanel=new GO.addressbook.ContactReadPanel({region:"east",title:GO.addressbook.lang.cmdPanelContact,width:420});this.companyEastPanel=new GO.addressbook.CompanyReadPanel({region:"east",title:GO.addressbook.lang.cmdPanelCompany,width:420});this.contactsPanel=new Ext.Panel({id:"ab-contacts-grid",title:GO.addressbook.lang.contacts,layout:"border",items:[this.contactsGrid,this.contactEastPanel]});this.contactsPanel.on("show",function(){this.contactsGrid.onGridShow();this.setAdvancedSearchNotification(this.contactsGrid.store);this.addressbooksGrid.setType("contact")},this);this.companyPanel=new Ext.Panel({id:"ab-company-grid",title:GO.addressbook.lang.companies,layout:"border",items:[this.companiesGrid,this.companyEastPanel]});this.companyPanel.on("show",this.companiesGrid.onGridShow,this.companiesGrid);this.companyPanel.on("show",function(){this.companiesGrid.onGridShow();this.setAdvancedSearchNotification(this.companiesGrid.store);this.addressbooksGrid.setType("company")},this);this.addressbooksGrid=new GO.addressbook.AddresbooksGrid({region:"west",id:"ab-addressbook-grid",width:180});this.addressbooksGrid.on("rowclick",function(e,f){var d=e.getStore().getAt(f);this.setSearchParams({addressbook_id:d.get("id")})},this);this.addressbooksGrid.getSelectionModel().on("rowselect",function(f,e,d){GO.addressbook.defaultAddressbook=f.getSelected().get("id")},this);this.addressbooksGrid.on("drop",function(d){if(d=="company"){this.companiesGrid.store.reload()}else{this.contactsGrid.store.reload()}},this);this.tabPanel=new Ext.TabPanel({region:"center",activeTab:0,border:true,items:[this.contactsPanel,this.companyPanel]});a.layout="border";a.border=false;if(GO.mailings){this.mailingsFilterPanel=new GO.mailings.MailingsFilterPanel({region:"center"});this.mailingsFilterPanel.on("change",function(f,e){var d=this.tabPanel.getActiveTab();if(d.id=="ab-contacts-grid"){this.contactsGrid.store.baseParams.mailings_filter=Ext.encode(e);this.contactsGrid.store.load();delete this.contactsGrid.store.baseParams.mailings_filter}else{this.companiesGrid.store.baseParams.mailings_filter=Ext.encode(e);this.companiesGrid.store.load();delete this.companiesGrid.store.baseParams.mailings_filter}},this);this.addressbooksGrid.region="north";this.addressbooksGrid.height=200;var c=new Ext.Panel({layout:"border",border:false,region:"west",width:180,split:true,items:[this.addressbooksGrid,this.mailingsFilterPanel]});a.items=[this.searchPanel,c,this.tabPanel]}else{a.items=[this.searchPanel,this.addressbooksGrid,this.tabPanel]}var b=[{iconCls:"btn-addressbook-add-contact",text:GO.addressbook.lang.btnAddContact,cls:"x-btn-text-icon",handler:function(){GO.addressbook.contactDialog.show(0);this.tabPanel.setActiveTab("ab-contacts-grid")},scope:this},{iconCls:"btn-addressbook-add-company",text:GO.addressbook.lang.btnAddCompany,cls:"x-btn-text-icon",handler:function(){GO.addressbook.companyDialog.show(0);this.tabPanel.setActiveTab("ab-company-grid")},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){var d=this.tabPanel.getActiveTab();switch(d.id){case"ab-contacts-grid":this.contactsGrid.deleteSelected({callback:this.contactEastPanel.gridDeleteCallback,scope:this.contactEastPanel});break;case"ab-company-grid":this.companiesGrid.deleteSelected({callback:this.companyEastPanel.gridDeleteCallback,scope:this.companyEastPanel});break}},scope:this},"-",{iconCls:"btn-addressbook-manage",text:GO.lang.administration,cls:"x-btn-text-icon",handler:function(){if(!this.manageDialog){this.manageDialog=new GO.addressbook.ManageDialog()}this.manageDialog.show()},scope:this},{iconCls:"btn-export",text:GO.lang.cmdExport,cls:"x-btn-text-icon",handler:function(){var e=this.tabPanel.getActiveTab();var d={};switch(e.id){case"ab-contacts-grid":d.query="search_contacts";d.colModel=this.contactsGrid.getColumnModel();break;case"ab-company-grid":d.query="search_companies";d.colModel=this.companiesGrid.getColumnModel();break}d.title=e.title;var f=this.searchPanel.queryField.getValue();if(!GO.util.empty(f)){d.subtitle=GO.lang.searchQuery+": "+f}else{d.subtile=""}if(!this.exportDialog){this.exportDialog=new GO.ExportQueryDialog()}this.exportDialog.show(d)},scope:this}];if(GO.mailings&&GO.email){b.push("-");b.push({iconCls:"ml-btn-mailings",text:GO.addressbook.lang.sendMailing,cls:"x-btn-text-icon",handler:function(){if(!this.selectMailingGroupWindow){this.selectMailingGroupWindow=new GO.mailings.SelectMailingGroupWindow();this.selectMailingGroupWindow.on("select",function(e,d){GO.email.showComposer({mailing_group_id:d})},this)}this.selectMailingGroupWindow.show()},scope:this})}a.tbar=new Ext.Toolbar({cls:"go-head-tb",items:b});GO.addressbook.MainPanel.superclass.constructor.call(this,a)};Ext.extend(GO.addressbook.MainPanel,Ext.Panel,{setAdvancedSearchNotification:function(a){if(!GO.util.empty(a.baseParams.advancedQuery)){this.searchPanel.queryField.setValue("[ "+GO.addressbook.lang.advancedSearch+" ]");this.searchPanel.queryField.setDisabled(true)}else{if(this.searchPanel.queryField.getValue()=="[ "+GO.addressbook.lang.advancedSearch+" ]"){this.searchPanel.queryField.setValue("")}this.searchPanel.queryField.setDisabled(false)}},afterRender:function(){GO.addressbook.MainPanel.superclass.afterRender.call(this);GO.addressbook.readableAddressbooksStore.load({callback:function(){this.addressbooksGrid.getSelectionModel().selectFirstRow()},scope:this});if(GO.mailings){if(!GO.mailings.ooTemplatesStore.loaded){GO.mailings.ooTemplatesStore.load()}}GO.addressbook.contactDialog.on("save",function(){var a=this.tabPanel.getActiveTab();if(a.id=="ab-contacts-grid"){this.contactsGrid.store.reload()}},this);GO.addressbook.companyDialog.on("save",function(){var a=this.tabPanel.getActiveTab();if(a.id=="ab-company-grid"){this.companiesGrid.store.reload()}},this)},setSearchParams:function(c){var a=this.tabPanel.getActiveTab();for(var b in c){if(b!="advancedQuery"||a.id=="ab-contacts-grid"){this.contactsGrid.store.baseParams[b]=c[b]}if(b!="advancedQuery"||a.id!="ab-contacts-grid"){this.companiesGrid.store.baseParams[b]=c[b]}}if(a.id=="ab-contacts-grid"){this.companiesGrid.loaded=false;this.contactsGrid.store.load()}else{this.contactsGrid.loaded=false;this.companiesGrid.store.load()}},rowDoubleClick:function(){var a=this.tabPanel.getActiveTab();switch(a.id){case"ab-contacts-grid":GO.addressbook.contactDialog.show(this.contactsGrid.selModel.selections.items[0].data.id);break;case"ab-company-grid":GO.addressbook.companyDialog.show(this.companiesGrid.selModel.selections.items[0].data.id);break}}});GO.mainLayout.onReady(function(){GO.addressbook.contactDialog=new GO.addressbook.ContactDialog();GO.addressbook.companyDialog=new GO.addressbook.CompanyDialog()});GO.addressbook.searchSenderStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"search_sender",email:""},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});GO.addressbook.searchSender=function(b,a){GO.addressbook.searchSenderStore.baseParams.email=b;GO.addressbook.searchSenderStore.load({callback:function(){switch(GO.addressbook.searchSenderStore.getCount()){case 0:if(confirm(GO.addressbook.lang.confirmCreate)){GO.addressbook.contactDialog.show();var g=a.split(" ");var h={email:b,first_name:g[0]};if(g[2]){h.last_name=g[2];h.middle_name=g[1]}else{if(g[1]){h.last_name=g[1]}}var f=b.lastIndexOf(".");if(f){var c=b.substring(f+1,b.length).toUpperCase();if(GO.lang.countries[c]){h.country=c}}GO.addressbook.contactDialog.formPanel.form.setValues(h)}break;case 1:var d=GO.addressbook.searchSenderStore.getAt(0);GO.linkHandlers[2].call(this,d.get("id"));break;default:if(!GO.addressbook.searchSenderWin){var e=new GO.grid.SimpleSelectList({store:GO.addressbook.searchSenderStore});e.on("click",function(i,j){var k=i.store.data.items[j].id;e.clearSelections();GO.addressbook.searchSenderWin.hide();GO.linkHandlers[2].call(this,k)},this);GO.addressbook.searchSenderWin=new GO.Window({title:GO.addressbook.lang.strSelectContact,items:{autoScroll:true,items:e,cls:"go-form-panel"},layout:"fit",autoScroll:true,closeAction:"hide",closeable:true,height:400,width:400,buttons:[{text:GO.lang.cmdClose,handler:function(){GO.addressbook.searchSenderWin.hide()}}]})}GO.addressbook.searchSenderWin.show();break}},scope:this})};GO.moduleManager.addModule("addressbook",GO.addressbook.MainPanel,{title:GO.addressbook.lang.addressbook,iconCls:"go-tab-icon-addressbook"});GO.linkHandlers[2]=GO.mailFunctions.showContact=function(c){var a=new GO.addressbook.ContactReadPanel();var b=new GO.LinkViewWindow({title:GO.addressbook.lang.contact,items:a});a.load(c);b.show()};GO.linkHandlers[3]=function(c){var a=new GO.addressbook.CompanyReadPanel();var b=new GO.LinkViewWindow({title:GO.addressbook.lang.company,items:a});a.load(c);b.show()};GO.addressbook.SelectAddressbook=function(a){a=a||{};if(!a.hiddenName){a.hiddenName="addressbook_id"}if(!a.fieldLabel){a.fieldLabel=GO.addressbook.lang.addressbook}a.store=GO.addressbook.writableAddressbooksStore;GO.addressbook.SelectAddressbook.superclass.constructor.call(this,{displayField:"name",valueField:"id",triggerAction:"all",mode:"remote",editable:true,selectOnFocus:true,forceSelection:true,typeAhead:true,emptyText:GO.lang.strPleaseSelect,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.addressbook.SelectAddressbook,GO.form.ComboBox,{});