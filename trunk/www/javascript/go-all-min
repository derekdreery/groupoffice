Ext.Container.prototype.bufferResize=false;Ext.override(Ext.menu.Menu,{showAt:function(d,b,a){this.parentMenu=b;if(!this.el){this.render()}if(a!==false){this.fireEvent("beforeshow",this);d=this.el.adjustForConstraints(d)}this.el.setXY(d);var c=Ext.getBody().getHeight()-d[1];if(!this.el.origHeight){this.el.origHeight=this.el.getHeight()}if(this.el.origHeight>c){this.el.setHeight(c);this.el.applyStyles("overflow-y: auto;")}else{}this.el.show();this.hidden=false;this.focus();this.fireEvent("show",this)}});Ext.override(Ext.grid.GridView,{scrollOffset:20});Ext.apply(Ext.form.VTypes,{password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:GO.lang.passwordMatchError});Ext.Window.override({constrainHeader:true,animCollapse:false});Ext.MessageBox.buttonText.yes=GO.lang.cmdYes;Ext.MessageBox.buttonText.no=GO.lang.cmdNo;Ext.MessageBox.buttonText.ok=GO.lang.cmdOk;Ext.MessageBox.buttonText.cancel=GO.lang.cmdCancel;Ext.override(Ext.DatePicker,{startDay:parseInt(GO.settings.first_weekday)});Ext.override(Ext.Element,{printCSS:"",printStyle:false,printTitle:document.title,print:function(f){Ext.apply(this,f);var d=Ext.get(this.id).dom;var k=document.getElementById("printcontainer");var e=document.getElementById("printframe");var h='<HTML><HEAD>{0}<TITLE>{1}</TITLE></HEAD><BODY onload="{2}" style="background-color:white;">{3}</BODY></HTML>';var b="";var l;var j;if(e!=null){k.removeChild(e)}if(k!=null){d.removeChild(k)}for(var g=0;g<d.attributes.length;g++){if(Ext.isEmpty(d.attributes[g].value)||d.attributes[g].value.toLowerCase()!="null"){l=Ext.isEmpty(d.attributes[g].value)?'{0}="true" ':'{0}="{1}" ';if(this.printStyle?this.printStyle:d.attributes[g].name.toLowerCase()!="style"){b+=String.format(l,d.attributes[g].name,d.attributes[g].value)}}}for(var g=0;g<document.styleSheets.length;g++){this.printCSS+='<link rel="stylesheet" type="text/css" href="'+document.styleSheets[g].href+'"/>'}j=String.format(h,Ext.isEmpty(this.printCSS)?"#":this.printCSS,this.printTitle,Ext.isIE?"document.execCommand('print');":"window.print();",d.innerHTML);var a=window.open("about:blank");if(!a.opener){a.opener=self}a.document.write(j);a.document.close();a.focus()}});Ext.override(Ext.Component,{printEl:function(a){this.el.print(Ext.isEmpty(a)?this.initialConfig:a)},printBody:function(a){this.body.print(Ext.isEmpty(a)?this.initialConfig:a)}});Ext.decode=Ext.util.JSON.decode=function(json){try{return eval("("+json+")")}catch(e){GO.errorDialog.show(GO.lang.serverError,json)}};Date.prototype.getLastSunday=function(){var a=this.getDay();return this.add(Date.DAY,-a)};var deployJava={debug:null,myInterval:null,preInstallJREList:null,returnPage:null,brand:null,locale:null,installType:null,EAInstallEnabled:false,EarlyAccessURL:null,getJavaURL:"http://java.sun.com/webapps/getjava/BrowserRedirect?host=java.com",appleRedirectPage:"http://www.apple.com/support/downloads/",mimeType:"application/npruntime-scriptable-plugin;DeploymentToolkit",launchButtonPNG:"http://java.sun.com/products/jfc/tsc/articles/swing2d/webstart.png",getJREs:function(){var d=new Array();if(deployJava.isPluginInstalled()){var c=deployJava.getPlugin();for(var b=0;b<c.jvms.getLength();b++){d[b]=c.jvms.get(b).version}}else{var a=deployJava.getBrowser();if(a=="MSIE"){if(deployJava.testUsingActiveX("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingActiveX("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingActiveX("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingActiveX("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingActiveX("1.4.2")){d[0]="1.4.2"}else{if(deployJava.testForMSVM()){d[0]="1.1"}}}}}}}else{if(a=="Netscape Family"){if(deployJava.testUsingMimeTypes("1.8")){d[0]="1.8.0"}else{if(deployJava.testUsingMimeTypes("1.7")){d[0]="1.7.0"}else{if(deployJava.testUsingMimeTypes("1.6")){d[0]="1.6.0"}else{if(deployJava.testUsingMimeTypes("1.5")){d[0]="1.5.0"}else{if(deployJava.testUsingMimeTypes("1.4.2")){d[0]="1.4.2"}}}}}}else{if(a=="Safari"){if(deployJava.testUsingPluginsArray("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingPluginsArray("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingPluginsArray("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingPluginsArray("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingPluginsArray("1.4.2")){d[0]="1.4.2"}}}}}}}}}if(deployJava.debug){for(var b=0;b<d.length;++b){alert("We claim to have detected Java SE "+d[b])}}return d},installJRE:function(b){var a=false;if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installJRE(b)){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{return deployJava.installLatestJRE()}},installLatestJRE:function(){if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installLatestJRE()){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{var b=deployJava.getBrowser();var a=navigator.platform.toLowerCase();if((deployJava.EAInstallEnabled=="true")&&(a.indexOf("win")!=-1)&&(deployJava.EarlyAccessURL!=null)){deployJava.preInstallJREList=deployJava.getJREs();if(deployJava.returnPage!=null){deployJava.myInterval=setInterval("deployJava.poll()",3000)}location.href=deployJava.EarlyAccessURL;return false}else{if(b=="MSIE"){return deployJava.IEInstall()}else{if((b=="Netscape Family")&&(a.indexOf("win32")!=-1)){return deployJava.FFInstall()}else{location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")}}return false}}},runApplet:function(b,f,d){if(d=="undefined"||d==null){d="1.1"}var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(deployJava.returnPage==null){deployJava.returnPage=document.location}if(a!=null){var c=deployJava.getBrowser();if((c!="?")&&(c!="Safari")){if(deployJava.versionCheck(d+"+")){deployJava.writeAppletTag(b,f)}else{if(deployJava.installJRE(d+"+")){deployJava.refresh();location.href=document.location;deployJava.writeAppletTag(b,f)}}}else{deployJava.writeAppletTag(b,f)}}else{if(deployJava.debug){alert("Invalid minimumVersion argument to runApplet():"+d)}}},writeAppletTag:function(a,d){var b="<applet ";for(var c in a){b+=(" "+c+'="'+a[c]+'"')}b+=">";document.write(b);if(d!="undefined"&&d!=null){for(var e in d){b='<param name="'+e+'" value="'+d[e]+'">';document.write(b)}}document.write("</applet>")},versionCheck:function(h){var c=0;var f="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?(\\*|\\+)?$";var a=h.match(f);if(a!=null){var e=true;var b=new Array();for(var d=1;d<a.length;++d){if((typeof a[d]=="string")&&(a[d]!="")){b[c]=a[d];c++}}if(b[b.length-1]=="+"){e=false;b.length--}else{if(b[b.length-1]=="*"){b.length--}}var g=deployJava.getJREs();for(var d=0;d<g.length;++d){if(deployJava.compareVersionToPattern(g[d],b,e)){return true}}return false}else{alert("Invalid versionPattern passed to versionCheck: "+h);return false}},isWebStartInstalled:function(d){var c=deployJava.getBrowser();if((c=="?")||(c=="Safari")){return true}if(d=="undefined"||d==null){d="1.4.2"}var b=false;var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(a!=null){b=deployJava.versionCheck(d+"+")}else{if(deployJava.debug){alert("Invalid minimumVersion argument to isWebStartInstalled(): "+d)}b=deployJava.versionCheck("1.4.2+")}return b},createWebStartLaunchButton:function(c,b){if(deployJava.returnPage==null){deployJava.returnPage=c}var a="javascript:if (!deployJava.isWebStartInstalled(&quot;"+b+"&quot;)) {if (deployJava.installLatestJRE()) {if (deployJava.launch(&quot;"+c+"&quot;)) {}}} else {if (deployJava.launch(&quot;"+c+"&quot;)) {}}";document.write('<a href="'+a+'" onMouseOver="window.status=\'\'; return true;"><img src="'+deployJava.launchButtonPNG+'" border="0" /></a>')},launch:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().launch(a)}else{document.location=a;return true}},isPluginInstalled:function(){var a=deployJava.getPlugin();if(a&&a.jvms){return true}else{return false}},isAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().isAutoUpdateEnabled()}return false},setAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAutoUpdateEnabled()}return false},setInstallerType:function(a){deployJava.installType=a;if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setInstallerType(a)}return false},setAdditionalPackages:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAdditionalPackages(a)}return false},setEarlyAccess:function(a){deployJava.EAInstallEnabled=a},isPlugin2:function(){if(deployJava.isPluginInstalled()){try{return deployJava.getPlugin().isPlugin2()}catch(a){}}return false},getPlugin:function(){deployJava.refresh();var a=document.getElementById("deployJavaPlugin");return a},compareVersionToPattern:function(f,b,c){var g="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var h=f.match(g);if(h!=null){var e=0;var j=new Array();for(var d=1;d<h.length;++d){if((typeof h[d]=="string")&&(h[d]!="")){j[e]=h[d];e++}}var a=Math.min(j.length,b.length);if(c){for(var d=0;d<a;++d){if(j[d]!=b[d]){return false}}return true}else{for(var d=0;d<a;++d){if(j[d]<b[d]){return false}else{if(j[d]>b[d]){return true}}}return true}}else{return false}},getBrowser:function(){var a=navigator.userAgent.toLowerCase();if(deployJava.debug){alert("userAgent -> "+a)}if((navigator.vendor)&&(navigator.vendor.toLowerCase().indexOf("apple")!=-1)&&(a.indexOf("safari")!=-1)){if(deployJava.debug){alert('We claim to have detected "Safari".')}return"Safari"}else{if(a.indexOf("msie")!=-1){if(deployJava.debug){alert('We claim to have detected "IE".')}return"MSIE"}else{if((a.indexOf("mozilla")!=-1)||(a.indexOf("firefox")!=-1)){if(deployJava.debug){alert("We claim to have detected a Netscape family browser.")}return"Netscape Family"}else{if(deployJava.debug){alert("We claim to have failed to detect a browser.")}return"?"}}}},testUsingActiveX:function(a){var c="JavaWebStart.isInstalled."+a+".0";if(!ActiveXObject){if(deployJava.debug){alert("Browser claims to be IE, but no ActiveXObject object?")}return false}try{return(new ActiveXObject(c)!=null)}catch(b){return false}},testForMSVM:function(){var b="{08B0E5C0-4FCB-11CF-AAA5-00401C608500}";if(typeof oClientCaps!="undefined"){var a=oClientCaps.getComponentVersion(b,"ComponentID");if((a=="")||(a=="5,0,5000,0")){return false}else{return true}}else{return false}},testUsingMimeTypes:function(b){if(!navigator.mimeTypes){if(deployJava.debug){alert("Browser claims to be Netscape family, but no mimeTypes[] array?")}return false}for(var c=0;c<navigator.mimeTypes.length;++c){s=navigator.mimeTypes[c].type;var a=s.match(/^application\/x-java-applet\x3Bversion=(1\.8|1\.7|1\.6|1\.5|1\.4\.2)$/);if(a!=null){if(deployJava.compareVersions(a[1],b)){return true}}}return false},testUsingPluginsArray:function(a){if((!navigator.plugins)||(!navigator.plugins.length)){if(deployJava.debug){alert("Browser claims to be Safari, but no plugins[] array?")}return false}for(var b=0;b<navigator.plugins.length;++b){s=navigator.plugins[b].description;if(s.search(/^Java Switchable Plug-in/)!=-1){return true}m=s.match(/^Java (1\.4\.2|1\.5|1\.6|1\.7).* Plug-in/);if(m!=null){if(deployJava.compareVersions(m[1],a)){return true}}}return false},IEInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},done:function(b,a){},FFInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},compareVersions:function(f,g){var d=f.split(".");var c=g.split(".");for(var e=0;e<d.length;++e){d[e]=Number(d[e])}for(var e=0;e<c.length;++e){c[e]=Number(c[e])}if(d.length==2){d[2]=0}if(d[0]>c[0]){return true}if(d[0]<c[0]){return false}if(d[1]>c[1]){return true}if(d[1]<c[1]){return false}if(d[2]>c[2]){return true}if(d[2]<c[2]){return false}return true},enableAlerts:function(){deployJava.debug=true},poll:function(){deployJava.refresh();var a=deployJava.getJREs();if((deployJava.preInstallJREList.length==0)&&(a.length!=0)){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}if((deployJava.preInstallJREList.length!=0)&&(a.length!=0)&&(deployJava.preInstallJREList[0]!=a[0])){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}},writePluginTag:function(){var a=deployJava.getBrowser();if(a=="MSIE"){document.write('<object classid="clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA" id="deployJavaPlugin" width="0" height="0"></object>')}else{if(a=="Netscape Family"){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},refresh:function(){navigator.plugins.refresh(false);var a=deployJava.getBrowser();if(a=="Netscape Family"){var c=document.getElementById("deployJavaPlugin");if(c==null){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},do_initialize:function(){deployJava.writePluginTag();if(deployJava.locale==null){var b=null;if(b==null){try{b=navigator.userLanguage}catch(a){}}if(b==null){try{b=navigator.systemLanguage}catch(a){}}if(b==null){try{b=navigator.language}catch(a){}}if(b!=null){b.replace("-","_");deployJava.locale=b}}}};deployJava.do_initialize();GO.MainLayout=function(){this.addEvents({ready:true,render:true});this.resumeEvents()};Ext.extend(GO.MainLayout,Ext.util.Observable,{ready:false,fullscreenPopup:false,state:false,stateSaveScheduled:false,onReady:function(b,a){if(!this.ready){this.on("ready",b,a)}else{b.call(a,this)}},launchFullscreen:function(a){this.fullscreenPopup=GO.util.popup({url:a,target:"groupoffice"})},login:function(){this.fireReady();this.createLoginCallback();GO.loginDialog.show();this.removeLoadMask()},saveState:function(){this.stateToSave=this.getOpenModules();if(!this.stateSaveScheduled){this.stateSaveScheduled=true;this.sendSaveRequest.defer(2000,this)}},sendSaveRequest:function(){var a=function(){this.stateSaveScheduled=false};Ext.state.Manager.getProvider().set("open-modules",Ext.encode(this.stateToSave),a,this)},logout:function(a){if(!a||Ext.Ajax.isLoading()){this.logout.defer(200,this,[true])}else{document.location=GO.settings.config.host+"index.php?task=logout"}},createLoginCallback:function(){GO.loginDialog.addCallback(function(){var a=GO.afterLoginUrl?GO.afterLoginUrl:GO.settings.config.host;if(GO.loginDialog.fullscreenField.getValue()&&window.name!="groupoffice"){this.launchFullscreen(a);GO.loginDialog.hideDialog=false;GO.loginDialog.on("callbackshandled",this.createLoginCallback,this)}else{document.location.href=a}},this)},fireReady:function(){this.fireEvent("ready",this);this.ready=true},getOpenModules:function(){var a=[];this.tabPanel.items.each(function(b){var c=this.tabPanel.getTabEl(b);if(c.style.display!="none"){a.push(b.moduleName)}},this);return a},createTabPanel:function(a){this.tabPanel=new Ext.TabPanel({region:"center",titlebar:false,border:false,activeTab:"go-module-panel-"+GO.settings.start_module,tabPosition:"top",items:a,layoutOnTabChange:true});this.tabPanel.on("contextmenu",function(f,b,d){var g=this.getOpenModules();if(g.length>1){f.hideTabStripItem(b);b.hide();if(b==f.activeTab){var c=f.stack.next();if(c){f.setActiveTab(c)}else{if(f.items.getCount()>0){f.setActiveTab(0)}else{f.activeTab=null}}}this.saveState()}},this)},getModulePanel:function(a){var b="go-module-panel-"+a;if(this.tabPanel.items.map[b]){return this.tabPanel.items.map[b]}else{return false}},beforeRender:function(){},init:function(){this.fireReady();Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{dismissDelay:0,maxWidth:500});var k=GO.moduleManager.getAllPanelConfigs();var h=[];this.startMenu=new Ext.menu.Menu({id:"startMenu"});if(k.length==0){h=new Ext.Panel({id:"go-module-panel-"+GO.settings.start_module,region:"center",border:false,cls:"go-form-panel",title:"No modules",html:"<h1>No modules available</h1>You have a valid Group-Office account but you don't have access to any of the modules. Please contact the administrator if you feel this is an error."})}var j=[];var d;this.state=Ext.state.Manager.get("open-modules");for(var c=0;c<k.length;c++){if(this.state&&this.state.indexOf(k[c].moduleName)>-1){h.push(GO.moduleManager.getPanel(k[c].moduleName))}d={id:"go-start-menu-"+k[c].moduleName,moduleName:k[c].moduleName,text:k[c].title,iconCls:"go-menu-icon-"+k[c].moduleName,handler:this.openModule,scope:this};if(!k[c].admin){if(!this.state){h.push(GO.moduleManager.getPanel(k[c].moduleName))}this.startMenu.add(d)}else{j.push(d)}}if(j.length){this.startMenu.add(new Ext.menu.TextItem({id:"go-start-menu-admin-menu",text:'<div class="menu-title">'+GO.lang.adminMenu+"</div>"}));for(var c=0;c<j.length;c++){this.startMenu.add(j[c])}}this.createTabPanel(h);this.beforeRender();var f=new Ext.Panel({region:"north",contentEl:"mainNorthPanel",cls:"go-top-panel",height:28,titlebar:false,border:false});var g=new Ext.Viewport({layout:"border",border:false,items:[f,this.tabPanel]});this.startMenuLink=Ext.get("start-menu-link");this.startMenuLink.on("click",function(){var o=this.startMenuLink.getX();var p=f.el.getY()+f.el.getHeight();this.startMenu.showAt([o,p])},this);var a=Ext.get("configuration-link");if(a){a.on("click",function(){if(!this.personalSettingsDialog){this.personalSettingsDialog=new GO.PersonalSettingsDialog()}this.personalSettingsDialog.show()},this)}var e=Ext.get("help-link");if(e){var n=new Ext.menu.Menu({id:"helpMenu",items:[{iconCls:"btn-help",text:GO.lang.strHelpContents,handler:function(){var o=window.open("http://www.group-office.com/wiki/");o.focus()},scope:this},{iconCls:"btn-forum",text:GO.lang.strCommunityForum,handler:function(){var o=window.open("http://www.group-office.com/forum/");o.focus()},scope:this},"-",{iconCls:"btn-support",text:GO.lang.contactSupportDesk,handler:function(){GO.supportLink=GO.settings.config.webmaster_email;if(Ext.form.VTypes.email(GO.supportLink)){if(GO.email&&GO.settings.modules.email.read_permission){GO.email.showComposer({values:{to:GO.supportLink}})}else{document.location="mailto:"+GO.supportLink}}else{window.open(GO.supportLink)}},scope:this},{iconCls:"btn-report-bug",text:GO.lang.strReportBug,handler:function(){var o=window.open("https://sourceforge.net/tracker2/?func=add&group_id=76359&atid=547651");o.focus()},scope:this},"-",{iconCls:"btn-info",text:GO.lang.strAbout,handler:function(){if(!this.aboutDialog){this.aboutDialog=new GO.dialog.AboutDialog()}this.aboutDialog.show()},scope:this}]});e.on("click",function(){var o=e.getX();var p=f.el.getY()+f.el.getHeight();n.showAt([o,p])},this)}var b=this.tabPanel.getLayout().activeItem;if(!b){this.tabPanel.setActiveTab(0)}GO.checker=new GO.Checker();GO.checker.init.defer(2000,GO.checker);GO.checker.on("alert",function(o){if(o.notification_area){Ext.get("notification-area").update(o.notification_area)}},this);var l=new Ext.form.TextField({name:"search_query",enableKeyEvents:true,emptyText:GO.lang.strSearch+"...",listeners:{scope:this,keypress:function(p,o){if(o.getKey()==Ext.EventObject.ENTER){this.addSearchPanel(p.getValue())}},blur:function(o){o.reset()}},renderTo:"search_query"});Ext.QuickTips.register({text:GO.lang.rightClickToClose,title:GO.lang.closeApps,target:this.startMenuLink});this.fireEvent("render");this.removeLoadMask()},openModule:function(c,d){var b="go-module-panel-"+c.moduleName;var a;if(!this.tabPanel.items.map[b]){a=GO.moduleManager.getPanel(c.moduleName);a.id=b;this.tabPanel.add(a)}else{a=this.tabPanel.items.map[b];this.tabPanel.unhideTabStripItem(a)}a.show();this.saveState()},removeLoadMask:function(){var b=Ext.get("loading");var a=Ext.get("loading-mask");a.setOpacity(0.8);a.shift({xy:b.getXY(),width:b.getWidth(),height:b.getHeight(),remove:true,duration:1,opacity:0.3,easing:"bounceOut",callback:function(){b.fadeOut({duration:0.2,remove:true})}})},addSearchPanel:function(b){var a=new GO.grid.SearchPanel({query:b});this.tabPanel.add(a);a.show()},createBox:function(a,b){return['<div class="msg">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',a,"</h3>",b,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")},msg:function(d,c){if(!this.msgCt){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}this.msgCt.alignTo(this.tabPanel.el,"tr-tr");var b=String.format.apply(String,Array.prototype.slice.call(arguments,1));var a=Ext.DomHelper.append(this.msgCt,{html:this.createBox(d,b)},true);a.slideIn("t").pause(3).ghost("t",{remove:true})}});GO.mainLayout=new GO.MainLayout();GO.layout.ColumnFitLayout=Ext.extend(Ext.layout.ColumnLayout,{onLayout:function(e,j){GO.layout.ColumnFitLayout.superclass.onLayout.apply(this,arguments);var g=e.items.items,a=g.length,k,d;var b=Ext.isIE&&j.dom!=Ext.getBody().dom?j.getStyleSize():j.getViewSize();var f=b.height-j.getPadding("tb");for(d=0;d<a;d++){k=g[d];k.setHeight(f+(k.footer?k.footer.getHeight():0))}}});Ext.Container.LAYOUTS.columnfit=GO.layout.ColumnFitLayout;GO.ExportQueryDialog=Ext.extend(Ext.Window,{initComponent:function(){Ext.apply(this,{title:GO.lang.cmdExport,items:this.formPanel=new Ext.FormPanel({items:this.formPanelItems,bodyStyle:"padding:5px"}),autoHeight:true,closeAction:"hide",closeable:true,height:400,width:400,buttons:[{text:GO.lang.strEmail,handler:function(){this.hide();this.beforeRequest();GO.email.showComposer({loadUrl:BaseHref+"json.php",loadParams:this.loadParams})},scope:this},{text:GO.lang.download,handler:function(){this.beforeRequest();var b="";for(var a in this.loadParams){if(b==""){b=BaseHref+"export_query.php?"}else{b+="&"}b+=a+"="+encodeURIComponent(this.loadParams[a])}document.location=b;this.hide()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ExportQueryDialog.superclass.initComponent.call(this)},loadParams:{},downloadUrl:"",formPanelItems:[{autoHeight:true,xtype:"radiogroup",fieldLabel:GO.lang.strType,items:[{boxLabel:"CSV",name:"type",inputValue:"CSV",checked:true},{boxLabel:"PDF",name:"type",inputValue:"PDF"}]},{xtype:"checkbox",name:"export_hidden",hideLabel:true,boxLabel:GO.lang.exportHiddenColumns}],show:function(a){GO.ExportQueryDialog.superclass.show.call(this);var a=a||{};Ext.apply(this,a)},beforeRequest:function(){var d=[];var f=this.formPanel.form.findField("export_hidden").getValue();if(this.colModel){for(var b=0;b<this.colModel.getColumnCount();b++){var e=this.colModel.config[b];if(f||!e.hidden){d.push(e.dataIndex+":"+e.header)}}}if(GO.util.empty(this.title)){this.title=this.query}this.loadParams={task:"email_export_query",query:this.query,columns:d.join(","),title:this.title};if(this.subtitle){this.loadParams.subtitle=this.subtitle}if(this.text){this.loadParams.text=this.text}var a=this.formPanel.form.getValues();Ext.apply(this.loadParams,a)}});GO.WeekPicker=function(a){a=a||{};a.cls="go-weekpicker";a.items=[{iconCls:"btn-left-arrow",text:GO.lang.cmdPrevious,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,-7))},scope:this},this.periodInfoPanel=new Ext.Panel({plain:true,border:true,cls:"cal-period"}),{iconCls:"btn-right-arrow",text:GO.lang.cmdNext,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,7))},scope:this},{text:GO.lang.today,handler:function(){this.setDate()},scope:this}];GO.WeekPicker.superclass.constructor.call(this,a);this.addEvents({change:true})};Ext.extend(GO.WeekPicker,Ext.Toolbar,{sunday:false,setDate:function(c,d){if(!c){var b=new Date();c=b.getLastSunday()}if(this.fireEvent("beforechange",this,c,this.sunday)!==false){this.sunday=c;var a=this.sunday.add(Date.DAY,1);this.goToLink.update(GO.lang.strWeek+" "+a.format("W")+" ("+a.format(GO.settings.date_format)+")");if(!d){this.fireEvent("change",this,this.sunday)}}},getDate:function(){return this.sunday},afterRender:function(){GO.WeekPicker.superclass.afterRender.call(this);this.goToLink=Ext.DomHelper.append(this.periodInfoPanel.body,{tag:"a",href:"#",html:""},true);this.goToLink.on("click",function(){if(!this.gotoWeekDialog){this.gotoWeekDialog=new GO.GoToWeekDialog()}this.gotoWeekDialog.show(this)},this);this.setDate()}});GO.GoToWeekDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.formPanel.items.items[0].focus()};b.layout="fit";b.title=GO.projects.lang.goToWeek;b.modal=false;b.width=335;b.height=135;b.resizable=false;b.closeAction="hide";b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.GoToWeekDialog.superclass.constructor.call(this,b)};Ext.extend(GO.GoToWeekDialog,Ext.Window,{show:function(b){this.wp=b;if(!this.rendered){this.render(Ext.getBody())}var d=this.wp.periodInfoPanel.getPosition();this.setPosition(d[0],d[1]+20);this.formPanel.form.reset();var a=new Date(this.wp.sunday);var c=a.format("Y");this.year.setValue(c);this.setYear(c);GO.GoToWeekDialog.superclass.show.call(this)},buildForm:function(){this.formPanel=new Ext.form.FormPanel({cls:"go-form-panel",layout:"form",waitMsgTarget:true,labelWidth:50,border:false,anchor:"95% 95%",items:[this.year=new Ext.form.TextField({name:"year",fieldLabel:GO.lang.strYear,allowBlank:false,anchor:"95%",selectOnFocus:true}),this.selectWeek=new GO.form.ComboBox({fieldLabel:GO.lang.strWeek,hiddenName:"date",emptyText:GO.lang.selectWeek,store:new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"get_weeks"},root:"results",id:"value",totalProperty:"total",fields:["value","text"],remoteSort:true}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true,allowBlank:false,anchor:"95%"})]});this.year.on("change",function(){this.setYear(this.year.getValue())},this);this.selectWeek.on("select",function(c,b){var a=new Date(this.selectWeek.getValue()*1000);this.wp.setDate(a);this.hide()},this)},setYear:function(a){this.selectWeek.store.baseParams.year=a;this.selectWeek.store.load()}});GO.users.TimeZones=[["Africa/Abidjan"],["Africa/Accra"],["Africa/Addis_Ababa"],["Africa/Algiers"],["Africa/Asmara"],["Africa/Asmera"],["Africa/Bamako"],["Africa/Bangui"],["Africa/Banjul"],["Africa/Bissau"],["Africa/Blantyre"],["Africa/Brazzaville"],["Africa/Bujumbura"],["Africa/Cairo"],["Africa/Casablanca"],["Africa/Ceuta"],["Africa/Conakry"],["Africa/Dakar"],["Africa/Dar_es_Salaam"],["Africa/Djibouti"],["Africa/Douala"],["Africa/El_Aaiun"],["Africa/Freetown"],["Africa/Gaborone"],["Africa/Harare"],["Africa/Johannesburg"],["Africa/Kampala"],["Africa/Khartoum"],["Africa/Kigali"],["Africa/Kinshasa"],["Africa/Lagos"],["Africa/Libreville"],["Africa/Lome"],["Africa/Luanda"],["Africa/Lubumbashi"],["Africa/Lusaka"],["Africa/Malabo"],["Africa/Maputo"],["Africa/Maseru"],["Africa/Mbabane"],["Africa/Mogadishu"],["Africa/Monrovia"],["Africa/Nairobi"],["Africa/Ndjamena"],["Africa/Niamey"],["Africa/Nouakchott"],["Africa/Ouagadougou"],["Africa/Porto-Novo"],["Africa/Sao_Tome"],["Africa/Timbuktu"],["Africa/Tripoli"],["Africa/Tunis"],["Africa/Windhoek"],["America/Adak"],["America/Anchorage"],["America/Anguilla"],["America/Antigua"],["America/Araguaina"],["America/Argentina/Buenos_Aires"],["America/Argentina/Catamarca"],["America/Argentina/ComodRivadavia"],["America/Argentina/Cordoba"],["America/Argentina/Jujuy"],["America/Argentina/La_Rioja"],["America/Argentina/Mendoza"],["America/Argentina/Rio_Gallegos"],["America/Argentina/San_Juan"],["America/Argentina/Tucuman"],["America/Argentina/Ushuaia"],["America/Aruba"],["America/Asuncion"],["America/Atikokan"],["America/Atka"],["America/Bahia"],["America/Barbados"],["America/Belem"],["America/Belize"],["America/Blanc-Sablon"],["America/Boa_Vista"],["America/Bogota"],["America/Boise"],["America/Buenos_Aires"],["America/Cambridge_Bay"],["America/Campo_Grande"],["America/Cancun"],["America/Caracas"],["America/Catamarca"],["America/Cayenne"],["America/Cayman"],["America/Chicago"],["America/Chihuahua"],["America/Coral_Harbour"],["America/Cordoba"],["America/Costa_Rica"],["America/Cuiaba"],["America/Curacao"],["America/Danmarkshavn"],["America/Dawson"],["America/Dawson_Creek"],["America/Denver"],["America/Detroit"],["America/Dominica"],["America/Edmonton"],["America/Eirunepe"],["America/El_Salvador"],["America/Ensenada"],["America/Fort_Wayne"],["America/Fortaleza"],["America/Glace_Bay"],["America/Godthab"],["America/Goose_Bay"],["America/Grand_Turk"],["America/Grenada"],["America/Guadeloupe"],["America/Guatemala"],["America/Guayaquil"],["America/Guyana"],["America/Halifax"],["America/Havana"],["America/Hermosillo"],["America/Indiana/Indianapolis"],["America/Indiana/Knox"],["America/Indiana/Marengo"],["America/Indiana/Petersburg"],["America/Indiana/Vevay"],["America/Indiana/Vincennes"],["America/Indiana/Winamac"],["America/Indianapolis"],["America/Inuvik"],["America/Iqaluit"],["America/Jamaica"],["America/Jujuy"],["America/Juneau"],["America/Kentucky/Louisville"],["America/Kentucky/Monticello"],["America/Knox_IN"],["America/La_Paz"],["America/Lima"],["America/Los_Angeles"],["America/Louisville"],["America/Maceio"],["America/Managua"],["America/Manaus"],["America/Martinique"],["America/Mazatlan"],["America/Mendoza"],["America/Menominee"],["America/Merida"],["America/Mexico_City"],["America/Miquelon"],["America/Moncton"],["America/Monterrey"],["America/Montevideo"],["America/Montreal"],["America/Montserrat"],["America/Nassau"],["America/New_York"],["America/Nipigon"],["America/Nome"],["America/Noronha"],["America/North_Dakota/Center"],["America/North_Dakota/New_Salem"],["America/Panama"],["America/Pangnirtung"],["America/Paramaribo"],["America/Phoenix"],["America/Port-au-Prince"],["America/Port_of_Spain"],["America/Porto_Acre"],["America/Porto_Velho"],["America/Puerto_Rico"],["America/Rainy_River"],["America/Rankin_Inlet"],["America/Recife"],["America/Regina"],["America/Resolute"],["America/Rio_Branco"],["America/Rosario"],["America/Santiago"],["America/Santo_Domingo"],["America/Sao_Paulo"],["America/Scoresbysund"],["America/Shiprock"],["America/St_Johns"],["America/St_Kitts"],["America/St_Lucia"],["America/St_Thomas"],["America/St_Vincent"],["America/Swift_Current"],["America/Tegucigalpa"],["America/Thule"],["America/Thunder_Bay"],["America/Tijuana"],["America/Toronto"],["America/Tortola"],["America/Vancouver"],["America/Virgin"],["America/Whitehorse"],["America/Winnipeg"],["America/Yakutat"],["America/Yellowknife"],["Antarctica/Casey"],["Antarctica/Davis"],["Antarctica/DumontDUrville"],["Antarctica/Mawson"],["Antarctica/McMurdo"],["Antarctica/Palmer"],["Antarctica/Rothera"],["Antarctica/South_Pole"],["Antarctica/Syowa"],["Antarctica/Vostok"],["Arctic/Longyearbyen"],["Asia/Aden"],["Asia/Almaty"],["Asia/Amman"],["Asia/Anadyr"],["Asia/Aqtau"],["Asia/Aqtobe"],["Asia/Ashgabat"],["Asia/Ashkhabad"],["Asia/Baghdad"],["Asia/Bahrain"],["Asia/Baku"],["Asia/Bangkok"],["Asia/Beirut"],["Asia/Bishkek"],["Asia/Brunei"],["Asia/Calcutta"],["Asia/Choibalsan"],["Asia/Chongqing"],["Asia/Chungking"],["Asia/Colombo"],["Asia/Dacca"],["Asia/Damascus"],["Asia/Dhaka"],["Asia/Dili"],["Asia/Dubai"],["Asia/Dushanbe"],["Asia/Gaza"],["Asia/Harbin"],["Asia/Hong_Kong"],["Asia/Hovd"],["Asia/Irkutsk"],["Asia/Istanbul"],["Asia/Jakarta"],["Asia/Jayapura"],["Asia/Jerusalem"],["Asia/Kabul"],["Asia/Kamchatka"],["Asia/Karachi"],["Asia/Kashgar"],["Asia/Katmandu"],["Asia/Krasnoyarsk"],["Asia/Kuala_Lumpur"],["Asia/Kuching"],["Asia/Kuwait"],["Asia/Macao"],["Asia/Macau"],["Asia/Magadan"],["Asia/Makassar"],["Asia/Manila"],["Asia/Muscat"],["Asia/Nicosia"],["Asia/Novosibirsk"],["Asia/Omsk"],["Asia/Oral"],["Asia/Phnom_Penh"],["Asia/Pontianak"],["Asia/Pyongyang"],["Asia/Qatar"],["Asia/Qyzylorda"],["Asia/Rangoon"],["Asia/Riyadh"],["Asia/Saigon"],["Asia/Sakhalin"],["Asia/Samarkand"],["Asia/Seoul"],["Asia/Shanghai"],["Asia/Singapore"],["Asia/Taipei"],["Asia/Tashkent"],["Asia/Tbilisi"],["Asia/Tehran"],["Asia/Tel_Aviv"],["Asia/Thimbu"],["Asia/Thimphu"],["Asia/Tokyo"],["Asia/Ujung_Pandang"],["Asia/Ulaanbaatar"],["Asia/Ulan_Bator"],["Asia/Urumqi"],["Asia/Vientiane"],["Asia/Vladivostok"],["Asia/Yakutsk"],["Asia/Yekaterinburg"],["Asia/Yerevan"],["Atlantic/Azores"],["Atlantic/Bermuda"],["Atlantic/Canary"],["Atlantic/Cape_Verde"],["Atlantic/Faeroe"],["Atlantic/Faroe"],["Atlantic/Jan_Mayen"],["Atlantic/Madeira"],["Atlantic/Reykjavik"],["Atlantic/South_Georgia"],["Atlantic/St_Helena"],["Atlantic/Stanley"],["Australia/ACT"],["Australia/Adelaide"],["Australia/Brisbane"],["Australia/Broken_Hill"],["Australia/Canberra"],["Australia/Currie"],["Australia/Darwin"],["Australia/Eucla"],["Australia/Hobart"],["Australia/LHI"],["Australia/Lindeman"],["Australia/Lord_Howe"],["Australia/Melbourne"],["Australia/North"],["Australia/NSW"],["Australia/Perth"],["Australia/Queensland"],["Australia/South"],["Australia/Sydney"],["Australia/Tasmania"],["Australia/Victoria"],["Australia/West"],["Australia/Yancowinna"],["Brazil/Acre"],["Brazil/DeNoronha"],["Brazil/East"],["Brazil/West"],["Canada/Atlantic"],["Canada/Central"],["Canada/East-Saskatchewan"],["Canada/Eastern"],["Canada/Mountain"],["Canada/Newfoundland"],["Canada/Pacific"],["Canada/Saskatchewan"],["Canada/Yukon"],["CET"],["Chile/Continental"],["Chile/EasterIsland"],["CST6CDT"],["Cuba"],["EET"],["Egypt"],["Eire"],["EST"],["EST5EDT"],["Etc/GMT"],["Etc/GMT0"],["Etc/Greenwich"],["Etc/UCT"],["Etc/Universal"],["Etc/UTC"],["Etc/Zulu"],["Europe/Amsterdam"],["Europe/Andorra"],["Europe/Athens"],["Europe/Belfast"],["Europe/Belgrade"],["Europe/Berlin"],["Europe/Bratislava"],["Europe/Brussels"],["Europe/Bucharest"],["Europe/Budapest"],["Europe/Chisinau"],["Europe/Copenhagen"],["Europe/Dublin"],["Europe/Gibraltar"],["Europe/Guernsey"],["Europe/Helsinki"],["Europe/Isle_of_Man"],["Europe/Istanbul"],["Europe/Jersey"],["Europe/Kaliningrad"],["Europe/Kiev"],["Europe/Lisbon"],["Europe/Ljubljana"],["Europe/London"],["Europe/Luxembourg"],["Europe/Madrid"],["Europe/Malta"],["Europe/Mariehamn"],["Europe/Minsk"],["Europe/Monaco"],["Europe/Moscow"],["Europe/Nicosia"],["Europe/Oslo"],["Europe/Paris"],["Europe/Podgorica"],["Europe/Prague"],["Europe/Riga"],["Europe/Rome"],["Europe/Samara"],["Europe/San_Marino"],["Europe/Sarajevo"],["Europe/Simferopol"],["Europe/Skopje"],["Europe/Sofia"],["Europe/Stockholm"],["Europe/Tallinn"],["Europe/Tirane"],["Europe/Tiraspol"],["Europe/Uzhgorod"],["Europe/Vaduz"],["Europe/Vatican"],["Europe/Vienna"],["Europe/Vilnius"],["Europe/Volgograd"],["Europe/Warsaw"],["Europe/Zagreb"],["Europe/Zaporozhye"],["Europe/Zurich"],["Factory"],["GB"],["GB-Eire"],["GMT+0"],["GMT-0"],["GMT0"],["Greenwich"],["Hongkong"],["HST"],["Iceland"],["Indian/Antananarivo"],["Indian/Chagos"],["Indian/Christmas"],["Indian/Cocos"],["Indian/Comoro"],["Indian/Kerguelen"],["Indian/Mahe"],["Indian/Maldives"],["Indian/Mauritius"],["Indian/Mayotte"],["Indian/Reunion"],["Iran"],["Israel"],["Jamaica"],["Japan"],["Kwajalein"],["Libya"],["MET"],["Mexico/BajaNorte"],["Mexico/BajaSur"],["Mexico/General"],["MST"],["MST7MDT"],["Navajo"],["NZ"],["NZ-CHAT"],["Pacific/Apia"],["Pacific/Auckland"],["Pacific/Chatham"],["Pacific/Easter"],["Pacific/Efate"],["Pacific/Enderbury"],["Pacific/Fakaofo"],["Pacific/Fiji"],["Pacific/Funafuti"],["Pacific/Galapagos"],["Pacific/Gambier"],["Pacific/Guadalcanal"],["Pacific/Guam"],["Pacific/Honolulu"],["Pacific/Johnston"],["Pacific/Kiritimati"],["Pacific/Kosrae"],["Pacific/Kwajalein"],["Pacific/Majuro"],["Pacific/Marquesas"],["Pacific/Midway"],["Pacific/Nauru"],["Pacific/Niue"],["Pacific/Norfolk"],["Pacific/Noumea"],["Pacific/Pago_Pago"],["Pacific/Palau"],["Pacific/Pitcairn"],["Pacific/Ponape"],["Pacific/Port_Moresby"],["Pacific/Rarotonga"],["Pacific/Saipan"],["Pacific/Samoa"],["Pacific/Tahiti"],["Pacific/Tarawa"],["Pacific/Tongatapu"],["Pacific/Truk"],["Pacific/Wake"],["Pacific/Wallis"],["Pacific/Yap"],["Poland"],["Portugal"],["PRC"],["PST8PDT"],["ROC"],["ROK"],["Singapore"],["Turkey"],["UCT"],["Universal"],["US/Alaska"],["US/Aleutian"],["US/Arizona"],["US/Central"],["US/East-Indiana"],["US/Eastern"],["US/Hawaii"],["US/Indiana-Starke"],["US/Michigan"],["US/Mountain"],["US/Pacific"],["US/Pacific-New"],["US/Samoa"],["W-SU"],["WET"],["Zulu"]];GO.PersonalSettingsDialog=function(a){if(!a){a={}}this.buildForm();a.layout="fit";a.modal=false;a.resizable=true;a.maxizable=true;a.width=900;a.height=450;a.closeAction="hide";a.title=GO.lang.settings;a.items=this.formPanel;a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.PersonalSettingsDialog.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.PersonalSettingsDialog,Ext.Window,{reload:false,show:function(){this.reload=false;if(!this.rendered){this.render(Ext.getBody());this.tabPanel.items.items[0].languageCombo.on("change",function(){this.reload=true},this);if(this.tabPanel.items.items[1].themeCombo){this.tabPanel.items.items[1].themeCombo.on("change",function(){this.reload=true},this)}}this.formPanel.form.baseParams.user_id=GO.settings.user_id;this.user_id=GO.settings.user_id;if(!this.loaded){this.formPanel.load({url:BaseHref+"json.php",success:function(d,e){this.loaded=true;GO.PersonalSettingsDialog.superclass.show.call(this);for(var b=0;b<this.tabPanel.items.getCount();b++){var a=this.tabPanel.items.itemAt(b);if(a.onLoadSettings){var c=a.onLoadSettings.createDelegate(a,[e]);c.call()}}},failure:function(a,b){Ext.Msg.alert(GO.lang.strError,b.result.feedback)},scope:this})}else{GO.PersonalSettingsDialog.superclass.show.call(this)}},setWritePermission:function(a){this.buttons[0].setDisabled(!a);this.buttons[1].setDisabled(!a);this.linksPanel.setWritePermission(a)},submitForm:function(d){for(var c=0;c<this.tabPanel.items.getCount();c++){var b=this.tabPanel.items.itemAt(c);if(b.onBeforeSaveSettings){var e=b.onBeforeSaveSettings.createDelegate(b,[this]);var a=e.call();if(!a){this.tabPanel.setActiveTab(b);return false}}}this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_settings"},waitMsg:GO.lang.waitMsgSave,success:function(j,k){this.fireEvent("save",this);for(var g=0;g<this.tabPanel.items.getCount();g++){var f=this.tabPanel.items.itemAt(g);if(f.onSaveSettings){var h=f.onSaveSettings.createDelegate(f,[k]);h.call()}}if(this.reload){document.location=GO.settings.config.host}else{if(d){this.hide()}}},failure:function(f,g){if(g.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,g.result.feedback)}},scope:this})},buildForm:function(){this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,anchor:"100% 100%",border:false,items:GO.moduleManager.getAllSettingsPanels()});this.formPanel=new Ext.form.FormPanel({items:this.tabPanel,baseParams:{task:"settings"},waitMsgTarget:true,border:false})}});GO.users.RegionalSettingsPanel=function(d){if(!d){d={}}this.autoScroll=true;var e=new Ext.data.SimpleStore({fields:["id","date_format"],data:[["dmY",GO.users.lang.dmy],["mdY",GO.users.lang.mdy],["Ymd",GO.users.lang.jmd]]});var f=new Ext.data.SimpleStore({fields:["id","date_separator"],data:[["-","-"],[".","."],["/","/"]]});var b=new Ext.data.SimpleStore({fields:["id","time_format"],data:[["G:i",GO.users.lang.fullhourformat],["g:i a",GO.users.lang.halfhourformat]]});var c=new Ext.data.SimpleStore({fields:["id","first_weekday"],data:[["0",GO.users.lang.sunday],["1",GO.users.lang.monday]]});var a=GO.settings.date_format.substring(0,1)+GO.settings.date_format.substring(2,3)+GO.settings.date_format.substring(4,5);d.border=false;d.hideLabel=true;d.title=GO.users.lang.regionalSettings;d.layout="column";d.defaults={columnWidth:0.5,cls:"go-form-panel",border:false};d.labelWidth=190;d.items=[{columnWidth:1,items:[{border:false,layout:"form",autoHeight:true,defaults:{anchor:"100%"},items:[this.languageCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelLanguage,name:"language_id",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),displayField:"language",valueField:"id",hiddenName:"language",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.language}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTimezone,name:"timezone",store:new Ext.data.SimpleStore({fields:["timezone"],data:GO.users.TimeZones}),displayField:"timezone",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:GO.settings.timezone}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateFormat,name:"date_format",store:e,displayField:"date_format",value:a,valueField:"id",hiddenName:"date_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateSeperator,name:"date_separator_name",store:f,displayField:"date_separator",value:GO.settings.date_separator,valueField:"id",hiddenName:"date_separator",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.timeFormat,name:"time_format_name",store:b,displayField:"time_format",valueField:"id",hiddenName:"time_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,value:GO.settings.time_format,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelFirstWeekday,name:"first_weekday_name",store:c,displayField:"first_weekday",valueField:"id",hiddenName:"first_weekday",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.first_weekday})]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.numberFormat,items:[{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelThousandSeperator,name:"thousands_separator",value:GO.settings.thousands_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelDecimalSeperator,name:"decimal_separator",value:GO.settings.decimal_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelCurrency,name:"currency",value:GO.settings.currency}]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.importExport,items:[{xtype:"textfield",fieldLabel:GO.users.lang.listSeparator,name:"list_separator",value:GO.settings.list_separator},{xtype:"textfield",fieldLabel:GO.users.lang.textSeparator,name:"text_separator",value:GO.settings.text_separator}]}]}];GO.users.RegionalSettingsPanel.superclass.constructor.call(this,d)};Ext.extend(GO.users.RegionalSettingsPanel,Ext.Panel,{});GO.users.LookAndFeelPanel=function(b){if(!b){b={}}this.autoScroll=true;b.border=false;b.hideLabel=true;b.title=GO.users.lang.cmdPanelLookFeel;b.layout="form";b.defaults={anchor:"100%"};b.defaultType="textfield";b.cls="go-form-panel";b.labelWidth=190;var a=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"themes"},root:"results",totalProperty:"total",fields:["theme"],remoteSort:true});this.modulesStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"start_module",user_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});b.items=[];if(GO.settings.config.allow_themes){b.items.push(this.themeCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTheme,name:"theme",store:a,displayField:"theme",valueField:"theme",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.config.theme}))}b.items.push(this.startModuleField=new GO.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelStartModule,name:"start_module_name",hiddenName:"start_module",store:this.modulesStore,displayField:"name",valueField:"id",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.start_module}));b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelMaximunRows,store:new Ext.data.SimpleStore({fields:["value"],data:[["10"],["15"],["20"],["25"],["30"],["50"]]}),displayField:"value",valueField:"value",name:"max_rows_list",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:30});b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelSortNamesBy,store:new Ext.data.SimpleStore({fields:["value","text"],data:[["first_name",GO.users.lang.firstName],["last_name",GO.users.lang.lastName]]}),displayField:"text",valueField:"value",hiddenName:"sort_name",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.sort_name});b.items.push({xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.muteSound,name:"mute_sound"});GO.users.LookAndFeelPanel.superclass.constructor.call(this,b)};Ext.extend(GO.users.LookAndFeelPanel,Ext.Panel,{onLoadSettings:function(a){this.startModuleField.setRemoteText(a.result.data.start_module_name)}});GO.users.PasswordPanel=function(a){if(!a){a={}}a.autoScroll=true;a.border=false;a.hideLabel=true;a.title=GO.users.lang.changePassword;a.layout="form";a.defaults={anchor:"100%"};a.defaultType="textfield";a.cls="go-form-panel";a.labelWidth=140;this.currentPasswordField=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.currentPassword,name:"current_password"});this.passwordField1=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.newPassword,name:"password1"});this.passwordField2=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.confirmPassword,name:"password2"});a.items=[this.currentPasswordField,this.passwordField1,this.passwordField2];GO.users.PasswordPanel.superclass.constructor.call(this,a)};Ext.extend(GO.users.PasswordPanel,Ext.Panel);GO.mainLayout.onReady(function(){GO.moduleManager.addSettingsPanel("regional",GO.users.RegionalSettingsPanel);GO.moduleManager.addSettingsPanel("look_and_feel",GO.users.LookAndFeelPanel);if(GO.settings.config.allow_password_change){GO.moduleManager.addSettingsPanel("password",GO.users.PasswordPanel)}});GO.Window=Ext.extend(Ext.Window,{temporaryListeners:[],addListenerTillHide:function(a,c,b){this.on(a,c,b);this.temporaryListeners.push({eventName:a,fn:c,scope:b})},hide:function(){for(var a=0;a<this.temporaryListeners.length;a++){this.un(this.temporaryListeners[a].eventName,this.temporaryListeners[a].fn,this.temporaryListeners[a].scope)}this.temporaryListeners=[];GO.Window.superclass.hide.call(this)}});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.AboutDialog=function(a){Ext.apply(this,a);GO.dialog.AboutDialog.superclass.constructor.call(this,{modal:false,layout:"fit",height:500,width:520,resizable:false,closeAction:"hide",title:GO.lang.strAbout,items:new Ext.Panel({border:false,layout:"fit",autoLoad:"about.php",autoScroll:true}),buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.AboutDialog,Ext.Window,{});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.LoginDialog=function(b){if(!b){b={}}if(typeof(b.modal)=="undefined"){b.modal=true}Ext.apply(this,b);var a=new Ext.form.ComboBox({fieldLabel:GO.lang.strLanguage,name:"language_text",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),anchor:"100%",hiddenName:"language",displayField:"language",valueField:"id",mode:"local",triggerAction:"all",forceSelection:true,editable:false,value:GO.settings.language});a.on("select",function(){document.location=BaseHref+"index.php?SET_LANGUAGE="+a.getValue()},this);this.formPanel=new Ext.FormPanel({labelWidth:120,url:"action.php",defaultType:"textfield",autoHeight:true,waitMsgTarget:true,bodyStyle:"padding:5px 10px 5px 10px",items:[new GO.LogoComponent(),a,{fieldLabel:GO.lang.strUsername,name:"username",allowBlank:false,anchor:"100%"},{fieldLabel:GO.lang.strPassword,name:"password",inputType:"password",allowBlank:false,anchor:"100%"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.lang.remindPassword,name:"remind"},this.fullscreenField=new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.lang.fullscreen,checked:GO.fullscreen,name:"fullscreen"})]});GO.dialog.LoginDialog.superclass.constructor.call(this,{layout:"fit",autoHeight:true,width:400,resizable:false,closeAction:"hide",title:GO.lang.strLogin,closable:false,focus:function(){this.formPanel.form.findField("username").focus(true)}.createDelegate(this),items:[this.formPanel],buttons:[{text:GO.lang.lostPassword,handler:function(){Ext.Msg.prompt(GO.lang.lostPassword,GO.lang.lostPasswordText,function(c,d){if(c=="ok"){Ext.Ajax.request({url:"action.php",params:{task:"lost_password",email:d},callback:function(f,h,e){if(!h){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(e.responseText);if(!g.success){Ext.MessageBox.alert(GO.lang.strError,g.feedback)}else{Ext.MessageBox.alert(GO.lang.strSuccess,g.feedback)}}}})}})},scope:this},{text:GO.lang.cmdOk,handler:this.doLogin,scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:this.doLogin,scope:this}]});this.addEvents({callbackshandled:true})};Ext.extend(GO.dialog.LoginDialog,Ext.Window,{callbacks:new Array(),hideDialog:true,addCallback:function(b,a){this.callbacks.push({callback:b,scope:a})},doLogin:function(){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"login"},waitMsg:GO.lang.waitMsgLoad,success:function(a,b){if(GO.settings.user_id>0&&b.result.user_id!=GO.settings.user_id){document.location=document.location;return true}if(b.result.name==""){this.completeProfileDialog()}else{this.handleCallbacks()}if(this.hideDialog){this.hide()}},failure:function(a,b){if(b.result){Ext.MessageBox.alert(GO.lang.strError,b.result.feedback,function(){this.formPanel.form.findField("username").focus(true)},this)}},scope:this})},handleCallbacks:function(){for(var a=0;a<this.callbacks.length;a++){if(this.callbacks[a].callback){var b=this.callbacks[a].scope?this.callbacks[a].scope:this;this.callbacks[a].callback.call(b)}}this.callbacks=[];this.fireEvent("callbackshandled",this)},completeProfileDialog:function(){var a=new Ext.form.FormPanel({waitMsgTarget:true,url:BaseHref+"action.php",border:false,autoHeight:true,cls:"go-form-panel",baseParams:{task:"complete_profile"},defaults:{xtype:"textfield",anchor:"100%"},items:[{fieldLabel:GO.lang.strFirstName,name:"first_name",allowBlank:false},{fieldLabel:GO.lang.strMiddleName,name:"middle_name"},{fieldLabel:GO.lang.strLastName,name:"last_name",allowBlank:false}]});var b=function(){a.items.items[0].focus()};this.completeProfileDialog=new Ext.Window({width:400,autoHeight:true,title:GO.lang.completeProfile,items:a,closable:false,focus:b.createDelegate(this),buttons:[{text:GO.lang.cmdOk,handler:function(){a.form.submit({waitMsg:GO.lang.waitMsgSave,success:function(c,d){this.handleCallbacks()},failure:function(c,d){if(d.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,d.result.feedback)}},scope:this})},scope:this}]});this.completeProfileDialog.show()}});GO.loginDialog=new GO.dialog.LoginDialog({modal:false});GO.data.Connection=Ext.extend(Ext.data.Connection,{timeout:60000,request:function(a){if(!GO.checkerIcon){GO.checkerIcon=Ext.get("checker-icon")}if(GO.checkerIcon){GO.checkerIcon.setDisplayed(true)}if(a.callback){a.originalCallback=a.callback}a.loginCallback=function(){var b=a;b.callback=a.originalCallback;this.request(b)};a.loginCallbackScope=this;a.callback=this.authHandler;GO.data.Connection.superclass.request.call(this,a)},authHandler:function(b,c,a){if(GO.checkerIcon){GO.checkerIcon.setDisplayed(false)}if(!c){Ext.callback(b.originalCallback,b.scope,[b,c,a])}else{switch(a.responseText.trim()){case"NOTLOGGEDIN":GO.loginDialog.addCallback(b.loginCallback,b.loginCallbackScope);GO.loginDialog.show();break;case"UNAUTHORIZED":Ext.Msg.alert(GO.lang.strUnauthorized,GO.lang.strUnauthorizedText);break;default:Ext.callback(b.originalCallback,b.scope,[b,c,a]);break}}}});Ext.Ajax=new GO.data.Connection({autoAbort:false,serializeForm:function(a){return Ext.lib.Ajax.serializeForm(a)}});GO.data.JsonStore=function(a){GO.data.JsonStore.superclass.constructor.call(this,a);this.on("load",function(){this.loaded=true},this);this.on("loadexception",function(d,c,b,f){if(b.status==0){GO.errorDialog.show(GO.lang.strRequestError,"")}else{if(!this.reader.jsonData||GO.jsonAuthHandler(this.reader.jsonData,this.load,this)){var g=GO.lang.serverError;if(this.reader.jsonData&&this.reader.jsonData.feedback){g+="<br /><br />"+this.reader.jsonData.feedback}GO.errorDialog.show(g,b.responseText)}}},this)};Ext.extend(GO.data.JsonStore,Ext.data.JsonStore,{loaded:false});GO.grid.GridPanel=function(a){if(!a){a={}}if(!a.keys){a.keys=[]}if(!a.store){a.store=a.ds}a.keys.push({key:Ext.EventObject.DELETE,fn:function(b,c){if(c.target.tagName!="INPUT"){this.deleteSelected(this.deleteConfig)}},scope:this});if(a.paging){if(!a.bbar){a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems})}if(!a.store.baseParams){a.store.baseParams={}}a.store.baseParams.limit=parseInt(GO.settings.max_rows_list)}GO.grid.GridPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.GridPanel,Ext.grid.GridPanel,{deleteConfig:{},paging:false,initComponent:function(){this.addEvents({delayedrowselect:true});this.on("rowcontextmenu",function(a,d,b){b.stopEvent();this.rowClicked=true;var c=this.getSelectionModel();if(c.isSelected(d)!==true){c.clearSelections();c.selectRow(d)}},this);this.on("rowclick",function(b,d,c){if(!c.ctrlKey&&!c.shiftKey){var a=this.getSelectionModel().getSelected();this.fireEvent("delayedrowselect",this,d,a)}this.rowClicked=true},this);this.getSelectionModel().on("rowselect",function(d,c,b){if(!this.rowClicked){var a=this.getSelectionModel().getSelected();if(a==b){this.fireEvent("delayedrowselect",this,c,b)}}this.rowClicked=false},this,{delay:400});GO.grid.GridPanel.superclass.initComponent.call(this)},deleteSelected:function(b){b=b||{};Ext.apply(b,this.deleteConfig);if(!b.deleteParam){b.deleteParam="delete_keys"}var c={};c[b.deleteParam]=Ext.encode(this.selModel.selections.keys);var a={store:this.store,params:c,count:this.selModel.selections.keys.length,extraWarning:b.extraWarning||"",noConfirmation:b.noConfirmation};if(b.callback){a.callback=b.callback}if(b.success){a.success=b.success}if(b.failure){a.failure=b.failure}if(b.scope){a.scope=b.scope}GO.deleteItems(a)},getGridData:function(){var d={};for(var b=0;b<this.store.data.items.length;b++){var c=this.store.data.items[b].data;d[b]={};for(var a in c){d[b][a]=c[a]}}return d},numberRenderer:function(a){return GO.util.numberFormat(a)}});Ext.grid.GroupSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div id="x-grid3-summary-row-'+this.grid.id+'" class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.cm.config;var e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,k){var g={},a,n,l=this.cm.config,b;for(var e=0,o=d.length;e<o;e++){a=d[e];for(var f=0,h=k.length;f<h;f++){n=k[f];b=l[f];if(b.summaryType){g[n.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[n.name]||0,a,n.name,g)}}}return g},doGroupEnd:function(a,d,b,f,c){var e=this.calculate(d.rs,b);a.push("</div>",this.renderSummary({data:e},b),"</div>")},doWidth:function(e,b,d){var c=this.view.getGroups(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getGroups(),k,h,e=g.length;for(var c=0,f=a.length;c<f;c++){k=a[c].childNodes[2];k.style.width=d;k.firstChild.style.width=d;h=k.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){h[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getGroups(),f,h=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=h}},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a))},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=document.getElementById(d);if(!f){return false}var b=[];this.grid.store.each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData();var h=this.calculate(b,c);var a=this.renderSummary({data:h},c);var e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){this.refreshSummaryById(a._groupId)},doRemove:function(d,a,b,c){if(!c){this.refreshSummaryById(a._groupId)}},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.layout=this.layout.createDelegate(this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("refreshRow",this.refreshSummary,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.cm.config;var e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="-"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,k){var g={},a,n,l=this.cm.config,b;for(var e=0,o=d.length;e<o;e++){a=d[e];for(var f=0,h=k.length;f<h;f++){n=k[f];b=l[f];if(b&&b.summaryType){g[n.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[n.name]||0,a,n.name,g)}}}return g},layout:function(){if(!this.view.summary){this.view.summary=Ext.DomHelper.insertAfter(this.view.mainBody.dom.parentNode,{tag:"div"},true)}if(!this.view.mainBody){return}var f=this.grid;var k=f.getGridEl(),n=this.cm,b=f.autoExpandColumn,a=this.view;var d=k.getSize(true);var l=d.width;if(!l||!d.height){return}if(f.autoHeight){this.view.scroller.dom.style.overflow="visible"}else{var j=this.view.summary.getHeight();var h=this.view.mainHd.getHeight();this.view.el.setSize(d.width,d.height+j);var e=d.height-(h)-(j);this.view.scroller.setSize(l,e);this.view.innerHd.style.width=(l)+"px"}if(this.view.forceFit){if(this.view.lastViewWidth!=l){this.view.fitColumns(false,false);this.view.lastViewWidth=l}}else{this.view.autoExpand()}this.view.onLayout(l,e)},doWidth:function(e,b,d){var c=this.view.getRows(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getRows(),k,h,e=g.length;for(var c=0,f=a.length;c<f;c++){k=a[c].childNodes[2];k.style.width=d;k.firstChild.style.width=d;h=k.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){h[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getRows(),f,h=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=h}},refreshSummary:function(){var f=this.grid,j=f.colModel,b=f.store,n=f.stripeRows;var k=j.getColumnCount();if(b.getCount()<1){return""}var h=this.view.getColumnData();var l=l||0;var d=typeof d=="undefined"?b.getCount()-1:d;var c=b.getRange();var a=[];var e=this.calculate(c,h);a.push("</div>",this.renderSummary({data:e},h),"</div>");this.view.summary.update(a.join(""));this.view.layout()},getSummaryNode:function(){return this.view.summary},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary.Calculations={sum:function(b,a,c){return GO.util.numberFormat(GO.util.unlocalizeNumber(b)+(GO.util.unlocalizeNumber(a.data[c])||0))},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=GO.util.unlocalizeNumber(b.data[e]);var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return GO.util.numberFormat(c>a?(d[e+"max"]=c):a)},min:function(b,a,e,d){var b=GO.util.unlocalizeNumber(a.data[e]);var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return GO.util.numberFormat(b<c?(d[e+"min"]=b):c)},average:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(GO.util.unlocalizeNumber(a.data[f])||0)));return GO.util.numberFormat(d===0?0:d/g)}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(b,d){var a=this.view.getGroupField();var c=b[0].data[a];var e=this.getSummaryData(c);return e||Ext.grid.HybridSummary.superclass.calculate.call(this,b,d)},updateSummaryData:function(a,d,c){var b=this.grid.store.reader.jsonData;if(!b.summaryData){b.summaryData={}}b.summaryData[a]=d;if(!c){this.refreshSummary(a)}},getSummaryData:function(a){var b=this.grid.store.reader.jsonData;if(b&&b.summaryData){return b.summaryData[a]}return null}});GO.menu.RecordsContextMenu=Ext.extend(Ext.menu.Menu,{records:[],showAt:function(e,b){this.records=b;var a=this.records.length>1;for(var c=0;c<this.items.getCount();c++){var d=this.items.get(c);d.setDisabled(!d.multiple&&a)}GO.menu.RecordsContextMenu.superclass.showAt.call(this,e)}});GO.grid.SimpleSelectList=function(b){if(!b){b={}}if(!b.tpl){var a="";if(b.title){a+="<b>"+b.title+":</b>"}a+='<tpl for="."><div id="{dom_id}" class="go-item-wrap">{name}</div></tpl>';b.tpl=new Ext.XTemplate(a)}else{var a=b.tpl}b.singleSelect=true;b.autoHeight=true;b.overClass="go-view-over";b.itemSelector="div.go-item-wrap";b.selectedClass="go-view-selected";GO.grid.SimpleSelectList.superclass.constructor.call(this,b)};Ext.extend(GO.grid.SimpleSelectList,Ext.DataView,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-select-list"});GO.grid.SimpleSelectList.superclass.onRender.apply(this,arguments)}});GO.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this);this.addEvents({change:true});GO.grid.CheckColumn.superclass.constructor.call(this)};Ext.extend(GO.grid.CheckColumn,Ext.util.Observable,{disabled_field:"disabled",init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);var d=a.get(this.disabled_field);if(!d){var f=a.data[this.dataIndex]=="1"?"0":"1";a.set(this.dataIndex,f);this.fireEvent("change",a,f)}}},renderer:function(c,e,b){e.css+=" x-grid3-check-col-td";var d=b.get(this.disabled_field);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-check-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}});Ext.ns("Ext.ux.grid");Ext.ux.grid.RowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,header:"",menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',widthIntercept:4,widthSlope:21,init:function(c){this.grid=c;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var b=c.getView();var a={scope:this};a[this.actionEvent]=this.onClick;c.on({render:{scope:this,fn:function(){b.mainBody.on(a)}}});if(!this.renderer){this.renderer=function(h,d,e,j,g,f){d.css+=(d.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(h,d,e,j,g,f))}.createDelegate(this)}if(b.groupTextTpl&&this.groupActions){b.interceptMouse=b.interceptMouse.createInterceptor(function(d){if(d.getTarget(".ux-grow-action-item")){return false}});b.groupTextTpl='<div class="ux-grow-action-text">'+b.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(d,c){var a=[];Ext.each(d,function(e,f){if(e.iconCls&&"function"===typeof(e.callback||e.cb)){this.callbacks=this.callbacks||{};this.callbacks[e.iconCls]=e.callback||e.cb}var g={cls:e.iconIndex?"{"+e.iconIndex+"}":(e.iconCls?e.iconCls:""),qtip:e.qtipIndex?"{"+e.qtipIndex+"}":(e.tooltip||e.qtip?e.tooltip||e.qtip:""),text:e.textIndex?"{"+e.textIndex+"}":(e.text?e.text:""),hide:e.hideIndex?'<tpl if="'+e.hideIndex+'">visibility:hidden;</tpl>':(e.hide?"visibility:hidden;":""),align:e.align||"right",style:e.style?e.style:""};a.push(g)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},onClick:function(g,h){var j=this.grid.getView();var c=false;var o=g.getTarget(".x-grid3-row");var a=j.findCellIndex(h.parentNode.parentNode);var n=g.getTarget(".ux-row-action-item");if(n){c=n.className.replace(/ux-row-action-item /,"");if(c){c=c.replace(/ ux-row-action-text/,"");c=c.trim()}}if(false!==o&&false!==a&&false!==c){var f=this.grid.store.getAt(o.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,f,c,o.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,f,c,o.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,f,c,o.rowIndex,a)}}}n=g.getTarget(".ux-grow-action-item");if(n){var k=j.findGroup(h);var d=k?k.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var l=new RegExp(d);b=this.grid.store.queryBy(function(e){return e._groupId.match(l)});b=b?b.items:[]}c=n.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);GO.grid.RadioColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};GO.grid.RadioColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(g,d){if(d.className&&d.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();var b=this.grid.getView().findRowIndex(d);var a=this.grid.store.getAt(b);var f=this.isDisabled(a);if(!f){if(a.get(this.dataIndex)){return}for(var c=0;c<this.grid.store.getCount();++c){var h=this.grid.store.getAt(c);if(h.get(this.dataIndex)){h.set(this.dataIndex,false)}}a.set(this.dataIndex,true)}}},isDisabled:function(a){return false},renderer:function(c,e,b){e.css+=" x-grid3-radio-col-td";var d=this.isDisabled(b);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-radio-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}};Ext.namespace("GO.util");GO.util.empty=function(a){if(!a){return true}if(a==""){return true}if(a=="0"){return true}if(a=="undefined"){return true}if(a=="null"){return true}return false};GO.mailTo=function(a){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+a+"','');\">"+a+"</a>"}else{return'<a href="mailto:'+a+'">'+a+"</a>"}};GO.util.getFileExtension=function(a){var c=a.lastIndexOf(".");var b="";if(c){b=a.substr(c+1)}return b.toLowerCase()};GO.playAlarm=function(){if(GO.util.empty(GO.settings.mute_sound)){var a=GO.util.getFlashMovieObject("alarmSound");if(a){a.Play()}}};GO.util.nl2br=function(a){return a.replace(/\n/g,"<br />")};GO.util.clone=function clone(c){if(c==null||typeof(c)!="object"){return c}var a=new c.constructor();for(var b in c){a[b]=clone(c[b])}return a};GO.jsonAuthHandler=function(a,c,b){if(a.authError){switch(a.authError){case"UNAUTHORIZED":alert(GO.lang.strUnauthorizedText);return false;case"NOTLOGGEDIN":if(c){GO.loginDialog.addCallback(c,b)}GO.loginDialog.show();return false}}return true};GO.deleteItems=function(a){a.extraWarning=a.extraWarning||"";switch(a.count){case 0:alert(GO.lang.noItemSelected);return false;case 1:var c=a.extraWarning+GO.lang.strDeleteSelectedItem;break;default:var b=new Ext.Template(a.extraWarning+GO.lang.strDeleteSelectedItems);var c=b.applyTemplate({count:a.count});break}if(a.noConfirmation||confirm(c)){if(a.store){for(var d in a.params){a.store.baseParams[d]=a.params[d]}a.store.reload({callback:function(){if(!this.reader.jsonData.deleteSuccess){if(a.failure){callback=a.failure.createDelegate(a.scope);callback.call(a.scope,a)}alert(this.reader.jsonData.deleteFeedback)}else{if(a.success){callback=a.success.createDelegate(a.scope);callback.call(a.scope,a)}}if(a.callback){callback=a.callback.createDelegate(a.scope);callback.call(this,a)}}});for(var d in a.params){delete a.store.baseParams[d]}}else{Ext.Ajax.request({url:a.url,params:a.params,callback:function(f,h,e){var g=Ext.decode(e.responseText);if(!g.success){if(a.failure){callback=a.failure.createDelegate(a.scope);callback.call(this,g)}alert(g.feedback)}else{if(a.success){callback=a.success.createDelegate(a.scope);callback.call(this,g)}}if(a.callback){callback=a.callback.createDelegate(a.scope);callback.call(this,g)}}})}}};GO.util.getFlashMovieObject=function(a){if(window.document[a]){return window.document[a]}if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[a]){return document.embeds[a]}}else{return document.getElementById(a)}};GO.util.unlocalizeNumber=function(c,a,d){if(GO.util.empty(c)){return 0}if(!a){a=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}c=c+"";var b=new RegExp("["+d+"]","g");c=c.replace(b,"");return parseFloat(c.replace(a,"."))};String.prototype.regexpEscape=function(){var a=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];var b=new RegExp("(\\"+a.join("|\\")+")","g");return this.replace(b,"\\$1")};GO.util.numberFormat=function(f,c,j,d){if(typeof(c)=="undefined"){c=2}if(!j){j=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}if(f==""){f="0"}var k=parseFloat(f);k=k.toFixed(c);if(c>0){var b=k.indexOf(".");if(!b){k=k+".";b=k.indexOf(".")}var g=k.length-b;for(i=g;i<=c;i++){k=k+"0"}var h=j+k.substring(b+1);var e=c;while(h.substring(h.length-1)=="0"&&e>c){e--;h=h.substring(0,h.length-1)}}else{var h="";var b=k.length}var a=0;for(i=b-1;i>=0;i--){if(a==3&&k.substr(i,1)!="-"){h=d+h;a=0}h=k.substr(i,1)+h;a++}if(h==",NaN"){h=GO.util.numberFormat("0",c,j,d)}return h};GO.util.popup=function(c){if(!c.width){c.width=screen.availWidth;c.height=screen.availHeight}if(!c.target){c.target="_blank"}var b;x=(screen.availWidth-c.width)/2;y=(screen.availHeight-c.height)/2;b=",width="+c.width+",height="+c.height+",left="+x+",top="+y+",scrollbars=yes,resizable=yes,status=no";var a=window.open(c.url,c.target,b);if(!a){alert(GO.lang.popupBlocker);return false}if(!a.opener){a.opener=self}a.focus();return a};GO.util.get_html_translation_table=function(j,f){var d={},h={},c=0,a="";var e={},b={};var k={},g={};k=(j?j.toUpperCase():"HTML_SPECIALCHARS");g=(f?f.toUpperCase():"ENT_COMPAT");e[0]="HTML_SPECIALCHARS";e[1]="HTML_ENTITIES";b[0]="ENT_NOQUOTES";b[2]="ENT_COMPAT";b[3]="ENT_QUOTES";if(!isNaN(k)){k=e[k]}if(!isNaN(g)){g=b[g]}if(k=="HTML_SPECIALCHARS"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;"}else{if(k=="HTML_ENTITIES"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;";d["160"]="&nbsp;";d["161"]="&iexcl;";d["162"]="&cent;";d["163"]="&pound;";d["164"]="&curren;";d["165"]="&yen;";d["166"]="&brvbar;";d["167"]="&sect;";d["168"]="&uml;";d["169"]="&copy;";d["170"]="&ordf;";d["171"]="&laquo;";d["172"]="&not;";d["173"]="&shy;";d["174"]="&reg;";d["175"]="&macr;";d["176"]="&deg;";d["177"]="&plusmn;";d["178"]="&sup2;";d["179"]="&sup3;";d["180"]="&acute;";d["181"]="&micro;";d["182"]="&para;";d["183"]="&middot;";d["184"]="&cedil;";d["185"]="&sup1;";d["186"]="&ordm;";d["187"]="&raquo;";d["188"]="&frac14;";d["189"]="&frac12;";d["190"]="&frac34;";d["191"]="&iquest;";d["192"]="&Agrave;";d["193"]="&Aacute;";d["194"]="&Acirc;";d["195"]="&Atilde;";d["196"]="&Auml;";d["197"]="&Aring;";d["198"]="&AElig;";d["199"]="&Ccedil;";d["200"]="&Egrave;";d["201"]="&Eacute;";d["202"]="&Ecirc;";d["203"]="&Euml;";d["204"]="&Igrave;";d["205"]="&Iacute;";d["206"]="&Icirc;";d["207"]="&Iuml;";d["208"]="&ETH;";d["209"]="&Ntilde;";d["210"]="&Ograve;";d["211"]="&Oacute;";d["212"]="&Ocirc;";d["213"]="&Otilde;";d["214"]="&Ouml;";d["215"]="&times;";d["216"]="&Oslash;";d["217"]="&Ugrave;";d["218"]="&Uacute;";d["219"]="&Ucirc;";d["220"]="&Uuml;";d["221"]="&Yacute;";d["222"]="&THORN;";d["223"]="&szlig;";d["224"]="&agrave;";d["225"]="&aacute;";d["226"]="&acirc;";d["227"]="&atilde;";d["228"]="&auml;";d["229"]="&aring;";d["230"]="&aelig;";d["231"]="&ccedil;";d["232"]="&egrave;";d["233"]="&eacute;";d["234"]="&ecirc;";d["235"]="&euml;";d["236"]="&igrave;";d["237"]="&iacute;";d["238"]="&icirc;";d["239"]="&iuml;";d["240"]="&eth;";d["241"]="&ntilde;";d["242"]="&ograve;";d["243"]="&oacute;";d["244"]="&ocirc;";d["245"]="&otilde;";d["246"]="&ouml;";d["247"]="&divide;";d["248"]="&oslash;";d["249"]="&ugrave;";d["250"]="&uacute;";d["251"]="&ucirc;";d["252"]="&uuml;";d["253"]="&yacute;";d["254"]="&thorn;";d["255"]="&yuml;"}else{throw Error("Table: "+k+" not supported");return false}}if(g!="ENT_NOQUOTES"){d["34"]="&quot;"}if(g=="ENT_QUOTES"){d["39"]="&#039;"}for(c in d){a=String.fromCharCode(c);h[a]=d[c]}return h};GO.util.html_entity_decode=function(b,f){b+="";var e={},d="",a="",c=0;a=b.toString();if(false===(e=GO.util.get_html_translation_table("HTML_ENTITIES",f))){return false}for(d in e){entity=e[d];a=a.split(entity).join(d)}return a};GO.util.add_slashes=function(a){return(a+"").replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")};GO.util.basename=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(b+1)}return a};GO.util.dirname=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(0,b)}return a};GO.state.HttpProvider=function(a){GO.state.HttpProvider.superclass.constructor.call(this);this.url=BaseHref+"state.php";Ext.apply(this,a);this.state=this.readValues()};Ext.extend(GO.state.HttpProvider,Ext.state.Provider,{set:function(a,c,d,b){if(a.substr(0,4)!="ext-"){if(typeof c=="undefined"||c===null){this.clear(a);return}this.setValue(a,c,d,b);GO.state.HttpProvider.superclass.set.call(this,a,c)}},clear:function(a){this.clearValue(a);GO.state.HttpProvider.superclass.clear.call(this,a)},readValues:function(){var b={};for(var a in GO.settings.state){if(a!="remove"){b[a]=this.decodeValue(GO.settings.state[a])}}return b},setValue:function(a,c,d,b){Ext.Ajax.request({url:this.url,params:{task:"set",name:a,value:this.encodeValue(c),index:GO.settings.state_index},callback:d,scope:b})},clearValue:function(a){Ext.Ajax.request({url:this.url,params:{task:"set",name:a,value:"null"}})}});Ext.DataView.DragSelector=function(g){g=g||{};var k,d,j,n;var e,l,o=new Ext.lib.Region(0,0,0,0);var b=g.dragSafe===true;this.init=function(t){k=t;k.on("render",r)};function p(){e=[];k.all.each(function(t){e[e.length]=t.getRegion()});l=k.el.getRegion()}function f(){return false}function h(t){return !b||t.target==k.el.dom}function q(t){k.on("containerclick",f,k,{single:true});if(!j){j=k.el.createChild({cls:"x-view-selector"})}else{j.setDisplayed("block")}p();k.clearSelections()}function c(B){var C=n.startXY;var G=n.getXY();var E=Math.min(C[0],G[0]);var D=Math.min(C[1],G[1]);var F=Math.abs(C[0]-G[0]);var z=Math.abs(C[1]-G[1]);o.left=E;o.top=D;o.right=E+F;o.bottom=D+z;o.constrainTo(l);j.setRegion(o);for(var v=0,A=e.length;v<A;v++){var t=e[v],u=o.intersect(t);if(u&&!t.selected){t.selected=true;k.select(v,true)}else{if(!u&&t.selected){t.selected=false;k.deselect(v)}}}}function a(t){if(j){j.setDisplayed(false)}}function r(t){n=new Ext.dd.DragTracker({onBeforeStart:h,onStart:q,onDrag:c,onEnd:a});n.initEl(t.el)}};GO.plugins.InsertAtCursorTextareaPlugin=function(){return{init:function(a){a.insertAtCursor=function(b){if(Ext.isIE){this.el.focus();var e=document.selection.createRange();e.text=b;e.moveEnd("character",b.length);e.moveStart("character",b.length)}else{var d=this.el.dom.selectionStart;var c=this.el.dom.selectionEnd;this.el.dom.value=this.el.dom.value.substring(0,d)+b+this.el.dom.value.substring(c,this.el.dom.value.length);this.el.focus();this.el.dom.setSelectionRange(c+b.length,c+b.length)}}}}};GO.plugins.HtmlEditorImageInsert=function(a){a=a||{};Ext.apply(this,a);this.init=function(b){this.editor=b;this.editor.on("render",this.onRender,this)};this.addEvents({insert:true})};Ext.extend(GO.plugins.HtmlEditorImageInsert,Ext.util.Observable,{onRender:function(){if(!Ext.isSafari){this.editor.tb.add({itemId:"htmlEditorImage",cls:"x-btn-icon go-edit-insertimage",enableToggle:false,scope:this,handler:function(){this.showFileBrowser()},clickEvent:"mousedown",tabIndex:-1,tooltip:{title:GO.lang.image,text:GO.lang.insertImage}})}},showFileBrowser:function(){if(!GO.files){alert(GO.lang.noFilesModule);return false}if(!this.fileBrowser){this.fileBrowser=new GO.files.FileBrowser({border:false,fileClickHandler:this.selectImage,filesFilter:"jpg,png,gif,jpeg,bmp",scope:this});this.fileBrowserWindow=new Ext.Window({title:"Select files",height:480,width:680,layout:"fit",border:false,closeAction:"hide",items:this.fileBrowser,buttons:[{text:GO.lang.cmdOk,handler:this.selectImage,scope:this},{text:GO.lang.cmdClose,handler:function(){this.fileBrowserWindow.hide()},scope:this}]})}this.fileBrowserWindow.show.defer(200,this.fileBrowserWindow)},selectImage:function(){var a=this.fileBrowser.getSelectedGridRecords();if(a.length){this.selectedPath=a[0].data.path;this.selectedUrl=GO.settings.modules.files.url+"download.php?path="+encodeURIComponent(this.selectedPath);var b='<img src="'+this.selectedUrl+'" border="0" />';this.fireEvent("insert",this);this.editor.insertAtCursor(b)}this.fileBrowserWindow.hide()}});GO.DisplayPanel=Ext.extend(Ext.Panel,{link_type:0,newMenuButton:false,template:"",templateConfig:{notEmpty:function(a){if(a&&a.length){return true}}},loadParams:{},idParam:"",loadUrl:"",data:{},saveHandlerAdded:false,addSaveHandler:function(a){if(!this.saveHandlerAdded){a.on("save",this.onSave,this);this.saveHandlerAdded=true}},createTopToolbar:function(){this.newMenuButton=new GO.NewMenuButton();var a=[];a.push(this.editButton=new Ext.Button({iconCls:"btn-edit",text:GO.lang.cmdEdit,cls:"x-btn-text-icon",handler:this.editHandler,scope:this,disabled:true}));a.push(this.linkBrowseButton=new Ext.Button({iconCls:"btn-link",cls:"x-btn-text-icon",text:GO.lang.cmdBrowseLinks,handler:function(){GO.linkBrowser.show({link_id:this.data.id,link_type:this.link_type,folder_id:"0"});GO.linkBrowser.on("hide",this.reload,this,{single:true})},scope:this}));if(GO.files){a.push(this.fileBrowseButton=new Ext.Button({iconCls:"btn-files",cls:"x-btn-text-icon",text:GO.files.lang.files,handler:function(){GO.files.openFolder(this.data.files_folder_id);GO.files.fileBrowserWin.on("hide",this.reload,this,{single:true})},scope:this,disabled:true}))}a.push(this.newMenuButton);a.push("-");a.push({iconCls:"btn-refresh",tooltip:GO.lang.cmdRefresh,handler:this.reload,scope:this});a.push({iconCls:"btn-print",tooltip:GO.lang.cmdPrint,handler:function(){this.body.print()},scope:this});return a},initComponent:function(){this.autoScroll=true;this.split=true;this.tbar=this.createTopToolbar();this.xtemplate=new Ext.XTemplate(this.template,this.templateConfig);this.xtemplate.compile();GO.DisplayPanel.superclass.initComponent.call(this)},afterRender:function(){this.getTopToolbar().setDisabled(true);GO.DisplayPanel.superclass.afterRender.call(this)},getLinkName:function(){return this.data.name},onSave:function(a,b){if(b>0&&this.data.id==b){this.reload()}},gridDeleteCallback:function(a){if(this.data){var c=Ext.decode(a.params.delete_keys);for(var b=0;b<c.length;b++){if(this.data.id==c[b]){this.reset()}}}},reset:function(){this.body.removeAllListeners();this.body.update("");this.getTopToolbar().setDisabled(true)},setData:function(a){this.body.removeAllListeners();a.link_type=this.link_type;this.data=a;this.getTopToolbar().setDisabled(false);this.editButton.setDisabled(!a.write_permission);if(a.write_permission){this.newMenuButton.setLinkConfig({id:this.data.id,type:this.link_type,text:this.getLinkName(),callback:this.reload,scope:this})}else{this.newMenuButton.setDisabled(true)}if(GO.files){this.fileBrowseButton.setDisabled(a.files_folder_id<1)}this.xtemplate.overwrite(this.body,a);this.body.on("click",this.onBodyClick,this)},onBodyClick:function(g,h){if(h.tagName!="A"){h=Ext.get(h).findParent("A",10);if(!h){return false}}if(h.tagName=="A"){var a=h.attributes.href.value;if(GO.email&&a.substr(0,6)=="mailto"){var n=a.indexOf("?");if(n>0){var j=a.substr(7,n-8)}else{var j=a.substr(7)}g.preventDefault();GO.email.addressContextMenu.showAt(g.getXY(),j)}else{var k=a.indexOf("#link_");if(k>-1){g.preventDefault();var f=a.substr(k+6,a.length);var l=this.data.links[f];if(l.link_type=="folder"){GO.linkBrowser.show({link_id:l.parent_link_id,link_type:l.parent_link_type,folder_id:l.id})}else{GO.linkHandlers[l.link_type].call(this,l.id,{data:l})}}else{k=a.indexOf("#files_");if(k>-1){var f=a.substr(k+7,a.length);var c=this.data.files[f];if(c.extension=="folder"){var b=GO.files.openFolder(this.data.files_folder_id,c.id)}else{var d=new GO.files.FileRecord(c);GO.files.filePropertiesDialog.show(d.get("id"))}}}}}},load:function(b,a){if(this.data.id!=b||a){this.loadParams[this.idParam]=b;this.body.mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:this.loadUrl,params:this.loadParams,callback:function(d,f,c){this.body.unmask();if(!f){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var e=Ext.decode(c.responseText);this.setData(e.data)}},scope:this})}},reload:function(){if(this.data.id){this.load(this.data.id,true)}},editHandler:function(){}});GO.panel.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){if(!this.name){this.name=""}this.el=b.createChild({tag:"iframe",id:this.id,frameBorder:0,src:this.url,name:this.name})},setUrl:function(a){this.el.set({src:a})}});GO.dialog.SelectGroups=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","user_id","user_name"],remoteSort:true,baseParams:{task:"groups"}});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.grid.on("rowdblclick",function(){this.callHandler(true)},this);this.store.load();Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectGroups,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:function(){this.callHandler(true)},scope:this}]})};Ext.extend(GO.dialog.SelectGroups,Ext.Window,{callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectUsers=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","email"],remoteSort:true,baseParams:{task:"users"}});this.searchField=new GO.form.SearchField({store:this.store,width:320});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.searchField]});this.grid.on("rowdblclick",function(){this.callHandler(true)},this);var b=function(){this.searchField.focus(true)};GO.dialog.SelectUsers.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",focus:b.createDelegate(this),title:GO.lang.strSelectUsers,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectUsers,Ext.Window,{show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.dialog.SelectUsers.superclass.show.call(this)},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectEmail=function(b){Ext.apply(this,b);var a=Array();this.usersStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},id:"id",root:"results",totalProperty:"total",fields:["id","username","name","company","logins","lastlogin","registration_time","address","zip","city","state","country","phone","email","waddress","wzip","wcity","wstate","wcountry","wphone"],remoteSort:true});this.usersSearchField=new GO.form.SearchField({store:this.usersStore,width:320});this.usersGrid=new GO.grid.GridPanel({id:"select-users-grid",title:GO.addressbook.lang.users,paging:true,border:false,store:this.usersStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.usersSearchField]});this.usersGrid.on("show",function(){this.usersStore.load()},this);this.usersGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.usersGrid);if(GO.addressbook){this.contactsStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts"},root:"results",id:"id",totalProperty:"total",fields:["id","name","company_name","email","home_phone","work_phone","work_fax","cellular"],remoteSort:true});this.contactsSearchField=new GO.form.SearchField({store:this.contactsStore,width:320});this.contactsGrid=new GO.grid.GridPanel({id:"select-contacts-grid",title:GO.addressbook.lang.contacts,paging:true,border:false,store:this.contactsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.contactsSearchField]});this.contactsGrid.on("show",function(){this.contactsStore.load()},this);this.contactsGrid.on("rowdblclick",function(){this.callHandler(true)},this);this.companiesStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies"},totalProperty:"total",root:"results",id:"id",fields:["id","name","city","email","phone","homepage","address","zip"],remoteSort:true});this.companySearchField=new GO.form.SearchField({store:this.companiesStore,width:320});this.companyGrid=new GO.grid.GridPanel({id:"select-companies-grid",title:GO.addressbook.lang.companies,paging:true,border:false,store:this.companiesStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.companySearchField]});this.companyGrid.on("show",function(){this.companiesStore.load()},this);this.companyGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.contactsGrid);a.push(this.companyGrid)}this.tabPanel=new Ext.TabPanel({activeTab:0,items:a});Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectEmail,items:this.tabPanel,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectEmail,Ext.Window,{callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var c;switch(this.tabPanel.getLayout().activeItem.id){case"select-users-grid":c=this.usersGrid;break;case"select-contacts-grid":c=this.contactsGrid;break;case"select-companies-grid":c=this.companiesGrid;break}var b=this.handler.createDelegate(this.scope,[c]);b.call()}if(a){this.hide()}}});GO.ErrorDialog=function(a){a=a||{};Ext.apply(a,{width:550,height:300,autoHeight:true,closeAction:"hide",plain:true,border:false,closable:true,title:GO.lang.strError,modal:false,items:[this.messagePanel=new Ext.FormPanel({region:"center",cls:"go-error-dialog",autoHeight:true,html:""}),this.detailPanel=new Ext.Panel({region:"south",collapsible:true,collapsed:true,height:150,title:GO.lang.errorDetails,titleCollapse:true,autoScroll:true,html:""})],buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ErrorDialog.superclass.constructor.call(this,a)};Ext.extend(GO.ErrorDialog,GO.Window,{show:function(a,b){if(!this.rendered){this.render(Ext.getBody())}this.detailPanel.collapse();this.messagePanel.body.update(a);if(GO.util.empty(b)){this.detailPanel.hide()}else{this.detailPanel.show();this.detailPanel.body.update("<pre>"+b+"</pre>")}GO.ErrorDialog.superclass.show.call(this)}});GO.errorDialog=new GO.ErrorDialog();GO.form.TreeSelect=Ext.extend(Ext.form.TriggerField,{triggerClass:"go-form-tree-select",onTriggerClick:function(){if(!this.treeSelectWindow){this.treeSelectWindow=new GO.form.TreeSelectWindow({textfield:this})}this.treeSelectWindow.show()}});GO.form.TreeSelectWindow=Ext.extend(function(a){a=a||{};a.title=a.textfield.windowTitle||"";this.treePanel=new Ext.tree.TreePanel({layout:"fit",loader:a.textfield.treeLoader,containerScroll:true,autoScroll:true,rootVisible:false,root:{nodeType:"async",id:"root"}});a.layout="fit";a.items=[this.treePanel];a.modal=true;a.width=640;a.height=400;a.closeAction="hide";a.closable=true;a.buttons=[{text:GO.lang.cmdOk,handler:function(){var d=[],b=this.treePanel.getChecked();var g=this.textfield.getValue();var c=g.split(",");for(var e=0;e<c.length;e++){if(c[e]!=""){var f=this.treePanel.getNodeById(c[e]);if(!f){d.push(c[e])}}}Ext.each(b,function(h){d.push(h.id)});this.textfield.setValue(d.join(","));this.hide()},scope:this}];GO.form.TreeSelectWindow.superclass.constructor.call(this,a);this.treePanel.on("load",function(d){var b=this.textfield.getValue();var c=b.split(",");Ext.each(d.childNodes,function(f){var e=c.indexOf(f.id);if(e>-1){f.attributes.checked=true}})},this);this.on("show",function(){var b=this.textfield.getValue();var d=b.split(",");this.clearChecked();for(var c=0;c<d.length;c++){var e=this.treePanel.getNodeById(d[c]);if(e){e.getUI().toggleCheck(true)}}},this)},GO.Window,{clearChecked:function(){var a=this.treePanel.getChecked();Ext.each(a,function(b){b.getUI().toggleCheck(false)})}});Ext.reg("treeselect",GO.form.TreeSelect);GO.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{store:false,initComponent:function(){GO.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this);this.on("focus",function(){this.focus(true)},this)},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",width:180,hasSearch:false,paramName:"query",onTrigger1Click:function(){if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.load();this.el.dom.value="";this.hasSearch=false}},onTrigger2Click:function(){var a=this.getRawValue();if(a.length<1){this.onTrigger1Click();return}this.store.baseParams[this.paramName]=a;this.store.load();this.hasSearch=true},afterRender:function(){GO.form.SearchField.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}},setValue:function(a){GO.form.SearchField.superclass.setValue.call(this,a);if(a!=""){this.hasSearch=true;if(this.rendered){}}}});GO.form.ComboBox=Ext.extend(Ext.form.ComboBox,{setRemoteText:function(e){var d=this.findRecord(this.valueField,this.value);if(!d){var c=Ext.data.Record.create([{name:this.valueField},{name:this.displayField}]);var b={};b[this.valueField]=this.value;b[this.displayField]=e;var a=new c(b);this.store.add(a);this.setValue(this.value)}},initValue:function(){GO.form.ComboBox.superclass.initValue.call(this);this.setRawValue(this.lastSelectionText)},selectFirst:function(){if(this.store.getCount()){var a=this.store.getRange(0,1);this.setValue(a[0].get(this.valueField))}},clearLastSearch:function(){this.lastQuery=false;this.hasSearch=false}});Ext.reg("combo",GO.form.ComboBox);GO.form.ColorField=Ext.extend(function(a){this.menu=new Ext.menu.ColorMenu();this.menu.palette.on("select",this.handleSelect,this);this.menu.on("show",function(){this.menu.palette.select(this.curColor)},this);this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));if(a.colors){this.menu.palette.colors=a.colors}GO.form.ColorField.superclass.constructor.call(this,a)},Ext.form.TriggerField,{showHexValue:false,defaultAutoCreate:{tag:"input",type:"text",size:"1",autocomplete:"off",maxlength:"6"},lengthText:"Color hex values must be either 3 or 6 characters.",blankText:"Must have a hexidecimal value in the format ABCDEF.",maskRe:/[a-f0-9]/i,regex:/[a-f0-9]/i,curColor:"ffffff",validateValue:function(a){if(!this.showHexValue){return true}if(a.length<1){this.el.setStyle({"background-color":"#"+this.defaultColor});if(!this.allowBlank){this.markInvalid(String.format(this.blankText,a));return false}return true}if(a.length!=3&&a.length!=6){this.markInvalid(String.format(this.lengthText,a));return false}this.setColor(a);return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},markInvalid:function(a){GO.form.ColorField.superclass.markInvalid.call(this,a);this.el.setStyle({"background-image":"url(../lib/resources/images/default/grid/invalid_line.gif)"})},setValue:function(a){GO.form.ColorField.superclass.setValue.call(this,a);this.setColor(a)},initValue:function(){GO.form.ColorField.superclass.initValue.call(this);this.setColor(this.value)},setColor:function(a){if(this.rendered){this.curColor=a;this.el.setStyle({"background-color":"#"+a,"background-image":"none"});if(!this.showHexValue){this.el.setStyle({"text-indent":"-100px"});if(Ext.isIE){this.el.setStyle({"margin-left":"100px"})}}}},menuListeners:{select:function(a,b){this.setValue(b)},show:function(){this.onFocus()},hide:function(){this.focus();var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},handleSelect:function(b,a){this.setValue(a)},onTriggerClick:function(){if(this.disabled){return}this.menu.show(this.el,"tl-bl")}});Ext.reg("colorfield",GO.form.ColorField);GO.form.ComboBoxReset=Ext.extend(GO.form.ComboBox,{initComponent:Ext.form.TwinTriggerField.prototype.initComponent,getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",onViewClick:Ext.form.ComboBox.prototype.onViewClick.createSequence(function(){}),onTrigger2Click:function(){this.onTriggerClick()},onTrigger1Click:function(){var a=this.getValue();this.clearValue();this.fireEvent("change",this,this.getValue(),a);this.fireEvent("clear",this)},setValue:function(a){GO.form.ComboBoxReset.superclass.setValue.call(this,a);if(this.rendered){}},afterRender:function(){GO.form.ComboBoxReset.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}}});Ext.reg("comboboxreset",GO.form.ComboBoxReset);GO.form.ComboBoxMulti=function(a){a.typeAhead=false;a.minChars=2;a.hideTrigger=true;a.defaultAutoCreate={tag:"textarea",autocomplete:"off"};GO.form.ComboBoxMulti.superclass.constructor.call(this,a);this.on("focus",function(){this.focused=true},this);this.on("blur",function(){this.focused=false},this)};Ext.extend(GO.form.ComboBoxMulti,GO.form.ComboBox,{sep:",",focused:false,getCursorPosition:function(){if(document.selection){var a=document.selection.createRange();var b=a.duplicate();b.moveToElementText(this.el.dom);b.setEndPoint("EndToEnd",a);return b.text.length}else{return this.el.dom.selectionEnd}},getActiveRange:function(){var b=this.sep;var d=this.getCursorPosition();var a=this.getRawValue();var c=d;while(c>0&&a.charAt(c)!=b){--c}if(c>0){c++}return{left:c,right:d}},getActiveEntry:function(){var a=this.getActiveRange();return this.getRawValue().substring(a.left,a.right).replace(/^s+|s+$/g,"")},replaceActiveEntry:function(c){var b=this.getActiveRange();var a=this.getRawValue();if(this.preventDuplicates&&a.indexOf(c)>=0){return}var e=(this.sep==" "?"":" ");this.setValue(a.substring(0,b.left)+(b.left>0?e:"")+c+this.sep+e+a.substring(b.right));var d=b.left+c.length+2+e.length;this.selectText.defer(200,this,[d,d])},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=Ext.util.Format.htmlDecode(a.data[this.valueField||this.displayField]);if(this.sep){this.replaceActiveEntry(c)}else{this.setValue(c)}this.collapse();this.fireEvent("select",this,a,b)}},initQuery:function(){if(this.focused){this.doQuery(this.sep?this.getActiveEntry():this.getRawValue())}}});GO.form.UploadFile=function(a){if(!a.addText){a.addText=GO.lang.browse}this.inputs=new Ext.util.MixedCollection();GO.form.UploadFile.superclass.constructor.call(this,a);this.addEvents({fileAdded:true})};Ext.extend(GO.form.UploadFile,Ext.BoxComponent,{addText:"",cls:"",defaultAutoCreate:{tag:"div"},fileCls:"filetype",max:0,onRender:function(b,a){this.id=Ext.id();this.el=b.createChild({tag:"div",id:this.id,cls:this.cls});this.createButtons();this.createUploadInput()},createUploadInput:function(){if(!this.inputName){this.inputName=Ext.id()}var b=Ext.id();var a=this.inputWrap.createChild({tag:"input",type:"file",cls:"x-uf-input",size:0,id:b,name:this.inputName+"[]"});a.on("change",this.onFileAdded,this);this.inputs.add(a);return a},createButtons:function(){this.buttonsWrap=this.el.createChild({tag:"div",cls:"x-uf-buttons-ct",children:[{tag:"div",cls:"x-uf-input-ct",children:[{tag:"div",cls:"x-uf-bbtn-ct"},{tag:"div",cls:"x-uf-input-wrap"}]}]});this.inputWrap=this.buttonsWrap.select("div.x-uf-input-wrap").item(0);this.addBtnCt=this.buttonsWrap.select("div.x-uf-input-ct").item(0);var a=this.buttonsWrap.select("div.x-uf-bbtn-ct").item(0);this.browseBtn=new Ext.Button({renderTo:a,text:this.addText})},onFileAdded:function(b,a){this.inputs.each(function(c){c.setDisplayed(false)});if(!this.table){this.table=this.el.createChild({tag:"table",cls:"x-uf-table",children:[{tag:"tbody"}]});this.tbody=this.table.select("tbody").item(0);this.table.on({click:{scope:this,fn:this.onDeleteFile,delegate:"a"}})}var a=this.inputs.itemAt(this.inputs.getCount()-1);a.un("change",this.onFileAdded,this);this.appendRow(a);this.createUploadInput();if(this.max>0&&this.max<=this.inputs.getCount()){this.setDisabled(true)}this.fireEvent("filesChanged",this,this.inputs)},appendRow:function(c){var a=c.getValue();var d={id:c.id,fileCls:this.getFileCls(a),fileName:Ext.util.Format.ellipsis(a.split(/[\/\\]/).pop(),this.maxNameLength),fileQtip:a};var b=new Ext.Template(['<tr id="r-{id}">','<td class="x-unselectable">','<span class="filetype-link {fileCls}" unselectable="on" qtip="{fileQtip}">{fileName}</span>',"</td>",'<td id="m-{id}" class="x-uf-filedelete"><a id="d-{id}" href="#"><div class="go-icon btn-delete"></div></a>',"</td>","</tr>"]);c.row=b.append(this.tbody,d,true)},onDeleteFile:function(b,a){this.removeFile(a.id.substr(2))},removeFile:function(b){if(this.uploading){return}var a=this.inputs.get(b);if(a&&a.row){a.row.remove()}if(a){a.remove()}this.inputs.removeKey(b);this.setDisabled(false);this.fireEvent("filesChanged",this,this.inputs)},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop()}},clearQueue:function(){this.inputs.each(function(a){if(!a.isVisible()){this.removeFile(a.id,true)}},this)},setDisabled:function(a){if(a){this.addBtnCt.mask()}else{this.addBtnCt.unmask()}}});GO.form.PlainField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div",cls:"x-form-plainfield"},initComponent:function(){GO.form.PlainField.superclass.initComponent.call(this);if(this.boxLabel&&GO.util.empty(this.fieldLabel)){this.fieldLabel=this.boxLabel;this.hideLabel=false}this.addEvents("load")},getName:function(){return this.name},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setValue(this.el.dom.value)}}},getValue:function(){return this.value},setValue:function(a){if(this.boxLabel){if(a=="1"){a=GO.lang.cmdYes}else{a=GO.lang.cmdNo}}this.value=a;if(this.rendered){this.el.update(a)}}});Ext.reg("plainfield",GO.form.PlainField);GO.form.SelectUser=function(a){a=a||{};if(typeof(a.allowBlank)=="undefined"){a.allowBlank=false}Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","username"],remoteSort:true});this.store.setDefaultSort("name","asc");if(!this.hiddenName){this.hiddenName="user_id"}this.setRemoteValue(GO.settings.user_id,GO.settings.name);GO.form.SelectUser.superclass.constructor.call(this,{displayField:"name",value:GO.settings.user_id,valueField:"id",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectUser,GO.form.ComboBoxReset,{setRemoteValue:function(a,b){var c=this.findRecord("id",a);if(!c){var e=Ext.data.Record.create([{name:"id"},{name:"name"}]);var d=new e({id:a,name:b});this.store.add(d)}this.setValue(a)}});Ext.reg("selectuser",GO.form.SelectUser);GO.form.SelectGroup=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.groups.url+"non_admin_json.php",baseParams:{task:"groups"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","groupname"],remoteSort:true});this.store.setDefaultSort("name","asc");this.setRemoteValue(GO.settings.group_id,GO.settings.name);GO.form.SelectGroup.superclass.constructor.call(this,{displayField:"name",hiddenName:"group_id",value:GO.settings.group_id,valueField:"id",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectGroup,GO.form.ComboBox,{setRemoteValue:function(c,b){var d=Ext.data.Record.create([{name:"id"},{name:"name"}]);var a=new d({id:c,name:b});this.store.add(a);this.setValue(c)}});Ext.reg("selectgroup",GO.form.SelectGroup);GO.form.SelectCountry=function(b){if(!GO.countriesStore){var a=[];for(var d in GO.lang.countries){a.push([d,GO.lang.countries[d]])}GO.countriesStore=new Ext.data.SimpleStore({fields:["iso","name"],data:a,sortInfo:{field:"name",direction:"ASC"}})}Ext.apply(this,b);GO.form.SelectCountry.superclass.constructor.call(this,{store:GO.countriesStore,valueField:"iso",displayField:"name",triggerAction:"all",editable:true,mode:"local",selectOnFocus:true,forceSelection:true,emptyText:GO.lang.strNoCountrySelected})};Ext.extend(GO.form.SelectCountry,Ext.form.ComboBox);GO.addressFormatStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"select_address_format"},root:"results",totalProperty:"total",id:"iso",fields:["iso","address_format_id","country_name"],remoteSort:true});GO.addressFormatStore.setDefaultSort("country_name","ASC");GO.form.SelectAddressFormat=function(a){Ext.apply(this,a);this.store=GO.addressFormatStore;GO.form.SelectAddressFormat.superclass.constructor.call(this,{valueField:"iso",triggerAction:"all",selectOnFocus:true,forceSelection:true,editable:true,mode:"local",lazyInit:false})};Ext.extend(GO.form.SelectAddressFormat,GO.form.ComboBox,{afterRender:function(){if(!this.store.loaded){this.store.load({callback:function(){var a=this.getValue();if(a){this.setValue(a)}},scope:this})}GO.form.SelectAddressFormat.superclass.afterRender.call(this)}});Ext.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:false,autoSize:Ext.emptyFn,initComponent:function(){Ext.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1});var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.fileInput.on("change",function(){var d=this.fileInput.dom.value;this.setValue(d);this.fireEvent("fileselected",this,d)},this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},preFocus:Ext.emptyFn,getResizeEl:function(){return this.wrap},getPositionEl:function(){return this.wrap},alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.form.FileUploadField);GO.form.HtmlComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",html:this.html,cls:this.cls,style:this.style})}});Ext.reg("htmlcomponent",GO.form.HtmlComponent);GO.form.NumberField=Ext.extend(Ext.form.TextField,{decimals:2,initComponent:function(){GO.form.NumberField.superclass.initComponent.call(this);this.style="text-align:right";this.on("focus",function(a){this.fixPrecision();a.focus(true)})},beforeBlur:function(){this.fixPrecision()},fixPrecision:function(){var a=GO.util.unlocalizeNumber(this.getValue());this.setValue(GO.util.numberFormat(a,this.decimals))}});Ext.reg("numberfield",GO.form.NumberField);GO.grid.PermissionsPanel=Ext.extend(Ext.Panel,{changed:false,loaded:false,initComponent:function(){this.header=false;this.layout="anchor";this.border=false;this.anchor="100% 100%";this.disabled=true;this.aclGroupsStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"groups_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});this.aclGroupsStore.setDefaultSort("name","ASC");this.aclGroupsGrid=new GO.grid.GridPanel({anchor:"100% 50%",title:GO.lang.strAuthorizedGroups,store:this.aclGroupsStore,border:false,columns:[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddGroupsDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclGroupsGrid.deleteSelected()},scope:this}]});this.aclUsersStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"users_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});this.aclUsersStore.setDefaultSort("name","ASC");this.aclUsersGrid=new GO.grid.GridPanel({anchor:"100% 50%",title:GO.lang.strAuthorizedUsers,store:this.aclUsersStore,border:false,columns:[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true}],view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddUsersDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclUsersGrid.deleteSelected()},scope:this}]});this.items=[this.aclGroupsGrid,this.aclUsersGrid];GO.grid.PermissionsPanel.superclass.initComponent.call(this)},setAcl:function(a){this.acl_id=a?a:0;this.loaded=false;this.aclGroupsStore.baseParams.acl_id=a;this.aclUsersStore.baseParams.acl_id=a;this.setDisabled(a==0);if(this.isVisible()){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},onShow:function(){GO.grid.PermissionsPanel.superclass.onShow.call(this);if(!this.loaded){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},afterRender:function(){GO.grid.PermissionsPanel.superclass.afterRender.call(this);if(this.isVisible()&&!this.loaded){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},showAddGroupsDialog:function(){if(!this.addGroupsDialog){this.addGroupsDialog=new GO.dialog.SelectGroups({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclGroupsStore.baseParams.add_groups=Ext.encode(a.selModel.selections.keys);this.aclGroupsStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclGroupsStore.baseParams.add_groups}},scope:this})}this.addGroupsDialog.show()},showAddUsersDialog:function(){if(!this.addUsersDialog){this.addUsersDialog=new GO.dialog.SelectUsers({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclUsersStore.baseParams.add_users=Ext.encode(a.selModel.selections.keys);this.aclUsersStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclUsersStore.baseParams.add_users}},scope:this})}this.addUsersDialog.show()}});GO.ModuleManager=Ext.extend(function(){this.addEvents({moduleReady:true,moduleconstructed:true});this.resumeEvents()},Ext.util.Observable,{modules:{},modulePanels:{},panelConfigs:{},sortOrder:Array(),adminModulePanels:{},adminPanelConfigs:{},adminSortOrder:Array(),settingsPanels:{},settingsPanelConfigs:{},settingsSortOrder:Array(),readyFunctions:{},addSettingsPanel:function(b,a,c){this.settingsPanels[b]=a;this.settingsPanelConfigs[b]=c;this.settingsSortOrder.push(b)},getSettingsPanel:function(a){if(this.settingsPanels[a]){return new this.settingsPanels[a](this.settingsPanelConfigs[a])}else{return false}},getAllSettingsPanels:function(){var a=[];for(var b=0;b<this.settingsSortOrder.length;b++){a.push(this.getSettingsPanel(this.settingsSortOrder[b]))}return a},addModule:function(b,a,c){this.modules[b]=true;if(a){c.moduleName=b;c.id="go-module-panel-"+c.moduleName;this.modulePanels[b]=a;this.panelConfigs[b]=c;this.sortOrder.push(b)}this.onAddModule(b)},onAddModule:function(a){if(this.readyFunctions[a]){for(var b=0;b<this.readyFunctions[a].length;b++){var d=this.readyFunctions[a][b];d.fn.call(d.fn.scope,a,this)}}},onModuleReady:function(a,c,b){b=b||window;if(!this.modules[a]){this.readyFunctions[a]=this.readyFunctions[a]||[];this.readyFunctions[a].push({fn:c,scope:b})}else{c.call(b,a,this)}},getPanel:function(a){if(this.modulePanels[a]){var b=new this.modulePanels[a](this.panelConfigs[a]);this.fireEvent("moduleconstructed",this,a,b);return b}else{return false}},getAllPanels:function(){var a=[];for(var b=0;b<this.sortOrder.length;b++){a.push(this.getPanel(this.sortOrder[b]))}return a},getAllPanelConfigs:function(){var b=[];for(var a=0;a<this.sortOrder.length;a++){b.push(this.panelConfigs[this.sortOrder[a]])}return b}});GO.moduleManager=new GO.ModuleManager();GO.NewMenuButton=Ext.extend(Ext.Button,{initComponent:function(){this.menu=new Ext.menu.Menu({items:GO.newMenuItems});this.text=GO.lang.cmdNew;this.iconCls="btn-add";this.disabled=true;this.hidden=GO.newMenuItems.length==0;GO.NewMenuButton.superclass.initComponent.call(this)},setLinkConfig:function(a){this.menu.link_config=a;this.menu.link_config.type_id=a.type+":"+a.id;if(!this.menu.link_config.scope){this.menu.link_config.scope=this}if(this.menu.link_config.callback){this.menu.link_config.callback=this.menu.link_config.callback.createDelegate(this.menu.link_config.scope)}this.setDisabled(false)}});GO.LinkFolderWindow=function(a){if(!a){a={}}var b=function(){this.newFolderNameField.focus(true)};this.newFolderNameField=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name",value:GO.lang.newFolder,allowBlank:false,anchor:"100%"});this.formPanel=new Ext.form.FormPanel({defaultType:"textfield",labelWidth:75,cls:"go-form-panel",waitMsgTarget:true,items:this.newFolderNameField,autoHeight:true,baseParams:{task:"link_folder",folder_id:0}});a.layout="fit";a.modal=false;a.resizable=false;a.width=400;a.autHeight=true;a.closeAction="hide";a.title=GO.lang.newFolder;a.items=this.formPanel;a.focus=b.createDelegate(this);a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.LinkFolderWindow.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.LinkFolderWindow,Ext.Window,{show:function(a){if(!this.rendered){this.render(Ext.getBody())}if(!a.folder_id){a.folder_id=0}this.link_id=a.link_id?a.link_id:0;this.link_type=a.link_type?a.link_type:0;this.parent_id=a.parent_id?a.parent_id:0;this.setLinkFolderId(a.folder_id);if(this.folder_id>0){this.formPanel.load({url:BaseHref+"json.php",success:function(b,c){this.setLinkFolderId(c.result.data.id);this.link_id=c.result.data.link_id;this.link_type=c.result.data.link_type;this.parent_id=c.result.data.parent_id;GO.LinkFolderWindow.superclass.show.call(this)},failure:function(b,c){Ext.Msg.alert(GO.lang.strError,c.result.feedback)},scope:this})}else{this.formPanel.form.reset();GO.LinkFolderWindow.superclass.show.call(this)}},setLinkFolderId:function(a){if(!a){a=0}this.formPanel.form.baseParams.folder_id=a;this.folder_id=a},submitForm:function(a){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_link_folder",link_id:this.link_id,link_type:this.link_type,parent_id:this.parent_id},waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.fireEvent("save",this);if(a){this.hide()}else{if(c.result.folder_id){this.setLinkFolderId(c.result.folder_id)}}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})}});GO.form.SelectLink=function(a){a=a||{};a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{query:"",task:"links"},root:"results",totalProperty:"total",fields:["link_id","link_type","link_and_type","type_name"],remoteSort:true});a.forceSelection=true;a.displayField="type_name";a.valueField="link_and_type",a.hiddenName="link";a.triggerAction="all";a.width=400;a.selectOnFocus=false;a.fieldLabel=GO.lang.cmdLink;a.pageSize=parseInt(GO.settings.max_rows_list);GO.form.SelectLink.superclass.constructor.call(this,a)};Ext.extend(GO.form.SelectLink,GO.form.ComboBox);GO.LinksTree=function(a){if(!a){a={}}a.title=GO.lang.folders;a.layout="fit";a.split=true;a.autoScroll=true;a.width=200;a.animate=true;a.loader=new Ext.tree.TreeLoader({dataUrl:BaseHref+"json.php",baseParams:{task:"link_folders_tree",link_type:0,link_id:0},preloadChildren:true});a.collapsed=a.treeCollapsed;a.containerScroll=true;a.rootVisible=true;a.collapsible=true;a.ddAppendOnly=true;a.containerScroll=true;a.ddGroup="LinksDD";a.enableDD=true;GO.LinksTree.superclass.constructor.call(this,a);this.rootNode=new Ext.tree.AsyncTreeNode({text:GO.lang.root,draggable:false,iconCls:"folder-default",expanded:false});this.setRootNode(this.rootNode)};Ext.extend(GO.LinksTree,Ext.tree.TreePanel,{loadLinks:function(a,b){this.loader.baseParams.link_id=a;this.loader.baseParams.link_type=b;if(this.rootNode.isExpanded()){this.rootNode.reload()}else{this.rootNode.expand()}}});GO.grid.LinksGrid=function(a){var b;if(!a){a={}}if(!a.link_id){a.link_id=0}if(!a.link_type){a.link_type=0}if(!a.folder_id){a.folder_id=0}a.hideMode="offsets";a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls","link_description"],remoteSort:true});a.store.setDefaultSort("mtime","desc");if(!a.noSearchField){this.searchField=new GO.form.SearchField({store:a.store,width:320});a.tbar=[GO.lang.strSearch+": "," ",this.searchField]}a.clicksToEdit=1;a.enableDragDrop=true;a.ddGroup="LinksDD";a.columns=[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(d,e,c){return'<div class="go-grid-icon '+c.data.iconCls+'">'+d+"</div>"}},{header:GO.lang.strDescription,dataIndex:"link_description",sortable:true,editor:new GO.form.LinkDescriptionField()},{header:GO.lang.strType,dataIndex:"type",sortable:true,hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:80}];a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems});a.layout="fit";a.view=new Ext.grid.GridView({enableRowBody:true,showPreview:true,autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems,getRowClass:function(c,f,e,d){if(this.showPreview&&c.data.description.length){e.body='<div class="go-links-panel-description">'+c.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}});a.loadMask={msg:GO.lang.waitMsgLoad};a.sm=new Ext.grid.RowSelectionModel({});GO.grid.LinksGrid.superclass.constructor.call(this,a);this.addEvents({folderOpened:true,folderDrop:true})};Ext.extend(GO.grid.LinksGrid,Ext.grid.EditorGridPanel,{write_permission:false,afterRender:function(){GO.grid.LinksGrid.superclass.afterRender.call(this);var a=new Ext.dd.DropTarget(this.getView().mainBody,{ddGroup:"LinksDD",copy:false,notifyOver:this.onGridNotifyOver,notifyDrop:this.onGridNotifyDrop.createDelegate(this)});this.on("afteredit",function(b){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"updatelink",link_id1:this.store.baseParams.link_id,link_type1:this.store.baseParams.link_type,link_id2:b.record.get("id"),link_type2:b.record.get("link_type"),description:b.record.get("link_description")},success:function(c,d){var e=Ext.decode(c.responseText);if(!e.success){alert(e.feedback)}else{this.store.commitChanges()}},scope:this})},this)},deleteSelected:function(b){if(!b){b=this.deleteConfig}if(!b.deleteParam){b.deleteParam="delete_keys"}var c=this.selModel.selections.keys;var d={};d[b.deleteParam]=Ext.encode(this.selModel.selections.keys);var a={store:this.store,params:d,count:this.selModel.selections.keys.length};if(b.callback){a.callback=b.callback}if(b.success){a.success=b.success}if(b.failure){a.failure=b.failure}if(b.scope){a.scope=b.scope}GO.deleteItems(a)},onGridNotifyOver:function(a,f,c){var d=a.getDragData(f);if(c.grid&&this.write_permission){var b=c.grid.store.data.items[d.rowIndex];if(b){if(b.data.link_type=="folder"){return this.dropAllowed}}}return false},onGridNotifyDrop:function(a,g,d){if(d.grid&&this.write_permission){var h=d.grid.getSelectionModel();var c=h.getSelections();var f=a.getDragData(g);var b=d.grid.store.data.items[f.rowIndex];if(b.data.link_type=="folder"){this.fireEvent("folderDrop",this,d.selections,b)}}else{return false}},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.dialog.LinksDialog=function(a){Ext.apply(this,a);this.grid=new GO.grid.SearchPanel({noTitle:true,noOpenLinks:true});this.grid.searchGrid.on("rowdblclick",this.linkItems,this);var b=function(){this.grid.searchField.focus(true)};GO.dialog.LinksDialog.superclass.constructor.call(this,{layout:"fit",focus:b.createDelegate(this),modal:false,minWidth:300,minHeight:300,height:500,width:700,border:false,plain:true,closeAction:"hide",title:GO.lang.strLinkItems,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.linkItems()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({link:true})};Ext.extend(GO.dialog.LinksDialog,Ext.Window,{folder_id:0,setLinkRecords:function(b){this.fromLinks=[];for(var a=0;a<b.length;a++){this.fromLinks.push({link_id:b[a].data.link_id,link_type:b[a].data.link_type})}},setSingleLink:function(a,b){this.fromLinks=[{link_id:a,link_type:b}]},linkItems:function(){var a=this.grid.searchGrid.getSelectionModel();var c=a.getSelections();var b=[];for(var d=0;d<c.length;d++){b.push({link_id:c[d].data.id,link_type:c[d].data.link_type})}Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"link",fromLinks:Ext.encode(this.fromLinks),toLinks:Ext.encode(b),description:this.grid.linkDescriptionField.getValue(),folder_id:this.folder_id},callback:function(f,g,e){if(!g){Ext.MessageBox.alert(GO.lang.strError,e.result.errors)}else{this.fireEvent("link");this.grid.searchGrid.getSelectionModel().clearSelections();this.hide()}},scope:this})}});GO.grid.LinksPanel=function(a){if(!a){a={}}if(!this.link_id){this.link_id=0}if(!this.link_type){this.link_type=0}if(!this.folder_id){this.folder_id=0}this.linksDialog=new GO.dialog.LinksDialog({linksStore:a.store});this.linksDialog.on("link",function(){this.linksGrid.store.reload()},this);this.linksTree=new GO.LinksTree({region:"west",split:true,title:GO.lang.folders});this.linksTree.on("click",function(b){this.setFolder(b.id.substr(10))},this);this.linksTree.on("contextmenu",function(d,g){g.stopEvent();var c=this.linksTree.getSelectionModel();if(!c.isSelected(d)){c.clearSelections();c.select(d)}var b=d.id.substr(10);if(b!=""){var f=g.getXY();this.linksContextMenu.showAt([f[0],f[1]],["folder:"+b],"folder")}},this);this.linksTree.on("beforenodedrop",function(h){if(!this.write_permission){return false}var g={folder_id:h.target.id.substr(10),link_id:this.link_id,link_type:this.link_type};var c=[];if(h.data.selections){for(var b=0;b<h.data.selections.length;b++){if(h.data.selections[b].data.link_and_type.substr(0,6)=="folder"){var j=h.data.selections[b].data.link_and_type.substr(7);var d=this.linksTree.getNodeById("lt-folder-"+j);var f=this.linksTree.getNodeById("lt-folder-"+g.folder_id);f.appendChild(d)}c.push(h.data.selections[b].data.link_and_type)}}else{c=["folder:"+h.data.node.id.substr(10)]}this.moveSelections(c,g)},this);this.linksGrid=new GO.grid.LinksGrid({region:"center",deleteConfig:{scope:this,success:function(){var b=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b){b.reload()}else{this.linksTree.getRootNode().reload()}}}});this.linksGrid.store.on("load",function(){var c=this.linksTree.getSelectionModel();var b=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b){c.select(b)}},this);this.linksGrid.on("folderDrop",function(d,e,b){var g={folder_id:b.data.id,link_id:this.link_id,link_type:this.link_type};var f=[];for(var c=0;c<e.length;c++){f.push(e[c].data.link_and_type)}this.moveSelections(f,g)},this);this.linksGrid.on("rowcontextmenu",function(b,g,d){d.stopEvent();var f=b.getSelectionModel();if(f.isSelected(g)!==true){f.clearSelections();f.selectRow(g)}var c=d.getXY();this.linksContextMenu.showAt([c[0],c[1]],f.selections.keys)},this);this.linksGrid.store.on("load",function(){this.setWritePermission(this.linksGrid.store.reader.jsonData.write_permission)},this);this.folderWindow=new GO.LinkFolderWindow();this.folderWindow.on("save",function(){this.linksGrid.store.reload();var b=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b){delete b.attributes.children;b.reload()}else{this.linksTree.rootNode.reload()}},this);a.items=[this.linksTree,this.linksGrid];this.linksContextMenu=new GO.LinksContextMenu();this.linksContextMenu.on("properties",function(e,c){var d=c[0].indexOf(":");var b=c[0].substr(d+1);this.folderWindow.show({folder_id:b})},this);this.linksContextMenu.on("delete",function(d,b){if(b.indexOf("folder:"+this.folder_id)>-1){this.setFolder(0,true)}var c={store:this.linksGrid.store,params:{delete_keys:Ext.encode(b)},count:b.length,callback:function(){var h,e,f;for(var g=0;g<b.length;g++){h=b[g].indexOf(":");e=b[g].substr(h+1);f=this.linksTree.getNodeById("lt-folder-"+e);if(f){f.remove()}}},scope:this};GO.deleteItems(c)},this);this.linksContextMenu.on("unlink",function(c,b){this.unlinkSelected()},this);a.layout="border";a.border=false;a.hideMode="offsets";a.tbar=[this.linkButton=new Ext.Button({iconCls:"btn-link",text:GO.lang.cmdLink,cls:"x-btn-text-icon",handler:function(){this.linksDialog.show()},scope:this}),this.unlinkButton=new Ext.Button({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.unlinkSelected()},scope:this}),this.newFolderButton=new Ext.Button({id:"unlink",iconCls:"btn-add",text:GO.lang.newFolder,cls:"x-btn-text-icon",handler:function(){this.folderWindow.show({link_id:this.link_id,link_type:this.link_type,parent_id:this.folder_id})},scope:this}),this.deleteButton=new Ext.Button({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.linksGrid.deleteSelected()},scope:this})];if(GO.links&&GO.links.LinkDescriptionsGrid){a.tbar.push("-");a.tbar.push({text:GO.links.lang.linkDescriptions,scope:this,iconCls:"btn-settings",handler:function(){if(!this.settingsWindow){this.settingsWindow=new GO.Window({height:400,width:300,layout:"fit",title:GO.links.lang.linkDescriptions,closeAction:"hide",items:new GO.links.LinkDescriptionsGrid(),buttons:[{text:GO.lang.cmdClose,handler:function(){this.settingsWindow.hide()},scope:this}]})}this.settingsWindow.show()}})}this.linksGrid.on("rowdblclick",this.rowDoulbleClicked,this);GO.grid.LinksPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.LinksPanel,Ext.Panel,{afterRender:function(){GO.grid.LinksPanel.superclass.afterRender.call(this);this.on("rowdblclick",this.rowDoulbleClicked,this);if(this.isVisible()){this.onShow()}},unlinkSelected:function(){var a=this.linksGrid.getSelectionModel();var b=a.getSelections();if(b.length>0){this.linksGrid.store.baseParams.unlinks=Ext.encode(a.selections.keys);this.linksGrid.store.reload();delete this.linksGrid.store.baseParams.unlinks}},moveSelections:function(a,b){Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"move_links",selections:Ext.encode(a),target:Ext.encode(b)},callback:function(e,h,d){if(!h){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(d.responseText);if(g.moved_links){for(var f=0;f<g.moved_links.length;f++){var c=this.linksGrid.store.getById(g.moved_links[f]);if(c){this.linksGrid.store.remove(c)}}}}},scope:this})},rowDoulbleClicked:function(c,d,f){var a=c.getSelectionModel();var b=a.getSelected();if(b.data.link_type=="folder"){this.setFolder(b.data.id)}else{if(GO.linkHandlers[b.data.link_type]){GO.linkHandlers[b.data.link_type].call(this,b.data.id)}else{Ext.Msg.alert(GO.lang.strError,"No handler definded for link type: "+b.data.link_type)}}},onShow:function(){GO.grid.LinksPanel.superclass.onShow.call(this);if(!this.loaded&&this.link_id>0){this.linksGrid.store.load();var a=this.linksTree.getRootNode();if(a.isExpanded()){a.reload()}else{a.expand()}this.loaded=true}},setWritePermission:function(a){this.linkButton.setDisabled(!a);this.unlinkButton.setDisabled(!a);this.newFolderButton.setDisabled(!a);this.deleteButton.setDisabled(!a);this.write_permission=a;this.linksGrid.write_permission=a},setFolder:function(a,b){var c=this.linksTree.getNodeById("lt-folder-"+a);if(c){c.expand()}this.linksDialog.folder_id=a;this.folder_id=a;this.linksGrid.store.baseParams.folder_id=a;if(!b){this.linksGrid.store.load()}},loadLinks:function(b,c,a){if(b>0){this.setDisabled(false)}else{this.setDisabled(true)}if(this.link_id!=b||this.link_type!=c){this.link_id=this.linksGrid.store.baseParams.link_id=b;this.link_type=this.linksGrid.store.baseParams.link_type=c;this.linksGrid.store.baseParams.folder_id=a;this.linksTree.loadLinks(b,c);this.linksDialog.setSingleLink(this.link_id,this.link_type);this.loaded=false}}});GO.linksTemplate='<tpl if="links.length"><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="4" class="display-panel-heading">'+GO.lang.latestLinks+'</td></tr><tr><td style="width:16px" class="display-panel-links-header">&nbsp;</td><td style="width: 100%" class="table_header_links">'+GO.lang.strName+'</td><td class="table_header_links" style="white-space:nowrap">'+GO.lang.strMtime+'</td></tr><tpl for="links"><tr><td><div class="go-icon {iconCls}" ext:qtip="{type}"></div></td><td><a href="#link_{[xindex-1]}">{name}</a><tpl if="link_description.length"><br />{link_description}</tpl></td><td style="white-space:nowrap">{mtime}</td></tr><tpl if="description.length"><tr class="display-panel-link-description"><td>&nbsp;</td><td colspan="3">{description}</td></tr></tpl></tpl></tpl>';GO.linksTemplateConfig={};GO.LinksContextMenu=function(a){if(!a){a={}}a.shadow="frame";a.minWidth=180;this.deleteButton=new Ext.menu.Item({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.fireEvent("delete",this,this.selected)},scope:this});this.unlinkButton=new Ext.menu.Item({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.fireEvent("unlink",this,this.selected)},scope:this});this.propertiesButton=new Ext.menu.Item({iconCls:"btn-properties",text:GO.lang.strProperties,handler:function(){this.fireEvent("properties",this,this.selected)},scope:this});a.items=[this.propertiesButton,this.deleteButton,this.unlinkButton];GO.LinksContextMenu.superclass.constructor.call(this,a);this.addEvents({properties:true,unlink:true,"delete":true})};Ext.extend(GO.LinksContextMenu,Ext.menu.Menu,{clickedAt:"grid",showAt:function(d,a){this.link_type=c;this.selected=a;if(this.selected.length>1){c="mixed"}else{var b=a[0].indexOf(":");var c=a[0].substr(0,b)}switch(c){case"folder":this.propertiesButton.show();this.unlinkButton.hide();break;default:this.propertiesButton.hide();this.unlinkButton.show();break}GO.LinksContextMenu.superclass.showAt.call(this,d)}});GO.LinkBrowser=function(a){Ext.apply(this,a);this.linksPanel=new GO.grid.LinksPanel();GO.LinkBrowser.superclass.constructor.call(this,{layout:"fit",modal:false,minWidth:300,minHeight:300,height:500,width:750,border:false,plain:true,maximizable:true,collapsible:true,closeAction:"hide",title:GO.lang.cmdBrowseLinks,items:this.linksPanel,buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({link:true})};Ext.extend(GO.LinkBrowser,Ext.Window,{show:function(a){this.linksPanel.loadLinks(a.link_id,a.link_type);if(a.folder_id){this.linksPanel.setFolder(a.folder_id)}GO.LinkBrowser.superclass.show.call(this)}});GO.mainLayout.onReady(function(){GO.linkBrowser=new GO.LinkBrowser()});GO.LinkViewWindow=function(a){if(!a){a={}}a.collapsible=true;a.maximizable=true;a.layout="fit";a.modal=false;a.resizable=true;if(!a.width){a.width=500}if(!a.height){a.height=500}a.buttons=[{text:GO.lang.cmdClose,handler:function(){this.close()},scope:this}];GO.LinkViewWindow.superclass.constructor.call(this,a);this.render(Ext.getBody())};Ext.extend(GO.LinkViewWindow,Ext.Window);GO.linkTypeStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"link_types"},root:"results",totalProperty:"total",id:"id",fields:["id","name","checked"],remoteSort:true});GO.LinkTypeFilterPanel=function(b){if(!b){b={}}b.autoScroll=true;var c=new GO.grid.CheckColumn({header:"&nbsp;",dataIndex:"checked",width:30});b.title=GO.lang.strType;this.filterGrid=new GO.grid.GridPanel({cls:"go-grid3-hide-headers",autoHeight:true,border:false,loadMask:true,store:GO.linkTypeStore,columns:[c,{header:GO.lang.strName,dataIndex:"name"}],plugins:[c],autoExpandColumn:1});var a=new Ext.Button({text:GO.lang.cmdApply,handler:function(){var e=[];for(var d=0;d<this.filterGrid.store.data.items.length;d++){var f=this.filterGrid.store.data.items[d].get("checked");if(f=="1"){e.push(this.filterGrid.store.data.items[d].get("id"))}}this.fireEvent("change",this,e);this.filterGrid.store.commitChanges()},scope:this});b.items=[this.filterGrid,new Ext.Panel({border:false,cls:"go-form-panel",items:[new GO.form.HtmlComponent({html:"<br />"}),a]})];GO.LinkTypeFilterPanel.superclass.constructor.call(this,b);this.addEvents({change:true})};Ext.extend(GO.LinkTypeFilterPanel,Ext.Panel);GO.form.LinkDescriptionField=Ext.extend(function(a){a=a||{};a.store=new GO.data.JsonStore({url:GO.settings.config.host+"json.php",baseParams:{task:"link_descriptions"},root:"results",id:"id",totalProperty:"total",fields:["id","description"],remoteSort:true});a.displayField="description";a.triggerAction="all";a.selectOnFocus=false;a.pageSize=parseInt(GO.settings.max_rows_list);GO.form.LinkDescriptionField.superclass.constructor.call(this,a)},GO.form.ComboBoxReset,{hiddenName:"description",maxLength:100});GO.LinksAccordion=Ext.extend(Ext.Panel,{link_id:0,link_type:0,title:GO.lang.strLinks,disabled:true,initComponent:function(){this.layout="accordion";this.items=[];if(GO.calendar){var a=new GO.grid.LinksGrid({title:GO.calendar.lang.appointments,noSearchField:true});a.store.baseParams.types=Ext.encode([1]);this.items.push(a)}if(GO.tasks){var b=new GO.grid.LinksGrid({title:GO.tasks.lang.tasks,noSearchField:true});b.store.baseParams.types=Ext.encode([12]);this.items.push(b)}if(GO.notes){var d=new GO.grid.LinksGrid({title:GO.notes.lang.notes,noSearchField:true});d.store.baseParams.types=Ext.encode([4]);this.items.push(d)}var e;for(var c=0;c<this.items.length;c++){e=this.items[c];e.store.baseParams.no_filter_save=true;e.on("expand",function(){if(!e.store.loaded){e.store.load()}},this)}this.on("show",this.loadActivePanel,this);GO.LinksAccordion.superclass.initComponent.call(this)},setLinkID:function(a,b){this.setDisabled(GO.util.empty(a));this.link_id=a;this.items.each(function(c){c.store.loaded=false;c.store.baseParams.link_id=a;c.store.baseParams.link_type=b;c.store.baseParams.type_filter=true});if(this.isVisible()){this.loadActivePanel()}},loadActivePanel:function(){var a=this.layout.activeItem;if(!a.store.loaded){a.store.load()}}});GO.grid.SearchPanel=function(a){a=a||{};if(!this.query){this.query=""}a.border=false;if(!a.noTitle){a.title=GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.query)+'"'}a.closable=true;a.iconCls="go-search-icon-tab";a.layout="border";this.filterPanel=new GO.LinkTypeFilterPanel({region:"west",collapsible:true,split:true,border:true,width:120});this.filterPanel.on("change",function(d,c){this.searchGrid.store.baseParams.types=Ext.encode(c);this.searchGrid.store.load();delete this.searchGrid.store.baseParams.types},this);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id,type_filter:"true"},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls"],remoteSort:true});this.searchField=new GO.form.SearchField({store:this.store,width:320});var b={border:true,region:"center",tbar:[GO.lang.strSearch+": "," ",this.searchField,"-",{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.searchGrid.deleteSelected()},scope:this}],store:this.store,columns:[{id:"name",header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(d,e,c){return'<div class="go-grid-icon '+c.data.iconCls+'">'+d+"</div>"}},{header:GO.lang.strType,dataIndex:"type",sortable:true,width:100},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:100}],autoExpandMax:2500,autoExpandColumn:"name",paging:true,layout:"fit",view:new Ext.grid.GridView({enableRowBody:true,showPreview:true,emptyText:GO.lang.strNoItems,getRowClass:function(c,f,e,d){if(this.showPreview&&c.data.description.length){e.body='<div class="go-links-panel-description">'+c.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({})};this.searchGrid=new GO.grid.GridPanel(b);this.searchGrid.store.setDefaultSort("mtime","desc");if(!a.noTitle){this.searchGrid.store.on("load",function(){this.setTitle(GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.searchGrid.store.baseParams.query)+'"')},this)}if(!a.noOpenLinks){this.searchGrid.on("rowdblclick",function(f,g,h){var c=f.getSelectionModel();var d=c.getSelected();if(GO.linkHandlers[d.data.link_type]){GO.linkHandlers[d.data.link_type].call(this,d.data.id,d)}else{Ext.Msg.alert(GO.lang.strError,"No handler definded for link type: "+d.data.link_type)}},this)}a.items=[this.filterPanel,this.searchGrid];if(a.noOpenLinks){a.items.push({region:"south",height:34,layout:"form",cls:"go-form-panel",split:true,items:this.linkDescriptionField=new GO.form.LinkDescriptionField({name:"description",fieldLabel:GO.lang.strDescription,anchor:"100%"})})}GO.grid.SearchPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.SearchPanel,Ext.Panel,{afterRender:function(){GO.grid.SearchPanel.superclass.afterRender.call(this);this.load()},load:function(){if(!GO.linkTypeStore.loaded){GO.linkTypeStore.load({scope:this,callback:function(){this.load()}})}else{this.searchField.setValue(this.query);this.searchGrid.store.baseParams.query=this.query;this.searchGrid.store.load()}},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.CheckerWindow=function(b){if(!b){b={}}b.title=GO.lang.reminders;b.maximizable=true;b.layout="fit";b.modal=false;b.resizable=true;b.closeAction="hide";if(!b.width){b.width=400}if(!b.height){b.height=500}b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];var a=new Ext.menu.Menu({items:[{text:"5 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"10 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"20 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"30 "+GO.lang.strMinutes,handler:function(){this.doTask("snooze_reminders",1800)},scope:this},{text:"1 "+GO.lang.strHour,handler:function(){this.doTask("snooze_reminders",3600)},scope:this},{text:"2 "+GO.lang.strHours,handler:function(){this.doTask("snooze_reminders",7200)},scope:this},{text:"3 "+GO.lang.strHours,handler:function(){this.doTask("snooze_reminders",10800)},scope:this},{text:"1 "+GO.lang.strDay,handler:function(){this.doTask("snooze_reminders",86400)},scope:this},{text:"2 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",2*86400)},scope:this},{text:"3 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",3*86400)},scope:this},{text:"4 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",4*86400)},scope:this},{text:"5 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",5*86400)},scope:this},{text:"6 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",6*86400)},scope:this},{text:"7 "+GO.lang.strDays,handler:function(){this.doTask("snooze_reminders",7*86400)},scope:this}]});b.tbar=[{iconCls:"btn-delete",text:GO.lang.dismiss,handler:function(){this.doTask("dismiss_reminders")},scope:this},{iconCls:"btn-dismiss",text:GO.lang.snooze,menu:a},"-",{iconCls:"btn-select-all",text:GO.lang.selectAll,handler:function(){this.checkerGrid.getSelectionModel().selectAll()},scope:this}];this.checkerGrid=new GO.CheckerPanel();b.items=this.checkerGrid;GO.CheckerWindow.superclass.constructor.call(this,b);this.addEvents({changed:true})};Ext.extend(GO.CheckerWindow,Ext.Window,{doTask:function(a,e){var d=this.checkerGrid.selModel.getSelections();if(!d.length){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noItemSelected)}else{var b=[];for(var c=0;c<d.length;c++){b.push(d[c].get("id"))}Ext.Ajax.request({url:BaseHref+"action.php",params:{task:a,snooze_time:e,reminders:Ext.encode(b)},callback:function(){for(var f=0;f<d.length;f++){this.checkerGrid.store.remove(d[f])}if(!this.checkerGrid.store.getRange().length){this.hide()}},scope:this})}}});GO.CheckerPanel=Ext.extend(function(a){if(!a){a={}}a.layout="fit";a.id="go-checker-panel";a.store=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({totalProperty:"count",root:"results",id:"id",fields:["id","name","description","link_id","link_type","link_type_name","local_time","iconCls","time"]}),groupField:"link_type_name",sortInfo:{field:"time",direction:"ASC"}});a.cm=new Ext.grid.ColumnModel([{dataIndex:"link_type_name",hideable:false},{header:"",width:28,dataIndex:"icon",renderer:this.iconRenderer,hideable:false},{header:GO.lang.strTime,dataIndex:"local_time",width:50},{header:GO.lang.strName,dataIndex:"name"}]);a.view=new Ext.grid.GroupingView({hideGroupedColumn:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "Items" : "Item"]})',emptyText:GO.lang.strNoItems,showGroupName:false});a.selModel=new Ext.grid.RowSelectionModel();a.loadMask=true;a.autoExpandColumn=3;GO.grid.GridPanel.superclass.constructor.call(this,a);this.on("rowdblclick",function(e,d){var b=e.getSelectionModel();var c=b.getSelected();if(GO.linkHandlers[c.data.link_type]){GO.linkHandlers[c.data.link_type].call(this,c.data.link_id)}else{Ext.Msg.alert(GO.lang.strError,"No handler definded for link type: "+c.data.link_type)}},this)},GO.grid.GridPanel,{iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.Checker=function(){this.addEvents({alert:true,startcheck:true,endcheck:true});this.checkerWindow=new GO.CheckerWindow();this.reminderIcon=Ext.get("reminder-icon");this.reminderIcon.setDisplayed(false);this.reminderIcon.on("click",function(){this.checkerWindow.show()},this)};Ext.extend(GO.Checker,Ext.util.Observable,{interval:300000,init:function(){if(this.checkerWindow.isVisible()){this.init.defer(this.interval,this)}else{this.fireEvent("startcheck",this);Ext.Ajax.request({url:BaseHref+"json.php",params:{task:"checker"},callback:function(b,d,a){if(!d){}else{var c=Ext.decode(a.responseText);if(c){this.fireEvent("alert",c);if(c.reminders){this.checkerWindow.checkerGrid.store.loadData({results:c.reminders});if(!this.reminderIcon.isDisplayed()){GO.playAlarm();this.checkerWindow.show();this.reminderIcon.setDisplayed(true)}}else{this.reminderIcon.setDisplayed(false)}}}this.fireEvent("endcheck",this);this.init.defer(this.interval,this)},scope:this})}}});