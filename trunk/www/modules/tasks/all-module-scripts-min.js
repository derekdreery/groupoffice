GO.tasks.TasklistDialog=function(A){if(!A){A={}}this.propertiesTab=new Ext.Panel({title:GO.lang.strProperties,layout:"form",anchor:"100% 100%",defaults:{anchor:"100%"},defaultType:"textfield",autoHeight:true,cls:"go-form-panel",labelWidth:75,items:[this.selectUser=new GO.form.SelectUser({fieldLabel:GO.lang.strUser,disabled:!GO.settings.modules.email["write_permission"],value:GO.settings.user_id}),{fieldLabel:GO.lang.strName,name:"name",allowBlank:false}]});this.readPermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strReadPermissions});this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions});this.formPanel=new Ext.form.FormPanel({url:GO.settings.modules.tasks.url+"action.php",defaultType:"textfield",border:false,items:[{hideLabel:true,deferredRender:false,xtype:"tabpanel",activeTab:0,border:false,anchor:"100% 100%",items:[this.propertiesTab,this.readPermissionsTab,this.writePermissionsTab]}]});GO.tasks.TasklistDialog.superclass.constructor.call(this,{title:GO.tasks.lang.tasklist,layout:"fit",modal:false,height:500,width:400,items:this.formPanel,buttons:[{text:GO.lang.cmdOk,handler:function(){this.save(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.save(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.tasks.TasklistDialog,Ext.Window,{initComponent:function(){this.addEvents({save:true});GO.tasks.TasklistDialog.superclass.initComponent.call(this)},show:function(A){if(!this.rendered){this.render(Ext.getBody())}if(A>0){if(A!=this.tasklist_id){this.loadTasklist(A)}}else{this.tasklist_id=0;this.formPanel.form.reset();this.propertiesTab.show();this.readPermissionsTab.setDisabled(true);this.writePermissionsTab.setDisabled(true);GO.tasks.TasklistDialog.superclass.show.call(this)}},loadTasklist:function(A){this.formPanel.form.load({url:GO.settings.modules.tasks.url+"json.php",params:{tasklist_id:A,task:"tasklist"},success:function(B,C){this.tasklist_id=A;this.selectUser.setRemoteText(C.result.data.user_name);this.readPermissionsTab.setAcl(C.result.data.acl_read);this.writePermissionsTab.setAcl(C.result.data.acl_write);GO.tasks.TasklistDialog.superclass.show.call(this)},failure:function(B,C){Ext.Msg.alert(GO.lang.strError,C.result.feedback)},scope:this})},save:function(A){this.formPanel.form.submit({url:GO.settings.modules.tasks.url+"action.php",params:{task:"save_tasklist",tasklist_id:this.tasklist_id},waitMsg:GO.lang.waitMsgSave,success:function(B,C){if(C.result.tasklist_id){this.tasklist_id=C.result.tasklist_id;this.readPermissionsTab.setAcl(C.result.acl_read);this.writePermissionsTab.setAcl(C.result.acl_write)}this.fireEvent("save");if(A){this.hide()}},failure:function(C,D){var B="";if(D.failureType=="client"){B=GO.lang.strErrorsInForm}else{B=D.result.feedback}Ext.MessageBox.alert(GO.lang.strError,B)},scope:this})}});GO.tasks.TaskDialog=function(){this.linksPanel=new GO.grid.LinksPanel({title:GO.lang.strLinks});if(GO.files){this.fileBrowser=new GO.files.FileBrowser({title:GO.lang.strFiles,treeRootVisible:true,treeCollapsed:true,disabled:true})}this.buildForm();var A=function(){this.nameField.focus()};this.win=new Ext.Window({layout:"fit",modal:false,resizable:false,width:560,height:400,closeAction:"hide",title:GO.tasks.lang.task,items:this.formPanel,focus:A.createDelegate(this),buttons:[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.win.hide()},scope:this}]});this.win.render(Ext.getBody());GO.tasks.TaskDialog.superclass.constructor.call(this);this.addEvents({save:true})};Ext.extend(GO.tasks.TaskDialog,Ext.util.Observable,{show:function(A){if(!A){A={}}propertiesPanel.show();if(!A.task_id){A.task_id=0}this.setTaskId(A.task_id);if(A.task_id>0){this.formPanel.load({url:GO.settings.modules.tasks.url+"json.php",success:function(B,C){this.win.show();this.changeRepeat(C.result.data.repeat_type);this.setValues(A.values);this.selectTaskList.setRemoteText(C.result.data.tasklist_name);if(GO.files){this.fileBrowser.setRootPath(C.result.data.files_path);this.fileBrowser.setDisabled(false)}this.setWritePermission(C.result.data.write_permission)},failure:function(B,C){Ext.Msg.alert(GO.lang.strError,C.result.feedback)},scope:this})}else{delete this.formPanel.form.baseParams.exception_task_id;delete this.formPanel.form.baseParams.exceptionDate;this.lastTaskListId=this.selectTaskList.getValue();this.formPanel.form.reset();this.linksPanel.setDisabled(true);this.setWritePermission(true);if(GO.files){this.fileBrowser.setDisabled(true)}this.win.show();this.setValues(A.values)}if(A.link_config){this.link_config=A.link_config;if(A.link_config.type_id){this.selectLinkField.setValue(A.link_config.type_id);this.selectLinkField.setRemoteText(A.link_config.text)}}else{delete this.link_config}if(A.tasklist_id){this.selectTaskList.setValue(A.tasklist_id);this.selectTaskList.setRawValue(A.tasklist_name)}else{this.selectTaskList.setValue(this.lastTaskListId)}},setWritePermission:function(A){this.win.buttons[0].setDisabled(!A);this.win.buttons[1].setDisabled(!A);this.linksPanel.setWritePermission(A)},setValues:function(A){if(A){for(var B in A){var C=this.formPanel.form.findField(B);if(C){C.setValue(A[B])}}}},setTaskId:function(A){this.formPanel.form.baseParams.task_id=A;this.task_id=A;this.linksPanel.loadLinks(A,12)},setCurrentDate:function(){var B={};var A=new Date();B.start_date=A.format(GO.settings.date_format);B.start_hour=A.format("H");B.start_min="00";B.end_date=A.format(GO.settings.date_format);B.end_hour=A.add(Date.HOUR,1).format("H");B.end_min="00";this.formPanel.form.setValues(B)},submitForm:function(A){this.formPanel.form.submit({url:GO.settings.modules.tasks.url+"action.php",params:{task:"save_task"},waitMsg:GO.lang.waitMsgSave,success:function(B,C){if(C.result.task_id){this.setTaskId(C.result.task_id);if(GO.files&&C.result.files_path){this.fileBrowser.setRootPath(C.result.files_path);this.fileBrowser.setDisabled(false)}}if(this.link_config&&this.link_config.callback){this.link_config.callback.call(this)}this.fireEvent("save",this);if(A){this.win.hide()}},failure:function(B,C){if(C.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,C.result.feedback)}},scope:this})},buildForm:function(){var M=[["00","00"],["01","01"],["02","02"],["03","03"],["04","04"],["05","05"],["06","06"],["07","07"],["08","08"],["09","09"],["10","10"],["11","11"],["12","12"],["13","13"],["14","14"],["15","15"],["16","16"],["17","17"],["18","18"],["19","19"],["20","20"],["21","21"],["22","22"],["23","23"]];var E=[["00","00"],["15","15"],["30","30"],["45","45"]];this.nameField=new Ext.form.TextField({name:"name",allowBlank:false,fieldLabel:GO.lang.strSubject});this.selectLinkField=new GO.form.SelectLink();var N=new Ext.form.TextArea({name:"description",height:100,allowBlank:true,fieldLabel:GO.lang.strDescription});var A=new Date();var B=new Ext.form.DateField({name:"start_date",format:GO.settings.date_format,allowBlank:false,fieldLabel:GO.tasks.lang.startsAt,value:A.format(GO.settings.date_format)});var O=new Ext.form.DateField({name:"due_date",format:GO.settings.date_format,allowBlank:false,fieldLabel:GO.tasks.lang.dueAt,value:A.format(GO.settings.date_format)});var J=new Ext.form.ComboBox({name:"status_text",hiddenName:"status",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,fieldLabel:GO.lang.strStatus,mode:"local",value:"ACCEPTED",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["NEEDS-ACTION",GO.tasks.lang.needsAction],["ACCEPTED",GO.tasks.lang.accepted],["DECLINED",GO.tasks.lang.declined],["TENTATIVE",GO.tasks.lang.tentative],["DELEGATED",GO.tasks.lang.delegated],["COMPLETED",GO.tasks.lang.completed],["IN-PROCESS",GO.tasks.lang.inProcess]]})});this.selectTaskList=new GO.tasks.SelectTasklist({fieldLabel:GO.tasks.lang.tasklist});propertiesPanel=new Ext.Panel({hideMode:"offsets",title:GO.lang.strProperties,defaults:{anchor:"-20"},bodyStyle:"padding:5px",layout:"form",autoScroll:true,items:[this.nameField,this.selectLinkField,N,B,O,J,this.selectTaskList]});this.repeatEvery=new Ext.form.ComboBox({fieldLabel:GO.tasks.lang.repeatEvery,name:"repeat_every_text",hiddenName:"repeat_every",triggerAction:"all",editable:false,selectOnFocus:true,width:50,forceSelection:true,mode:"local",value:"1",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["1","1"],["2","2"],["3","3"],["4","4"],["5","5"],["6","6"],["7","7"],["8","8"],["9","9"],["10","10"],["11","11"],["12","12"]]})});this.repeatType=new Ext.form.ComboBox({hiddenName:"repeat_type",triggerAction:"all",editable:false,selectOnFocus:true,width:200,forceSelection:true,mode:"local",value:"0",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["0",GO.lang.noRecurrence],["1",GO.lang.strDays],["2",GO.lang.strWeeks],["3",GO.lang.monthsByDate],["4",GO.lang.monthsByDay],["5",GO.lang.strYears]]}),hideLabel:true,laelSeperator:""});this.repeatType.on("select",function(R,Q){this.changeRepeat(Q.data.value)},this);this.monthTime=new Ext.form.ComboBox({hiddenName:"month_time",triggerAction:"all",selectOnFocus:true,disabled:true,width:80,forceSelection:true,fieldLabel:GO.tasks.lang.atDays,mode:"local",value:"1",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["1",GO.lang.strFirst],["2",GO.lang.strSecond],["3",GO.lang.strThird],["4",GO.lang.strFourth]]})});var D=[];for(var L=0;L<7;L++){D[L]=new Ext.form.Checkbox({boxLabel:GO.lang.shortDays[L],name:"repeat_days_"+L,disabled:true,checked:false,width:"auto",hideLabel:true,laelSeperator:""})}this.repeatEndDate=new Ext.form.DateField({name:"repeat_end_date",width:100,disabled:true,format:GO.settings.date_format,allowBlank:true,fieldLabel:GO.tasks.lang.repeatUntil});this.repeatForever=new Ext.form.Checkbox({boxLabel:GO.tasks.lang.repeatForever,name:"repeat_forever",checked:true,disabled:true,width:"auto",hideLabel:true,laelSeperator:""});var F=new Ext.Panel({title:GO.tasks.lang.recurrence,bodyStyle:"padding: 5px",layout:"form",hideMode:"offsets",autoScroll:true,items:[{border:false,layout:"table",defaults:{border:false,layout:"form",bodyStyle:"padding-right:3px"},items:[{items:this.repeatEvery},{items:this.repeatType}]},{border:false,layout:"table",defaults:{border:false,layout:"form",bodyStyle:"padding-right:3px;white-space:nowrap"},items:[{items:this.monthTime},{items:D[0]},{items:D[1]},{items:D[2]},{items:D[3]},{items:D[4]},{items:D[5]},{items:D[6]}]},{border:false,layout:"table",defaults:{border:false,layout:"form",bodyStyle:"padding-right:3px"},items:[{items:this.repeatEndDate},{items:this.repeatForever}]}]});var C=[["0","No reminder"]];for(var G=1;G<60;G++){C.push([G,G])}var H=new Ext.form.ComboBox({fieldLabel:GO.tasks.lang.reminder,hiddenName:"reminder_value",triggerAction:"all",editable:false,selectOnFocus:true,width:148,forceSelection:true,mode:"local",value:"0",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:C})});var I=new Ext.form.ComboBox({hiddenName:"reminder_multiplier",triggerAction:"all",editable:false,selectOnFocus:true,width:148,forceSelection:true,mode:"local",value:"60",valueField:"value",displayField:"text",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["60",GO.lang.strMinutes],["3600",GO.lang.strHours],["86400",GO.lang.strDays]]}),hideLabel:true,labelSeperator:""});var P=new Ext.Panel({title:GO.tasks.lang.options,defaults:{anchor:"100%"},bodyStyle:"padding:5px",layout:"form",hideMode:"offsets",autoScroll:true,items:[{border:false,layout:"table",defaults:{border:false,layout:"form",bodyStyle:"padding-right:3px"},items:[{items:H},{items:I}]}]});var K=[propertiesPanel,F,P,this.linksPanel];if(GO.files){K.push(this.fileBrowser)}this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,anchor:"100% 100%",hideLabel:true,items:K});this.formPanel=new Ext.form.FormPanel({url:GO.settings.modules.tasks.url+"action.php",border:false,baseParams:{task:"task"},items:this.tabPanel})},changeRepeat:function(B){var A=this.formPanel.form;switch(B){case"0":this.disableDays(true);this.monthTime.setDisabled(true);this.repeatForever.setDisabled(true);this.repeatEndDate.setDisabled(true);this.repeatEvery.setDisabled(true);break;case"1":this.disableDays(true);this.monthTime.setDisabled(true);this.repeatForever.setDisabled(false);this.repeatEndDate.setDisabled(false);this.repeatEvery.setDisabled(false);break;case"2":this.disableDays(false);this.monthTime.setDisabled(true);this.repeatForever.setDisabled(false);this.repeatEndDate.setDisabled(false);this.repeatEvery.setDisabled(false);break;case"3":this.disableDays(true);this.monthTime.setDisabled(true);this.repeatForever.setDisabled(false);this.repeatEndDate.setDisabled(false);this.repeatEvery.setDisabled(false);break;case"4":this.disableDays(false);this.monthTime.setDisabled(false);this.repeatForever.setDisabled(false);this.repeatEndDate.setDisabled(false);this.repeatEvery.setDisabled(false);break;case"5":this.disableDays(true);this.monthTime.setDisabled(true);this.repeatForever.setDisabled(false);this.repeatEndDate.setDisabled(false);this.repeatEvery.setDisabled(false);break}},disableDays:function(B){for(var A=0;A<7;A++){this.formPanel.form.findField("repeat_days_"+A).setDisabled(B)}}});GO.tasks.TasksPanel=function(A){if(!A){A={}}A.store=new GO.data.JsonStore({url:GO.settings.modules.tasks.url+"json.php",baseParams:{task:"tasks"},root:"results",totalProperty:"total",id:"id",fields:["id","name","completed","due_time","late"]});var B=new GO.grid.CheckColumn({header:"",dataIndex:"completed",width:30,header:'<div class="tasks-complete-icon"></div>'});B.on("change",function(D,E){this.store.baseParams.completed_task_id=D.data.id;this.store.baseParams.checked=E;this.store.reload();delete this.store.baseParams.completed_task_id;delete this.store.baseParams.checked},this);var C=new Ext.Template('<table border="0" cellspacing="0" cellpadding="0" style="{tstyle}">','<thead><tr class="x-grid3-hd-row">{cells}</tr></thead>','<tbody><tr class="new-task-row">','<td><div id="tasks-new-task-icon"></div></td>','<td><table border="0" cellspacing="0" cellpadding="0"><tr><td><div class="x-small-editor" id="new-task-name"></div></td><td><div class="x-small-editor" id="new-task-link"></div></td></tr></table></td>','<td><div class="x-small-editor" id="new-task-due"></div></td>',"</tr></tbody>","</table>");A.paging=true,A.plugins=B;A.autoExpandColumn=1;A.autoExpandMax=2500;A.enableColumnHide=false;A.enableColumnMove=false;A.columns=[B,{header:GO.lang.strName,dataIndex:"name"},{header:GO.tasks.lang.dueDate,dataIndex:"due_time",width:100}];A.view=new Ext.grid.GridView({emptyText:GO.tasks.lang.noTask,templates:{header:C},getRowClass:function(D,G,F,E){if(D.data.late){return"tasks-late"}}}),A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;GO.tasks.TasksPanel.superclass.constructor.call(this,A)};Ext.extend(GO.tasks.TasksPanel,GO.grid.GridPanel,{saveListenerAdded:true,afterRender:function(){GO.tasks.TasksPanel.superclass.afterRender.call(this);this.ntName=new Ext.form.TextField({renderTo:"new-task-name",emptyText:GO.tasks.lang.addTask,width:200});this.ntDue=new Ext.form.DateField({renderTo:"new-task-due",value:new Date(),disabled:true,format:GO.settings.date_format});this.ntSelectLink=new GO.form.SelectLink({renderTo:"new-task-link",disabled:true,emptyText:GO.tasks.lang.createLink});this.on("rowdblclick",function(B,C,D){if(!GO.tasks.taskDialog){GO.tasks.taskDialog=new GO.tasks.TaskDialog()}if(!this.saveListenerAdded){this.saveListenerAdded=true;GO.tasks.taskDialog.on("save",function(){this.store.reload()},this)}GO.tasks.taskDialog.show({task_id:B.selModel.selections.keys[0]})},this);this.editing=false;this.focused=false;this.userTriggered=false;var A={focus:function(){this.focused=true},blur:function(){this.focused=false;this.doBlur.defer(250,this)},specialkey:function(B,C){if(C.getKey()==C.ENTER){this.userTriggered=true;C.stopEvent();B.el.blur();if(B.triggerBlur){B.triggerBlur()}}},scope:this};this.ntName.on(A,this);this.ntDue.on(A,this);this.ntSelectLink.on(A,this);this.ntName.on("focus",function(){this.focused=true;if(!this.editing){this.ntDue.enable();this.ntSelectLink.enable();this.syncFields();this.editing=true}},this);this.syncFields.defer(200,this)},syncFields:function(){var A=this.getColumnModel();this.ntSelectLink.setSize(A.getColumnWidth(1)-204);this.ntDue.setSize(A.getColumnWidth(2)-4)},doBlur:function(){if(this.editing&&!this.focused){var A=this.ntName.getValue();var C=this.ntDue.getValue();var B=this.ntSelectLink.getValue();if(!Ext.isEmpty(A)){Ext.Ajax.request({url:GO.settings.modules.tasks.url+"action.php",params:{task:"save_task",tasklist_id:this.store.baseParams.tasklist_id,name:A,link:B,start_date:C.format(GO.settings.date_format),due_date:C.format(GO.settings.date_format)},callback:function(E,F,D){if(!F){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{this.store.reload()}},scope:this});this.ntName.setValue("");if(this.userTriggered){this.userTriggered=false;this.ntName.focus.defer(100,this.ntName)}}this.ntSelectLink.reset();this.ntSelectLink.disable();this.ntDue.disable();this.editing=false}}});GO.tasks.SelectTasklist=function(A){Ext.apply(this,A);if(!this.company_name){this.company_name=""}this.store=new GO.data.JsonStore({url:GO.settings.modules.tasks.url+"json.php",baseParams:{task:"tasklists",auth_type:"write"},root:"results",totalProperty:"total",id:"id",fields:["id","name","user_name"],remoteSort:true});GO.tasks.SelectTasklist.superclass.constructor.call(this,{displayField:"name",hiddenName:"tasklist_id",valueField:"id",triggerAction:"all",mode:"remote",editable:false,selectOnFocus:true,forceSelection:true,typeAhead:true,emptyText:GO.lang.strPleaseSelect,fieldLabel:GO.tasks.lang.tasklist,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.tasks.SelectTasklist,GO.form.ComboBox);GO.tasks.MainPanel=function(D){if(!D){D={}}this.taskListsStore=new GO.data.JsonStore({url:GO.settings.modules.tasks.url+"json.php",baseParams:{task:"tasklists"},root:"results",totalProperty:"total",id:"id",fields:["id","dom_id","name"]});this.tasksLists=new GO.grid.SimpleSelectList({store:this.taskListsStore});this.tasksLists.on("click",function(F,G){this.tasklist_id=F.store.data.items[G].data.id;this.tasklist_name=F.store.data.items[G].data.name;this.gridPanel.store.baseParams.tasklist_id=this.tasklist_id;this.gridPanel.store.load()},this);var C=new Ext.Panel({region:"center",title:GO.tasks.lang.tasklists,items:this.tasksLists,autoScroll:true,border:true,split:true});var B=new Ext.form.Checkbox({boxLabel:GO.tasks.lang.showCompletedTasks,hideLabel:true});B.on("check",function(F,G){this.gridPanel.store.baseParams.show_completed=G;this.gridPanel.store.reload()},this);var A=new Ext.form.Checkbox({boxLabel:GO.tasks.lang.showInactiveTasks,hideLabel:true});A.on("check",function(F,G){this.gridPanel.store.baseParams.show_inactive=G;this.gridPanel.store.reload()},this);var E=new Ext.form.FormPanel({title:GO.tasks.lang.filter,height:80,cls:"go-form-panel",region:"north",border:true,split:true,items:[B,A]});this.gridPanel=new GO.tasks.TasksPanel({region:"center"});D.layout="border";D.items=[new Ext.Panel({region:"north",height:32,baseCls:"x-plain",tbar:new Ext.Toolbar({cls:"go-head-tb",items:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){if(!GO.tasks.taskDialog){GO.tasks.taskDialog=new GO.tasks.TaskDialog()}if(!GO.tasks.taskDialog.hasListener("save")){GO.tasks.taskDialog.on("save",function(){this.gridPanel.store.reload()},this)}GO.tasks.taskDialog.show({tasklist_id:this.tasklist_id,tasklist_name:this.tasklist_name})},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.gridPanel.deleteSelected()},scope:this},{iconCls:"btn-settings",text:GO.lang.cmdSettings,cls:"x-btn-text-icon",handler:function(){this.showAdminDialog()},scope:this}]})}),new Ext.Panel({region:"west",titlebar:false,autoScroll:false,closeOnTab:true,width:210,split:true,resizable:true,layout:"border",baseCls:"x-plain",items:[C,E]}),this.gridPanel];GO.tasks.MainPanel.superclass.constructor.call(this,D)};Ext.extend(GO.tasks.MainPanel,Ext.Panel,{afterRender:function(){GO.tasks.MainPanel.superclass.afterRender.call(this);this.taskListsStore.load({callback:function(){this.tasklist_id=this.taskListsStore.data.items[0].data.id;this.tasklist_name=this.taskListsStore.data.items[0].data.name;this.tasksLists.select(this.taskListsStore.data.items[0].data.dom_id);this.gridPanel.store.baseParams.tasklist_id=this.tasklist_id;this.gridPanel.store.load()},scope:this})},showAdminDialog:function(){if(!this.adminDialog){this.tasklistDialog=new GO.tasks.TasklistDialog();this.tasklistDialog.on("save",function(){GO.tasks.writableTasklistsStore.load();this.taskListsStore.load()},this);this.tasklistsGrid=new GO.grid.GridPanel({paging:true,border:false,store:GO.tasks.writableTasklistsStore,deleteConfig:{callback:function(){this.taskListsStore.load()},scope:this},columns:[{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strOwner,dataIndex:"user_name"}],view:new Ext.grid.GridView({autoFill:true}),sm:new Ext.grid.RowSelectionModel(),loadMask:true,tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.tasklistDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.tasklistsGrid.deleteSelected()},scope:this}]});this.tasklistsGrid.on("rowdblclick",function(A,B,C){this.tasklistDialog.show(A.selModel.selections.keys[0])},this);this.adminDialog=new Ext.Window({title:GO.tasks.lang.tasklists,layout:"fit",modal:false,minWidth:300,minHeight:300,height:400,width:600,closeAction:"hide",items:this.tasklistsGrid,buttons:[{text:GO.lang.cmdClose,handler:function(){this.adminDialog.hide()},scope:this}]})}if(!GO.tasks.writableTasklistsStore.loaded){GO.tasks.writableTasklistsStore.load()}this.adminDialog.show()}});GO.tasks.writableTasklistsStore=new GO.data.JsonStore({url:GO.settings.modules.tasks.url+"json.php",baseParams:{task:"tasklists",auth_type:"write"},root:"results",totalProperty:"total",id:"id",fields:["id","name","user_name"],remoteSort:true});GO.moduleManager.addModule("tasks",GO.tasks.MainPanel,{title:GO.tasks.lang.tasks,iconCls:"go-tab-icon-tasks"});GO.linkHandlers[12]=function(B,A){if(!GO.tasks.taskDialog){GO.tasks.taskDialog=new GO.tasks.TaskDialog()}GO.tasks.taskDialog.show({task_id:B,link_config:A})};GO.newMenuItems.push({text:GO.tasks.lang.task,iconCls:"go-link-icon-12",handler:function(A,B){if(!GO.tasks.taskDialog){GO.tasks.taskDialog=new GO.tasks.TaskDialog()}GO.tasks.taskDialog.show({link_config:A.parentMenu.link_config})}});GO.tasks.SimpleTasksPanel=function(A){if(!A){A={}}A.store=new GO.data.JsonStore({url:GO.settings.modules.tasks.url+"json.php",baseParams:{task:"tasks",user_id:GO.settings.user_id,active_only:true},root:"results",totalProperty:"total",id:"id",fields:["id","name","completed","due_time"]});var B=new GO.grid.CheckColumn({header:"",dataIndex:"completed",width:30,header:'<div class="tasks-complete-icon"></div>'});B.on("change",function(C,D){this.store.baseParams.completed_task_id=C.data.id;this.store.baseParams.checked=D;this.store.reload();delete this.store.baseParams.completed_task_id;delete this.store.baseParams.checked},this);A.paging=false,A.plugins=B;A.autoExpandColumn=1;A.autoExpandMax=2500;A.enableColumnHide=false;A.enableColumnMove=false;A.columns=[B,{header:GO.lang.strName,dataIndex:"name"},{header:GO.tasks.lang.dueDate,dataIndex:"due_time",width:100}];A.view=new Ext.grid.GridView({emptyText:GO.tasks.lang.noTask}),A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;A.autoHeight=true;GO.tasks.SimpleTasksPanel.superclass.constructor.call(this,A)};Ext.extend(GO.tasks.SimpleTasksPanel,GO.grid.GridPanel,{saveListenerAdded:false,afterRender:function(){GO.tasks.SimpleTasksPanel.superclass.afterRender.call(this);this.on("rowdblclick",function(A,B,C){if(!GO.tasks.taskDialog){GO.tasks.taskDialog=new GO.tasks.TaskDialog()}if(!this.saveListenerAdded){this.saveListenerAdded=true;GO.tasks.taskDialog.on("save",function(){this.store.reload()},this)}GO.tasks.taskDialog.show({task_id:A.selModel.selections.keys[0]})},this);this.store.load()}});GO.mainLayout.onReady(function(){if(GO.summary){var A=new GO.tasks.SimpleTasksPanel();GO.summary.portlets["portlet-tasks"]=new GO.summary.Portlet({id:"portlet-tasks",title:GO.tasks.lang.tasks,layout:"fit",tools:[{id:"gear",handler:function(){feedGrid.store.reload()}},{id:"close",handler:function(D,C,B){B.ownerCt.remove(B,true)}}],items:A,autoHeight:true})}});