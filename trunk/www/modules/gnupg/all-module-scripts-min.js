GO.gnupg.KeysGrid=function(A){if(!A){A={}}A.title=GO.gnupg.lang.keys;A.layout="fit";A.autoScroll=true;A.split=true;A.store=new GO.data.JsonStore({url:GO.settings.modules.gnupg.url+"json.php",baseParams:{task:"keys"},root:"results",id:"fingerprint",totalProperty:"total",fields:["fingerprint","id","uid","type"]});var B=new Ext.grid.ColumnModel([{header:"id",dataIndex:"id"},{header:"uid",dataIndex:"uid"},{header:"type",dataIndex:"type"}]);B.defaultSortable=true;A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;A.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){if(!this.genKeyDialog){this.genKeyDialog=new GO.gnupg.GenKeyDialog();this.genKeyDialog.on("save",function(){this.store.reload()},this)}this.genKeyDialog.show()},scope:this},{iconCls:"btn-add",text:GO.lang.cmdImport,cls:"x-btn-text-icon",handler:function(){if(!this.importKeyDialog){this.importKeyDialog=new GO.gnupg.ImportKeyDialog();this.importKeyDialog.on("save",function(){this.store.reload()},this)}this.importKeyDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this},{iconCls:"",text:GO.lang.cmdExport,cls:"x-btn-text-icon",handler:function(){var C=this.getSelectionModel().getSelected();if(!C){alert(GO.lang.noItemSelected)}else{document.location=GO.settings.modules.gnupg.url+"export.php?fingerprint="+C.get("fingerprint")}},scope:this}];GO.gnupg.KeysGrid.superclass.constructor.call(this,A)};Ext.extend(GO.gnupg.KeysGrid,GO.grid.GridPanel,{});GO.gnupg.SecurityDialog=function(B){if(!B){B={}}this.keysGrid=new GO.gnupg.KeysGrid();var A=[this.keysGrid];this.tabPanel=new Ext.TabPanel({activeTab:0,border:false,items:A});B.maximizable=true;B.layout="fit";B.modal=false;B.resizable=false;B.width=600;B.height=400;B.closeAction="hide";B.title="Security settings";B.items=this.tabPanel;B.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.gnupg.SecurityDialog.superclass.constructor.call(this,B)};Ext.extend(GO.gnupg.SecurityDialog,Ext.Window,{show:function(){this.keysGrid.store.load();GO.gnupg.SecurityDialog.superclass.show.call(this)}});GO.gnupg.GenKeyDialog=function(B){if(!B){B={}}var C,A;this.formPanel=new Ext.FormPanel({cls:"go-form-panel",defaults:{anchor:"100%"},waitMsgTarget:true,autoHeight:true,items:[this.accountCombo=new Ext.form.ComboBox({store:new GO.data.JsonStore({url:BaseHref+"modules/email/json.php",baseParams:{task:"accounts",personal_only:true},fields:["id","email","signature"],root:"results",totalProperty:"total",id:"id"}),fieldLabel:GO.email.lang.from,name:"account_name",displayField:"email",valueField:"id",hiddenName:"account_id",forceSelection:true,triggerAction:"all",mode:"local"}),{id:"gen-key-pass",xtype:"textfield",inputType:"password",name:"passphrase",fieldLabel:GO.lang.strPassword,allowBlank:false},{xtype:"textfield",inputType:"password",fieldLabel:GO.lang.strConfirm,name:"passphrase2",allowBlank:false,vtype:"password",initialPassField:"gen-key-pass"},{xtype:"textfield",fieldLabel:GO.gnupg.lang.comment,name:"comment",allowBlank:false}]});B.maximizable=true;B.layout="fit";B.modal=false;B.resizable=false;B.width=400;B.autoHeight=true;B.closeAction="hide";B.title=GO.gnupg.lang.genKey;B.items=this.formPanel;B.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.gnupg.GenKeyDialog.superclass.constructor.call(this,B);this.addEvents({save:true})};Ext.extend(GO.gnupg.GenKeyDialog,Ext.Window,{show:function(){this.accountCombo.store.load();this.formPanel.form.reset();GO.gnupg.GenKeyDialog.superclass.show.call(this)},submitForm:function(){this.formPanel.form.submit({url:GO.settings.modules.gnupg.url+"action.php",params:{task:"gen_key"},waitMsg:GO.lang.waitMsgSave,success:function(A,B){this.fireEvent("save",this);this.hide()},failure:function(A,B){if(B.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,B.result.feedback)}},scope:this})}});GO.gnupg.ImportKeyDialog=function(A){if(!A){A={}}this.formPanel=new Ext.FormPanel({fileUpload:true,cls:"go-form-panel",defaults:{anchor:"100%"},waitMsgTarget:true,autoHeight:true,items:[new GO.form.UploadFile({inputName:"keys",addText:GO.gnupg.lang.selectKeyFile})]});A.maximizable=true;A.layout="fit";A.modal=false;A.resizable=false;A.width=400;A.autoHeight=true;A.closeAction="hide";A.title=GO.gnupg.lang.genKey;A.items=this.formPanel;A.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.gnupg.ImportKeyDialog.superclass.constructor.call(this,A);this.addEvents({save:true})};Ext.extend(GO.gnupg.ImportKeyDialog,Ext.Window,{submitForm:function(){this.formPanel.form.submit({url:GO.settings.modules.gnupg.url+"action.php",params:{task:"import_key"},waitMsg:GO.lang.waitMsgSave,success:function(A,B){this.fireEvent("save",this);this.hide()},failure:function(A,B){if(B.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,B.result.feedback)}},scope:this})}});