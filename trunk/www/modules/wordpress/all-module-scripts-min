Ext.namespace("GO.wordpress");var wpIframe;var wpConfig={title:"Wordpress",iconCls:"go-tab-icon-wordpress",layout:"fit",items:[wpIframe=new GO.panel.IFrameComponent({url:GO.settings.modules.wordpress.url+"redirect.php"})],border:false,tbar:[{iconCls:"go-module-icon-wordpress",text:"Wordpress admin",handler:function(){wpIframe.el.dom.contentDocument.location=GO.settings.modules.wordpress.url+"redirect.php"},scope:this}]};if(GO.settings.has_admin_permission){wpConfig.tbar.push("-",{iconCls:"btn-settings",text:GO.lang.cmdSettings,handler:function(){if(!this.adminDialog){this.adminDialog=new GO.wordpress.AdminDialog()}this.adminDialog.show()}})}GO.moduleManager.addModule("wordpress",Ext.Panel,wpConfig);GO.wordpress.PublishPanel=function(a){a=a||{};a.title="Wordpress publish";a.layout="form";a.items=[{xtype:"checkbox",hideLabel:true,boxLabel:"Publish to Wordpress",name:"wp_publish"},{xtype:"textfield",fieldLabel:"Title",name:"wp_title",anchor:"100%"},{hideLabel:true,xtype:"htmleditor",anchor:"100% -50",name:"wp_content"}];GO.wordpress.PublishPanel.superclass.constructor.call(this,a)};Ext.extend(GO.wordpress.PublishPanel,Ext.Panel,{});GO.moduleManager.onModuleReady("addressbook",function(){Ext.override(GO.addressbook.ContactDialog,{initComponent:GO.addressbook.ContactDialog.prototype.initComponent.createInterceptor(function(){this.tabPanel.add(new GO.wordpress.PublishPanel())})})});GO.moduleManager.onModuleReady("projects",function(){Ext.override(GO.projects.ProjectDialog,{initComponent:GO.projects.ProjectDialog.prototype.initComponent.createInterceptor(function(){this.tabPanel.add(new GO.wordpress.PublishPanel())})})});GO.wordpress.AdminDialog=function(c){c=c||{};c.width=400;c.autoHeight=true;c.title=GO.lang.cmdSettings;var b=[];var a=[2,5];for(var d=0;d<GO.linkTypes.length;d++){if(a.indexOf(GO.linkTypes[d].id)>-1){b.push({xtype:"textfield",fieldLabel:GO.linkTypes[d].name,name:"wp_category_"+GO.linkTypes[d].id,anchor:"100%"})}}this.linkTypesFieldset=new Ext.form.FieldSet({title:"Publish categories",autoHeight:true,items:b});this.formPanel=new Ext.FormPanel({waitMsgTarget:true,cls:"go-form-panel",url:GO.settings.modules.wordpress.url+"action.php",items:[{xtype:"textfield",fieldLabel:"Wordpress URL",name:"wp_url",anchor:"100%"},this.linkTypesFieldset]});c.items=[this.formPanel];c.listeners={show:function(){this.formPanel.form.load({url:GO.settings.modules.wordpress.url+"json.php",waitMsg:GO.lang.waitMsgLoad})},scope:this};c.buttons=[{text:GO.lang.cmdOk,handler:function(){this.formPanel.form.submit({waitMsg:GO.lang.waitMsgSave,success:function(){this.hide()},scope:this})},scope:this}];GO.wordpress.AdminDialog.superclass.constructor.call(this,c)};Ext.extend(GO.wordpress.AdminDialog,GO.Window);