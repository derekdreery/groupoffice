GO.servermanager.InstallationsGrid=function(A){if(!A){A={}}A.title=GO.servermanager.lang.installations;A.layout="fit";A.autoScroll=true;A.split=true;A.store=new GO.data.JsonStore({url:GO.settings.modules.servermanager.url+"json.php",baseParams:{task:"installations"},root:"results",id:"id",totalProperty:"total",fields:["id","name","webmaster_email","title","default_country","language","default_timezone","default_currency","default_date_format","default_date_separator","default_thousands_separator","theme","allow_themes","allow_password_change","allow_registration","allow_duplicate_email","auto_activate_accounts","notify_admin_of_registration","registration_fields","required_registration_fields","register_modules_read","register_modules_write","register_user_groups","register_visible_user_groups","max_users","ctime","mtime"],remoteSort:true});A.paging=true;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.servermanager.lang.webmasterEmail,dataIndex:"webmaster_email"},{header:GO.servermanager.lang.title,dataIndex:"title"},{header:GO.servermanager.lang.maxUsers,dataIndex:"max_users"},{header:GO.lang.strCtime,dataIndex:"ctime"},{header:GO.lang.strMtime,dataIndex:"mtime"}]);B.defaultSortable=true;A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;this.searchField=new GO.form.SearchField({store:A.store,width:320});GO.servermanager.installationDialog.on("save",function(){this.store.reload()},this);A.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){GO.servermanager.installationDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this},"-",GO.lang.strSearch+": "," ",this.searchField];GO.servermanager.InstallationsGrid.superclass.constructor.call(this,A);this.on("rowdblclick",function(D,E){var C=D.getStore().getAt(E);GO.servermanager.installationDialog.show(C.data.id)},this)};Ext.extend(GO.servermanager.InstallationsGrid,GO.grid.GridPanel,{afterRender:function(){GO.servermanager.InstallationsGrid.superclass.afterRender.call(this);this.store.load()}});GO.servermanager.InstallationDialog=function(B){if(!B){B={}}this.buildForm();var A=function(){this.propertiesPanel.items.items[0].focus()};B.maximizable=true;B.layout="fit";B.modal=false;B.resizable=false;B.width=750;B.height=550;B.closeAction="hide";B.title=GO.servermanager.lang.installation;B.items=this.formPanel;B.focus=A.createDelegate(this);B.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.servermanager.InstallationDialog.superclass.constructor.call(this,B);this.addEvents({save:true})};Ext.extend(GO.servermanager.InstallationDialog,Ext.Window,{show:function(B,A){if(!this.rendered){this.render(Ext.getBody())}this.tabPanel.setActiveTab(0);if(!B){B=0}this.setInstallationId(B);if(this.installation_id>0){this.formPanel.load({url:GO.settings.modules.servermanager.url+"json.php",success:function(C,D){GO.servermanager.InstallationDialog.superclass.show.call(this)},failure:function(C,D){Ext.Msg.alert(GO.lang.strError,D.result.feedback)},scope:this})}else{this.formPanel.form.reset();GO.servermanager.InstallationDialog.superclass.show.call(this)}if(A&&A.link_config){this.link_config=A.link_config;if(A.link_config.type_id){}}else{delete this.link_config}},setInstallationId:function(A){this.formPanel.form.baseParams.installation_id=A;this.installation_id=A;this.modulesGrid.store.baseParams.installation_id=A;this.modulesGrid.store.removeAll();this.modulesGrid.store.loaded=false;this.formPanel.form.findField("admin_password1").allowBlank=A>0;this.formPanel.form.findField("admin_password2").allowBlank=A>0;this.formPanel.form.findField("enabled").setDisabled(A==0)},submitForm:function(A){var B={task:"save_installation"};if(this.modulesGrid.store.loaded){B.modules=Ext.encode(this.modulesGrid.getGridData())}this.formPanel.form.submit({url:GO.settings.modules.servermanager.url+"action.php",params:B,waitMsg:GO.lang.waitMsgSave,success:function(C,D){this.fireEvent("save",this);if(this.modulesGrid.loaded){this.modulesGrid.store.commitChanges()}if(A){this.hide()}else{if(D.result.installation_id){this.setInstallationId(D.result.installation_id)}}},failure:function(C,D){if(D.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,D.result.feedback)}},scope:this})},buildForm:function(){var D=new Ext.data.SimpleStore({fields:["id","date_format"],data:[["dmY",GO.users.lang.dmy],["mdY",GO.users.lang.mdy],["Ymd",GO.users.lang.jmd]]});var E=new Ext.data.SimpleStore({fields:["id","date_separator"],data:[["-","-"],[".","."],["/","/"]]});var A=new Ext.data.SimpleStore({fields:["id","time_format"],data:[["G:i",GO.users.lang.fullhourformat],["g:i a",GO.users.lang.halfhourformat]]});var C=new Ext.data.SimpleStore({fields:["id","first_weekday"],data:[["0",GO.users.lang.sunday],["1",GO.users.lang.monday]]});this.propertiesPanel=new Ext.Panel({title:GO.lang.strProperties,layout:"column",autoScroll:true,items:[{cls:"go-form-panel",waitMsgTarget:true,layout:"form",labelWidth:140,border:false,columnWidth:0.5,items:[{xtype:"checkbox",name:"enabled",anchor:"-20",hideLabel:true,boxLabel:GO.servermanager.lang.enabled,checked:true,disabled:true},{xtype:"textfield",name:"name",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.domain},{xtype:"textfield",name:"admin_password1",anchor:"-20",inputType:"password",fieldLabel:GO.servermanager.lang.adminPassword},{xtype:"textfield",name:"admin_password2",anchor:"-20",inputType:"password",fieldLabel:GO.servermanager.lang.confirmAdminPassword},{xtype:"textfield",name:"webmaster_email",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.webmasterEmail,value:GO.settings.email},{xtype:"textfield",name:"title",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.title,value:GO.settings.config.title},{xtype:"combo",name:"theme",store:new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"themes"},root:"results",totalProperty:"total",fields:["theme"],remoteSort:true}),displayField:"theme",valueField:"theme",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.theme,value:GO.settings.config.theme},{xtype:"checkbox",name:"allow_themes",anchor:"-20",hideLabel:true,boxLabel:GO.servermanager.lang.allowThemes,checked:!GO.util.empty(GO.servermanager.config.allow_themes)},{xtype:"checkbox",name:"allow_password_change",anchor:"-20",hideLabel:true,boxLabel:GO.servermanager.lang.allowPasswordChange,checked:!GO.util.empty(GO.servermanager.config.allow_password_change)}]},{cls:"go-form-panel",waitMsgTarget:true,layout:"form",columnWidth:0.5,labelWidth:140,border:false,items:[new GO.form.SelectCountry({fieldLabel:GO.lang.strCountry,hiddenName:"default_country",anchor:"-20",value:GO.settings.country}),new Ext.form.ComboBox({anchor:"-20",fieldLabel:GO.users.lang.cmdFormLabelLanguage,name:"language",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),displayField:"language",valueField:"id",hiddenName:"language",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:GO.settings.language}),new Ext.form.ComboBox({anchor:"-20",fieldLabel:GO.users.lang.cmdFormLabelTimezone,name:"default_timezone",store:new Ext.data.SimpleStore({fields:["timezone"],data:GO.users.TimeZones}),displayField:"timezone",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:GO.settings.timezone}),{anchor:"-20",xtype:"textfield",name:"default_currency",allowBlank:false,fieldLabel:GO.servermanager.lang.defaultCurrency,value:GO.settings.currency},new Ext.form.ComboBox({anchor:"-20",fieldLabel:GO.users.lang.cmdFormLabelDateFormat,name:"date_format",store:D,displayField:"date_format",value:GO.settings.date_format.replace(new RegExp(GO.settings.date_separator,"g"),""),valueField:"id",hiddenName:"default_date_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({anchor:"-20",fieldLabel:GO.users.lang.cmdFormLabelDateSeperator,name:"date_separator_name",store:E,displayField:"date_separator",value:GO.settings.date_separator,valueField:"id",hiddenName:"default_date_separator",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.timeFormat,name:"time_format_name",store:A,displayField:"time_format",valueField:"id",hiddenName:"default_time_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,value:GO.settings.time_format,anchor:"-20",forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelFirstWeekday,store:C,displayField:"first_weekday",valueField:"id",hiddenName:"first_weekday",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,anchor:"-20",value:GO.settings.first_weekday}),{xtype:"textfield",name:"default_decimal_separator",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.defaultDecimalSeperator,value:GO.settings.decimal_separator},{xtype:"textfield",name:"default_thousands_separator",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.defaultThousandsSeperator,value:GO.settings.thousands_separator}]},{columnWidth:1,layout:"form",cls:"go-form-panel",waitMsgTarget:true,labelWidth:160,border:false,items:[{xtype:"textfield",name:"restrict_smtp_hosts",anchor:"-20",fieldLabel:GO.servermanager.lang.restrictSmtpHosts,value:GO.servermanager.config.restrict_smtp_hosts},{xtype:"textfield",name:"serverclient_domains",anchor:"-20",fieldLabel:GO.servermanager.lang.mailDomains,value:GO.servermanager.config.serverclient_domains},new GO.form.NumberField({decimals:0,name:"max_users",anchor:"-20",allowBlank:false,fieldLabel:GO.servermanager.lang.maxUsers,value:GO.servermanager.config.max_users}),new GO.form.NumberField({name:"quota",anchor:"-20",fieldLabel:GO.servermanager.lang.quota,value:GO.servermanager.config.quota})]}]});this.modulesGrid=new GO.servermanager.ModulesGrid();var B=[this.propertiesPanel,this.modulesGrid];this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:B,anchor:"100% 100%"});this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,url:GO.settings.modules.servermanager.url+"action.php",border:false,baseParams:{task:"installation"},items:this.tabPanel})}});GO.servermanager.ModulesGrid=function(A){if(!A){A={}}A.title=GO.servermanager.lang.modules;A.layout="fit";A.autoScroll=true;A.split=true;A.store=new GO.data.JsonStore({url:GO.settings.modules.servermanager.url+"json.php",baseParams:{task:"modules",installation_id:0},root:"results",id:"id",totalProperty:"total",fields:["id","name","installed","allowed"]});var C=new GO.grid.CheckColumn({header:GO.servermanager.lang.allowed,dataIndex:"allowed",width:55,menuDisabled:true});A.plugins=[C];A.paging=true;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name",sortable:true},C]);A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;GO.servermanager.ModulesGrid.superclass.constructor.call(this,A)};Ext.extend(GO.servermanager.ModulesGrid,GO.grid.GridPanel,{afterRender:function(){GO.servermanager.ModulesGrid.superclass.afterRender.call(this)},onShow:function(){GO.servermanager.ModulesGrid.superclass.onShow.call(this);if(!this.store.loaded){this.store.load()}}});GO.servermanager.InstallationPanel=function(A){Ext.apply(this,A);this.split=true;this.autoScroll=true;this.newMenuButton=new GO.NewMenuButton();this.tbar=[this.editButton=new Ext.Button({iconCls:"btn-edit",text:GO.lang.cmdEdit,cls:"x-btn-text-icon",handler:function(){GO.servermanager.installationDialog.show(this.data.id)},scope:this,disabled:true}),{iconCls:"btn-link",cls:"x-btn-text-icon",text:GO.lang.cmdBrowseLinks,handler:function(){GO.linkBrowser.show({link_id:this.data.id,link_type:"13",folder_id:"0"})},scope:this},this.newMenuButton];GO.servermanager.InstallationPanel.superclass.constructor.call(this)};Ext.extend(GO.servermanager.InstallationPanel,Ext.Panel,{initComponent:function(){var B='<div><table class="display-panel" cellpadding="0" cellspacing="0" border="0"><tr><td colspan="2" class="display-panel-heading">Information</td></tr><tpl if="name.length"><tr><td>'+GO.lang.strName+':</td><td>{name}</td></tr></tpl><tpl if="webmaster_email.length"><tr><td>'+GO.servermanager.lang.webmasterEmail+':</td><td>{webmaster_email}</td></tr></tpl><tpl if="title.length"><tr><td>'+GO.servermanager.lang.title+':</td><td>{title}</td></tr></tpl><tpl if="default_country.length"><tr><td>'+GO.servermanager.lang.defaultCountry+':</td><td>{default_country}</td></tr></tpl><tpl if="language.length"><tr><td>'+GO.servermanager.lang.language+':</td><td>{language}</td></tr></tpl><tpl if="default_timezone.length"><tr><td>'+GO.servermanager.lang.defaultTimezone+':</td><td>{default_timezone}</td></tr></tpl><tpl if="default_currency.length"><tr><td>'+GO.servermanager.lang.defaultCurrency+':</td><td>{default_currency}</td></tr></tpl><tpl if="default_date_format.length"><tr><td>'+GO.servermanager.lang.defaultDateFormat+':</td><td>{default_date_format}</td></tr></tpl><tpl if="default_date_separator.length"><tr><td>'+GO.servermanager.lang.defaultDateSeperator+':</td><td>{default_date_separator}</td></tr></tpl><tpl if="default_thousands_separator.length"><tr><td>'+GO.servermanager.lang.defaultThousandsSeperator+':</td><td>{default_thousands_separator}</td></tr></tpl><tpl if="theme.length"><tr><td>'+GO.servermanager.lang.theme+':</td><td>{theme}</td></tr></tpl><tpl if="allow_themes.length"><tr><td>'+GO.servermanager.lang.allowThemes+':</td><td>{allow_themes}</td></tr></tpl><tpl if="allow_password_change.length"><tr><td>'+GO.servermanager.lang.allowPasswordChange+':</td><td>{allow_password_change}</td></tr></tpl><tpl if="allow_registration.length"><tr><td>'+GO.servermanager.lang.allowRegistration+':</td><td>{allow_registration}</td></tr></tpl><tpl if="allow_duplicate_email.length"><tr><td>'+GO.servermanager.lang.allowDuplicateEmail+':</td><td>{allow_duplicate_email}</td></tr></tpl><tpl if="auto_activate_accounts.length"><tr><td>'+GO.servermanager.lang.autoActivateAccounts+':</td><td>{auto_activate_accounts}</td></tr></tpl><tpl if="notify_admin_of_registration.length"><tr><td>'+GO.servermanager.lang.notifyAdminOfRegistration+':</td><td>{notify_admin_of_registration}</td></tr></tpl><tpl if="registration_fields.length"><tr><td>'+GO.servermanager.lang.registrationFields+':</td><td>{registration_fields}</td></tr></tpl><tpl if="required_registration_fields.length"><tr><td>'+GO.servermanager.lang.requiredRegistrationFields+':</td><td>{required_registration_fields}</td></tr></tpl><tpl if="register_modules_read.length"><tr><td>'+GO.servermanager.lang.registerModulesRead+':</td><td>{register_modules_read}</td></tr></tpl><tpl if="register_modules_write.length"><tr><td>'+GO.servermanager.lang.registerModulesWrite+':</td><td>{register_modules_write}</td></tr></tpl><tpl if="register_user_groups.length"><tr><td>'+GO.servermanager.lang.registerUserGroups+':</td><td>{register_user_groups}</td></tr></tpl><tpl if="register_visible_user_groups.length"><tr><td>'+GO.servermanager.lang.registerVisibleUserGroups+':</td><td>{register_visible_user_groups}</td></tr></tpl><tpl if="max_users.length"><tr><td>'+GO.servermanager.lang.maxUsers+':</td><td>{max_users}</td></tr></tpl><tpl if="ctime.length"><tr><td>'+GO.lang.strCtime+':</td><td>{ctime}</td></tr></tpl><tpl if="mtime.length"><tr><td>'+GO.lang.strMtime+":</td><td>{mtime}</td></tr></tpl></table>";B+=GO.linksTemplate;if(GO.customfields){B+=GO.customfields.displayPanelTemplate}var A={};B+="</div>";this.template=new Ext.XTemplate(B,A);GO.servermanager.InstallationPanel.superclass.initComponent.call(this)},loadInstallation:function(A){this.body.mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:GO.settings.modules.servermanager.url+"json.php",params:{task:"installation_with_items",installation_id:A},callback:function(C,E,B){this.body.unmask();if(!E){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var D=Ext.decode(B.responseText);this.setData(D.data)}},scope:this})},setData:function(A){this.data=A;this.editButton.setDisabled(!A.write_permission);if(A.write_permission){this.newMenuButton.setLinkConfig({id:this.data.id,type:13,text:this.data.name,callback:function(){this.loadInstallation(this.data.id)},scope:this})}this.template.overwrite(this.body,A)}});GO.servermanager.ReportGrid=function(A){if(!A){A={}}A.title=GO.servermanager.lang.report;A.layout="fit";A.autoScroll=true;A.split=true;A.store=new GO.data.JsonStore({url:GO.settings.modules.servermanager.url+"json.php",baseParams:{task:"report"},totalProperty:"total",root:"results",id:"name",fields:["name","count_users","max_users","install_time","lastlogin","total_logins","database_usage","file_storage_usage","mailbox_usage","total_usage","comment","ctime","mailbox_domains","features","billing","professional"],remoteSort:true});A.paging=true;var B=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"},{header:GO.lang.strCtime,dataIndex:"ctime"},{header:GO.servermanager.lang.maxUsers,dataIndex:"max_users",align:"right"},{header:GO.servermanager.lang.countUsers,dataIndex:"count_users",align:"right"},{header:GO.servermanager.lang.installTime,dataIndex:"install_time"},{header:GO.servermanager.lang.lastlogin,dataIndex:"lastlogin"},{header:GO.servermanager.lang.totalLogins,dataIndex:"total_logins",align:"right"},{header:GO.servermanager.lang.databaseUsage,dataIndex:"database_usage",align:"right"},{header:GO.servermanager.lang.fileStorageUsage,dataIndex:"file_storage_usage",align:"right"},{header:GO.servermanager.lang.mailboxUsage,dataIndex:"mailbox_usage",align:"right"},{header:GO.servermanager.lang.totalUsage,dataIndex:"total_usage",align:"right"},{header:GO.servermanager.lang.strComment,dataIndex:"comment"},{header:GO.servermanager.lang.mailDomains,dataIndex:"mailbox_domains"},{header:GO.servermanager.lang.billing,dataIndex:"billing",renderer:function(C){return C=="1"?GO.lang.cmdYes:GO.lang.cmdNo}},{header:"Professional",dataIndex:"professional",renderer:function(C){return C=="1"?GO.lang.cmdYes:GO.lang.cmdNo}}]);B.defaultSortable=true;A.cm=B;A.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});A.sm=new Ext.grid.RowSelectionModel();A.loadMask=true;GO.servermanager.ReportGrid.superclass.constructor.call(this,A)};Ext.extend(GO.servermanager.ReportGrid,GO.grid.GridPanel,{afterRender:function(){GO.servermanager.ReportGrid.superclass.afterRender.call(this);this.store.load()}});GO.servermanager.MainPanel=function(D){if(!D){D={}}this.installationsGrid=new GO.servermanager.InstallationsGrid();this.reportGrid=new GO.servermanager.ReportGrid();this.installationsGrid.store.on("load",function(){this.navMenu.select(0)},this);var C=[["sm_installations",GO.servermanager.lang.installations],["sm_report",GO.servermanager.lang.report]];var B=[this.installationsGrid,this.reportGrid];var A=new Ext.data.SimpleStore({fields:["dom_id","name"],data:C});this.navMenu=new GO.grid.SimpleSelectList({store:A});this.navMenu.on("click",function(E,F){this.cardPanel.getLayout().setActiveItem(F)},this);this.navPanel=new Ext.Panel({region:"west",title:GO.lang.menu,autoScroll:true,width:150,split:true,resizable:true,items:this.navMenu});this.cardPanel=new Ext.Panel({region:"center",layout:"card",border:false,activeItem:0,layoutConfig:{deferredRender:true},items:B});D.items=[this.navPanel,this.cardPanel];D.title=GO.servermanager.lang.servermanager;D.layout="border";GO.servermanager.MainPanel.superclass.constructor.call(this,D)};Ext.extend(GO.servermanager.MainPanel,Ext.Panel,{afterRender:function(){GO.servermanager.MainPanel.superclass.afterRender.call(this)}});GO.mainLayout.onReady(function(){GO.servermanager.installationDialog=new GO.servermanager.InstallationDialog()});GO.moduleManager.addModule("servermanager",GO.servermanager.MainPanel,{title:GO.servermanager.lang.servermanager,iconCls:"go-tab-icon-servermanager"});GO.linkHandlers[13]=function(C){var A=new GO.servermanager.InstallationPanel();var B=new GO.LinkViewWindow({title:GO.billing.lang.installation,items:A});A.loadInstallation(C);B.show()};GO.newMenuItems.push({text:GO.servermanager.lang.installation,iconCls:"go-link-icon-13",handler:function(A,B){GO.servermanager.installationDialog.show(0,{link_config:A.parentMenu.link_config})}});