Ext.override(Ext.FormPanel,{initComponent:Ext.FormPanel.prototype.initComponent.createSequence(function(){this.on("actioncomplete",function(a,b){if(b.type=="load"){a.items.each(function(d){if(d.idValuePair){var c=d.getValue();if(!GO.util.empty(c)){c=c.split(":");if(c.length==2){d.setRawValue(c[1])}}}})}})})});Ext.override(Ext.menu.Menu,{showAt:function(d,b,a){this.parentMenu=b;if(!this.el){this.render()}if(a!==false){this.fireEvent("beforeshow",this);d=this.el.adjustForConstraints(d)}this.el.setXY(d);var c=Ext.getBody().getHeight()-d[1];if(!this.el.origHeight){this.el.origHeight=this.el.getHeight()}if(this.el.origHeight>c){this.el.setHeight(c);this.el.applyStyles("overflow-y: auto;")}else{}this.el.show();this.hidden=false;this.focus();this.fireEvent("show",this)}});Ext.override(Ext.grid.GridView,{scrollOffset:20});Ext.apply(Ext.form.VTypes,{password:function(c,b){if(b.initialPassField){var a=Ext.getCmp(b.initialPassField);return(c==a.getValue())}return true},passwordText:GO.lang.passwordMatchError});Ext.Window.override({constrainHeader:true,animCollapse:false});Ext.MessageBox.buttonText.yes=GO.lang.cmdYes;Ext.MessageBox.buttonText.no=GO.lang.cmdNo;Ext.MessageBox.buttonText.ok=GO.lang.cmdOk;Ext.MessageBox.buttonText.cancel=GO.lang.cmdCancel;if(GO.settings.date_format){Ext.override(Ext.DatePicker,{startDay:parseInt(GO.settings.first_weekday)});Ext.override(Ext.form.DateField,{format:GO.settings.date_format,startDay:parseInt(GO.settings.first_weekday)});Ext.override(Ext.form.DateField,{format:GO.settings.date_format,altFormats:GO.settings.date_format+"|"+GO.settings.date_format.replace("Y","y")})}Ext.override(Ext.Element,{printCSS:"",printStyle:false,printTitle:document.title,print:function(f){f=f||{};Ext.apply(this,f);var d=Ext.get(this.id).dom;var n=document.getElementById("printcontainer");var e=document.getElementById("printframe");var j='<HTML><HEAD>{0}<TITLE>{1}</TITLE></HEAD><BODY onload="{2}" style="background-color:white;">{3}</BODY></HTML>';var b="";var o;var l;if(e!=null){n.removeChild(e)}if(n!=null){d.removeChild(n)}for(var g=0;g<d.attributes.length;g++){if(Ext.isEmpty(d.attributes[g].value)||d.attributes[g].value.toLowerCase()!="null"){o=Ext.isEmpty(d.attributes[g].value)?'{0}="true" ':'{0}="{1}" ';if(this.printStyle?this.printStyle:d.attributes[g].name.toLowerCase()!="style"){b+=String.format(o,d.attributes[g].name,d.attributes[g].value)}}}for(var g=0;g<document.styleSheets.length;g++){this.printCSS+='<link rel="stylesheet" type="text/css" href="'+document.styleSheets[g].href+'"/>'}this.printCSS+="<style>body{overflow:visible !important;}</style>";var k=d.innerHTML;if(f.title){k='<h1 style="margin-left:5px;font-size:16px;margin:10px 5px;">'+f.title+"</h1>"+k}l=String.format(j,Ext.isEmpty(this.printCSS)?"#":this.printCSS,this.printTitle,Ext.isIE?"document.execCommand('print');":"window.print();",k);var a=window.open("about:blank");if(!a.opener){a.opener=self}a.document.write(l);a.document.close();a.focus()}});Ext.override(Ext.Component,{printEl:function(a){this.el.print(Ext.isEmpty(a)?this.initialConfig:a)},printBody:function(a){this.body.print(Ext.isEmpty(a)?this.initialConfig:a)}});Ext.decode=Ext.util.JSON.decode=function(json){try{return eval("("+json+")")}catch(e){switch(json.trim()){case"NOTLOGGEDIN":document.location=BaseHref;break;case"UNAUTHORIZED":Ext.Msg.alert(GO.lang.strUnauthorized,GO.lang.strUnauthorizedText);break;default:json+="<br /><br />Ext.decode exception occurred";GO.errorDialog.show(GO.lang.serverError,json);break}}};Ext.apply(Ext.form.VTypes,{emailAddress:function(a){var b=/^[a-z0-9\._\-+]+@[a-z0-9\.\-_]+\.[a-z]{2,6}$/i;return b.test(a)},emailAddressText:Ext.form.VTypes.emailText,emailAddressMask:/[a-z0-9_\.\-@\+]/i});GO.ModuleManager=Ext.extend(function(){this.addEvents({moduleReady:true,moduleconstructed:true,languageLoaded:true});this.resumeEvents()},Ext.util.Observable,{modules:{},modulePanels:{},panelConfigs:{},sortOrder:Array(),adminModulePanels:{},adminPanelConfigs:{},adminSortOrder:Array(),settingsPanels:{},settingsPanelConfigs:{},settingsSortOrder:Array(),readyFunctions:{},addSettingsPanel:function(b,a,c){this.settingsPanels[b]=a;this.settingsPanelConfigs[b]=c;this.settingsSortOrder.push(b)},getSettingsPanel:function(a){if(this.settingsPanels[a]){return new this.settingsPanels[a](this.settingsPanelConfigs[a])}else{return false}},getAllSettingsPanels:function(){var a=[];for(var b=0;b<this.settingsSortOrder.length;b++){a.push(this.getSettingsPanel(this.settingsSortOrder[b]))}return a},addModule:function(b,a,c){if(a){c.moduleName=b;c.id="go-module-panel-"+c.moduleName;this.modulePanels[b]=a;this.panelConfigs[b]=c;this.sortOrder.push(b)}this.onAddModule(b)},onAddModule:function(a){this.modules[a]=true;if(this.readyFunctions[a]){for(var b=0;b<this.readyFunctions[a].length;b++){var d=this.readyFunctions[a][b];d.fn.call(d.fn.scope,a,this)}}},onModuleReady:function(a,c,b){b=b||window;if(!this.modules[a]){this.readyFunctions[a]=this.readyFunctions[a]||[];this.readyFunctions[a].push({fn:c,scope:b})}else{c.call(b,a,this)}},getPanel:function(a){if(this.modulePanels[a]){var b=new this.modulePanels[a](this.panelConfigs[a]);this.fireEvent("moduleconstructed",this,a,b);return b}else{return false}},getAllPanels:function(){var a=[];for(var b=0;b<this.sortOrder.length;b++){a.push(this.getPanel(this.sortOrder[b]))}return a},getAllPanelConfigs:function(){var b=[];for(var a=0;a<this.sortOrder.length;a++){b.push(this.panelConfigs[this.sortOrder[a]])}return b}});GO.moduleManager=new GO.ModuleManager();Date.prototype.getLastSunday=function(){var a=this.getDay();return this.add(Date.DAY,-a)};var deployJava={debug:null,myInterval:null,preInstallJREList:null,returnPage:null,brand:null,locale:null,installType:null,EAInstallEnabled:false,EarlyAccessURL:null,getJavaURL:"http://java.sun.com/webapps/getjava/BrowserRedirect?host=java.com",appleRedirectPage:"http://www.apple.com/support/downloads/",mimeType:"application/npruntime-scriptable-plugin;DeploymentToolkit",launchButtonPNG:"http://java.sun.com/products/jfc/tsc/articles/swing2d/webstart.png",getJREs:function(){var d=new Array();if(deployJava.isPluginInstalled()){var c=deployJava.getPlugin();for(var b=0;b<c.jvms.getLength();b++){d[b]=c.jvms.get(b).version}}else{var a=deployJava.getBrowser();if(a=="MSIE"){if(deployJava.testUsingActiveX("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingActiveX("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingActiveX("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingActiveX("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingActiveX("1.4.2")){d[0]="1.4.2"}else{if(deployJava.testForMSVM()){d[0]="1.1"}}}}}}}else{if(a=="Netscape Family"){if(deployJava.testUsingMimeTypes("1.8")){d[0]="1.8.0"}else{if(deployJava.testUsingMimeTypes("1.7")){d[0]="1.7.0"}else{if(deployJava.testUsingMimeTypes("1.6")){d[0]="1.6.0"}else{if(deployJava.testUsingMimeTypes("1.5")){d[0]="1.5.0"}else{if(deployJava.testUsingMimeTypes("1.4.2")){d[0]="1.4.2"}}}}}}else{if(a=="Safari"){if(deployJava.testUsingPluginsArray("1.8.0")){d[0]="1.8.0"}else{if(deployJava.testUsingPluginsArray("1.7.0")){d[0]="1.7.0"}else{if(deployJava.testUsingPluginsArray("1.6.0")){d[0]="1.6.0"}else{if(deployJava.testUsingPluginsArray("1.5.0")){d[0]="1.5.0"}else{if(deployJava.testUsingPluginsArray("1.4.2")){d[0]="1.4.2"}}}}}}}}}if(deployJava.debug){for(var b=0;b<d.length;++b){alert("We claim to have detected Java SE "+d[b])}}return d},installJRE:function(b){var a=false;if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installJRE(b)){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{return deployJava.installLatestJRE()}},installLatestJRE:function(){if(deployJava.isPluginInstalled()){if(deployJava.getPlugin().installLatestJRE()){deployJava.refresh();if(deployJava.returnPage!=null){document.location=deployJava.returnPage}return true}else{return false}}else{var b=deployJava.getBrowser();var a=navigator.platform.toLowerCase();if((deployJava.EAInstallEnabled=="true")&&(a.indexOf("win")!=-1)&&(deployJava.EarlyAccessURL!=null)){deployJava.preInstallJREList=deployJava.getJREs();if(deployJava.returnPage!=null){deployJava.myInterval=setInterval("deployJava.poll()",3000)}location.href=deployJava.EarlyAccessURL;return false}else{if(b=="MSIE"){return deployJava.IEInstall()}else{if((b=="Netscape Family")&&(a.indexOf("win32")!=-1)){return deployJava.FFInstall()}else{location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")}}return false}}},runApplet:function(b,f,d){if(d=="undefined"||d==null){d="1.1"}var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(deployJava.returnPage==null){deployJava.returnPage=document.location}if(a!=null){var c=deployJava.getBrowser();if((c!="?")&&(c!="Safari")){if(deployJava.versionCheck(d+"+")){deployJava.writeAppletTag(b,f)}else{if(deployJava.installJRE(d+"+")){deployJava.refresh();location.href=document.location;deployJava.writeAppletTag(b,f)}}}else{deployJava.writeAppletTag(b,f)}}else{if(deployJava.debug){alert("Invalid minimumVersion argument to runApplet():"+d)}}},writeAppletTag:function(a,d){var b="<applet ";for(var c in a){b+=(" "+c+'="'+a[c]+'"')}b+=">";document.write(b);if(d!="undefined"&&d!=null){for(var e in d){b='<param name="'+e+'" value="'+d[e]+'">';document.write(b)}}document.write("</applet>")},versionCheck:function(j){var c=0;var f="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?(\\*|\\+)?$";var a=j.match(f);if(a!=null){var e=true;var b=new Array();for(var d=1;d<a.length;++d){if((typeof a[d]=="string")&&(a[d]!="")){b[c]=a[d];c++}}if(b[b.length-1]=="+"){e=false;b.length--}else{if(b[b.length-1]=="*"){b.length--}}var g=deployJava.getJREs();for(var d=0;d<g.length;++d){if(deployJava.compareVersionToPattern(g[d],b,e)){return true}}return false}else{alert("Invalid versionPattern passed to versionCheck: "+j);return false}},isWebStartInstalled:function(d){var c=deployJava.getBrowser();if((c=="?")||(c=="Safari")){return true}if(d=="undefined"||d==null){d="1.4.2"}var b=false;var e="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var a=d.match(e);if(a!=null){b=deployJava.versionCheck(d+"+")}else{if(deployJava.debug){alert("Invalid minimumVersion argument to isWebStartInstalled(): "+d)}b=deployJava.versionCheck("1.4.2+")}return b},createWebStartLaunchButton:function(c,b){if(deployJava.returnPage==null){deployJava.returnPage=c}var a="javascript:if (!deployJava.isWebStartInstalled(&quot;"+b+"&quot;)) {if (deployJava.installLatestJRE()) {if (deployJava.launch(&quot;"+c+"&quot;)) {}}} else {if (deployJava.launch(&quot;"+c+"&quot;)) {}}";document.write('<a href="'+a+'" onMouseOver="window.status=\'\'; return true;"><img src="'+deployJava.launchButtonPNG+'" border="0" /></a>')},launch:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().launch(a)}else{document.location=a;return true}},isPluginInstalled:function(){var a=deployJava.getPlugin();if(a&&a.jvms){return true}else{return false}},isAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().isAutoUpdateEnabled()}return false},setAutoUpdateEnabled:function(){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAutoUpdateEnabled()}return false},setInstallerType:function(a){deployJava.installType=a;if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setInstallerType(a)}return false},setAdditionalPackages:function(a){if(deployJava.isPluginInstalled()){return deployJava.getPlugin().setAdditionalPackages(a)}return false},setEarlyAccess:function(a){deployJava.EAInstallEnabled=a},isPlugin2:function(){if(deployJava.isPluginInstalled()){try{return deployJava.getPlugin().isPlugin2()}catch(a){}}return false},getPlugin:function(){deployJava.refresh();var a=document.getElementById("deployJavaPlugin");return a},compareVersionToPattern:function(f,b,c){var g="^(\\d+)(?:\\.(\\d+)(?:\\.(\\d+)(?:_(\\d+))?)?)?$";var j=f.match(g);if(j!=null){var e=0;var k=new Array();for(var d=1;d<j.length;++d){if((typeof j[d]=="string")&&(j[d]!="")){k[e]=j[d];e++}}var a=Math.min(k.length,b.length);if(c){for(var d=0;d<a;++d){if(k[d]!=b[d]){return false}}return true}else{for(var d=0;d<a;++d){if(k[d]<b[d]){return false}else{if(k[d]>b[d]){return true}}}return true}}else{return false}},getBrowser:function(){var a=navigator.userAgent.toLowerCase();if(deployJava.debug){alert("userAgent -> "+a)}if((navigator.vendor)&&(navigator.vendor.toLowerCase().indexOf("apple")!=-1)&&(a.indexOf("safari")!=-1)){if(deployJava.debug){alert('We claim to have detected "Safari".')}return"Safari"}else{if(a.indexOf("msie")!=-1){if(deployJava.debug){alert('We claim to have detected "IE".')}return"MSIE"}else{if((a.indexOf("mozilla")!=-1)||(a.indexOf("firefox")!=-1)){if(deployJava.debug){alert("We claim to have detected a Netscape family browser.")}return"Netscape Family"}else{if(deployJava.debug){alert("We claim to have failed to detect a browser.")}return"?"}}}},testUsingActiveX:function(a){var c="JavaWebStart.isInstalled."+a+".0";if(!ActiveXObject){if(deployJava.debug){alert("Browser claims to be IE, but no ActiveXObject object?")}return false}try{return(new ActiveXObject(c)!=null)}catch(b){return false}},testForMSVM:function(){var b="{08B0E5C0-4FCB-11CF-AAA5-00401C608500}";if(typeof oClientCaps!="undefined"){var a=oClientCaps.getComponentVersion(b,"ComponentID");if((a=="")||(a=="5,0,5000,0")){return false}else{return true}}else{return false}},testUsingMimeTypes:function(b){if(!navigator.mimeTypes){if(deployJava.debug){alert("Browser claims to be Netscape family, but no mimeTypes[] array?")}return false}for(var c=0;c<navigator.mimeTypes.length;++c){s=navigator.mimeTypes[c].type;var a=s.match(/^application\/x-java-applet\x3Bversion=(1\.8|1\.7|1\.6|1\.5|1\.4\.2)$/);if(a!=null){if(deployJava.compareVersions(a[1],b)){return true}}}return false},testUsingPluginsArray:function(a){if((!navigator.plugins)||(!navigator.plugins.length)){if(deployJava.debug){alert("Browser claims to be Safari, but no plugins[] array?")}return false}for(var b=0;b<navigator.plugins.length;++b){s=navigator.plugins[b].description;if(s.search(/^Java Switchable Plug-in/)!=-1){return true}m=s.match(/^Java (1\.4\.2|1\.5|1\.6|1\.7).* Plug-in/);if(m!=null){if(deployJava.compareVersions(m[1],a)){return true}}}return false},IEInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},done:function(b,a){},FFInstall:function(){location.href=deployJava.getJavaURL+((deployJava.returnPage!=null)?("&returnPage="+deployJava.returnPage):"")+((deployJava.locale!=null)?("&locale="+deployJava.locale):"")+((deployJava.brand!=null)?("&brand="+deployJava.brand):"")+((deployJava.installType!=null)?("&type="+deployJava.installType):"");return false},compareVersions:function(f,g){var d=f.split(".");var c=g.split(".");for(var e=0;e<d.length;++e){d[e]=Number(d[e])}for(var e=0;e<c.length;++e){c[e]=Number(c[e])}if(d.length==2){d[2]=0}if(d[0]>c[0]){return true}if(d[0]<c[0]){return false}if(d[1]>c[1]){return true}if(d[1]<c[1]){return false}if(d[2]>c[2]){return true}if(d[2]<c[2]){return false}return true},enableAlerts:function(){deployJava.debug=true},poll:function(){deployJava.refresh();var a=deployJava.getJREs();if((deployJava.preInstallJREList.length==0)&&(a.length!=0)){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}if((deployJava.preInstallJREList.length!=0)&&(a.length!=0)&&(deployJava.preInstallJREList[0]!=a[0])){clearInterval(deployJava.myInterval);if(deployJava.returnPage!=null){location.href=deployJava.returnPage}}},writePluginTag:function(){var a=deployJava.getBrowser();if(a=="MSIE"){document.write('<object classid="clsid:CAFEEFAC-DEC7-0000-0000-ABCDEFFEDCBA" id="deployJavaPlugin" width="0" height="0"></object>')}else{if(a=="Netscape Family"){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},refresh:function(){navigator.plugins.refresh(false);var a=deployJava.getBrowser();if(a=="Netscape Family"){var c=document.getElementById("deployJavaPlugin");if(c==null){if(navigator.mimeTypes!=null){for(var b=0;b<navigator.mimeTypes.length;b++){if(navigator.mimeTypes[b].type==deployJava.mimeType){if(navigator.mimeTypes[b].enabledPlugin){document.write('<embed id="deployJavaPlugin" type="'+deployJava.mimeType+'" hidden="true" />')}}}}}}},do_initialize:function(){deployJava.writePluginTag();if(deployJava.locale==null){var b=null;if(b==null){try{b=navigator.userLanguage}catch(a){}}if(b==null){try{b=navigator.systemLanguage}catch(a){}}if(b==null){try{b=navigator.language}catch(a){}}if(b!=null){b.replace("-","_");deployJava.locale=b}}}};deployJava.do_initialize();GO.MainLayout=function(){this.addEvents({ready:true,render:true,linksDeleted:true,focus:true,blur:true,login:true});this.resumeEvents()};Ext.extend(GO.MainLayout,Ext.util.Observable,{ready:false,fullscreenPopup:false,state:false,stateSaveScheduled:false,rendered:false,onReady:function(b,a){if(!this.ready){this.on("ready",b,a)}else{b.call(a,this)}},launchFullscreen:function(a){this.fullscreenPopup=GO.util.popup({url:a,target:"groupoffice"})},login:function(){new Ext.Viewport();GO.loginDialog=new GO.dialog.LoginDialog({modal:false});this.createLoginCallback();this.removeLoadMask();GO.loginDialog.show();if(window.console&&window.console.firebug){this.msg(GO.lang.firebugDetected,GO.lang.firebugWarning,4,400)}if(GO.settings.config.debug){this.msg(GO.lang.debugModeDetected,GO.lang.debugModeWarning,4,400)}this.fireEvent("login",this)},saveState:function(){Ext.state.Manager.getProvider().set("open-modules",this.getOpenModules())},logout:function(a){if(Ext.Ajax.isLoading()){if(a){Ext.getBody().mask(GO.lang.waitMsgLoad)}this.logout.defer(500,this,[true])}else{document.location=GO.url("core/logout")}},createLoginCallback:function(){GO.loginDialog.addCallback(function(){var a=GO.afterLoginUrl?GO.afterLoginUrl:GO.settings.config.host;if(GO.loginDialog.fullscreenField.getValue()&&window.name!="groupoffice"){a=GO.util.addParamToUrl(a,"fullscreen_loaded","true");this.launchFullscreen(a);GO.loginDialog.hideDialog=false;GO.loginDialog.on("callbackshandled",this.createLoginCallback,this)}else{document.location.href=a}},this)},fireReady:function(){this.fireEvent("ready",this);this.ready=true},getOpenModules:function(){var a=[];this.tabPanel.items.each(function(b){var c=this.tabPanel.getTabEl(b);if(c.style.display!="none"){a.push(b.moduleName)}},this);return a},createTabPanel:function(a){this.tabPanel=new Ext.TabPanel({region:"center",titlebar:false,border:false,activeTab:"go-module-panel-"+GO.settings.start_module,tabPosition:"top",items:a});this.tabPanel.on("contextmenu",function(f,b,d){if(b.closable){return false}var g=this.getOpenModules();if(g.length>1){f.hideTabStripItem(b);b.hide();if(b==f.activeTab){var c=f.stack.next();if(c){f.setActiveTab(c)}else{if(f.items.getCount()>0){f.setActiveTab(0)}else{f.activeTab=null}}}this.saveState()}},this)},getModulePanel:function(a){var b="go-module-panel-"+a;if(this.tabPanel.items.map[b]){return this.tabPanel.items.map[b]}else{return false}},beforeRender:function(){},init:function(){window.name="groupoffice";GO.loginDialog=new GO.dialog.LoginDialog({modal:true});GO.checker=new GO.Checker();this.fireReady();Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),{dismissDelay:0,maxWidth:500});var k=GO.moduleManager.getAllPanelConfigs();var g=[];this.startMenu=new Ext.menu.Menu({id:"startMenu"});if(k.length==0){g=new Ext.Panel({id:"go-module-panel-"+GO.settings.start_module,region:"center",border:false,cls:"go-form-panel",title:"No modules",html:"<h1>No modules available</h1>You have a valid account but you don't have access to any of the modules. Please contact the administrator if you feel this is an error."})}var j=[];var d;this.state=Ext.state.Manager.get("open-modules");for(var c=0;c<k.length;c++){if(this.state&&this.state.indexOf(k[c].moduleName)>-1){g.push(GO.moduleManager.getPanel(k[c].moduleName))}d={id:"go-start-menu-"+k[c].moduleName,moduleName:k[c].moduleName,text:k[c].title,iconCls:"go-menu-icon-"+k[c].moduleName,handler:function(o,p){this.openModule(o.moduleName)},scope:this};if(!k[c].admin){if(!this.state){g.push(GO.moduleManager.getPanel(k[c].moduleName))}this.startMenu.add(d)}else{j.push(d)}}if(j.length){this.startMenu.add(new Ext.menu.TextItem({id:"go-start-menu-admin-menu",text:'<div class="menu-title">'+GO.lang.adminMenu+"</div>"}));for(var c=0;c<j.length;c++){this.startMenu.add(j[c])}}this.createTabPanel(g);this.beforeRender();var e=new Ext.Panel({region:"north",contentEl:"mainNorthPanel",cls:"go-top-panel",height:28,titlebar:false,border:false});GO.viewport=new Ext.Viewport({layout:"border",border:false,items:[e,this.tabPanel]});this.startMenuLink=Ext.get("start-menu-link");this.startMenuLink.on("click",function(){var o=this.startMenuLink.getX();var p=e.el.getY()+e.el.getHeight();this.startMenu.showAt([o,p])},this);var a=Ext.get("configuration-link");if(a){a.on("click",function(){if(!this.personalSettingsDialog){this.personalSettingsDialog=new GO.PersonalSettingsDialog()}this.personalSettingsDialog.show()},this)}var f=Ext.get("help-link");if(f){var n=new Ext.menu.Menu({id:"helpMenu",items:[{iconCls:"btn-help",text:GO.lang.strHelpContents,handler:function(){var o=window.open(GO.settings.config.help_link);o.focus()},scope:this},{iconCls:"btn-forum",text:GO.lang.strCommunityForum,handler:function(){var o=window.open("http://www.group-office.com/forum/");o.focus()},scope:this},"-",{iconCls:"btn-support",text:GO.lang.contactSupportDesk,handler:function(){GO.supportLink=GO.settings.config.webmaster_email;if(Ext.form.VTypes.email(GO.supportLink)){if(GO.email&&GO.settings.modules.email.read_permission){GO.email.showComposer({values:{to:GO.supportLink}})}else{document.location="mailto:"+GO.supportLink}}else{window.open(GO.supportLink)}},scope:this},{iconCls:"btn-report-bug",text:GO.lang.strReportBug,handler:function(){var o=window.open("https://sourceforge.net/tracker2/?func=add&group_id=76359&atid=547651");o.focus()},scope:this},"-",{iconCls:"btn-info",text:GO.lang.strAbout.replace("{product_name}",GO.settings.config.product_name),handler:function(){if(!this.aboutDialog){this.aboutDialog=new GO.dialog.AboutDialog()}this.aboutDialog.show()},scope:this}]});f.on("click",function(){var o=f.getX();var p=e.el.getY()+e.el.getHeight();n.showAt([o,p])},this)}var b=this.tabPanel.getLayout().activeItem;if(!b){this.tabPanel.setActiveTab(0)}GO.checker.init.defer(2000,GO.checker);GO.checker.on("alert",function(o){if(o.notification_area){Ext.get("notification-area").update(o.notification_area)}},this);if(GO.settings.modules.search&&GO.settings.modules.search.read_permission){var l=new Ext.form.TextField({name:"search_query",enableKeyEvents:true,emptyText:GO.lang.strSearch+"...",listeners:{scope:this,keypress:function(p,o){if(o.getKey()==Ext.EventObject.ENTER){if(!this.searchPanel){this.searchPanel=new GO.grid.SearchPanel({query:p.getValue(),id:"go-search-panel"});this.tabPanel.add(this.searchPanel)}else{this.searchPanel.query=p.getValue();this.searchPanel.load()}this.tabPanel.unhideTabStripItem(this.searchPanel);this.searchPanel.show()}},blur:function(o){o.reset()}},renderTo:"search_query"})}Ext.QuickTips.register({text:GO.lang.rightClickToClose,title:GO.lang.closeApps,target:this.startMenuLink});this.rendered=true;this.fireEvent("render");this.removeLoadMask()},initModule:function(b){var c="go-module-panel-"+b;var a;if(!this.tabPanel.items.map[c]){a=GO.moduleManager.getPanel(b);if(a){a.id=c;this.tabPanel.add(a);this.saveState()}else{return false}}else{a=this.tabPanel.items.map[c];this.tabPanel.unhideTabStripItem(a)}return a},openModule:function(b){var a=this.initModule(b);if(a){a.show();return a}else{return false}},removeLoadMask:function(){var b=Ext.get("loading");var a=Ext.get("loading-mask");a.setOpacity(0.8);a.shift({xy:b.getXY(),width:b.getWidth(),height:b.getHeight(),remove:true,duration:1,opacity:0.3,easing:"bounceOut",callback:function(){b.fadeOut({duration:0.2,remove:true})}})},createBox:function(a,c,b){if(!b){b=400}return['<div class="msg" style="width:'+b+'px;position:relative;margin:auto">','<div class="x-box-tl"><div class="x-box-tr"><div class="x-box-tc"></div></div></div>','<div class="x-box-ml"><div class="x-box-mr"><div class="x-box-mc"><h3>',a,"</h3>",c,"</div></div></div>",'<div class="x-box-bl"><div class="x-box-br"><div class="x-box-bc"></div></div></div>',"</div>"].join("")},msg:function(f,e,d,c){if(!d){d=4}if(!this.msgCt){this.msgCt=Ext.DomHelper.insertFirst(document.body,{id:"msg-div"},true)}if(this.tabPanel){this.msgCt.alignTo(this.tabPanel.el,"tr-tr")}else{this.msgCt.alignTo(Ext.getBody(),"t-t",[0,20])}var b=String.format.apply(String,Array.prototype.slice.call(arguments,1));var a=Ext.DomHelper.append(this.msgCt,{html:this.createBox(f,b,c)},true);a.slideIn("t").pause(d).ghost("t",{remove:true})},onLinksDeletedHandler:function(a,d,b){if(a){for(var c=0;c<a.length;c++){if(b.getById(a[c])){d.on("show",function(){b.reload()},this,{single:true})}}}}});GO.mainLayout=new GO.MainLayout();GO.layout.ColumnFitLayout=Ext.extend(Ext.layout.ColumnLayout,{onLayout:function(e,j){GO.layout.ColumnFitLayout.superclass.onLayout.apply(this,arguments);var g=e.items.items,a=g.length,k,d;var b=Ext.isIE&&j.dom!=Ext.getBody().dom?j.getStyleSize():j.getViewSize();var f=b.height-j.getPadding("tb");for(d=0;d<a;d++){k=g[d];k.setHeight(f+(k.footer?k.footer.getHeight():0))}}});Ext.Container.LAYOUTS.columnfit=GO.layout.ColumnFitLayout;GO.Window=function(a){if(!a){a={}}a.maximizable=true;a.minimizable=true;if(!a.keys){a.keys=[]}GO.Window.superclass.constructor.call(this,a)};GO.Window=Ext.extend(Ext.Window,{temporaryListeners:[],addListenerTillHide:function(a,c,b){this.on(a,c,b);this.temporaryListeners.push({eventName:a,fn:c,scope:b})},beforeShow:function(){GO.Window.superclass.beforeShow.call(this);if(GO.viewport){var b=GO.viewport.getEl().getHeight();var a=GO.viewport.getEl().getWidth();if(this.height>b){this.setHeight(b)}if(this.width>a){this.setWidth(a)}var c=this.getPosition();if(c[0]<0||c[0]+this.width>a||c[1]<0||c[1]+this.height>b){this.center()}}},getState:function(){var a=GO.Window.superclass.getState.call(this);delete a.x;delete a.y;return a},show:function(){GO.dialogListeners.apply(this);GO.Window.superclass.show.call(this)},hide:function(){for(var a=0;a<this.temporaryListeners.length;a++){this.un(this.temporaryListeners[a].eventName,this.temporaryListeners[a].fn,this.temporaryListeners[a].scope)}this.temporaryListeners=[];GO.Window.superclass.hide.call(this)}});GO.dialog.PasswordDialog=function(a){if(!a){a={}}a.modal=true;Ext.apply(this,a);this.formPanel=new Ext.FormPanel({labelWidth:120,layout:"form",bodyStyle:"padding:5px 10px 5px 10px",items:[this.passwordField=new Ext.form.TextField({fieldLabel:GO.lang.strPassword,name:"password",inputType:"password",allowBlank:false,anchor:"100%"})]});GO.dialog.PasswordDialog.superclass.constructor.call(this,{layout:"fit",width:400,height:100,resizable:false,modal:true,closeAction:"hide",closable:false,focus:function(){this.formPanel.form.findField("password").focus(true)}.createDelegate(this),items:[this.formPanel],buttons:[{text:GO.lang.cmdOk,handler:function(){this.pressButton("ok")},scope:this},{text:GO.lang.cmdCancel,handler:function(){this.pressButton("cancel")},scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:function(){this.pressButton("ok")},scope:this}]});this.addEvents({buttonpressed:true});if(a.fn){if(!a.scope){a.scope=this}this.on("buttonpressed",a.fn,a.scope)}};Ext.extend(GO.dialog.PasswordDialog,GO.Window,{pressButton:function(a){this.fireEvent("buttonpressed",a,this.formPanel.form.findField("password").getValue(),this);this.formPanel.form.reset();this.hide()}});GO.DialogListeners=function(){};GO.DialogListeners.prototype={listeners:{},add:function(a,b){if(!this.listeners[a]){this.listeners[a]=[]}this.listeners[a].push(b)},apply:function(c){if(c.goDialogId){if(this.listeners[c.goDialogId]){for(var b=0,a=this.listeners[c.goDialogId].length;b<a;b++){c.on(this.listeners[c.goDialogId][b])}this.listeners[c.goDialogId]=[]}}}};GO.dialogListeners=new GO.DialogListeners();Ext.namespace("GO.menu");GO.menu.JsonMenu=function(a){GO.menu.JsonMenu.superclass.constructor.call(this,a);this.on("show",this.onMenuLoad,this);this.store.on("load",this.onLoad,this)};Ext.extend(GO.menu.JsonMenu,Ext.menu.Menu,{loadingText:GO.lang.waitMsgLoad,loaded:false,onMenuLoad:function(){if(!this.store.loaded){this.store.load()}else{if(!this.loaded){this.updateMenuItems()}}},updateMenuItems:function(){if(this.rendered){this.removeAll();this.el.sync();var records=this.store.getRange();for(var i=0,len=records.length;i<len;i++){if(records[i].json.handler){eval("records[i].json.handler = "+records[i].json.handler)}if(records[i].json.menu){eval("records[i].json.menu = "+records[i].json.menu)}this.add(records[i].json)}this.loaded=true}},onLoad:function(b,a){this.updateMenuItems()}});
/*
 * Ext JS Library 3.3.1
 * Copyright(c) 2006-2010 Sencha Inc.
 * licensing@sencha.com
 * http://www.sencha.com/license
 */
(function(){var a=Ext.Toolbar;GO.SmallPagingToolbar=Ext.extend(Ext.Toolbar,{pageSize:20,firstText:"First Page",prevText:"Previous Page",nextText:"Next Page",lastText:"Last Page",refreshText:"Refresh",initComponent:function(){var c=[this.prev=new a.Button({tooltip:this.prevText,overflowText:this.prevText,iconCls:"x-tbar-page-prev",disabled:true,handler:this.movePrevious,scope:this}),this.inputItem=new Ext.form.NumberField({cls:"x-tbar-page-number",allowDecimals:false,allowNegative:false,enableKeyEvents:true,selectOnFocus:true,submitValue:false,listeners:{scope:this,keydown:this.onPagingKeyDown,blur:this.onPagingBlur}}),this.next=new a.Button({tooltip:this.nextText,overflowText:this.nextText,iconCls:"x-tbar-page-next",disabled:true,handler:this.moveNext,scope:this})];var b=this.items||this.buttons||[];if(this.prependButtons){this.items=b.concat(c)}else{this.items=c.concat(b)}delete this.buttons;GO.SmallPagingToolbar.superclass.initComponent.call(this);this.addEvents("change","beforechange");this.on("afterlayout",this.onFirstLayout,this,{single:true});this.cursor=0;this.bindStore(this.store,true)},onFirstLayout:function(){if(this.dsLoaded){this.onLoad.apply(this,this.dsLoaded)}},onLoad:function(b,e,k){if(!this.rendered){this.dsLoaded=[b,e,k];return}var f=this.getParams();this.cursor=(k.params&&k.params[f.start])?k.params[f.start]:0;var j=this.getPageData(),c=j.activePage,g=j.pages;this.inputItem.setValue(c);this.prev.setDisabled(c==1);this.next.setDisabled(c==g);this.fireEvent("change",this,j)},getPageData:function(){var b=this.store.getTotalCount();return{total:b,activePage:Math.ceil((this.cursor+this.pageSize)/this.pageSize),pages:b<this.pageSize?1:Math.ceil(b/this.pageSize)}},changePage:function(b){this.doLoad(((b-1)*this.pageSize).constrain(0,this.store.getTotalCount()))},onLoadError:function(){if(!this.rendered){return}this.refresh.enable()},readPage:function(e){var b=this.inputItem.getValue(),c;if(!b||isNaN(c=parseInt(b,10))){this.inputItem.setValue(e.activePage);return false}return c},onPagingFocus:function(){this.inputItem.select()},onPagingBlur:function(b){this.inputItem.setValue(this.getPageData().activePage)},onPagingKeyDown:function(j,g){var c=g.getKey(),l=this.getPageData(),f;if(c==g.RETURN){g.stopEvent();f=this.readPage(l);if(f!==false){f=Math.min(Math.max(1,f),l.pages)-1;this.doLoad(f*this.pageSize)}}else{if(c==g.HOME||c==g.END){g.stopEvent();f=c==g.HOME?1:l.pages;j.setValue(f)}else{if(c==g.UP||c==g.PAGEUP||c==g.DOWN||c==g.PAGEDOWN){g.stopEvent();if((f=this.readPage(l))){var b=g.shiftKey?10:1;if(c==g.DOWN||c==g.PAGEDOWN){b*=-1}f+=b;if(f>=1&f<=l.pages){j.setValue(f)}}}}}},getParams:function(){return this.paramNames||this.store.paramNames},beforeLoad:function(){if(this.rendered&&this.refresh){this.refresh.disable()}},doLoad:function(d){var c={},b=this.getParams();c[b.start]=d;c[b.limit]=this.pageSize;if(this.fireEvent("beforechange",this,c)!==false){this.store.load({params:c})}},moveFirst:function(){this.doLoad(0)},movePrevious:function(){this.doLoad(Math.max(0,this.cursor-this.pageSize))},moveNext:function(){this.doLoad(this.cursor+this.pageSize)},moveLast:function(){var c=this.store.getTotalCount(),b=c%this.pageSize;this.doLoad(b?(c-b):c-this.pageSize)},doRefresh:function(){this.doLoad(this.cursor)},bindStore:function(c,d){var b;if(!d&&this.store){if(c!==this.store&&this.store.autoDestroy){this.store.destroy()}else{this.store.un("beforeload",this.beforeLoad,this);this.store.un("load",this.onLoad,this);this.store.un("exception",this.onLoadError,this)}if(!c){this.store=null}}if(c){c=Ext.StoreMgr.lookup(c);c.on({scope:this,beforeload:this.beforeLoad,load:this.onLoad,exception:this.onLoadError});b=true}this.store=c;if(b){this.onLoad(c,null,{})}},unbind:function(b){this.bindStore(null)},bind:function(b){this.bindStore(b)},onDestroy:function(){this.bindStore(null);GO.SmallPagingToolbar.superclass.onDestroy.call(this)}})})();GO.WeekPicker=function(a){a=a||{};a.cls="go-weekpicker";a.items=[{iconCls:"btn-left-arrow",text:GO.lang.cmdPrevious,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,-7))},scope:this},this.periodInfoPanel=new Ext.Panel({plain:true,border:true,cls:"cal-period"}),{iconCls:"btn-right-arrow",text:GO.lang.cmdNext,cls:"x-btn-text-icon",handler:function(){this.setDate(this.sunday.add(Date.DAY,7))},scope:this},{text:GO.lang.today,handler:function(){this.setDate()},scope:this}];GO.WeekPicker.superclass.constructor.call(this,a);this.addEvents({change:true})};Ext.extend(GO.WeekPicker,Ext.Toolbar,{sunday:false,setDate:function(c,d){if(!c){var b=new Date();c=b.getLastSunday()}if(this.fireEvent("beforechange",this,c,this.sunday)!==false){this.sunday=c;var a=this.sunday.add(Date.DAY,1);this.goToLink.update(GO.lang.strWeek+" "+a.format("W")+" ("+a.format(GO.settings.date_format)+")");if(!d){this.fireEvent("change",this,this.sunday)}}},getDate:function(){return this.sunday},afterRender:function(){GO.WeekPicker.superclass.afterRender.call(this);this.goToLink=Ext.DomHelper.append(this.periodInfoPanel.body,{tag:"a",href:"#",html:""},true);this.goToLink.on("click",function(){if(!this.gotoWeekDialog){this.gotoWeekDialog=new GO.GoToWeekDialog()}this.gotoWeekDialog.show(this)},this);this.setDate()}});GO.GoToWeekDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.formPanel.items.items[0].focus()};b.layout="fit";b.title=GO.projects.lang.goToWeek;b.modal=false;b.width=335;b.height=135;b.resizable=false;b.closeAction="hide";b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.GoToWeekDialog.superclass.constructor.call(this,b)};Ext.extend(GO.GoToWeekDialog,Ext.Window,{show:function(b){this.wp=b;if(!this.rendered){this.render(Ext.getBody())}var d=this.wp.periodInfoPanel.getPosition();this.setPosition(d[0],d[1]+20);this.formPanel.form.reset();var a=new Date(this.wp.sunday);var c=a.format("Y");this.year.setValue(c);this.setYear(c);GO.GoToWeekDialog.superclass.show.call(this)},buildForm:function(){this.formPanel=new Ext.form.FormPanel({cls:"go-form-panel",layout:"form",waitMsgTarget:true,labelWidth:50,border:false,anchor:"95% 95%",items:[this.year=new Ext.form.TextField({name:"year",fieldLabel:GO.lang.strYear,allowBlank:false,anchor:"95%",selectOnFocus:true}),this.selectWeek=new GO.form.ComboBox({fieldLabel:GO.lang.strWeek,hiddenName:"date",emptyText:GO.lang.selectWeek,store:new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"get_weeks"},root:"results",id:"value",totalProperty:"total",fields:["value","text"],remoteSort:true}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true,allowBlank:false,anchor:"95%"})]});this.year.on("change",function(){this.setYear(this.year.getValue())},this);this.selectWeek.on("select",function(c,b){var a=new Date(this.selectWeek.getValue()*1000);this.wp.setDate(a);this.hide()},this)},setYear:function(a){this.selectWeek.store.baseParams.year=a;this.selectWeek.store.load()}});GO.users.TimeZones=[["Africa/Abidjan"],["Africa/Accra"],["Africa/Addis_Ababa"],["Africa/Algiers"],["Africa/Asmara"],["Africa/Asmera"],["Africa/Bamako"],["Africa/Bangui"],["Africa/Banjul"],["Africa/Bissau"],["Africa/Blantyre"],["Africa/Brazzaville"],["Africa/Bujumbura"],["Africa/Cairo"],["Africa/Casablanca"],["Africa/Ceuta"],["Africa/Conakry"],["Africa/Dakar"],["Africa/Dar_es_Salaam"],["Africa/Djibouti"],["Africa/Douala"],["Africa/El_Aaiun"],["Africa/Freetown"],["Africa/Gaborone"],["Africa/Harare"],["Africa/Johannesburg"],["Africa/Kampala"],["Africa/Khartoum"],["Africa/Kigali"],["Africa/Kinshasa"],["Africa/Lagos"],["Africa/Libreville"],["Africa/Lome"],["Africa/Luanda"],["Africa/Lubumbashi"],["Africa/Lusaka"],["Africa/Malabo"],["Africa/Maputo"],["Africa/Maseru"],["Africa/Mbabane"],["Africa/Mogadishu"],["Africa/Monrovia"],["Africa/Nairobi"],["Africa/Ndjamena"],["Africa/Niamey"],["Africa/Nouakchott"],["Africa/Ouagadougou"],["Africa/Porto-Novo"],["Africa/Sao_Tome"],["Africa/Timbuktu"],["Africa/Tripoli"],["Africa/Tunis"],["Africa/Windhoek"],["America/Adak"],["America/Anchorage"],["America/Anguilla"],["America/Antigua"],["America/Araguaina"],["America/Argentina/Buenos_Aires"],["America/Argentina/Catamarca"],["America/Argentina/ComodRivadavia"],["America/Argentina/Cordoba"],["America/Argentina/Jujuy"],["America/Argentina/La_Rioja"],["America/Argentina/Mendoza"],["America/Argentina/Rio_Gallegos"],["America/Argentina/San_Juan"],["America/Argentina/Tucuman"],["America/Argentina/Ushuaia"],["America/Aruba"],["America/Asuncion"],["America/Atikokan"],["America/Atka"],["America/Bahia"],["America/Barbados"],["America/Belem"],["America/Belize"],["America/Blanc-Sablon"],["America/Boa_Vista"],["America/Bogota"],["America/Boise"],["America/Buenos_Aires"],["America/Cambridge_Bay"],["America/Campo_Grande"],["America/Cancun"],["America/Caracas"],["America/Catamarca"],["America/Cayenne"],["America/Cayman"],["America/Chicago"],["America/Chihuahua"],["America/Coral_Harbour"],["America/Cordoba"],["America/Costa_Rica"],["America/Cuiaba"],["America/Curacao"],["America/Danmarkshavn"],["America/Dawson"],["America/Dawson_Creek"],["America/Denver"],["America/Detroit"],["America/Dominica"],["America/Edmonton"],["America/Eirunepe"],["America/El_Salvador"],["America/Ensenada"],["America/Fort_Wayne"],["America/Fortaleza"],["America/Glace_Bay"],["America/Godthab"],["America/Goose_Bay"],["America/Grand_Turk"],["America/Grenada"],["America/Guadeloupe"],["America/Guatemala"],["America/Guayaquil"],["America/Guyana"],["America/Halifax"],["America/Havana"],["America/Hermosillo"],["America/Indiana/Indianapolis"],["America/Indiana/Knox"],["America/Indiana/Marengo"],["America/Indiana/Petersburg"],["America/Indiana/Vevay"],["America/Indiana/Vincennes"],["America/Indiana/Winamac"],["America/Indianapolis"],["America/Inuvik"],["America/Iqaluit"],["America/Jamaica"],["America/Jujuy"],["America/Juneau"],["America/Kentucky/Louisville"],["America/Kentucky/Monticello"],["America/Knox_IN"],["America/La_Paz"],["America/Lima"],["America/Los_Angeles"],["America/Louisville"],["America/Maceio"],["America/Managua"],["America/Manaus"],["America/Martinique"],["America/Mazatlan"],["America/Mendoza"],["America/Menominee"],["America/Merida"],["America/Mexico_City"],["America/Miquelon"],["America/Moncton"],["America/Monterrey"],["America/Montevideo"],["America/Montreal"],["America/Montserrat"],["America/Nassau"],["America/New_York"],["America/Nipigon"],["America/Nome"],["America/Noronha"],["America/North_Dakota/Center"],["America/North_Dakota/New_Salem"],["America/Panama"],["America/Pangnirtung"],["America/Paramaribo"],["America/Phoenix"],["America/Port-au-Prince"],["America/Port_of_Spain"],["America/Porto_Acre"],["America/Porto_Velho"],["America/Puerto_Rico"],["America/Rainy_River"],["America/Rankin_Inlet"],["America/Recife"],["America/Regina"],["America/Resolute"],["America/Rio_Branco"],["America/Rosario"],["America/Santiago"],["America/Santo_Domingo"],["America/Sao_Paulo"],["America/Scoresbysund"],["America/Shiprock"],["America/St_Johns"],["America/St_Kitts"],["America/St_Lucia"],["America/St_Thomas"],["America/St_Vincent"],["America/Swift_Current"],["America/Tegucigalpa"],["America/Thule"],["America/Thunder_Bay"],["America/Tijuana"],["America/Toronto"],["America/Tortola"],["America/Vancouver"],["America/Virgin"],["America/Whitehorse"],["America/Winnipeg"],["America/Yakutat"],["America/Yellowknife"],["Antarctica/Casey"],["Antarctica/Davis"],["Antarctica/DumontDUrville"],["Antarctica/Mawson"],["Antarctica/McMurdo"],["Antarctica/Palmer"],["Antarctica/Rothera"],["Antarctica/South_Pole"],["Antarctica/Syowa"],["Antarctica/Vostok"],["Arctic/Longyearbyen"],["Asia/Aden"],["Asia/Almaty"],["Asia/Amman"],["Asia/Anadyr"],["Asia/Aqtau"],["Asia/Aqtobe"],["Asia/Ashgabat"],["Asia/Ashkhabad"],["Asia/Baghdad"],["Asia/Bahrain"],["Asia/Baku"],["Asia/Bangkok"],["Asia/Beirut"],["Asia/Bishkek"],["Asia/Brunei"],["Asia/Calcutta"],["Asia/Choibalsan"],["Asia/Chongqing"],["Asia/Chungking"],["Asia/Colombo"],["Asia/Dacca"],["Asia/Damascus"],["Asia/Dhaka"],["Asia/Dili"],["Asia/Dubai"],["Asia/Dushanbe"],["Asia/Gaza"],["Asia/Harbin"],["Asia/Hong_Kong"],["Asia/Hovd"],["Asia/Irkutsk"],["Asia/Istanbul"],["Asia/Jakarta"],["Asia/Jayapura"],["Asia/Jerusalem"],["Asia/Kabul"],["Asia/Kamchatka"],["Asia/Karachi"],["Asia/Kashgar"],["Asia/Katmandu"],["Asia/Krasnoyarsk"],["Asia/Kuala_Lumpur"],["Asia/Kuching"],["Asia/Kuwait"],["Asia/Macao"],["Asia/Macau"],["Asia/Magadan"],["Asia/Makassar"],["Asia/Manila"],["Asia/Muscat"],["Asia/Nicosia"],["Asia/Novosibirsk"],["Asia/Omsk"],["Asia/Oral"],["Asia/Phnom_Penh"],["Asia/Pontianak"],["Asia/Pyongyang"],["Asia/Qatar"],["Asia/Qyzylorda"],["Asia/Rangoon"],["Asia/Riyadh"],["Asia/Saigon"],["Asia/Sakhalin"],["Asia/Samarkand"],["Asia/Seoul"],["Asia/Shanghai"],["Asia/Singapore"],["Asia/Taipei"],["Asia/Tashkent"],["Asia/Tbilisi"],["Asia/Tehran"],["Asia/Tel_Aviv"],["Asia/Thimbu"],["Asia/Thimphu"],["Asia/Tokyo"],["Asia/Ujung_Pandang"],["Asia/Ulaanbaatar"],["Asia/Ulan_Bator"],["Asia/Urumqi"],["Asia/Vientiane"],["Asia/Vladivostok"],["Asia/Yakutsk"],["Asia/Yekaterinburg"],["Asia/Yerevan"],["Atlantic/Azores"],["Atlantic/Bermuda"],["Atlantic/Canary"],["Atlantic/Cape_Verde"],["Atlantic/Faeroe"],["Atlantic/Faroe"],["Atlantic/Jan_Mayen"],["Atlantic/Madeira"],["Atlantic/Reykjavik"],["Atlantic/South_Georgia"],["Atlantic/St_Helena"],["Atlantic/Stanley"],["Australia/ACT"],["Australia/Adelaide"],["Australia/Brisbane"],["Australia/Broken_Hill"],["Australia/Canberra"],["Australia/Currie"],["Australia/Darwin"],["Australia/Eucla"],["Australia/Hobart"],["Australia/LHI"],["Australia/Lindeman"],["Australia/Lord_Howe"],["Australia/Melbourne"],["Australia/North"],["Australia/NSW"],["Australia/Perth"],["Australia/Queensland"],["Australia/South"],["Australia/Sydney"],["Australia/Tasmania"],["Australia/Victoria"],["Australia/West"],["Australia/Yancowinna"],["Brazil/Acre"],["Brazil/DeNoronha"],["Brazil/East"],["Brazil/West"],["Canada/Atlantic"],["Canada/Central"],["Canada/East-Saskatchewan"],["Canada/Eastern"],["Canada/Mountain"],["Canada/Newfoundland"],["Canada/Pacific"],["Canada/Saskatchewan"],["Canada/Yukon"],["CET"],["Chile/Continental"],["Chile/EasterIsland"],["CST6CDT"],["Cuba"],["EET"],["Egypt"],["Eire"],["EST"],["EST5EDT"],["Etc/GMT"],["Etc/GMT0"],["Etc/Greenwich"],["Etc/UCT"],["Etc/Universal"],["Etc/UTC"],["Etc/Zulu"],["Europe/Amsterdam"],["Europe/Andorra"],["Europe/Athens"],["Europe/Belfast"],["Europe/Belgrade"],["Europe/Berlin"],["Europe/Bratislava"],["Europe/Brussels"],["Europe/Bucharest"],["Europe/Budapest"],["Europe/Chisinau"],["Europe/Copenhagen"],["Europe/Dublin"],["Europe/Gibraltar"],["Europe/Guernsey"],["Europe/Helsinki"],["Europe/Isle_of_Man"],["Europe/Istanbul"],["Europe/Jersey"],["Europe/Kaliningrad"],["Europe/Kiev"],["Europe/Lisbon"],["Europe/Ljubljana"],["Europe/London"],["Europe/Luxembourg"],["Europe/Madrid"],["Europe/Malta"],["Europe/Mariehamn"],["Europe/Minsk"],["Europe/Monaco"],["Europe/Moscow"],["Europe/Nicosia"],["Europe/Oslo"],["Europe/Paris"],["Europe/Podgorica"],["Europe/Prague"],["Europe/Riga"],["Europe/Rome"],["Europe/Samara"],["Europe/San_Marino"],["Europe/Sarajevo"],["Europe/Simferopol"],["Europe/Skopje"],["Europe/Sofia"],["Europe/Stockholm"],["Europe/Tallinn"],["Europe/Tirane"],["Europe/Tiraspol"],["Europe/Uzhgorod"],["Europe/Vaduz"],["Europe/Vatican"],["Europe/Vienna"],["Europe/Vilnius"],["Europe/Volgograd"],["Europe/Warsaw"],["Europe/Zagreb"],["Europe/Zaporozhye"],["Europe/Zurich"],["Factory"],["GB"],["GB-Eire"],["GMT+0"],["GMT-0"],["GMT0"],["Greenwich"],["Hongkong"],["HST"],["Iceland"],["Indian/Antananarivo"],["Indian/Chagos"],["Indian/Christmas"],["Indian/Cocos"],["Indian/Comoro"],["Indian/Kerguelen"],["Indian/Mahe"],["Indian/Maldives"],["Indian/Mauritius"],["Indian/Mayotte"],["Indian/Reunion"],["Iran"],["Israel"],["Jamaica"],["Japan"],["Kwajalein"],["Libya"],["MET"],["Mexico/BajaNorte"],["Mexico/BajaSur"],["Mexico/General"],["MST"],["MST7MDT"],["Navajo"],["NZ"],["NZ-CHAT"],["Pacific/Apia"],["Pacific/Auckland"],["Pacific/Chatham"],["Pacific/Easter"],["Pacific/Efate"],["Pacific/Enderbury"],["Pacific/Fakaofo"],["Pacific/Fiji"],["Pacific/Funafuti"],["Pacific/Galapagos"],["Pacific/Gambier"],["Pacific/Guadalcanal"],["Pacific/Guam"],["Pacific/Honolulu"],["Pacific/Johnston"],["Pacific/Kiritimati"],["Pacific/Kosrae"],["Pacific/Kwajalein"],["Pacific/Majuro"],["Pacific/Marquesas"],["Pacific/Midway"],["Pacific/Nauru"],["Pacific/Niue"],["Pacific/Norfolk"],["Pacific/Noumea"],["Pacific/Pago_Pago"],["Pacific/Palau"],["Pacific/Pitcairn"],["Pacific/Ponape"],["Pacific/Port_Moresby"],["Pacific/Rarotonga"],["Pacific/Saipan"],["Pacific/Samoa"],["Pacific/Tahiti"],["Pacific/Tarawa"],["Pacific/Tongatapu"],["Pacific/Truk"],["Pacific/Wake"],["Pacific/Wallis"],["Pacific/Yap"],["Poland"],["Portugal"],["PRC"],["PST8PDT"],["ROC"],["ROK"],["Singapore"],["Turkey"],["UCT"],["Universal"],["US/Alaska"],["US/Aleutian"],["US/Arizona"],["US/Central"],["US/East-Indiana"],["US/Eastern"],["US/Hawaii"],["US/Indiana-Starke"],["US/Michigan"],["US/Mountain"],["US/Pacific"],["US/Pacific-New"],["US/Samoa"],["W-SU"],["WET"],["Zulu"]];GO.PersonalSettingsDialog=function(a){if(!a){a={}}this.buildForm();a.layout="fit";a.modal=true;a.resizable=true;a.maxizable=true;a.width=900;a.height=520;a.closeAction="hide";a.title=GO.lang.settings;a.items=this.formPanel;a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.PersonalSettingsDialog.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.PersonalSettingsDialog,GO.Window,{reload:false,show:function(){this.reload=false;if(!this.rendered){this.render(Ext.getBody());this.tabPanel.items.items[0].languageCombo.on("change",function(){this.reload=true},this);if(this.tabPanel.items.items[1].themeCombo){this.tabPanel.items.items[1].themeCombo.on("change",function(){this.reload=true},this)}}this.formPanel.form.baseParams.user_id=GO.settings.user_id;this.user_id=GO.settings.user_id;if(!this.loaded){this.formPanel.load({url:BaseHref+"json.php",success:function(d,e){this.loaded=true;GO.PersonalSettingsDialog.superclass.show.call(this);for(var b=0;b<this.tabPanel.items.getCount();b++){var a=this.tabPanel.items.itemAt(b);if(a.onLoadSettings){var c=a.onLoadSettings.createDelegate(a,[e]);c.call()}}},failure:function(a,b){Ext.Msg.alert(GO.lang.strError,b.result.feedback)},scope:this})}else{GO.PersonalSettingsDialog.superclass.show.call(this)}},setWritePermission:function(a){this.buttons[0].setDisabled(!a);this.buttons[1].setDisabled(!a);this.linksPanel.setWritePermission(a)},submitForm:function(d){for(var c=0;c<this.tabPanel.items.getCount();c++){var b=this.tabPanel.items.itemAt(c);if(b.onBeforeSaveSettings){var e=b.onBeforeSaveSettings.createDelegate(b,[this]);var a=e.call();if(!a){this.tabPanel.setActiveTab(b);return false}}}this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_settings"},waitMsg:GO.lang.waitMsgSave,success:function(k,l){this.fireEvent("save",this);for(var g=0;g<this.tabPanel.items.getCount();g++){var f=this.tabPanel.items.itemAt(g);if(f.onSaveSettings){var j=f.onSaveSettings.createDelegate(f,[l]);j.call()}}GO.settings.mute_sound=this.formPanel.form.findField("mute_sound").getValue();GO.settings.mute_reminder_sound=this.formPanel.form.findField("mute_reminder_sound").getValue();GO.settings.mute_new_mail_sound=this.formPanel.form.findField("mute_new_mail_sound").getValue();GO.settings.popup_reminders=this.formPanel.form.findField("popup_reminders").getValue();GO.settings.show_smilies=this.formPanel.form.findField("show_smilies").getValue();document.location=GO.settings.config.host},failure:function(f,g){if(g.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,g.result.feedback)}},scope:this})},buildForm:function(){this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,anchor:"100% 100%",enableTabScroll:true,border:false,items:GO.moduleManager.getAllSettingsPanels()});this.formPanel=new Ext.form.FormPanel({items:this.tabPanel,baseParams:{task:"settings"},waitMsgTarget:true,border:false})}});GO.users.RegionalSettingsPanel=function(d){if(!d){d={}}this.autoScroll=true;var e=new Ext.data.SimpleStore({fields:["id","date_format"],data:[["dmY",GO.users.lang.dmy],["mdY",GO.users.lang.mdy],["Ymd",GO.users.lang.jmd]]});var f=new Ext.data.SimpleStore({fields:["id","date_separator"],data:[["-","-"],[".","."],["/","/"]]});var b=new Ext.data.SimpleStore({fields:["id","time_format"],data:[["G:i",GO.users.lang.fullhourformat],["g:i a",GO.users.lang.halfhourformat]]});var c=new Ext.data.SimpleStore({fields:["id","first_weekday"],data:[["0",GO.users.lang.sunday],["1",GO.users.lang.monday]]});var a=GO.settings.date_format.substring(0,1)+GO.settings.date_format.substring(2,3)+GO.settings.date_format.substring(4,5);d.border=false;d.hideLabel=true;d.title=GO.users.lang.regionalSettings;d.layout="column";d.defaults={columnWidth:0.5,cls:"go-form-panel",border:false};d.labelWidth=190;d.items=[{columnWidth:1,items:[{border:false,layout:"form",autoHeight:true,defaults:{anchor:"100%"},items:[this.languageCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelLanguage,name:"language_id",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),displayField:"language",valueField:"id",hiddenName:"language",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.language}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTimezone,name:"timezone",store:new Ext.data.SimpleStore({fields:["timezone"],data:GO.users.TimeZones}),displayField:"timezone",mode:"local",triggerAction:"all",selectOnFocus:true,forceSelection:true,value:GO.settings.timezone}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateFormat,name:"date_format",store:e,displayField:"date_format",value:a,valueField:"id",hiddenName:"date_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelDateSeperator,name:"date_separator_name",store:f,displayField:"date_separator",value:GO.settings.date_separator,valueField:"id",hiddenName:"date_separator",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.timeFormat,name:"time_format_name",store:b,displayField:"time_format",valueField:"id",hiddenName:"time_format",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,value:GO.settings.time_format,forceSelection:true}),new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelFirstWeekday,name:"first_weekday_name",store:c,displayField:"first_weekday",valueField:"id",hiddenName:"first_weekday",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.first_weekday})]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.numberFormat,items:[{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelThousandSeperator,name:"thousands_separator",value:GO.settings.thousands_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelDecimalSeperator,name:"decimal_separator",value:GO.settings.decimal_separator},{xtype:"textfield",fieldLabel:GO.users.lang.cmdFormLabelCurrency,name:"currency",value:GO.settings.currency}]}]},{items:[{xtype:"fieldset",defaults:{width:50},autoHeight:true,title:GO.users.lang.importExport,items:[{xtype:"textfield",fieldLabel:GO.users.lang.listSeparator,name:"list_separator",value:GO.settings.list_separator},{xtype:"textfield",fieldLabel:GO.users.lang.textSeparator,name:"text_separator",value:GO.settings.text_separator}]}]}];GO.users.RegionalSettingsPanel.superclass.constructor.call(this,d)};Ext.extend(GO.users.RegionalSettingsPanel,Ext.Panel,{});GO.users.LookAndFeelPanel=function(b){if(!b){b={}}this.autoScroll=true;b.border=false;b.hideLabel=true;b.title=GO.users.lang.cmdPanelLookFeel;b.layout="form";b.defaults={anchor:"100%"};b.defaultType="textfield";b.cls="go-form-panel";b.labelWidth=190;var a=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"themes"},root:"results",totalProperty:"total",fields:["theme"],remoteSort:true});this.modulesStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"start_module",user_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name"],remoteSort:true});b.items=[];if(GO.settings.config.allow_themes){b.items.push(this.themeCombo=new Ext.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelTheme,name:"theme",store:a,displayField:"theme",valueField:"theme",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.config.theme}))}b.items.push(this.startModuleField=new GO.form.ComboBox({fieldLabel:GO.users.lang.cmdFormLabelStartModule,name:"start_module_name",hiddenName:"start_module",store:this.modulesStore,displayField:"name",valueField:"id",mode:"remote",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.start_module}));b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelMaximunRows,store:new Ext.data.SimpleStore({fields:["value"],data:[["10"],["15"],["20"],["25"],["30"],["50"]]}),displayField:"value",valueField:"value",name:"max_rows_list",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:20});b.items.push({xtype:"combo",fieldLabel:GO.users.lang.cmdFormLabelSortNamesBy,store:new Ext.data.SimpleStore({fields:["value","text"],data:[["first_name",GO.users.lang.firstName],["last_name",GO.users.lang.lastName]]}),displayField:"text",valueField:"value",hiddenName:"sort_name",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.sort_name});this.cbMuteReminderSound=new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.users.lang.muteReminderSound,name:"mute_reminder_sound"});this.cbMuteNewMailSound=new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.users.lang.muteNewMailSound,name:"mute_new_mail_sound"});b.items.push({xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.muteSound,name:"mute_sound",listeners:{check:function(c,d){if(d){this.cbMuteNewMailSound.disable();this.cbMuteReminderSound.disable()}else{this.cbMuteNewMailSound.enable();this.cbMuteReminderSound.enable()}},scope:this}},this.cbMuteReminderSound,this.cbMuteNewMailSound,{xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.popupNotification,name:"popup_reminders"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.mailReminders,name:"mail_reminders"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.users.lang.showSmilies,name:"show_smilies"});GO.users.LookAndFeelPanel.superclass.constructor.call(this,b)};Ext.extend(GO.users.LookAndFeelPanel,Ext.Panel,{onLoadSettings:function(a){this.startModuleField.setRemoteText(a.result.data.start_module_name)}});GO.users.PasswordPanel=function(a){if(!a){a={}}var b=(a.ldap_password)?"ldap_":"";a.autoScroll=true;a.border=false;a.hideLabel=true;a.title=GO.users.lang.changePassword;a.layout="form";a.defaults={anchor:"100%"};a.defaultType="textfield";a.cls="go-form-panel";a.labelWidth=140;this.currentPasswordField=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.currentPassword,name:"current_"+b+"password"});this.passwordField1=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.newPassword,name:b+"password1"});this.passwordField2=new Ext.form.TextField({inputType:"password",fieldLabel:GO.users.lang.confirmPassword,name:b+"password2"});a.items=[this.currentPasswordField,this.passwordField1,this.passwordField2];GO.users.PasswordPanel.superclass.constructor.call(this,a)};Ext.extend(GO.users.PasswordPanel,Ext.Panel,{onSaveSettings:function(){this.currentPasswordField.reset();this.passwordField1.reset();this.passwordField2.reset()}});GO.mainLayout.onReady(function(){GO.moduleManager.addSettingsPanel("regional",GO.users.RegionalSettingsPanel);GO.moduleManager.addSettingsPanel("look_and_feel",GO.users.LookAndFeelPanel);if(GO.settings.config.allow_profile_edit){GO.moduleManager.addSettingsPanel("profile",GO.users.ProfilePanel)}if(GO.settings.config.allow_password_change&&(!GO.ldapemail||(GO.ldapemail&&!GO.ldapemail.ldapUser))){GO.moduleManager.addSettingsPanel("password",GO.users.PasswordPanel)}});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.AboutDialog=function(a){Ext.apply(this,a);GO.dialog.AboutDialog.superclass.constructor.call(this,{modal:false,layout:"fit",height:500,width:520,resizable:false,closeAction:"hide",title:GO.lang.strAbout.replace("{product_name}",GO.settings.config.product_name),items:new Ext.Panel({border:false,layout:"fit",autoLoad:"about.php",autoScroll:true}),buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.AboutDialog,Ext.Window,{});GO.LogoComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-app-logo"})}});GO.dialog.LoginDialog=function(b){if(!b){b={}}if(typeof(b.modal)=="undefined"){b.modal=true}Ext.apply(this,b);var a=new GO.form.ComboBoxReset({fieldLabel:GO.lang.strLanguage,name:"language_text",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),anchor:"100%",hiddenName:"login_language",displayField:"language",valueField:"id",mode:"local",triggerAction:"all",forceSelection:false,emptyText:GO.lang.userSelectedLanguage,editable:false,value:GO.loginSelectedLanguage||""});a.on("select",function(){if(a.getValue()!=""){document.location=BaseHref+"index.php?SET_LANGUAGE="+a.getValue()}},this);this.formPanel=new Ext.FormPanel({labelWidth:120,url:"action.php",defaultType:"textfield",waitMsgTarget:true,bodyStyle:"padding:5px 10px 5px 10px",items:[new GO.LogoComponent(),a,{itemId:"username",fieldLabel:GO.lang.strUsername,name:"username",allowBlank:false,anchor:"100%"},{fieldLabel:GO.lang.strPassword,name:"password",inputType:"password",allowBlank:false,anchor:"100%"},{xtype:"checkbox",hideLabel:true,boxLabel:GO.lang.remindPassword,name:"remind",height:20},this.fullscreenField=new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.lang.fullscreen,checked:GO.fullscreen,name:"fullscreen",height:20})]});GO.dialog.LoginDialog.superclass.constructor.call(this,{autoHeight:true,width:400,draggable:false,resizable:false,closeAction:"hide",title:GO.lang.strLogin,closable:false,items:[this.formPanel],buttons:[{text:GO.lang.lostPassword,handler:function(){Ext.Msg.prompt(GO.lang.lostPassword,GO.lang.lostPasswordText.replace("{product_name}",GO.settings.config.product_name),function(c,d){if(c=="ok"){this.hide();Ext.getBody().mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:BaseHref+"action.php",scope:this,params:{task:"lost_password",email:d},callback:function(f,j,e){Ext.getBody().unmask();this.show();if(!j){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(e.responseText);if(!g.success){Ext.MessageBox.alert(GO.lang.strError,g.feedback)}else{Ext.MessageBox.alert(GO.lang.strSuccess,g.feedback)}}}})}},this)},scope:this},{text:GO.lang.cmdOk,handler:this.doLogin,scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:this.doLogin,scope:this}]});this.addEvents({callbackshandled:true})};Ext.extend(GO.dialog.LoginDialog,GO.Window,{callbacks:new Array(),hideDialog:true,focus:function(){this.formPanel.form.findField("username").focus(true)},addCallback:function(b,a){this.callbacks.push({callback:b,scope:a})},doLogin:function(){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"login"},waitMsg:GO.lang.waitMsgLoad,success:function(a,b){if(GO.settings.user_id>0&&b.result.user_id!=GO.settings.user_id){document.location=document.location;return true}Ext.apply(GO.settings,b.result.settings);if(b.result.name==""){this.completeProfileDialog();this.profileFormPanel.form.setValues({email:b.result.email})}else{this.handleCallbacks()}if(this.hideDialog){this.hide()}},failure:function(a,b){if(b.result){Ext.MessageBox.alert(GO.lang.strError,b.result.feedback,function(){this.formPanel.form.findField("username").focus(true)},this)}},scope:this})},handleCallbacks:function(){for(var a=0;a<this.callbacks.length;a++){if(this.callbacks[a].callback){var b=this.callbacks[a].scope?this.callbacks[a].scope:this;this.callbacks[a].callback.call(b)}}this.callbacks=[];this.fireEvent("callbackshandled",this)},completeProfileDialog:function(){var a=function(){this.profileFormPanel.form.findField("first_name").focus()};this.profileFormPanel=new Ext.form.FormPanel({items:new GO.users.ProfilePanel({header:false}),baseParams:{task:"complete_profile"},url:BaseHref+"action.php",waitMsgTarget:true,border:false});this.completeProfileDialog=new GO.Window({width:900,height:560,title:GO.lang.completeProfile,autoScroll:true,resizable:true,items:this.profileFormPanel,closable:false,layout:"fit",focus:a.createDelegate(this),buttons:[{text:GO.lang.cmdOk,handler:function(){this.profileFormPanel.form.submit({waitMsg:GO.lang.waitMsgSave,success:function(c,d){this.fireEvent("save",this);if(this.profileFormPanel.onSaveSettings){var b=this.profileFormPanel.onSaveSettings.createDelegate(this.profileFormPanel,[d]);b.call()}if(this.reload){document.location=GO.settings.config.host}this.hide();this.handleCallbacks()},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},scope:this}]});this.completeProfileDialog.show()}});GO.data.JsonStore=function(a){Ext.applyIf(a,{root:"results",id:"id",totalProperty:"total",remoteSort:true});GO.data.JsonStore.superclass.constructor.call(this,a);this.on("load",function(){this.loaded=true},this);this.on("loadexception",function(d,c,b,f){if(b.status==0){}else{if(!this.reader.jsonData||GO.jsonAuthHandler(this.reader.jsonData,this.load,this)){switch(b.responseText.trim()){case"NOTLOGGEDIN":document.location=BaseHref;break;case"UNAUTHORIZED":Ext.Msg.alert(GO.lang.strUnauthorized,GO.lang.strUnauthorizedText);break;default:var g=GO.lang.serverError;if(this.reader.jsonData&&this.reader.jsonData.feedback){g+="<br /><br />"+this.reader.jsonData.feedback}g+="<br /><br />JsonStore load exception occurred";GO.errorDialog.show(g,b.responseText);break}}}},this)};Ext.extend(GO.data.JsonStore,Ext.data.JsonStore,{loaded:false});GO.grid.GridPanel=Ext.extend(Ext.grid.GridPanel,{initComponent:function(){if(!this.keys){this.keys=[]}if(!this.store){this.store=this.ds}if(!this.noDelete){this.keys.push({key:Ext.EventObject.DELETE,fn:function(a,b){if(b.target.tagName!="INPUT"){this.deleteSelected(this.deletethis)}},scope:this})}if(this.paging){if(typeof(this.paging)=="boolean"){this.paging=parseInt(GO.settings.max_rows_list)}if(!this.bbar){this.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:this.store,pageSize:this.paging,displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems})}if(!this.store.baseParams){this.store.baseParams={}}this.store.baseParams.limit=this.paging}this.loadMask=true;if(!this.sm){this.sm=this.selModel=new Ext.grid.RowSelectionModel()}if(this.standardTbar){this.tbar=this.tbar?this.tbar:[];this.tbar.push({itemId:"add",iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:this.btnAdd,disabled:this.standardTbarDisabled,scope:this},{itemId:"delete",iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",disabled:this.standardTbarDisabled,handler:function(){this.deleteSelected()},scope:this},"-",new GO.form.SearchField({store:this.store,width:150}))}GO.grid.GridPanel.superclass.initComponent.call(this);this.addEvents({delayedrowselect:true});this.on("rowcontextmenu",function(a,d,b){b.stopEvent();this.rowClicked=true;var c=this.getSelectionModel();if(c.isSelected(d)!==true){c.clearSelections();c.selectRow(d)}},this);this.on("rowclick",function(b,d,c){var a=this.getSelectionModel().getSelected();if(!c.ctrlKey&&!c.shiftKey){if(a){this.fireEvent("delayedrowselect",this,d,a)}}if(a){this.rowClicked=true}},this);this.getSelectionModel().on("rowselect",function(d,c,b){if(!this.rowClicked){var a=this.getSelectionModel().getSelected();if(a==b){this.fireEvent("delayedrowselect",this,c,b)}}this.rowClicked=false},this,{delay:250});this.on("rowdblclick",function(b,c){var a=b.getStore().getAt(c);this.dblClick(b,a,c)},this)},deleteConfig:{},paging:false,deleteSelected:function(b){b=b||{};Ext.apply(b,this.deleteConfig);if(!b.deleteParam){b.deleteParam="delete_keys"}var c={};c[b.deleteParam]=Ext.encode(this.selModel.selections.keys);var a={store:this.store,params:c,count:this.selModel.selections.keys.length,extraWarning:b.extraWarning||"",noConfirmation:b.noConfirmation};if(b.callback){a.callback=b.callback}if(b.success){a.success=b.success}if(b.failure){a.failure=b.failure}if(b.scope){a.scope=b.scope}GO.deleteItems(a)},getGridData:function(){var d={};for(var b=0;b<this.store.data.items.length;b++){var c=this.store.data.items[b].data;d[b]={};for(var a in c){d[b][a]=c[a]}}return d},numberRenderer:function(a){return GO.util.numberFormat(a)},btnAdd:function(){},dblClick:function(b,a,c){}});GO.grid.EditorGridPanel=function(a){if(!a){a={}}if(!a.keys){a.keys=[]}if(!a.store){a.store=a.ds}a.keys.push({key:Ext.EventObject.DELETE,fn:function(b,c){if(c.target.tagName!="INPUT"){this.deleteSelected(this.deleteConfig)}},scope:this});if(a.paging){if(!a.bbar){a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:parseInt(GO.settings.max_rows_list),displayInfo:true,displayMsg:GO.lang.displayingItems,emptyMsg:GO.lang.strNoItems})}if(!a.store.baseParams){a.store.baseParams={}}a.store.baseParams.limit=parseInt(GO.settings.max_rows_list)}GO.grid.EditorGridPanel.superclass.constructor.call(this,a);this.addEvents({delayedrowselect:true});this.on("rowclick",function(c,f,d){if(!d.ctrlKey&&!d.shiftKey){var b=this.getSelectionModel().getSelected();this.fireEvent("delayedrowselect",this,f,b)}this.rowClicked=true},this);this.getSelectionModel().on("rowselect",function(e,d,c){if(!this.rowClicked){var b=this.getSelectionModel().getSelected();if(b==c){this.fireEvent("delayedrowselect",this,d,c)}}this.rowClicked=false},this,{delay:250})};Ext.extend(GO.grid.EditorGridPanel,Ext.grid.EditorGridPanel,{deleteConfig:{},paging:false,deleteSelected:GO.grid.GridPanel.prototype.deleteSelected,getGridData:GO.grid.GridPanel.prototype.getGridData,numberRenderer:GO.grid.GridPanel.prototype.numberRenderer,isCellValid:function(c,e){if(!this.colModel.isCellEditable(c,e)){return true}var b=this.colModel.getCellEditor(c,e);if(!b){return true}var a=this.store.getAt(e);if(!a){return true}var d=this.colModel.getDataIndex(c);b.field.setValue(a.data[d]);return b.field.isValid(true)},isValid:function(g){var e=this.colModel.getColumnCount();var d=this.store.getCount();var b,f;var a=true;for(b=0;b<d;b++){for(f=0;f<e;f++){a=this.isCellValid(f,b);if(!a){break}}if(!a){break}}if(g&&!a){this.startEditing(b,f)}return a}});GO.grid.MultiSelectGrid=function(a){a=a||{};var b=new GO.grid.CheckColumn({header:"&nbsp;",dataIndex:"checked",width:20,listeners:{scope:this,change:function(c){c.commit();this.lastRecordClicked=c;if(this.timeoutNumber){clearTimeout(this.timeoutNumber)}this.timeoutNumber=this.applyFilter.defer(750,this,[])}}});if(a.allowNoSelection){this.allowNoSelection=true}Ext.apply(a,{plugins:[b],tools:[{text:GO.lang.selectAll,id:"plus",qtip:GO.lang.selectAll,handler:function(){this.selectAll()},scope:this}],layout:"fit",cls:"go-grid3-hide-headers",autoScroll:true,columns:[b,{header:GO.lang.strName,dataIndex:"name",id:"name"}],autoExpandColumn:"name",view:new Ext.grid.GridView({emptyText:GO.lang.strNoItems})});GO.grid.MultiSelectGrid.superclass.constructor.call(this,a);this.on("rowclick",function(c,d){this.applyFilter([c.store.getAt(d).id])},this);this.store.on("load",function(){var c=0;for(var d=0;d<this.store.data.items.length;d++){if(this.store.data.items[d].data.checked){c++}}this.selectedAll=(c==this.store.data.items.length)?true:false},this);this.addEvents({change:true})};Ext.extend(GO.grid.MultiSelectGrid,GO.grid.GridPanel,{timeoutNumber:false,allowNoSelection:false,lastRecordClicked:false,lastSelectedIndex:-1,selectedAll:false,selectAll:function(){if(this.allowNoSelection||!this.selectedAll){var a=(this.selectedAll&&this.allowNoSelection)?"clear":"all";this.applyFilter(a)}},getSelected:function(){var b=[];for(var a=0;a<this.store.data.items.length;a++){if(this.store.data.items[a].get("checked")){b.push(this.store.data.items[a].get("id"))}}return b},applyFilter:function(n,l){this.timeoutNumber=false;this.lastSelectedIndex=-1;var b=[],a=[],j,d,e;var f=[];var g=this.store.data.items.length;if(n=="all"&&g>50){if(!confirm(GO.lang.confirmSelectLotsOfItems.replace("{count}",g).replace("Group-Office",GO.settings.config.product_name))){return}}for(var c=0;c<g;c++){d=this.store.data.items[c].id;e=n&&n!="clear"&&(n=="all"||n.indexOf(d)>-1);if(n&&!e){j="0";if(this.store.data.items[c].data.checked=="1"){this.store.data.items[c].data.checked="0";f.push(this.store.data.items[c])}}else{if(e){j="1";if(GO.util.empty(this.store.data.items[c].data.checked)){this.store.data.items[c].data.checked="1";f.push(this.store.data.items[c])}}else{j=this.store.data.items[c].data.checked}}if(j=="1"){this.lastSelectedIndex=c;a.push(this.store.data.items[c].id);b.push(this.store.data.items[c])}}if(!this.allowNoSelection&&(a.length==0)){alert(GO.lang.noItemSelectedWarning);if(this.lastRecordClicked){this.lastRecordClicked.set("checked","1");this.lastRecordClicked.commit()}this.lastRecordClicked=false;this.store.rejectChanges()}else{if(!l){this.fireEvent("change",this,a,b)}if(f.length>10){this.getView().refresh()}else{for(var c=0,g=f.length;c<g;c++){this.getView().refreshRow(f[c])}}this.getSelectionModel().clearSelections()}if(this.lastSelectedIndex>-1){this.getView().focusRow(this.lastSelectedIndex)}this.selectedAll=(b.length==this.store.data.items.length)?true:false;if(this.allowNoSelection){var k=(this.selectedAll)?GO.lang.deselectAll:GO.lang.selectAll}}});Ext.grid.GroupSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GroupSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div id="x-grid3-summary-row-'+this.grid.id+'" class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||l.renderer)(d.data[l.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b.summaryType){g[o.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},doGroupEnd:function(a,d,b,f,c){var e=this.calculate(d.rs,b);a.push("</div>",this.renderSummary({data:e},b),"</div>")},doWidth:function(e,b,d){var c=this.view.getGroups(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getGroups(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getGroups(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a))},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=document.getElementById(d);if(!f){return false}var b=[];this.grid.store.each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData();var j=this.calculate(b,c);var a=this.renderSummary({data:j},c);var e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){this.refreshSummaryById(a._groupId)},doRemove:function(d,a,b,c){if(!c){this.refreshSummaryById(a._groupId)}},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Ext.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.layout=this.layout.createDelegate(this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("refreshRow",this.refreshSummary,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||l.renderer)(d.data[l.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="-"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b&&b.summaryType){g[o.name]=Ext.grid.GridSummary.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},layout:function(){if(!this.view.summary){this.view.summary=Ext.DomHelper.insertAfter(this.view.mainBody.dom.parentNode,{tag:"div"},true)}if(!this.view.mainBody){return}var f=this.grid;var l=f.getGridEl(),o=this.cm,b=f.autoExpandColumn,a=this.view;var d=l.getSize(true);var n=d.width;if(!n||!d.height){return}if(f.autoHeight){this.view.scroller.dom.style.overflow="visible"}else{var k=this.view.summary.getHeight();var j=this.view.mainHd.getHeight();this.view.el.setSize(d.width,d.height+k);var e=d.height-(j)-(k);this.view.scroller.setSize(n,e);this.view.innerHd.style.width=(n)+"px"}if(this.view.forceFit){if(this.view.lastViewWidth!=n){this.view.fitColumns(false,false);this.view.lastViewWidth=n}}else{this.view.autoExpand()}this.view.onLayout(n,e)},doWidth:function(e,b,d){var c=this.view.getRows(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getRows(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getRows(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(){var f=this.grid,k=f.colModel,b=f.store,o=f.stripeRows;var l=k.getColumnCount();if(b.getCount()<1){return""}var j=this.view.getColumnData();var n=n||0;var d=typeof d=="undefined"?b.getCount()-1:d;var c=b.getRange();var a=[];var e=this.calculate(c,j);a.push("</div>",this.renderSummary({data:e},j),"</div>");this.view.summary.update(a.join(""));this.view.layout()},getSummaryNode:function(){return this.view.summary},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Ext.grid.GridSummary.Calculations={sum:function(b,a,c){return GO.util.numberFormat(GO.util.unlocalizeNumber(b)+(GO.util.unlocalizeNumber(a.data[c])||0))},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=GO.util.unlocalizeNumber(b.data[e]);var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return GO.util.numberFormat(c>a?(d[e+"max"]=c):a)},min:function(b,a,e,d){var b=GO.util.unlocalizeNumber(a.data[e]);var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return GO.util.numberFormat(b<c?(d[e+"min"]=b):c)},average:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(GO.util.unlocalizeNumber(a.data[f])||0)));return GO.util.numberFormat(d===0?0:d/g)}};Ext.grid.HybridSummary=Ext.extend(Ext.grid.GroupSummary,{calculate:function(b,d){var a=this.view.getGroupField();var c=b[0].data[a];var e=this.getSummaryData(c);return e||Ext.grid.HybridSummary.superclass.calculate.call(this,b,d)},updateSummaryData:function(a,d,c){var b=this.grid.store.reader.jsonData;if(!b.summaryData){b.summaryData={}}b.summaryData[a]=d;if(!c){this.refreshSummary(a)}},getSummaryData:function(a){var b=this.grid.store.reader.jsonData;if(b&&b.summaryData){return b.summaryData[a]}return null}});GO.grid.RemoteGridTotals=function(a){Ext.apply(this,a)};Ext.extend(GO.grid.RemoteGridTotals,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.layout=this.layout.createDelegate(this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("refreshRow",this.refreshSummary,this);a.afterMethod("onColumnWidthUpdated",this.refreshSummary,this);a.afterMethod("onAllColumnWidthsUpdated",this.refreshSummary,this);a.afterMethod("onColumnHiddenUpdated",this.refreshSummary,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},renderSummary:function(d,j){j=j||this.view.getColumnData();var k=this.cm.config;var e=[],l,a={},b,n=j.length-1;for(var f=0,g=j.length;f<g;f++){l=j[f];b=k[f];a.id=l.id;a.style=l.style;a.css=f==0?"x-grid3-cell-first ":(f==n?"x-grid3-cell-last ":"");a.value=!Ext.isEmpty(d.data[l.name])?d.data[l.name]:"";if(b.summaryRenderer){a.value=b.summaryRenderer(a.value,a,d)}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,l){var g={},a,o,n=this.cm.config,b;for(var e=0,p=d.length;e<p;e++){a=d[e];for(var f=0,k=l.length;f<k;f++){o=l[f];b=n[f];if(b&&b.summaryType){g[o.name]=GO.grid.RemoteGridTotals.Calculations[b.summaryType](g[o.name]||0,a,o.name,g)}}}return g},layout:function(){if(!this.view.summary){this.view.summary=Ext.DomHelper.insertAfter(this.view.mainBody.dom.parentNode,{tag:"div"},true)}if(!this.view.mainBody){return}var f=this.grid;var l=f.getGridEl(),o=this.cm,b=f.autoExpandColumn,a=this.view;var d=l.getSize(true);var n=d.width;if(!n||!d.height){return}if(f.autoHeight){this.view.scroller.dom.style.overflow="visible"}else{var k=this.view.summary.getHeight();var j=this.view.mainHd.getHeight();this.view.el.setSize(d.width,d.height+k);var e=d.height-(j)-(k);this.view.scroller.setSize(n,e);this.view.innerHd.style.width=(n)+"px"}if(this.view.forceFit){if(this.view.lastViewWidth!=n){this.view.fitColumns(false,false);this.view.lastViewWidth=n}}else{this.view.autoExpand()}this.view.onLayout(n,e)},doWidth:function(e,b,d){var c=this.view.getRows(),g;for(var f=0,a=c.length;f<a;f++){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){var a=this.view.getRows(),l,k,e=g.length;for(var c=0,f=a.length;c<f;c++){l=a[c].childNodes[2];l.style.width=d;l.firstChild.style.width=d;k=l.firstChild.rows[0].childNodes;for(var b=0;b<e;b++){k[b].style.width=g[b]}}},doHidden:function(d,g,c){var b=this.view.getRows(),f,j=g?"none":"";for(var e=0,a=b.length;e<a;e++){f=b[this.view.getRows()-1].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=j}},refreshSummary:function(){var e=this.grid,a=e.colModel,j=e.store,k=e.stripeRows;var d=a.getColumnCount();if(j.getCount()<1){return""}var c=this.view.getColumnData();var b=[];var f=j.reader.jsonData.totals;b.push("</div>",this.renderSummary({data:f},c),"</div>");this.view.summary.update(b.join(""));this.view.layout()},getSummaryNode:function(){return this.view.summary},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a);var c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});GO.menu.RecordsContextMenu=Ext.extend(Ext.menu.Menu,{records:[],showAt:function(e,b){this.records=b;var a=this.records.length>1;for(var c=0;c<this.items.getCount();c++){var d=this.items.get(c);d.setDisabled(!d.multiple&&a)}GO.menu.RecordsContextMenu.superclass.showAt.call(this,e)}});GO.grid.SimpleSelectList=function(b){if(!b){b={}}if(!b.tpl){var a="";if(b.title){a+="<b>"+b.title+":</b>"}a+='<tpl for="."><div id="{dom_id}" class="go-item-wrap">{name}</div></tpl>';b.tpl=new Ext.XTemplate(a)}else{var a=b.tpl}b.singleSelect=true;b.autoHeight=true;b.overClass="go-view-over";b.itemSelector="div.go-item-wrap";b.selectedClass="go-view-selected";GO.grid.SimpleSelectList.superclass.constructor.call(this,b)};Ext.extend(GO.grid.SimpleSelectList,Ext.DataView,{onRender:function(b,a){this.el=b.createChild({tag:"div",cls:"go-select-list"});GO.grid.SimpleSelectList.superclass.onRender.apply(this,arguments)}});GO.grid.CheckColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.groupable=false;this.menuDisabled=true;this.renderer=this.renderer.createDelegate(this);this.addEvents({change:true});GO.grid.CheckColumn.superclass.constructor.call(this)};Ext.extend(GO.grid.CheckColumn,Ext.util.Observable,{disabled_field:"disabled",init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(g,c){if(c.className&&c.className.indexOf("x-grid3-cc-"+this.id)!=-1){g.stopEvent();var b=this.grid.getView().findRowIndex(c);var a=this.grid.store.getAt(b);var d=a.get(this.disabled_field);if(!d){var f=a.data[this.dataIndex]=="1"?"0":"1";a.set(this.dataIndex,f);this.fireEvent("change",a,f)}}},renderer:function(c,e,b){e.css+=" x-grid3-check-col-td";var d=b.get(this.disabled_field);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-check-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}});Ext.ns("Ext.ux.grid");if("function"!==typeof RegExp.escape){RegExp.escape=function(a){if("string"!==typeof a){return a}return a.replace(/([.*+?\^=!:${}()|\[\]\/\\])/g,"\\$1")}}Ext.ux.grid.RowActions=function(a){Ext.apply(this,a);this.addEvents("beforeaction","action","beforegroupaction","groupaction");Ext.ux.grid.RowActions.superclass.constructor.call(this)};Ext.extend(Ext.ux.grid.RowActions,Ext.util.Observable,{actionEvent:"click",autoWidth:true,dataIndex:"",editable:false,header:"",isColumn:true,keepSelection:false,menuDisabled:true,sortable:false,tplGroup:'<tpl for="actions"><div class="ux-grow-action-item<tpl if="\'right\'===align"> ux-action-right</tpl> {cls}" style="{style}" qtip="{qtip}">{text}</div></tpl>',tplRow:'<div class="ux-row-action"><tpl for="actions"><div class="ux-row-action-item {cls} <tpl if="text">ux-row-action-text</tpl>" style="{hide}{style}" qtip="{qtip}"><tpl if="text"><span qtip="{qtip}">{text}</span></tpl></div></tpl></div>',hideMode:"visibility",widthIntercept:4,widthSlope:21,init:function(c){this.grid=c;this.id=this.id||Ext.id();var d=c.getColumnModel().lookup;delete (d[undefined]);d[this.id]=this;if(!this.tpl){this.tpl=this.processActions(this.actions)}if(this.autoWidth){this.width=this.widthSlope*this.actions.length+this.widthIntercept;this.fixed=true}var b=c.getView();var a={scope:this};a[this.actionEvent]=this.onClick;c.afterRender=c.afterRender.createSequence(function(){b.mainBody.on(a);c.on("destroy",this.purgeListeners,this)},this);if(!this.renderer){this.renderer=function(k,e,f,l,j,g){e.css+=(e.css?" ":"")+"ux-row-action-cell";return this.tpl.apply(this.getData(k,e,f,l,j,g))}.createDelegate(this)}if(b.groupTextTpl&&this.groupActions){b.interceptMouse=b.interceptMouse.createInterceptor(function(f){if(f.getTarget(".ux-grow-action-item")){return false}});b.groupTextTpl='<div class="ux-grow-action-text">'+b.groupTextTpl+"</div>"+this.processActions(this.groupActions,this.tplGroup).apply()}if(true===this.keepSelection){c.processEvent=c.processEvent.createInterceptor(function(f,g){if("mousedown"===f){return !this.getAction(g)}},this)}},getData:function(e,a,b,f,d,c){return b.data||{}},processActions:function(d,c){var a=[];Ext.each(d,function(e,f){if(e.iconCls&&"function"===typeof(e.callback||e.cb)){this.callbacks=this.callbacks||{};this.callbacks[e.iconCls]=e.callback||e.cb}var g={cls:e.iconIndex?"{"+e.iconIndex+"}":(e.iconCls?e.iconCls:""),qtip:e.qtipIndex?"{"+e.qtipIndex+"}":(e.tooltip||e.qtip?e.tooltip||e.qtip:""),text:e.textIndex?"{"+e.textIndex+"}":(e.text?e.text:""),hide:e.hideIndex?'<tpl if="'+e.hideIndex+'">'+("display"===this.hideMode?"display:none":"visibility:hidden")+";</tpl>":(e.hide?("display"===this.hideMode?"display:none":"visibility:hidden;"):""),align:e.align||"right",style:e.style?e.style:""};a.push(g)},this);var b=new Ext.XTemplate(c||this.tplRow);return new Ext.XTemplate(b.apply({actions:a}))},getAction:function(c){var b=false;var a=c.getTarget(".ux-row-action-item");if(a){b=a.className.replace(/ux-row-action-item /,"");if(b){b=b.replace(/ ux-row-action-text/,"");b=b.trim()}}return b},onClick:function(g,j){var k=this.grid.getView();var o=g.getTarget(".x-grid3-row");var a=k.findCellIndex(j.parentNode.parentNode);var c=this.getAction(g);if(false!==o&&false!==a&&false!==c){var f=this.grid.store.getAt(o.rowIndex);if(this.callbacks&&"function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,f,c,o.rowIndex,a)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforeaction",this.grid,f,c,o.rowIndex,a)){return}else{if(true!==this.eventsSuspended){this.fireEvent("action",this.grid,f,c,o.rowIndex,a)}}}t=g.getTarget(".ux-grow-action-item");if(t){var l=k.findGroup(j);var d=l?l.id.replace(/ext-gen[0-9]+-gp-/,""):null;var b;if(d){var n=new RegExp(RegExp.escape(d));b=this.grid.store.queryBy(function(e){return e._groupId.match(n)});b=b?b.items:[]}c=t.className.replace(/ux-grow-action-item (ux-action-right )*/,"");if("function"===typeof this.callbacks[c]){this.callbacks[c](this.grid,b,c,d)}if(true!==this.eventsSuspended&&false===this.fireEvent("beforegroupaction",this.grid,b,c,d)){return false}this.fireEvent("groupaction",this.grid,b,c,d)}}});Ext.reg("rowactions",Ext.ux.grid.RowActions);GO.grid.RadioColumn=function(a){Ext.apply(this,a);if(!this.id){this.id=Ext.id()}this.renderer=this.renderer.createDelegate(this)};GO.grid.RadioColumn.prototype={init:function(a){this.grid=a;this.grid.on("render",function(){var b=this.grid.getView();b.mainBody.on("mousedown",this.onMouseDown,this)},this)},onMouseDown:function(j,f){if(f.className&&f.className.indexOf("x-grid3-cc-"+this.id)!=-1){j.stopEvent();var c=this.grid.getView().findRowIndex(f);var b=this.grid.store.getAt(c);var g=this.isDisabled(b);if(!g){if(!GO.util.empty(b.get(this.dataIndex))){return}for(var d=0,a=this.grid.store.getCount();d<a;d++){var k=this.grid.store.getAt(d);if(k.get(this.dataIndex)){k.set(this.dataIndex,false)}}b.set(this.dataIndex,true)}}},isDisabled:function(a){return false},renderer:function(c,e,b){e.css+=" x-grid3-radio-col-td";var d=this.isDisabled(b);var a;if(!GO.util.empty(c)){if(d){a="-on x-item-disabled"}else{a="-on"}}else{if(d){a=" x-item-disabled"}else{a=""}}return'<div class="x-grid3-radio-col'+a+" x-grid3-cc-"+this.id+'">&#160;</div>'}};Ext.namespace("GO.util");GO.util.callToHref=function(a){a=a.replace(/[^0-9+]/g,"");return GO.calltoTemplate.replace("{phone}",a)};GO.url=function(a){return BaseHref+"router.php?r="+a};GO.request=function(b){var a=GO.url(b.url);delete b.url;if(!b.scope){b.scope=this}if(b.maskEl){b.maskEl.mask(GO.lang.waitMsgLoad)}var c=b.success;delete b.success;var d=Ext.apply({url:a,callback:function(){if(b.maskEl){b.maskEl.unmask()}},success:function(f,g){var e=Ext.decode(f.responseText);if(!e.success){alert(e.feedback)}else{if(c){c.call(b.scope,f,g,e)}}}},b);Ext.Ajax.request(d)};GO.util.empty=function(a){if(!a){return true}if(a==""){return true}if(a=="0"){return true}if(a=="undefined"){return true}if(a=="null"){return true}return false};GO.mailTo=function(a){if(GO.email&&GO.settings.modules.email.read_permission){return'<a href="#" onclick="GO.email.showAddressMenu(event, \''+a+"','');\">"+a+"</a>"}else{return'<a href="mailto:'+a+'">'+a+"</a>"}};GO.util.getFileExtension=function(a){var c=a.lastIndexOf(".");var b="";if(c){b=a.substr(c+1)}return b.toLowerCase()};GO.playAlarm=function(){if(GO.util.empty(GO.settings.mute_sound)){var a=GO.util.getFlashMovieObject("alarmSound");if(a){try{a.Play()}catch(b){}}}};GO.util.nl2br=function(a){return a.replace(/\n/g,"<br />")};GO.util.clone=function(c){if(c==null||typeof(c)!="object"){return c}var a=new c.constructor();for(var b in c){a[b]=c[b]}return a};GO.jsonAuthHandler=function(a,c,b){if(a.authError){switch(a.authError){case"UNAUTHORIZED":alert(GO.lang.strUnauthorizedText);return false;case"NOTLOGGEDIN":if(c){GO.loginDialog.addCallback(c,b)}GO.loginDialog.show();return false}}return true};GO.deleteItems=function(a){a.extraWarning=a.extraWarning||"";switch(a.count){case 0:alert(GO.lang.noItemSelected);return false;case 1:var c=a.extraWarning+GO.lang.strDeleteSelectedItem;break;default:var b=new Ext.Template(a.extraWarning+GO.lang.strDeleteSelectedItems);var c=b.applyTemplate({count:a.count});break}if(a.noConfirmation||confirm(c)){if(a.store){for(var d in a.params){a.store.baseParams[d]=a.params[d]}a.store.reload({callback:function(){var e;if(!this.reader.jsonData.deleteSuccess){if(a.failure){e=a.failure.createDelegate(a.scope);e.call(a.scope,a)}alert(this.reader.jsonData.deleteFeedback)}else{if(a.success){e=a.success.createDelegate(a.scope);e.call(a.scope,a)}}if(a.callback){e=a.callback.createDelegate(a.scope);e.call(this,a)}}});for(var d in a.params){delete a.store.baseParams[d]}}else{Ext.Ajax.request({url:a.url,params:a.params,callback:function(f,j,e){var k;var g=Ext.decode(e.responseText);if(!g.success){if(a.failure){k=a.failure.createDelegate(a.scope);k.call(this,g)}alert(g.feedback)}else{if(a.success){k=a.success.createDelegate(a.scope);k.call(this,g)}}if(a.callback){k=a.callback.createDelegate(a.scope);k.call(this,g)}}})}}};GO.util.getFlashMovieObject=function(a){if(window.document[a]){return window.document[a]}if(navigator.appName.indexOf("Microsoft Internet")==-1){if(document.embeds&&document.embeds[a]){return document.embeds[a]}}else{return document.getElementById(a)}};GO.util.unlocalizeNumber=function(c,a,d){if(GO.util.empty(c)){return 0}if(!a){a=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}c=c+"";if(d!=""){var b=new RegExp("["+d+"]","g");c=c.replace(b,"")}return parseFloat(c.replace(a,"."))};String.prototype.regexpEscape=function(){var a=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];var b=new RegExp("(\\"+a.join("|\\")+")","g");return this.replace(b,"\\$1")};GO.util.numberFormat=function(f,c,l,d){if(typeof(c)=="undefined"){c=2}if(!l){l=GO.settings.decimal_separator}if(!d){d=GO.settings.thousands_separator}if(f==""){f="0"}var n=parseFloat(f);n=n.toFixed(c);if(c>0){var b=n.indexOf(".");if(!b){n=n+".";b=n.indexOf(".")}var g=n.length-b;for(var j=g;j<=c;j++){n=n+"0"}var k=l+n.substring(b+1);var e=c;while(k.substring(k.length-1)=="0"&&e>c){e--;k=k.substring(0,k.length-1)}}else{var k="";var b=n.length}var a=0;for(var j=b-1;j>=0;j--){if(a==3&&n.substr(j,1)!="-"){k=d+k;a=0}k=n.substr(j,1)+k;a++}if(k==",NaN"){k=GO.util.numberFormat("0",c,l,d)}return k};GO.util.round=function(b,d,a){d=parseFloat(d);b=parseFloat(b);if(d>0){var c=b/d;c=a?Math.floor(c):Math.ceil(c);b=c*d}return b};GO.util.popup=function(g){var d={scrollbars:"1",resizable:"1",location:"0",status:"0",target:"_blank"};Ext.apply(d,g);if(!d.width){d.width=screen.availWidth;d.height=screen.availHeight}if(typeof(d.left)=="undefined"||typeof(d.top)=="undefined"){d.position=d.position||"center";if(d.position=="center"){d.left=(screen.availWidth-d.width)/2;d.top=(screen.availHeight-d.height)/2}else{d.left=screen.availWidth-d.width;d.top=screen.availHeight-d.height}}var f=["url","position","focus","closeOnFocus","target"];var b="";for(var e in d){if(f.indexOf(e)==-1){b+=","+e+"="+d[e]}}b=b.substring(1,b.length);var a=window.open(d.url,d.target,b);if(!a){alert(GO.lang.popupBlocker);return false}if(!a.opener){a.opener=self}if(d.focus){a.focus()}if(d.closeOnFocus){GO.mainLayout.on("focus",function(){a.close()},{single:true})}return a};GO.util.get_html_translation_table=function(k,f){var d={},j={},c=0,a="";var e={},b={};var l={},g={};l=(k?k.toUpperCase():"HTML_SPECIALCHARS");g=(f?f.toUpperCase():"ENT_COMPAT");e[0]="HTML_SPECIALCHARS";e[1]="HTML_ENTITIES";b[0]="ENT_NOQUOTES";b[2]="ENT_COMPAT";b[3]="ENT_QUOTES";if(!isNaN(l)){l=e[l]}if(!isNaN(g)){g=b[g]}if(l=="HTML_SPECIALCHARS"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;"}else{if(l=="HTML_ENTITIES"){d["38"]="&amp;";d["60"]="&lt;";d["62"]="&gt;";d["160"]="&nbsp;";d["161"]="&iexcl;";d["162"]="&cent;";d["163"]="&pound;";d["164"]="&curren;";d["165"]="&yen;";d["166"]="&brvbar;";d["167"]="&sect;";d["168"]="&uml;";d["169"]="&copy;";d["170"]="&ordf;";d["171"]="&laquo;";d["172"]="&not;";d["173"]="&shy;";d["174"]="&reg;";d["175"]="&macr;";d["176"]="&deg;";d["177"]="&plusmn;";d["178"]="&sup2;";d["179"]="&sup3;";d["180"]="&acute;";d["181"]="&micro;";d["182"]="&para;";d["183"]="&middot;";d["184"]="&cedil;";d["185"]="&sup1;";d["186"]="&ordm;";d["187"]="&raquo;";d["188"]="&frac14;";d["189"]="&frac12;";d["190"]="&frac34;";d["191"]="&iquest;";d["192"]="&Agrave;";d["193"]="&Aacute;";d["194"]="&Acirc;";d["195"]="&Atilde;";d["196"]="&Auml;";d["197"]="&Aring;";d["198"]="&AElig;";d["199"]="&Ccedil;";d["200"]="&Egrave;";d["201"]="&Eacute;";d["202"]="&Ecirc;";d["203"]="&Euml;";d["204"]="&Igrave;";d["205"]="&Iacute;";d["206"]="&Icirc;";d["207"]="&Iuml;";d["208"]="&ETH;";d["209"]="&Ntilde;";d["210"]="&Ograve;";d["211"]="&Oacute;";d["212"]="&Ocirc;";d["213"]="&Otilde;";d["214"]="&Ouml;";d["215"]="&times;";d["216"]="&Oslash;";d["217"]="&Ugrave;";d["218"]="&Uacute;";d["219"]="&Ucirc;";d["220"]="&Uuml;";d["221"]="&Yacute;";d["222"]="&THORN;";d["223"]="&szlig;";d["224"]="&agrave;";d["225"]="&aacute;";d["226"]="&acirc;";d["227"]="&atilde;";d["228"]="&auml;";d["229"]="&aring;";d["230"]="&aelig;";d["231"]="&ccedil;";d["232"]="&egrave;";d["233"]="&eacute;";d["234"]="&ecirc;";d["235"]="&euml;";d["236"]="&igrave;";d["237"]="&iacute;";d["238"]="&icirc;";d["239"]="&iuml;";d["240"]="&eth;";d["241"]="&ntilde;";d["242"]="&ograve;";d["243"]="&oacute;";d["244"]="&ocirc;";d["245"]="&otilde;";d["246"]="&ouml;";d["247"]="&divide;";d["248"]="&oslash;";d["249"]="&ugrave;";d["250"]="&uacute;";d["251"]="&ucirc;";d["252"]="&uuml;";d["253"]="&yacute;";d["254"]="&thorn;";d["255"]="&yuml;"}else{throw Error("Table: "+l+" not supported");return false}}if(g!="ENT_NOQUOTES"){d["34"]="&quot;"}if(g=="ENT_QUOTES"){d["39"]="&#039;"}for(c in d){a=String.fromCharCode(c);j[a]=d[c]}return j};GO.util.html_entity_decode=function(c,g){c+="";var f={},e="",a="",d=0;a=c.toString();if(false===(f=GO.util.get_html_translation_table("HTML_ENTITIES",g))){return false}var b;for(e in f){b=f[e];a=a.split(b).join(e)}return a};GO.util.add_slashes=function(a){return(a+"").replace(/([\\"'])/g,"\\$1").replace(/\0/g,"\\0")};GO.util.addParamToUrl=function(a,d,c){var b=a.indexOf("?")!=-1?"&":"?";return a+b+d+"="+encodeURIComponent(c)};GO.util.basename=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(b+1)}return a};GO.util.dirname=function(a){var b=a.lastIndexOf("/");if(b){a=a.substring(0,b)}return a};GO.util.logExtEvents=function(){var a=Ext.util.Observable.prototype;a.fireEvent=a.fireEvent.createInterceptor(function(c){var b=arguments;console.log(this," fired event ",c," with args ",Array.prototype.slice.call(b,1,b.length))})};if(GO.settings&&GO.settings.time_format){GO.date={hours:[],minutes:[]};if(GO.settings.time_format.substr(0,1)=="G"){var timeformat="G"}else{var timeformat="g a"}for(var i=0;i<24;i++){var h=Date.parseDate(i,"G");GO.date.hours.push([h.format("G"),h.format(timeformat)])}GO.date.minutes=[["00","00"],["05","05"],["10","10"],["15","15"],["20","20"],["25","25"],["30","30"],["35","35"],["40","40"],["45","45"],["50","50"],["55","55"]]}GO.blinkTitle={blinkTitle:false,originalDocTitle:document.title,task:{run:function(){document.title=document.title!=this.blinkTitle?this.blinkTitle:this.originalDocTitle},interval:2000},running:false,blink:function(a){if(!this.task.scope){this.task.scope=this}if(GO.util.empty(a)){if(this.running){Ext.TaskMgr.stop(this.task);document.title=this.originalDocTitle}}else{this.blinkTitle=a;if(!this.running){Ext.TaskMgr.start(this.task);this.running=true}}}};GO.state.HttpProvider=function(a){GO.state.HttpProvider.superclass.constructor.call(this);this.url=BaseHref+"state.php";Ext.apply(this,a);this.state=this.readValues()};Ext.extend(GO.state.HttpProvider,Ext.state.Provider,{changedValues:false,set:function(a,c,d,b){if(a.substr(0,4)!="ext-"){if(typeof c=="undefined"||c===null){this.clear(a);return}this.setValue(a,c,d,b);GO.state.HttpProvider.superclass.set.call(this,a,c)}},clear:function(a){this.clearValue(a);GO.state.HttpProvider.superclass.clear.call(this,a)},readValues:function(){var b={};for(var a in GO.settings.state){if(a!="remove"){b[a]=this.decodeValue(GO.settings.state[a])}}return b},setValue:function(a,c,e,b){if(!this.changedValues){var d=3000;if(GO.settings.config.debug){d=100}this.sendRequest.defer(d,this,[e,b]);this.changedValues={}}this.changedValues[a]=this.encodeValue(c)},sendRequest:function(b,a){Ext.Ajax.request({url:this.url,params:{task:"set",values:Ext.encode(this.changedValues)},callback:b,scope:a});this.changedValues=false},clearValue:function(a){Ext.Ajax.request({url:this.url,params:{task:"set",name:a,value:"null"}})}});Ext.ns("Ext.ux");Ext.ux.PanelCollapsedTitle=(function(){var a="x-panel-header-rotated";var c=!!document.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1");var b=function(){var j=((this.region=="east")||(this.region=="west"));var k="overflow: visible; padding: 0; border: none; background: none;";if(j&&c){this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:"height: 100%; overflow: hidden;"});var g="http://www.w3.org/2000/svg";var f=document.createElementNS(g,"svg");this.collapsedHeader.dom.appendChild(f);f.setAttribute("width","100%");f.setAttribute("height","100%");var l=document.createElementNS(g,"text");l.setAttribute("x",6);l.setAttribute("y",1);l.setAttribute("transform","rotate(90 6 1)");l.setAttribute("class","x-panel-header "+a);f.appendChild(l);this.collapsedHeaderText=document.createTextNode(this.title);l.appendChild(this.collapsedHeaderText);var e=Ext.fly(l).getStyle("color");l.setAttribute("style",k+";fill: "+e+";")}else{var d="position: relative;";if(j){d+="white-space: nowrap; writing-mode: tb-rl; top: 1px; left: 3px;"}else{d+="top: 2px;";k+="padding-left: 4px; margin-right: 18px;"}this.collapsedHeader=this.ownerCt.layout[this.region].getCollapsedEl().createChild({tag:"div",style:k,cls:"x-panel-header "+a,html:'<span style="'+d+'">'+this.title+"</span>"});this.collapsedHeaderText=this.collapsedHeader.first()}if(this.collapsedIconCls){this.setCollapsedIconClass(this.collapsedIconCls)}};this.init=function(e){if(e.collapsible){var d=((e.region=="east")||(e.region=="west"));e.setTitle=Ext.Panel.prototype.setTitle.createSequence(function(f){if(this.rendered&&this.collapsedHeaderText){if(this.collapsedHeaderText.dom){this.collapsedHeaderText.dom.innerHTML=f}else{if(this.collapsedHeaderText.replaceData){this.collapsedHeaderText.nodeValue=f}}}});e.setCollapsedIconClass=function(g){var f=this.collapsedIconCls;this.collapsedIconCls=g;if(this.rendered&&this.collapsedHeader){var k=this.collapsedHeader,j=k.child("img.x-panel-inline-icon");if(j){if(this.collapsedIconCls){Ext.fly(j).replaceClass(f,this.collapsedIconCls)}else{Ext.fly(j).remove()}}else{if(this.collapsedIconCls){Ext.DomHelper.insertBefore(k.dom.firstChild,{tag:"img",src:Ext.BLANK_IMAGE_URL,cls:"x-panel-inline-icon "+this.collapsedIconCls,style:d?"display: block; margin: 1px 2px;":"margin-top: 2px; margin-right: 4px"})}}}};e.on("render",function(){if(this.ownerCt.rendered&&this.ownerCt.layout.hasLayout){b.call(e)}else{this.ownerCt.on("afterlayout",b,e,{single:true})}},e)}};return this})();Ext.DataView.DragSelector=function(g){g=g||{};var l,d,k,o;var e,n,p=new Ext.lib.Region(0,0,0,0);var b=g.dragSafe===true;this.init=function(v){l=v;l.on("render",u)};function q(){e=[];l.all.each(function(v){e[e.length]=v.getRegion()});n=l.el.getRegion()}function f(){return false}function j(v){return !b||v.target==l.el.dom}function r(v){l.on("containerclick",f,l,{single:true});if(!k){k=l.el.createChild({cls:"x-view-selector"})}else{k.setDisplayed("block")}q();l.clearSelections()}function c(D){var E=o.startXY;var I=o.getXY();var G=Math.min(E[0],I[0]);var F=Math.min(E[1],I[1]);var H=Math.abs(E[0]-I[0]);var B=Math.abs(E[1]-I[1]);p.left=G;p.top=F;p.right=G+H;p.bottom=F+B;p.constrainTo(n);k.setRegion(p);for(var A=0,C=e.length;A<C;A++){var v=e[A],z=p.intersect(v);if(z&&!v.selected){v.selected=true;l.select(A,true)}else{if(!z&&v.selected){v.selected=false;l.deselect(A)}}}}function a(v){if(k){k.setDisplayed(false)}}function u(v){o=new Ext.dd.DragTracker({onBeforeStart:j,onStart:r,onDrag:c,onEnd:a});o.initEl(v.el)}};GO.plugins.InsertAtCursorTextareaPlugin=function(){return{init:function(a){a.insertAtCursor=function(b){if(Ext.isIE){this.el.focus();var e=document.selection.createRange();e.text=b;e.moveEnd("character",b.length);e.moveStart("character",b.length)}else{var d=this.el.dom.selectionStart;var c=this.el.dom.selectionEnd;this.el.dom.value=this.el.dom.value.substring(0,d)+b+this.el.dom.value.substring(c,this.el.dom.value.length);this.el.focus();this.el.dom.setSelectionRange(c+b.length,c+b.length)}}}}};GO.plugins.HtmlEditorImageInsert=function(a){a=a||{};Ext.apply(this,a);this.init=function(b){this.editor=b;this.editor.on("render",this.onRender,this)};this.filesFilter="jpg,png,gif,jpeg,bmp";this.addEvents({insert:true})};Ext.extend(GO.plugins.HtmlEditorImageInsert,Ext.util.Observable,{root_folder_id:0,folder_id:0,onRender:function(){var b={};b.itemId="htmlEditorImage";b.cls="x-btn-icon go-edit-insertimage";b.enableToggle=false;b.scope=this;b.clickEvent="mousedown";b.tabIndex=-1;b.tooltip={title:GO.lang.image,text:GO.lang.insertImage};b.overflowText=GO.lang.insertImage;this.uploadForm=new GO.UploadPCForm({baseParams:{task:"upload_image"},url:BaseHref+"action.php"});this.uploadForm.on("upload",function(d,c){this.selectTempImage(c.name)},this);var a=[this.uploadForm];if(GO.files){a.push({iconCls:"btn-groupoffice",text:GO.email.lang.attachFilesGO.replace("{product_name}",GO.settings.config.product_name),handler:function(){this.showFileBrowser()},scope:this})}this.menu=b.menu=new Ext.menu.Menu({items:a});this.editor.tb.add(b)},showFileBrowser:function(){GO.files.createSelectFileBrowser();GO.selectFileBrowser.setFileClickHandler(this.selectImage,this);GO.selectFileBrowser.setFilesFilter(this.filesFilter);GO.selectFileBrowser.setRootID(this.root_folder_id,this.files_folder_id);GO.selectFileBrowserWindow.show();GO.selectFileBrowserWindow.show.defer(200,GO.selectFileBrowserWindow)},selectTempImage:function(a){this.selectedUrl=BaseHref+"controls/download_temp_file.php?name="+encodeURIComponent(a);this.name=a;this.selectedPath=a;this.temp=true;var b='<img src="'+this.selectedUrl+'" border="0" />';this.fireEvent("insert",this,this.selectedPath,this.selectedUrl,this.temp);this.menu.hide();this.editor.focus();this.editor.insertAtCursor(b)},selectImage:function(b){this.selectedRecord=b;this.selectedPath=b.data.path;this.selectedUrl=GO.settings.modules.files.url+"download.php?id="+this.selectedRecord.get("id");this.temp=false;var a='<img src="'+this.selectedUrl+'" border="0" />';this.fireEvent("insert",this,this.selectedPath,this.selectedUrl,this.temp,b.data.id);this.editor.focus();this.editor.insertAtCursor(a);GO.selectFileBrowserWindow.hide()}});GO.plugins.HtmlEditorSpellCheck=function(a){this.EmailComposer=a;this.init=function(b){this.editor=b;this.editor.on("render",this.onRender,this)};this.addEvents({insert:true})};Ext.extend(GO.plugins.HtmlEditorSpellCheck,Ext.util.Observable,{onRender:function(){if(!Ext.isSafari){var b=[];var c;for(var a=0;a<GO.Languages.length;a++){c={text:GO.Languages[a][1],lang:GO.Languages[a][0],handler:function(d){this.spellcheck(d.lang)},scope:this};if(GO.settings.language==c.lang){b.unshift(c,"-")}else{b.push(c)}}this.editor.tb.add({itemId:"htmlSpellCheck",cls:"x-btn-icon go-edit-spellcheck",enableToggle:false,scope:this,menu:{items:b},clickEvent:"mousedown",tabIndex:-1,overflowText:GO.lang.spellcheck,tooltip:{title:GO.lang.spellcheck,text:GO.lang.spellcheckdetails}})}},spellcheck:function(b){if(this.EmailComposer.isHTML()){var a=this;Ext.Ajax.request({url:BaseHref+"HtmlEditorSpellCheck.php",success:function(c,d){a.processResults(c,d,a)},failure:this.problem,params:{tocheck:this.editor.getValue(),lang:b}});this.editor.SpellCheck=true}else{}},processResults:function(a,d,b){var c=Ext.util.JSON.decode(a.responseText);if(c.errorcount==0){Ext.Msg.alert(GO.lang.spellcheck,GO.lang.spellcheckNoError)}else{b.showSpellChecker(c.errorcount,c.text,b)}},showSpellChecker:function(d,c,a){var b=GO.lang.spellcheckNoErrors.replace(/\{1\}/ig,d);a.textarea=new Ext.Panel({title:b,region:"north",cls:"go-form-panel x-spell-checker",autoScroll:true,html:c});a.wnd=new Ext.Window({width:600,height:400,modal:true,closeAction:"close",closable:true,layout:"fit",title:GO.lang.spellcheck,items:[a.textarea],buttons:[{text:GO.lang.cmdSave,handler:function(){a.UpdateEditorValue(a)}},{text:GO.lang.cmdCancel,handler:function(){a.closeWindow(a)}}]});a.wnd.show();Ext.select("span.spelling",a.textarea).on("click",function(f){a.showSuggestions(f,this)})},UpdateEditorValue:function(a){var b=this.textarea.el.dom.childNodes[1].childNodes[0].innerHTML;var c=new RegExp('<span [\\s\\S]*?class=(")?spelling(")?[\\s\\S]*?>(\\w+)[\\s\\S]*?</span>',"mig");b=b.replace(c,"$3 ");a.editor.setValue(b);a.closeWindow(a)},closeWindow:function(a){a.wnd.destroy()},showSuggestions:function(f,b){var a=b.getElementsByTagName("li");var g=new Array();var j=this;for(var c=0;c<a.length;c++){var d=a[c].innerHTML;g.push(new Ext.Action({text:d,handler:function(e,k){j.replaceSpelling(this.text,b)}}))}this.Suggestions=new Ext.menu.Menu({items:g});this.Suggestions.showAt(f.getXY())},replaceSpelling:function(c,b){if(Ext.isIE&&b.getAttribute("ieAfterObject")==" "){var a=document.createTextNode(c+" ")}else{var a=document.createTextNode(c)}b.parentNode.replaceChild(a,b);this.Suggestions.destroy()},problem:function(a,b){Ext.Msg.show({title:GO.lang.spellcheck,msg:GO.lang.spellcheckServerError,buttons:Ext.Msg.OK,icon:Ext.Msg.WARNING})}});
/*
 * MIT
 */
Ext.ns("Ext.ux.form.HtmlEditor");Ext.ux.form.HtmlEditor.MidasCommand=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.btns=[];this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true})},onInit:function(){Ext.EventManager.on(this.cmp.getDoc(),{mousedown:this.onEditorEvent,dblclick:this.onEditorEvent,click:this.onEditorEvent,keyup:this.onEditorEvent,buffer:100,scope:this})},onRender:function(){var c,a=this.cmp.getToolbar(),b;Ext.each(this.midasBtns,function(d){if(typeof(d)=="object"){c={tabIndex:-1,iconCls:"x-edit-"+d.cmd,handler:function(){this.cmp.relayCmd(d.cmd)},scope:this,tooltip:d.tooltip||{title:d.title},overflowText:d.overflowText||d.title}}else{c=new Ext.Toolbar.Separator()}b=a.addButton(c);if(d.enableOnSelection){b.disable()}this.btns.push(b)},this)},onEditorEvent:function(){var a=this.cmp.getDoc();Ext.each(this.btns,function(c,d){if(this.midasBtns[d].enableOnSelection||this.midasBtns[d].disableOnSelection){if(a.getSelection){if((this.midasBtns[d].enableOnSelection&&a.getSelection()!=="")||(this.midasBtns[d].disableOnSelection&&a.getSelection()==="")){c.enable()}else{c.disable()}}else{if(a.selection){if((this.midasBtns[d].enableOnSelection&&a.selection.createRange().text!=="")||(this.midasBtns[d].disableOnSelection&&a.selection.createRange().text==="")){c.enable()}else{c.disable()}}}}if(this.midasBtns[d].monitorCmdState){c.toggle(a.queryCommandState(this.midasBtns[d].cmd))}},this)}});Ext.ux.form.HtmlEditor.Divider=Ext.extend(Ext.util.Observable,{init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){this.cmp.getToolbar().addButton([new Ext.Toolbar.Separator()])}});Ext.ux.form.HtmlEditor.IndentOutdent=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{cmd:"indent",tooltip:{title:GO.lang.indent},overflowText:GO.lang.indent},{cmd:"outdent",tooltip:{title:GO.lang.outdent},overflowText:GO.lang.outdent}]});Ext.ux.form.HtmlEditor.RemoveFormat=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"removeFormat",tooltip:{title:GO.lang.removeFormatting},overflowText:GO.lang.removeFormatting}]});Ext.ux.form.HtmlEditor.SubSuperScript=Ext.extend(Ext.ux.form.HtmlEditor.MidasCommand,{midasBtns:["|",{enableOnSelection:true,cmd:"subscript",tooltip:{title:"Subscript"},overflowText:"Subscript"},{enableOnSelection:true,cmd:"superscript",tooltip:{title:"Superscript"},overflowText:"Superscript"}]});Ext.ux.form.HtmlEditor.SpecialCharacters=Ext.extend(Ext.util.Observable,{specialChars:[],charRange:[160,256],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-char",tabIndex:-1,handler:function(){if(this.specialChars.length){Ext.each(this.specialChars,function(e,d){this.specialChars[d]=["&#"+e+";"]},this)}for(i=this.charRange[0];i<this.charRange[1];i++){this.specialChars.push(["&#"+i+";"])}var c=new Ext.data.ArrayStore({fields:["char"],data:this.specialChars});this.charWindow=new Ext.Window({title:"Insert Special Character",width:436,autoHeight:true,layout:"fit",items:[{xtype:"dataview",store:c,ref:"../charView",autoHeight:true,multiSelect:true,tpl:new Ext.XTemplate('<tpl for="."><div class="char-item">{char}</div></tpl><div class="x-clear"></div>'),overClass:"char-over",itemSelector:"div.char-item",listeners:{dblclick:function(f,d,j,g){this.insertChar(f.getStore().getAt(d).get("char"));this.charWindow.close()},scope:this}}],buttons:[{text:"Insert",handler:function(){Ext.each(this.charWindow.charView.getSelectedRecords(),function(d){var e=d.get("char");this.insertChar(e)},this);this.charWindow.close()},scope:this},{text:"Cancel",handler:function(){this.charWindow.close()},scope:this}]});this.charWindow.show()},scope:this,tooltip:{title:"Insert Special Character"},overflowText:"Special Characters"})},insertChar:function(a){if(a){this.cmp.insertAtCursor(a)}}});Ext.ux.form.HtmlEditor.Table=Ext.extend(Ext.util.Observable,{cmd:"table",tableBorderOptions:[["none","None"],["1px solid #000","Sold Thin"],["2px solid #000","Solid Thick"],["1px dashed #000","Dashed"],["1px dotted #000","Dotted"]],init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-table",tabIndex:-1,handler:function(){if(!this.tableWindow){this.tableWindow=new Ext.Window({title:"Insert Table",closeAction:"hide",items:[{itemId:"insert-table",xtype:"form",border:false,plain:true,bodyStyle:"padding: 10px;",labelWidth:60,labelAlign:"right",items:[{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:"Rows",name:"row",width:60},{xtype:"numberfield",allowBlank:false,allowDecimals:false,fieldLabel:"Columns",name:"col",width:60},{xtype:"combo",fieldLabel:"Border",name:"border",forceSelection:true,mode:"local",store:new Ext.data.ArrayStore({autoDestroy:true,fields:["spec","val"],data:this.tableBorderOptions}),triggerAction:"all",value:"none",displayField:"val",valueField:"spec",width:90}]}],buttons:[{text:"Insert",handler:function(){var g=this.tableWindow.getComponent("insert-table").getForm();if(g.isValid()){var e=g.findField("border").getValue();var c=[g.findField("row").getValue(),g.findField("col").getValue()];if(c.length==2&&c[0]>0&&c[0]<10&&c[1]>0&&c[1]<10){var f="<table>";for(var j=0;j<c[0];j++){f+="<tr>";for(var d=0;d<c[1];d++){f+="<td width='20%' style='border: "+e+";'>"+j+"-"+d+"</td>"}f+="</tr>"}f+="</table>";this.cmp.insertAtCursor(f)}this.tableWindow.hide()}else{if(!g.findField("row").isValid()){g.findField("row").getEl().frame()}else{if(!g.findField("col").isValid()){g.findField("col").getEl().frame()}}}},scope:this},{text:"Cancel",handler:function(){this.tableWindow.hide()},scope:this}]})}else{this.tableWindow.getEl().frame()}this.tableWindow.show()},scope:this,tooltip:{title:"Insert Table"},overflowText:"Table"})}});Ext.ux.form.HtmlEditor.Word=Ext.extend(Ext.util.Observable,{curLength:0,lastLength:0,lastValue:"",wordPasteEnabled:true,init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this);this.cmp.on("initialize",this.onInit,this,{delay:100,single:true})},onInit:function(){this.lastValue=this.cmp.getValue();this.curLength=this.lastValue.length;this.lastLength=this.lastValue.length},findValueDiffAt:function(a){for(i=0;i<this.curLength;i++){if(this.lastValue[i]!=a[i]){return i}}},fixWordPaste:function(a){var b=[/&nbsp;/ig,/[\r\n]/g,/<(xml|style)[^>]*>.*?<\/\1>/ig,/<\/?(meta|object|span)[^>]*>/ig,/<\/?[A-Z0-9]*:[A-Z]*[^>]*>/ig,/(lang|class|type|href|name|title|id|clear)=\"[^\"]*\"/ig,/style=(\'\'|\"\")/ig,/<![\[-].*?-*>/g,/MsoNormal/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/&nbsp;/g,/<\/?SPAN[^>]*>/ig,/<\/?FONT[^>]*>/ig,/<\/?STRONG[^>]*>/ig,/<\/?H1[^>]*>/ig,/<\/?P[^>]*><\/P>/g,/<!--(.*)-->/g,/<!--(.*)>/g,/<!(.*)-->/g,/<\\?\?xml[^>]*>/g,/<\/?o:p[^>]*>/g,/<\/?v:[^>]*>/g,/<\/?o:[^>]*>/g,/<\/?st1:[^>]*>/g,/style=\"[^\"]*\"/g,/style=\'[^\"]*\'/g,/lang=\"[^\"]*\"/g,/lang=\'[^\"]*\'/g,/class=\"[^\"]*\"/g,/class=\'[^\"]*\'/g,/type=\"[^\"]*\"/g,/type=\'[^\"]*\'/g,/href=\'#[^\"]*\'/g,/href=\"#[^\"]*\"/g,/name=\"[^\"]*\"/g,/name=\'[^\"]*\'/g,/ clear=\"all\"/g,/id=\"[^\"]*\"/g,/title=\"[^\"]*\"/g,/<span[^>]*>/g,/<\/?span[^>]*>/g,/class=/g,/<script[^>]*>.*<\/script>/ig];Ext.each(b,function(c){a=a.replace(c,"")});a=a.replace(/<div[^>]*>/g,"<p>");a=a.replace(/<\/?div[^>]*>/g,"</p>");return a},onRender:function(){this.cmp.getToolbar().add({iconCls:"x-edit-wordpaste",tabIndex:-1,handler:function(a){this.cmp.setValue(this.fixWordPaste(this.cmp.getValue()))},scope:this,overflowText:"Word paste",tooltip:{text:"Cleans text pasted from Word or other Rich Text applications"}})}});Ext.ux.form.HtmlEditor.HR=Ext.extend(Ext.util.Observable,{cmd:"hr",init:function(a){this.cmp=a;this.cmp.on("render",this.onRender,this)},onRender:function(){var b=this.cmp;var a=this.cmp.getToolbar().addButton({iconCls:"x-edit-hr",tabIndex:-1,handler:function(){if(!this.hrWindow){this.hrWindow=new Ext.Window({width:400,autoHeight:true,resizable:false,title:GO.lang.insertHorizontalRule,closeAction:"hide",focus:function(){this.items.get(0).form.findField("hrwidth").focus(true)},items:[{itemId:"insert-hr",xtype:"form",border:false,bodyStyle:"padding: 10px;",labelWidth:60,labelAlign:"right",items:[{xtype:"label",html:GO.lang.insertHRtext+"<br/>&nbsp;"},{xtype:"textfield",maskRe:/[0-9]|%/,regex:/^[1-9][0-9%]{1,3}/,fieldLabel:GO.lang.width,name:"hrwidth",value:"100%",width:60,listeners:{specialkey:function(c,d){if((d.getKey()==d.ENTER||d.getKey()==d.RETURN)&&c.isValid()){this.doInsertHR()}else{c.getEl().frame()}},scope:this}}]}],buttons:[{text:GO.lang.cmdInsert,handler:function(){var c=this.hrWindow.getComponent("insert-hr").getForm();if(c.isValid()){this.doInsertHR()}else{c.findField("hrwidth").getEl().frame()}},scope:this},{text:GO.lang.cmdCancel,handler:function(){this.hrWindow.hide()},scope:this}]})}else{this.hrWindow.getEl().frame()}this.hrWindow.show()},scope:this,tooltip:{title:GO.lang.insertHorizontalRule},overflowText:GO.lang.insertHorizontalRule})},doInsertHR:function(){var b=this.hrWindow.getComponent("insert-hr").getForm();if(b.isValid()){var a=b.findField("hrwidth").getValue();if(a){this.insertHR(a)}else{this.insertHR("100%")}b.reset();this.hrWindow.hide()}},insertHR:function(a){this.cmp.insertAtCursor('<hr width="'+a+'">')}});GO.DisplayPanel=function(a){a=a||{};this.templateConfig={};this.collapsibleSections={};GO.DisplayPanel.superclass.constructor.call(this,a);this.addEvents({bodyclick:true,afterbodyclick:true})};Ext.extend(GO.DisplayPanel,Ext.Panel,{link_id:0,link_type:0,newMenuButton:false,template:"",templateConfig:{},loadParams:{},idParam:"id",loadUrl:"",data:{},saveHandlerAdded:false,noFileBrowser:false,collapsibleSections:{},hiddenSections:[],expandListenObject:false,editGoDialogId:false,loading:false,createTopToolbar:function(){this.newMenuButton=new GO.NewMenuButton({panel:this});var a=[];a.push(this.editButton=new Ext.Button({iconCls:"btn-edit",text:GO.lang.cmdEdit,cls:"x-btn-text-icon",handler:this.editHandler,scope:this,disabled:true}));a.push(this.newMenuButton);a.push(this.linkBrowseButton=new Ext.Button({iconCls:"btn-link",cls:"x-btn-text-icon",text:GO.lang.cmdBrowseLinks,handler:function(){if(!GO.linkBrowser){GO.linkBrowser=new GO.LinkBrowser()}GO.linkBrowser.show({link_id:this.data.id,link_type:this.link_type,folder_id:"0"});GO.linkBrowser.on("hide",this.reload,this,{single:true})},scope:this}));if(GO.files&&!this.noFileBrowser){a.push(this.fileBrowseButton=new Ext.Button({iconCls:"btn-files",cls:"x-btn-text-icon",text:GO.files.lang.files,handler:function(){if(this.data.files_folder_id==0&&this.data.model){GO.request({url:"files/item/createFolder",maskEl:this.getEl(),params:{model:this.data.model,id:this.data.id},success:function(c,d,b){this.data.files_folder_id=b.files_folder_id;GO.files.openFolder(this.data.files_folder_id);GO.files.fileBrowserWin.on("hide",this.reload,this,{single:true})},scope:this})}else{GO.files.openFolder(this.data.files_folder_id);GO.files.fileBrowserWin.on("hide",this.reload,this,{single:true})}},scope:this,disabled:true}))}a.push("-");a.push({iconCls:"btn-refresh",tooltip:GO.lang.cmdRefresh,handler:this.reload,scope:this});a.push({iconCls:"btn-print",tooltip:GO.lang.cmdPrint,handler:function(){this.body.print({title:this.getTitle()})},scope:this});return a},initTemplate:function(){},initComponent:function(){this.autoScroll=true;this.split=true;var a=this.createTopToolbar();if(a){this.tbar=a}this.initTemplate();this.templateConfig.panel=this;this.templateConfig.collapsibleSectionHeader=function(c,d,b){this.panel.collapsibleSections[d]=b;return'<div class="collapsible-display-panel-header"><div style="float:left">'+c+'</div><div class="x-tool x-tool-toggle" style="float:right;margin:0px;padding:0px;cursor:pointer" id="toggle-'+d+'">&nbsp;</div></div>'};this.xtemplate=new Ext.XTemplate(this.template,this.templateConfig);this.xtemplate.compile();GO.DisplayPanel.superclass.initComponent.call(this);if(!this.expandListenObject){this.expandListenObject=this}this.expandListenObject.on("expand",function(){if(this.collapsedLinkId){this.load(this.collapsedLinkId,true);delete this.collapsedLinkId}},this)},afterRender:function(){GO.DisplayPanel.superclass.afterRender.call(this);var a=this.getTopToolbar();if(a){a.setDisabled(true)}this.body.on("click",this.onBodyClick,this);if(this.editGoDialogId){GO.dialogListeners.add(this.editGoDialogId,{scope:this,save:this.onSave})}},getLinkName:function(){return this.data.name},onSave:function(a,b){if(b>0&&(this.link_id==b||this.link_id==0)){this.load(b,true)}},gridDeleteCallback:function(a){if(this.data){var c=Ext.decode(a.params.delete_keys);for(var b=0;b<c.length;b++){if(this.data.id==c[b]){this.reset()}}}},reset:function(){if(this.body){this.body.update("")}this.data={};this.link_id=this.collapsedLinkId=0;var a=this.getTopToolbar();if(a){a.setDisabled(true)}},getState:function(){return Ext.apply(GO.DisplayPanel.superclass.getState.call(this)||{},{hiddenSections:this.hiddenSections})},setData:function(a){a.link_type=this.link_type;a.panelId=this.getId();this.data=a;var c=this.getTopToolbar();if(c){c.setDisabled(false)}if(this.editButton){this.editButton.setDisabled(!a.write_permission)}if(this.newMenuButton){if(a.write_permission){this.newMenuButton.setLinkConfig({id:this.data.id,type:this.link_type,text:this.getLinkName(),callback:this.reload,scope:this})}else{this.newMenuButton.setDisabled(true)}}if(this.fileBrowseButton){this.fileBrowseButton.setDisabled(a.files_folder_id<1&&!a.model)}this.xtemplate.overwrite(this.body,a);for(var b in this.collapsibleSections){if(this.hiddenSections.indexOf(this.collapsibleSections[b])>-1){this.toggleSection(b,true)}}},toggleSection:function(d,f){var c=Ext.get(d);var e=Ext.get("toggle-"+d);if(!e){return false}var a=false;if(typeof(f)=="undefined"){f=!e.hasClass("go-tool-toggle-collapsed");a=true}if(f){if(this.hiddenSections.indexOf(this.collapsibleSections[d])==-1){this.hiddenSections.push(this.collapsibleSections[d])}}else{var b=this.hiddenSections.indexOf(this.collapsibleSections[d]);if(b>-1){this.hiddenSections.splice(b,1)}}if(!c&&!f){this.reload()}else{if(c){c.setDisplayed(!f)}if(f){e.addClass("go-tool-toggle-collapsed")}else{e.removeClass("go-tool-toggle-collapsed")}}if(a){this.saveState()}},onBodyClick:function(g,j){this.fireEvent("bodyclick",this,j,g);if(j.id.substring(0,6)=="toggle"){var a=j.id.substring(7,j.id.length);this.toggleSection(a)}if(j.tagName!="A"){j=Ext.get(j).findParent("A",10);if(!j){return false}}if(j.tagName=="A"){var b=j.attributes.href.value;if(GO.email&&b.substr(0,6)=="mailto"){var o=b.indexOf("?");if(o>0){var k=b.substr(7,o-8)}else{var k=b.substr(7)}g.preventDefault();GO.email.addressContextMenu.showAt(g.getXY(),k)}else{var n=b.indexOf("#link_");if(n>-1){var f=b.substr(n+6,b.length);var l=this.data.links[f];if(l.link_type=="folder"){GO.linkBrowser.show({link_id:l.parent_link_id,link_type:l.parent_link_type,folder_id:l.id})}else{GO.linkHandlers[l.link_type].call(this,l.id,{data:l})}g.preventDefault();return}n=b.indexOf("#files_");if(n>-1){var f=b.substr(n+7,b.length);var c=this.data.files[f];if(c.extension=="folder"){GO.files.openFolder(this.data.files_folder_id,c.id)}else{if(GO.files){var d=new GO.files.FileRecord(c);GO.files.openFile(d)}else{window.open(GO.settings.modules.files.url+"download.php?id="+c.id)}}g.preventDefault();return}if(b.indexOf("#browselinks")>-1){if(!GO.linkBrowser){GO.linkBrowser=new GO.LinkBrowser()}GO.linkBrowser.show({link_id:this.data.id,link_type:this.link_type,folder_id:"0"});GO.linkBrowser.on("hide",this.reload,this,{single:true});g.preventDefault();return}if(b.indexOf("#browsefiles")>-1){GO.files.openFolder(this.data.files_folder_id);GO.files.fileBrowserWin.on("hide",this.reload,this,{single:true});g.preventDefault();return}this.fireEvent("afterbodyclick",this,j,g,b)}}},load:function(b,a){if(this.expandListenObject.collapsed||!this.rendered){this.collapsedLinkId=this.link_id=b}else{if(this.link_id!=b||a){this.loading=true;this.loadParams[this.idParam]=this.link_id=b;this.loadParams.hidden_sections=Ext.encode(this.hiddenSections);this.body.mask(GO.lang.waitMsgLoad);Ext.Ajax.request({url:this.loadUrl,params:this.loadParams,callback:function(d,f,c){this.loading=false;this.body.unmask();if(!f){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var e=Ext.decode(c.responseText);if(!e.success){Ext.MessageBox.alert(GO.lang.strError,e.feedback)}else{this.setData(e.data);if(!a){this.body.scrollTo("top",0)}}}},scope:this})}}},setTitle:function(a){if(typeof(this.title)!="undefined"){GO.DisplayPanel.superclass.setTitle.call(this,a)}else{if(this.ownerCt){this.ownerCt.setTitle(a)}}},getTitle:function(){if(typeof(this.title)!="undefined"){return this.title}else{if(this.ownerCt){this.ownerCt.title}}return false},reload:function(){if(this.data.id){this.load(this.data.id,true)}},editHandler:function(){}});GO.panel.IFrameComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){if(!this.name){this.name=""}this.el=b.createChild({tag:"iframe",id:this.id,frameBorder:0,src:this.url,name:this.name})},setUrl:function(a){this.el.set({src:a})}});GO.dialog.SelectGroups=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","user_id","user_name"],remoteSort:true,baseParams:{task:"groups"}});var b=new Ext.ux.grid.RowActions({header:"-",autoWidth:true,align:"center",actions:[{iconCls:"btn-users",qtip:GO.lang.users}]});this.grid=new GO.grid.GridPanel({plugins:b,clicksToEdit:1,paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},b],sm:new Ext.grid.RowSelectionModel()});b.on({scope:this,action:function(e,c,f,g,d){this.grid.getSelectionModel().selectRow(g);switch(f){case"btn-users":this.showUsersInGroupDialog(c.data.id);break}}},this);this.grid.on("rowdblclick",function(){this.callHandler(true)},this);this.store.load();Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectGroups,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}],keys:[{key:Ext.EventObject.ENTER,fn:function(){this.callHandler(true)},scope:this}]})};Ext.extend(GO.dialog.SelectGroups,Ext.Window,{showUsersInGroupDialog:function(a){if(!this.usersInGroupDialog){this.usersInGroupDialog=new GO.dialog.UsersInGroup()}this.usersInGroupDialog.setGroupId(a);this.usersInGroupDialog.show()},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectUsers=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",root:"results",totalProperty:"total",id:"id",fields:["id","name","email"],remoteSort:true,baseParams:{task:"users"}});this.searchField=new GO.form.SearchField({store:this.store,width:320});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.searchField]});this.grid.on("rowdblclick",function(){this.callHandler(true)},this);var b=function(){this.searchField.focus(true)};GO.dialog.SelectUsers.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",focus:b.createDelegate(this),title:GO.lang.strSelectUsers,items:this.grid,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectUsers,Ext.Window,{show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.dialog.SelectUsers.superclass.show.call(this)},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.SelectEmail=function(b){Ext.apply(this,b);var a=Array();this.usersStore=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},id:"id",root:"results",totalProperty:"total",fields:["id","username","name","company","logins","lastlogin","registration_time","address","zip","city","state","country","phone","email","waddress","wzip","wcity","wstate","wcountry","wphone"],remoteSort:true});this.usersSearchField=new GO.form.SearchField({store:this.usersStore,width:320});this.usersGrid=new GO.grid.GridPanel({id:"select-users-grid",title:GO.lang.users,paging:true,border:false,store:this.usersStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.usersSearchField]});this.usersGrid.on("show",function(){this.usersStore.load()},this);this.usersGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.usersGrid);if(GO.addressbook){this.contactsStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"contacts",no_addressbooks_filter:true},root:"results",id:"id",totalProperty:"total",fields:["id","name","company_name","email","home_phone","work_phone","work_fax","cellular"],remoteSort:true});this.contactsSearchField=new GO.form.SearchField({store:this.contactsStore,width:320});this.contactsGrid=new GO.grid.GridPanel({id:"select-contacts-grid",title:GO.addressbook.lang.contacts,paging:true,border:false,store:this.contactsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.contactsSearchField]});this.contactsGrid.on("show",function(){this.contactsStore.load()},this);this.contactsGrid.on("rowdblclick",function(){this.callHandler(true)},this);this.companiesStore=new GO.data.JsonStore({url:GO.settings.modules.addressbook.url+"json.php",baseParams:{task:"companies"},totalProperty:"total",root:"results",id:"id",fields:["id","name","city","email","phone","homepage","address","zip"],remoteSort:true});this.companySearchField=new GO.form.SearchField({store:this.companiesStore,width:320});this.companyGrid=new GO.grid.GridPanel({id:"select-companies-grid",title:GO.addressbook.lang.companies,paging:true,border:false,store:this.companiesStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strEmail,dataIndex:"email",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.companySearchField]});this.companyGrid.on("show",function(){this.companiesStore.load()},this);this.companyGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.contactsGrid);a.push(this.companyGrid);if(GO.addressbook){this.mailingsGrid=new GO.grid.GridPanel({id:"select-mailings-grid",title:GO.addressbook.lang.cmdPanelMailings,paging:false,border:false,store:GO.addressbook.readableMailingsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.mailingsGrid.on("show",function(){if(!GO.addressbook.readableMailingsStore.loaded){GO.addressbook.readableMailingsStore.load()}},this);this.mailingsGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.mailingsGrid)}}this.userGroupsStore=new GO.data.JsonStore({url:GO.settings.modules.groups.url+"non_admin_json.php",baseParams:{task:"groups"},id:"id",root:"results",fields:["id","name","user_id","user_name"],totalProperty:"total",remoteSort:true});this.userGroupsGrid=new GO.grid.GridPanel({id:"select-usergroups-grid",title:GO.lang.userGroups,paging:true,border:false,store:this.userGroupsStore,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true},{header:GO.lang.strOwner,dataIndex:"user_name",css:"white-space:normal;",sortable:true}],sm:new Ext.grid.RowSelectionModel()});this.userGroupsGrid.on("show",function(){this.userGroupsStore.load()},this);this.userGroupsGrid.on("rowdblclick",function(){this.callHandler(true)},this);a.push(this.userGroupsGrid);this.tabPanel=new Ext.TabPanel({activeTab:0,items:a});Ext.Window.superclass.constructor.call(this,{layout:"fit",modal:false,height:400,width:600,closeAction:"hide",title:GO.lang.strSelectEmail,items:this.tabPanel,buttons:[{text:GO.lang.cmdOk,handler:function(){this.callHandler(true)},scope:this},{text:GO.lang.cmdAdd,handler:function(){this.callHandler(false)},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.SelectEmail,Ext.Window,{callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var d,c;switch(this.tabPanel.getLayout().activeItem.id){case"select-users-grid":c="users";d=this.usersGrid;break;case"select-contacts-grid":c="contacts";d=this.contactsGrid;break;case"select-usergroups-grid":c="usergroups";d=this.userGroupsGrid;break;case"select-companies-grid":c="companies";d=this.companyGrid;break;case"select-mailings-grid":c="mailings";d=this.mailingsGrid;break}var b=this.handler.createDelegate(this.scope,[d,c]);b.call()}if(a){this.hide()}}});GO.ErrorDialog=function(a){a=a||{};Ext.apply(a,{width:550,height:300,autoHeight:true,closeAction:"hide",plain:true,border:false,closable:true,title:GO.lang.strError,modal:false,items:[this.messagePanel=new Ext.FormPanel({region:"center",cls:"go-error-dialog",autoHeight:true,html:""}),this.detailPanel=new Ext.Panel({region:"south",collapsible:true,collapsed:true,height:150,title:GO.lang.errorDetails,titleCollapse:true,autoScroll:true,html:""})],buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ErrorDialog.superclass.constructor.call(this,a)};Ext.extend(GO.ErrorDialog,GO.Window,{show:function(a,b){if(!this.rendered){this.render(Ext.getBody())}this.detailPanel.collapse();this.messagePanel.body.update(a);if(GO.util.empty(b)){this.detailPanel.hide()}else{this.detailPanel.show();this.detailPanel.body.update("<pre>"+b+"</pre>")}GO.ErrorDialog.superclass.show.call(this)}});GO.errorDialog=new GO.ErrorDialog();Ext.ux.FieldHelp=Ext.extend(Object,(function(){function b(c,d){this.el.setSize(c,d)}function a(){if(!this.wrap){this.wrap=this.el.wrap({cls:"x-form-field-wrap"});this.positionEl=this.resizeEl=this.wrap;this.actionMode="wrap";this.onResize=this.onResize.createSequence(b)}this.helpTextEl=this.wrap[this.helpAlign=="top"?"insertFirst":"createChild"]({cls:"x-form-helptext",html:this.helpText})}return{constructor:function(c,d){this.helpText=c;this.align=d},init:function(c){c.helpAlign=this.align;c.helpText=this.helpText;c.afterRender=c.afterRender.createSequence(a)}}})());GO.form.TreeSelect=Ext.extend(Ext.form.TriggerField,{triggerClass:"go-form-tree-select",windowConfig:{},onTriggerClick:function(){if(!this.treeSelectWindow){this.windowConfig.textfield=this;this.treeSelectWindow=new GO.form.TreeSelectWindow(this.windowConfig)}this.treeSelectWindow.show()}});GO.form.TreeSelectWindow=Ext.extend(function(a){a=a||{};a.title=a.textfield.windowTitle||"";this.treePanel=new Ext.tree.TreePanel({layout:"fit",loader:a.textfield.treeLoader,containerScroll:true,autoScroll:true,rootVisible:false,root:{nodeType:"async",id:"root"}});a.layout="fit";a.items=[this.treePanel];a.modal=true;a.width=640;a.height=400;a.closeAction="hide";a.closable=true;a.buttons=[{text:GO.lang.cmdOk,handler:function(){var d=[],b=this.treePanel.getChecked();var g=this.textfield.getValue();var c=g.split(",");for(var e=0;e<c.length;e++){if(c[e]!=""){var f=this.treePanel.getNodeById(c[e]);if(!f){d.push(c[e])}}}Ext.each(b,function(j){d.push(j.id)});this.textfield.setValue(d.join(","));this.hide()},scope:this}];GO.form.TreeSelectWindow.superclass.constructor.call(this,a);this.treePanel.on("load",function(d){var b=this.textfield.getValue();var c=b.split(",");Ext.each(d.childNodes,function(f){var e=c.indexOf(f.id);if(e>-1){f.attributes.checked=true}})},this);this.on("show",function(){var b=this.textfield.getValue();var d=b.split(",");this.clearChecked();for(var c=0;c<d.length;c++){var e=this.treePanel.getNodeById(d[c]);if(e){e.getUI().toggleCheck(true)}}},this)},GO.Window,{clearChecked:function(){var a=this.treePanel.getChecked();Ext.each(a,function(b){b.getUI().toggleCheck(false)})}});Ext.reg("treeselect",GO.form.TreeSelect);GO.form.SearchField=Ext.extend(Ext.form.TwinTriggerField,{store:false,initComponent:function(){GO.form.SearchField.superclass.initComponent.call(this);this.on("specialkey",function(a,b){if(b.getKey()==b.ENTER){this.onTrigger2Click()}},this);this.on("focus",function(){this.focus(true)},this);this.addEvents({reset:true,search:true})},validationEvent:false,validateOnBlur:false,trigger1Class:"x-form-clear-trigger",trigger2Class:"x-form-search-trigger",width:180,hasSearch:false,paramName:"query",emptyText:GO.lang.strSearch,onTrigger1Click:function(){this.fireEvent("reset",this);if(this.hasSearch){this.store.baseParams[this.paramName]="";this.store.load();this.el.dom.value="";this.hasSearch=false}},onTrigger2Click:function(){this.fireEvent("search",this);var a=this.getRawValue();if(a.length<1){this.onTrigger1Click();return}this.store.baseParams[this.paramName]=a;this.store.load();this.hasSearch=true},afterRender:function(){GO.form.SearchField.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}},setValue:function(a){GO.form.SearchField.superclass.setValue.call(this,a);if(a!=""){this.hasSearch=true}}});GO.form.ComboBox=Ext.extend(Ext.form.ComboBox,{minChars:3,initComponent:function(){GO.form.ComboBox.superclass.initComponent.call(this);if(this.remoteText){this.setRemoteText(this.remoteText)}},setRemoteText:function(e){var d=this.findRecord(this.valueField,this.value);if(!d){var c=Ext.data.Record.create([{name:this.valueField},{name:this.displayField}]);var b={};b[this.valueField]=this.value;b[this.displayField]=e;var a=new c(b);this.store.add(a);this.setValue(this.value)}},initValue:function(){GO.form.ComboBox.superclass.initValue.call(this);if(!GO.util.empty(this.lastSelectionText)){this.setRawValue(this.lastSelectionText)}},selectFirst:function(){if(this.store.getCount()){var a=this.store.getRange(0,1);this.setValue(a[0].get(this.valueField))}},clearLastSearch:function(){this.lastQuery=false;this.hasSearch=false}});Ext.reg("combo",GO.form.ComboBox);GO.form.ColorField=Ext.extend(function(a){GO.form.ColorField.superclass.constructor.call(this,a)},Ext.form.TriggerField,{showHexValue:false,defaultAutoCreate:{tag:"input",type:"text",size:"1",autocomplete:"off",maxlength:"6"},lengthText:"Color hex values must be either 3 or 6 characters.",blankText:"Must have a hexidecimal value in the format ABCDEF.",maskRe:/[a-f0-9]/i,regex:/[a-f0-9]/i,curColor:"ffffff",validateValue:function(a){if(!this.showHexValue){return true}if(a.length<1){this.el.setStyle({"background-color":"#"+this.defaultColor});if(!this.allowBlank){this.markInvalid(String.format(this.blankText,a));return false}return true}if(a.length!=3&&a.length!=6){this.markInvalid(String.format(this.lengthText,a));return false}this.setColor(a);return true},validateBlur:function(){return !this.menu||!this.menu.isVisible()},markInvalid:function(a){GO.form.ColorField.superclass.markInvalid.call(this,a);this.el.setStyle({"background-image":"url(../lib/resources/images/default/grid/invalid_line.gif)"})},setValue:function(a){GO.form.ColorField.superclass.setValue.call(this,a);this.setColor(a)},initValue:function(){GO.form.ColorField.superclass.initValue.call(this);this.setColor(this.value)},setColor:function(a){if(this.rendered){this.curColor=a;this.el.setStyle({"background-color":"#"+a,"background-image":"none"});if(!this.showHexValue){this.el.setStyle({"text-indent":"-100px"});if(Ext.isIE){this.el.setStyle({"margin-left":"100px"})}}if(this.menu){this.menu.palette.select(this.curColor)}}},menuListeners:{select:function(a,b){this.setValue(b)},show:function(){this.onFocus()},hide:function(){this.focus();var a=this.menuListeners;this.menu.un("select",a.select,this);this.menu.un("show",a.show,this);this.menu.un("hide",a.hide,this)}},handleSelect:function(b,a){this.setValue(a)},onTriggerClick:function(){if(this.disabled){return}if(!this.menu){this.menu=new Ext.menu.ColorMenu();this.menu.palette.on("select",this.handleSelect,this);this.menu.palette.value=this.curColor;this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));if(this.colors){this.menu.palette.colors=this.colors}}this.menu.show(this.el,"tl-bl")}});Ext.reg("colorfield",GO.form.ColorField);GO.form.ComboBoxReset=Ext.extend(GO.form.ComboBox,{initComponent:Ext.form.TwinTriggerField.prototype.initComponent,getTrigger:Ext.form.TwinTriggerField.prototype.getTrigger,initTrigger:Ext.form.TwinTriggerField.prototype.initTrigger,trigger1Class:"x-form-clear-trigger",onViewClick:Ext.form.ComboBox.prototype.onViewClick.createSequence(function(){}),onTrigger2Click:function(){this.onTriggerClick()},onTrigger1Click:function(){var a=this.getValue();this.clearValue();this.fireEvent("change",this,this.getValue(),a);this.fireEvent("clear",this)},setValue:function(a){GO.form.ComboBoxReset.superclass.setValue.call(this,a);if(this.rendered){}},afterRender:function(){GO.form.ComboBoxReset.superclass.afterRender.call(this);if(Ext.isIE8){this.el.setTop(0)}}});Ext.reg("comboboxreset",GO.form.ComboBoxReset);GO.form.ComboBoxMulti=function(a){a.typeAhead=false;a.minChars=2;a.hideTrigger=true;a.defaultAutoCreate={tag:"textarea",autocomplete:"off"};GO.form.ComboBoxMulti.superclass.constructor.call(this,a);this.on("focus",function(){this.focused=true},this);this.on("blur",function(){this.focused=false},this)};Ext.extend(GO.form.ComboBoxMulti,GO.form.ComboBox,{sep:",",focused:false,getCursorPosition:function(){if(document.selection){var a=document.selection.createRange();if(!a){return false}var b=a.duplicate();if(!this.el.dom){return false}b.moveToElementText(this.el.dom);b.setEndPoint("EndToEnd",a);return b.text.length}else{return this.el.dom.selectionEnd}},getActiveRange:function(){var b=this.sep;var d=this.getCursorPosition();var a=this.getRawValue();var c=d;while(c>0&&a.charAt(c)!=b){--c}if(c>0){c++}return{left:c,right:d}},getActiveEntry:function(){var a=this.getActiveRange();return this.getRawValue().substring(a.left,a.right).replace(/^s+|s+$/g,"")},replaceActiveEntry:function(c){var b=this.getActiveRange();var a=this.getRawValue();if(this.preventDuplicates&&a.indexOf(c)>=0){return}var e=(this.sep==" "?"":" ");this.setValue(a.substring(0,b.left)+(b.left>0?e:"")+c+this.sep+e+a.substring(b.right));var d=b.left+c.length+2+e.length;this.selectText.defer(200,this,[d,d])},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=Ext.util.Format.htmlDecode(a.data[this.valueField||this.displayField]);if(this.sep){this.replaceActiveEntry(c)}else{this.setValue(c)}this.collapse();this.fireEvent("select",this,a,b)}},initQuery:function(){if(this.focused){this.doQuery(this.sep?this.getActiveEntry():this.getRawValue())}}});GO.form.UploadFile=function(a){if(!a.addText){a.addText=GO.lang.browse}this.inputs=new Ext.util.MixedCollection();if(!a.createNoRows){a.createNoRows=false}GO.form.UploadFile.superclass.constructor.call(this,a);this.addEvents({fileAdded:true})};Ext.extend(GO.form.UploadFile,Ext.BoxComponent,{addText:"",cls:"",defaultAutoCreate:{tag:"div"},fileCls:"filetype",max:0,onRender:function(b,a){this.id=Ext.id();this.el=b.createChild({tag:"div",id:this.id,cls:this.cls})},afterRender:function(){GO.form.UploadFile.superclass.afterRender.call(this);this.createButtons();this.createUploadInput()},createUploadInput:function(){if(!this.inputName){this.inputName=Ext.id()}var b=Ext.id();var a=this.inputWrap.createChild({tag:"input",type:"file",cls:"x-uf-input",size:0,id:b,name:this.inputName+"[]"});a.on("change",this.onFileAdded,this);this.inputs.add(a);return a},createButtons:function(){this.buttonsWrap=this.el.createChild({tag:"div",cls:"x-uf-buttons-ct",id:Ext.id(),children:[{tag:"div",cls:"x-uf-input-ct",id:Ext.id(),children:[{tag:"div",cls:"x-uf-bbtn-ct",id:Ext.id()},{tag:"div",cls:"x-uf-input-wrap",id:Ext.id()}]}]});this.inputWrap=this.buttonsWrap.select("div.x-uf-input-wrap").item(0);this.addBtnCt=this.buttonsWrap.select("div.x-uf-input-ct").item(0);var a=this.buttonsWrap.select("div.x-uf-bbtn-ct").item(0);this.browseBtn=new Ext.Button({renderTo:a,text:this.addText})},onFileAdded:function(b,a){this.inputs.each(function(c){c.setDisplayed(false)});if(!this.table&&!this.createNoRows){this.table=this.el.createChild({tag:"table",cls:"x-uf-table",children:[{tag:"tbody"}]});this.tbody=this.table.select("tbody").item(0);this.table.on({click:{scope:this,fn:this.onDeleteFile,delegate:"a"}})}var a=this.inputs.itemAt(this.inputs.getCount()-1);a.un("change",this.onFileAdded,this);if(!this.createNoRows){this.appendRow(a);this.createUploadInput();if(this.max>0&&this.max<=this.inputs.getCount()){this.setDisabled(true)}}else{this.createUploadInput()}this.fireEvent("filesChanged",this,this.inputs);this.fireEvent("fileAdded",this,a)},appendRow:function(c){var a=c.getValue();var d={id:c.id,fileCls:this.getFileCls(a),fileName:Ext.util.Format.ellipsis(a.split(/[\/\\]/).pop(),this.maxNameLength),fileQtip:a};var b=new Ext.Template(['<tr id="r-{id}">','<td class="x-unselectable">','<span class="filetype-link {fileCls}" unselectable="on" qtip="{fileQtip}">{fileName}</span>',"</td>",'<td id="m-{id}" class="x-uf-filedelete"><a id="d-{id}" href="#"><div class="go-icon btn-delete"></div></a>',"</td>","</tr>"]);c.row=b.append(this.tbody,d,true)},onDeleteFile:function(b,a){this.removeFile(a.id.substr(2))},removeFile:function(b){if(this.uploading){return}var a=this.inputs.get(b);if(a&&a.row){a.row.remove()}if(a){a.remove()}this.inputs.removeKey(b);this.setDisabled(false);this.fireEvent("filesChanged",this,this.inputs)},getFileCls:function(a){var b=a.split(".");if(1===b.length){return this.fileCls}else{return this.fileCls+"-"+b.pop()}},clearQueue:function(){this.inputs.each(function(a){if(!a.isVisible()){this.removeFile(a.id,true)}},this)},setDisabled:function(a){if(a){this.addBtnCt.mask()}else{this.addBtnCt.unmask()}}});GO.form.PlainField=Ext.extend(Ext.form.Field,{defaultAutoCreate:{tag:"div",cls:"x-form-plainfield"},initComponent:function(){GO.form.PlainField.superclass.initComponent.call(this);if(this.boxLabel&&GO.util.empty(this.fieldLabel)){this.fieldLabel=this.boxLabel;this.hideLabel=false}this.addEvents("load")},getName:function(){return this.name},initValue:function(){if(this.value!==undefined){this.setValue(this.value)}else{if(this.el.dom.innerHTML.length>0){this.setValue(this.el.dom.value)}}this.originalValue=this.getValue()},getValue:function(){return this.value},setValue:function(a){if(this.boxLabel){if(a=="1"){a=GO.lang.cmdYes}else{a=GO.lang.cmdNo}}this.value=a;if(this.rendered){this.el.update(a)}}});Ext.reg("plainfield",GO.form.PlainField);GO.form.SelectUser=function(a){a=a||{};if(typeof(a.allowBlank)=="undefined"){a.allowBlank=false}Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.users.url+"non_admin_json.php",baseParams:{task:"users"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","username","company","first_name","middle_name","last_name","address","address_no","zip","city","state","country","cf"],remoteSort:true});this.store.setDefaultSort("name","asc");if(!this.hiddenName){this.hiddenName="user_id"}if(!a.startBlank){this.setRemoteValue(GO.settings.user_id,GO.settings.name);this.value=GO.settings.user_id}if(!this.valueField){this.valueField="id"}GO.form.SelectUser.superclass.constructor.call(this,{displayField:"name",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectUser,GO.form.ComboBoxReset,{setRemoteValue:function(a,b){var c=this.findRecord("id",a);if(!c){var e=Ext.data.Record.create([{name:"id"},{name:"name"}]);var d=new e({id:a,name:b});this.store.add(d)}this.setValue(a)}});Ext.reg("selectuser",GO.form.SelectUser);GO.form.SelectGroup=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.settings.modules.groups.url+"non_admin_json.php",baseParams:{task:"groups"},root:"results",totalProperty:"total",id:"id",fields:["id","name","email","groupname"],remoteSort:true});this.store.setDefaultSort("name","asc");if(!this.fieldLabel){this.fieldLabel=GO.lang.userGroup}if(!this.hiddenName){this.hiddenName="group_id"}GO.form.SelectGroup.superclass.constructor.call(this,{displayField:"name",valueField:"id",triggerAction:"all",selectOnFocus:true,forceSelection:true,pageSize:parseInt(GO.settings.max_rows_list)})};Ext.extend(GO.form.SelectGroup,GO.form.ComboBoxReset,{setRemoteValue:function(c,b){var d=Ext.data.Record.create([{name:"id"},{name:"name"}]);var a=new d({id:c,name:b});this.store.add(a);this.setValue(c)}});Ext.reg("selectgroup",GO.form.SelectGroup);GO.form.SelectCountry=function(b){if(!GO.countriesStore){var a=[];for(var d in GO.lang.countries){a.push([d,GO.lang.countries[d]])}GO.countriesStore=new Ext.data.SimpleStore({fields:["iso","name"],data:a,sortInfo:{field:"name",direction:"ASC"}})}Ext.apply(this,b);GO.form.SelectCountry.superclass.constructor.call(this,{store:GO.countriesStore,valueField:"iso",displayField:"name",triggerAction:"all",editable:true,mode:"local",selectOnFocus:true,forceSelection:true,emptyText:GO.lang.strNoCountrySelected})};Ext.extend(GO.form.SelectCountry,Ext.form.ComboBox);GO.addressFormatStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"select_address_format"},root:"results",totalProperty:"total",id:"iso",fields:["iso","address_format_id","country_name"],remoteSort:true});GO.addressFormatStore.setDefaultSort("country_name","ASC");GO.form.SelectAddressFormat=function(a){Ext.apply(this,a);this.store=GO.addressFormatStore;GO.form.SelectAddressFormat.superclass.constructor.call(this,{valueField:"iso",triggerAction:"all",selectOnFocus:true,forceSelection:true,editable:true,mode:"local",lazyInit:false})};Ext.extend(GO.form.SelectAddressFormat,GO.form.ComboBox,{afterRender:function(){if(!this.store.loaded){this.store.load({callback:function(){var a=this.getValue();if(a){this.setValue(a)}},scope:this})}GO.form.SelectAddressFormat.superclass.afterRender.call(this)}});
/*
 * Ext JS Library 3.2.1
 * Copyright(c) 2006-2010 Ext JS, Inc.
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux.form");Ext.ux.form.FileUploadField=Ext.extend(Ext.form.TextField,{buttonText:"Browse...",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Ext.ux.form.FileUploadField.superclass.initComponent.call(this);this.addEvents("fileselected")},onRender:function(c,a){Ext.ux.form.FileUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var a=this.fileInput.dom.value;this.setValue(a);this.fireEvent("fileselected",this,a)}})},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Ext.ux.form.FileUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Ext.ux.form.FileUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Ext.ux.form.FileUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Ext.ux.form.FileUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Ext.ux.form.FileUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])}});Ext.reg("fileuploadfield",Ext.ux.form.FileUploadField);Ext.form.FileUploadField=Ext.ux.form.FileUploadField;GO.form.TriggerIdField=Ext.extend(Ext.form.TriggerField,{onRender:function(b,a){GO.form.TriggerIdField.superclass.onRender.call(this,b,a);this.hiddenField=this.el.insertSibling({tag:"input",type:"hidden",name:this.name},"before",true);this.el.dom.removeAttribute("name")},initValue:function(){GO.form.TriggerIdField.superclass.initValue.call(this);if(this.hiddenField){this.hiddenField.value=this.hiddenValue!==undefined?this.hiddenValue:this.value!==undefined?this.value:""}},setValue:function(a){if(this.hiddenField){this.hiddenField.value=a}},setText:function(a){this.setRawValue(a)}});Ext.namespace("Ext.ux.form");Ext.ux.form.SuperBoxSelect=function(a){Ext.ux.form.SuperBoxSelect.superclass.constructor.call(this,a);this.addEvents("beforeadditem","additem","newitem","beforeremoveitem","removeitem","clear")};Ext.ux.form.SuperBoxSelect=Ext.extend(Ext.ux.form.SuperBoxSelect,Ext.form.ComboBox,{max:0,allowAddNewData:false,backspaceDeletesLastItem:true,classField:null,clearBtnCls:"",displayFieldTpl:null,extraItemCls:"",extraItemStyle:"",expandBtnCls:"",fixFocusOnTabSelect:true,forceFormValue:true,forceSameValueQuery:false,itemDelimiterKey:Ext.EventObject.ENTER,navigateItemsWithTab:true,pinList:true,preventDuplicates:true,queryValuesDelimiter:"|",queryValuesIndicator:"valuesqry",removeValuesFromStore:true,renderFieldBtns:true,stackItems:false,styleField:null,supressClearValueRemoveEvents:false,validationEvent:"blur",valueDelimiter:",",initComponent:function(){Ext.apply(this,{items:new Ext.util.MixedCollection(false),usedRecords:new Ext.util.MixedCollection(false),addedRecords:[],remoteLookup:[],hideTrigger:true,grow:false,resizable:false,multiSelectMode:false,preRenderValue:null});if(this.transform){this.doTransform()}if(this.forceFormValue){this.items.on({add:this.manageNameAttribute,remove:this.manageNameAttribute,clear:this.manageNameAttribute,scope:this})}Ext.ux.form.SuperBoxSelect.superclass.initComponent.call(this);if(this.mode==="remote"&&this.store){this.store.on("load",this.onStoreLoad,this)}},onRender:function(b,a){var c=this.hiddenName;this.hiddenName=null;Ext.ux.form.SuperBoxSelect.superclass.onRender.call(this,b,a);this.hiddenName=c;this.manageNameAttribute();var d=(this.stackItems===true)?"x-superboxselect-stacked":"";if(this.renderFieldBtns){d+=" x-superboxselect-display-btns"}this.el.removeClass("x-form-text").addClass("x-superboxselect-input-field");this.wrapEl=this.el.wrap({tag:"ul"});this.outerWrapEl=this.wrapEl.wrap({tag:"div",cls:"x-form-text x-superboxselect "+d});this.inputEl=this.el.wrap({tag:"li",cls:"x-superboxselect-input"});if(this.renderFieldBtns){this.setupFieldButtons().manageClearBtn()}this.setupFormInterception()},onStoreLoad:function(b,a,c){var f=c.params[this.queryParam]||b.baseParams[this.queryParam]||"",g=c.params[this.queryValuesIndicator]||b.baseParams[this.queryValuesIndicator];if(this.removeValuesFromStore){this.store.each(function(k){if(this.usedRecords.containsKey(k.get(this.valueField))){this.store.remove(k)}},this)}if(g){var j=f.split(this.queryValuesDelimiter);Ext.each(j,function(k){this.remoteLookup.remove(k);var l=this.findRecord(this.valueField,k);if(l){this.addRecord(l)}},this);if(this.setOriginal){this.setOriginal=false;this.originalValue=this.getValue()}}if(f!==""&&this.allowAddNewData){Ext.each(this.remoteLookup,function(k){if(typeof k==="object"&&k[this.valueField]===f){this.remoteLookup.remove(k);if(a.length&&a[0].get(this.valueField)===f){this.addRecord(a[0]);return}var l=this.createRecord(k);this.store.add(l);this.addRecord(l);this.addedRecords.push(l);(function(){if(this.isExpanded()){this.collapse()}}).defer(10,this);return}},this)}var d=[];if(f===""){Ext.each(this.addedRecords,function(k){if(this.preventDuplicates&&this.usedRecords.containsKey(k.get(this.valueField))){return}d.push(k)},this)}else{var e=new RegExp(Ext.escapeRe(f)+".*","i");Ext.each(this.addedRecords,function(k){if(this.preventDuplicates&&this.usedRecords.containsKey(k.get(this.valueField))){return}if(e.test(k.get(this.displayField))){d.push(k)}},this)}this.store.add(d);this.sortStore();if(this.store.getCount()===0&&this.isExpanded()){this.collapse()}},doTransform:function(){var p=Ext.getDom(this.transform),f=[];if(!this.store){this.mode="local";var j=[],a=p.options;for(var e=0,g=a.length;e<g;e++){var c=a[e],n=Ext.get(c),k=n.getAttributeNS(null,"value")||"",l=n.getAttributeNS(null,"className")||"",b=n.getAttributeNS(null,"style")||"";if(c.selected){f.push(k)}j.push([k,c.text,l,typeof(b)==="string"?b:b.cssText])}this.store=new Ext.data.SimpleStore({id:0,fields:["value","text","cls","style"],data:j});Ext.apply(this,{valueField:"value",displayField:"text",classField:"cls",styleField:"style"})}if(f.length){this.value=f.join(",")}},setupFieldButtons:function(){this.buttonWrap=this.outerWrapEl.createChild({cls:"x-superboxselect-btns"});this.buttonClear=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-clear "+this.clearBtnCls});this.buttonExpand=this.buttonWrap.createChild({tag:"div",cls:"x-superboxselect-btn-expand "+this.expandBtnCls});this.initButtonEvents();return this},initButtonEvents:function(){this.buttonClear.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return}this.clearValue();this.el.focus()},this);this.buttonExpand.addClassOnOver("x-superboxselect-btn-over").on("click",function(a){a.stopEvent();if(this.disabled){return}if(this.isExpanded()){this.multiSelectMode=false}else{if(this.pinList){this.multiSelectMode=true}}this.onTriggerClick()},this)},removeButtonEvents:function(){this.buttonClear.removeAllListeners();this.buttonExpand.removeAllListeners();return this},clearCurrentFocus:function(){if(this.currentFocus){this.currentFocus.onLnkBlur();this.currentFocus=null}return this},initEvents:function(){var a=this.el;a.on({click:this.onClick,focus:this.clearCurrentFocus,blur:this.onBlur,keydown:this.onKeyDownHandler,keyup:this.onKeyUpBuffered,scope:this});this.on({collapse:this.onCollapse,expand:this.clearCurrentFocus,scope:this});this.wrapEl.on("click",this.onWrapClick,this);this.outerWrapEl.on("click",this.onWrapClick,this);this.inputEl.focus=function(){a.focus()};Ext.ux.form.SuperBoxSelect.superclass.initEvents.call(this);Ext.apply(this.keyNav,{tab:function(b){if(this.fixFocusOnTabSelect&&this.isExpanded()){b.stopEvent();a.blur();this.onViewClick(false);this.focus(false,10);return true}this.onViewClick(false);if(a.dom.value!==""){this.setRawValue("")}return true},down:function(b){if(!this.isExpanded()&&!this.currentFocus){this.onTriggerClick()}else{this.inKeyMode=true;this.selectNext()}},enter:function(){}})},onClick:function(){this.clearCurrentFocus();this.collapse();this.autoSize()},beforeBlur:Ext.form.ComboBox.superclass.beforeBlur,onFocus:function(){this.outerWrapEl.addClass(this.focusClass);Ext.ux.form.SuperBoxSelect.superclass.onFocus.call(this)},onBlur:function(){this.outerWrapEl.removeClass(this.focusClass);this.clearCurrentFocus();if(this.el.dom.value!==""){this.applyEmptyText();this.autoSize()}Ext.ux.form.SuperBoxSelect.superclass.onBlur.call(this)},onCollapse:function(){this.view.clearSelections();this.multiSelectMode=false},onWrapClick:function(a){a.stopEvent();this.collapse();this.el.focus();this.clearCurrentFocus()},markInvalid:function(c){var b,a;if(!this.rendered||this.preventMark){return}this.outerWrapEl.addClass(this.invalidClass);c=c||this.invalidText;switch(this.msgTarget){case"qtip":Ext.apply(this.el.dom,{qtip:c,qclass:"x-form-invalid-tip"});Ext.apply(this.wrapEl.dom,{qtip:c,qclass:"x-form-invalid-tip"});if(Ext.QuickTips){Ext.QuickTips.enable()}break;case"title":this.el.dom.title=c;this.wrapEl.dom.title=c;this.outerWrapEl.dom.title=c;break;case"under":if(!this.errorEl){b=this.getErrorCt();if(!b){this.el.dom.title=c;break}this.errorEl=b.createChild({cls:"x-form-invalid-msg"});this.errorEl.setWidth(b.getWidth(true)-20)}this.errorEl.update(c);Ext.form.Field.msgFx[this.msgFx].show(this.errorEl,this);break;case"side":if(!this.errorIcon){b=this.getErrorCt();if(!b){this.el.dom.title=c;break}this.errorIcon=b.createChild({cls:"x-form-invalid-icon"})}this.alignErrorIcon();Ext.apply(this.errorIcon.dom,{qtip:c,qclass:"x-form-invalid-tip"});this.errorIcon.show();this.on("resize",this.alignErrorIcon,this);break;default:a=Ext.getDom(this.msgTarget);a.innerHTML=c;a.style.display=this.msgDisplay;break}this.fireEvent("invalid",this,c)},clearInvalid:function(){if(!this.rendered||this.preventMark){return}this.outerWrapEl.removeClass(this.invalidClass);switch(this.msgTarget){case"qtip":this.el.dom.qtip="";this.wrapEl.dom.qtip="";break;case"title":this.el.dom.title="";this.wrapEl.dom.title="";this.outerWrapEl.dom.title="";break;case"under":if(this.errorEl){Ext.form.Field.msgFx[this.msgFx].hide(this.errorEl,this)}break;case"side":if(this.errorIcon){this.errorIcon.dom.qtip="";this.errorIcon.hide();this.un("resize",this.alignErrorIcon,this)}break;default:var a=Ext.getDom(this.msgTarget);a.innerHTML="";a.style.display="none";break}this.fireEvent("valid",this)},alignErrorIcon:function(){if(this.wrap){this.errorIcon.alignTo(this.wrap,"tl-tr",[Ext.isIE?5:2,3])}},expand:function(){if(this.isExpanded()||!this.hasFocus){return}if(this.bufferSize){this.doResize(this.bufferSize);delete this.bufferSize}this.list.alignTo(this.outerWrapEl,this.listAlign).show();this.innerList.setOverflow("auto");this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this)},restrictHeight:function(){var b=this.innerList.dom,c=b.scrollTop,f=this.list;b.style.height="";var g=f.getFrameWidth("tb")+(this.resizable?this.handleHeight:0)+this.assetHeight,d=Math.max(b.clientHeight,b.offsetHeight,b.scrollHeight),a=this.getPosition()[1]-Ext.getBody().getScroll().top,j=Ext.lib.Dom.getViewHeight()-a-this.getSize().height,e=Math.max(a,j,this.minHeight||0)-f.shadowOffset-g-5;d=Math.min(d,e,this.maxHeight);this.innerList.setHeight(d);f.beginUpdate();f.setHeight(d+g);f.alignTo(this.outerWrapEl,this.listAlign);f.endUpdate();if(this.multiSelectMode){b.scrollTop=c}},validateValue:function(a){if(this.items.getCount()===0){if(this.allowBlank){this.clearInvalid();return true}else{this.markInvalid(this.blankText);return false}}this.clearInvalid();return true},manageNameAttribute:function(){if(this.el){if(this.items.getCount()===0&&this.forceFormValue){this.el.dom.setAttribute("name",this.hiddenName||this.name)}else{this.el.dom.removeAttribute("name")}}},setupFormInterception:function(){var a;this.findParentBy(function(c){if(c.getForm){a=c.getForm()}});if(a&&!a.hasSuperBoxSequence){a.hasSuperBoxSequence=true;var b=this.orginalFormGetValues=a.getValues;a.getValues=function(c){a.items.each(function(e){if(e.setupFormInterception){e.el.dom.disabled=true;e.oldVal=this.el.dom.value;e.setRawValue("")}});var d=b.call(a);a.items.each(function(e){if(e.setupFormInterception){e.el.dom.disabled=false;e.setRawValue(e.oldVal);if(e.forceFormValue&&e.items.getCount()===0){d[e.name]=""}}});return c?Ext.urlEncode(d):d}}},onResize:function(a,c,e,b){var d=Ext.isIE6?4:Ext.isIE7?1:Ext.isIE8?1:0;if(this.wrapEl){this._width=a;this.outerWrapEl.setWidth(a-d);if(this.renderFieldBtns){d+=(this.buttonWrap.getWidth()+20);this.wrapEl.setWidth(a-d)}}Ext.ux.form.SuperBoxSelect.superclass.onResize.call(this,a,c,e,b);this.autoSize()},onEnable:function(){Ext.ux.form.SuperBoxSelect.superclass.onEnable.call(this);this.items.each(function(a){a.enable()});if(this.renderFieldBtns){this.initButtonEvents()}},onDisable:function(){Ext.ux.form.SuperBoxSelect.superclass.onDisable.call(this);this.items.each(function(a){a.disable()});if(this.renderFieldBtns){this.removeButtonEvents()}},clearValue:function(a){Ext.ux.form.SuperBoxSelect.superclass.clearValue.call(this);this.preventMultipleRemoveEvents=a||this.supressClearValueRemoveEvents||false;this.removeAllItems();this.preventMultipleRemoveEvents=false;this.fireEvent("clear",this);return this},onKeyUp:function(a){if(this.editable!==false&&(!a.isSpecialKey()||a.getKey()===a.BACKSPACE)&&a.getKey()!==this.itemDelimiterKey&&(!a.hasModifier()||a.shiftKey)){this.lastKey=a.getKey();this.dqTask.delay(this.queryDelay)}},onKeyDownHandler:function(g,c){var b,k,a;if((g.getKey()===g.DELETE||g.getKey()===g.SPACE)&&this.currentFocus){g.stopEvent();b=this.currentFocus;this.on("expand",function(){this.collapse()},this,{single:true});a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){k=this.items.itemAt(a+1)}b.preDestroy(true);if(k){(function(){k.onLnkFocus();this.currentFocus=k}).defer(200,this)}return true}var j=this.el.dom.value,d,f=g.ctrlKey;if(g.getKey()===this.itemDelimiterKey){g.stopEvent();if(j!==""){if(f||!this.isExpanded()){this.view.clearSelections();this.collapse();this.setRawValue("");this.fireEvent("newitem",this,j)}else{this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)}}}else{if(!this.isExpanded()){return}this.onViewClick();if(this.unsetDelayCheck){this.delayedCheck=true;this.unsetDelayCheck.defer(10,this)}}return true}if(j!==""){this.autoSize();return}if(g.getKey()===g.HOME){g.stopEvent();if(this.items.getCount()>0){this.collapse();d=this.items.get(0);d.el.focus()}return true}if(g.getKey()===g.BACKSPACE){g.stopEvent();if(this.currentFocus){b=this.currentFocus;this.on("expand",function(){this.collapse()},this,{single:true});a=this.items.indexOfKey(b.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){k=this.items.itemAt(a+1)}b.preDestroy(true);if(k){(function(){k.onLnkFocus();this.currentFocus=k}).defer(200,this)}return}else{d=this.items.get(this.items.getCount()-1);if(d){if(this.backspaceDeletesLastItem){this.on("expand",function(){this.collapse()},this,{single:true});d.preDestroy(true)}else{if(this.navigateItemsWithTab){d.onElClick()}else{this.on("expand",function(){this.collapse();this.currentFocus=d;this.currentFocus.onLnkFocus.defer(20,this.currentFocus)},this,{single:true})}}}return true}}if(!g.isNavKeyPress()){this.multiSelectMode=false;this.clearCurrentFocus();return}if(g.getKey()===g.LEFT||(g.getKey()===g.UP&&!this.isExpanded())){g.stopEvent();this.collapse();d=this.items.get(this.items.getCount()-1);if(this.navigateItemsWithTab){if(d){d.focus()}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a!==0){this.currentFocus=this.items.itemAt(a-1);this.currentFocus.onLnkFocus()}}else{this.currentFocus=d;if(d){d.onLnkFocus()}}}return true}if(g.getKey()===g.DOWN){if(this.currentFocus){this.collapse();g.stopEvent();a=this.items.indexOfKey(this.currentFocus.key);if(a==(this.items.getCount()-1)){this.clearCurrentFocus.defer(10,this)}else{this.clearCurrentFocus();this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}return true}}if(g.getKey()===g.RIGHT){this.collapse();d=this.items.itemAt(0);if(this.navigateItemsWithTab){if(d){d.focus()}}else{if(this.currentFocus){a=this.items.indexOfKey(this.currentFocus.key);this.clearCurrentFocus();if(a<(this.items.getCount()-1)){this.currentFocus=this.items.itemAt(a+1);if(this.currentFocus){this.currentFocus.onLnkFocus()}}}else{this.currentFocus=d;if(d){d.onLnkFocus()}}}}},onKeyUpBuffered:function(a){if(!a.isNavKeyPress()){this.autoSize()}},reset:function(){this.killItems();Ext.ux.form.SuperBoxSelect.superclass.reset.call(this);this.addedRecords=[];this.autoSize().setRawValue("")},applyEmptyText:function(){this.setRawValue("");if(this.items.getCount()>0){this.el.removeClass(this.emptyClass);this.setRawValue("");return this}if(this.rendered&&this.emptyText&&this.getRawValue().length<1){this.setRawValue(this.emptyText);this.el.addClass(this.emptyClass)}return this},removeAllItems:function(){this.items.each(function(a){a.preDestroy(true)},this);this.manageClearBtn();return this},killItems:function(){this.items.each(function(a){a.kill()},this);this.resetStore();this.items.clear();this.manageClearBtn();return this},resetStore:function(){this.store.clearFilter();if(!this.removeValuesFromStore){return this}this.usedRecords.each(function(a){this.store.add(a)},this);this.usedRecords.clear();if(!this.store.remoteSort){this.store.sort(this.displayField,"ASC")}return this},sortStore:function(){var a=this.store.getSortState();if(a&&a.field){this.store.sort(a.field,a.direction)}return this},getCaption:function(c){if(typeof this.displayFieldTpl==="string"){this.displayFieldTpl=new Ext.XTemplate(this.displayFieldTpl)}var b,a=c instanceof Ext.data.Record?c.data:c;if(this.displayFieldTpl){b=this.displayFieldTpl.apply(a)}else{if(this.displayField){b=a[this.displayField]}}return b},addRecord:function(b){var e=b.data[this.displayField],c=this.getCaption(b),f=b.data[this.valueField],a=this.classField?b.data[this.classField]:"",d=this.styleField?b.data[this.styleField]:"";if(this.removeValuesFromStore){this.usedRecords.add(f,b);this.store.remove(b)}this.addItemBox(f,e,c,a,d);this.fireEvent("additem",this,f,b)},createRecord:function(a){if(!this.recordConstructor){var b=[{name:this.valueField},{name:this.displayField}];if(this.classField){b.push({name:this.classField})}if(this.styleField){b.push({name:this.styleField})}this.recordConstructor=Ext.data.Record.create(b)}return new this.recordConstructor(a)},addItems:function(a){if(Ext.isArray(a)){Ext.each(a,function(b){this.addItem(b)},this)}else{this.addItem(a)}},addNewItem:function(a){this.addItem(a,true)},addItem:function(a,c){var e=a[this.valueField];if(this.disabled){return false}if(this.preventDuplicates&&this.hasValue(e)){return}var b=this.findRecord(this.valueField,e);if(b){this.addRecord(b);return}else{if(!this.allowAddNewData){return}}if(this.mode==="remote"){this.remoteLookup.push(a);this.doQuery(e,false,false,c);return}var d=this.createRecord(a);this.store.add(d);this.addRecord(d);return true},addItemBox:function(c,e,k,j,d){var f,g=function(n){var l="";switch(typeof n){case"function":l=n.call();break;case"object":for(var o in n){l+=o+":"+n[o]+";"}break;case"string":l=n+";"}return l},a=Ext.id(null,"sbx-item"),b=new Ext.ux.form.SuperBoxSelectItem({owner:this,disabled:this.disabled,renderTo:this.wrapEl,cls:this.extraItemCls+" "+j,style:g(this.extraItemStyle)+" "+d,caption:k,display:e,value:c,key:a,listeners:{remove:function(l){if(this.fireEvent("beforeremoveitem",this,l.value)===false){return false}this.items.removeKey(l.key);if(this.removeValuesFromStore){if(this.usedRecords.containsKey(l.value)){this.store.add(this.usedRecords.get(l.value));this.usedRecords.removeKey(l.value);this.sortStore();if(this.view){this.view.render()}}}if(!this.preventMultipleRemoveEvents){this.fireEvent.defer(250,this,["removeitem",this,l.value,this.findInStore(l.value)])}},destroy:function(){this.collapse();this.autoSize().manageClearBtn().validateValue()},scope:this}});b.render();f={tag:"input",type:"hidden",value:c,name:(this.hiddenName||this.name)};if(this.disabled){Ext.apply(f,{disabled:"disabled"})}b.hidden=this.el.insertSibling(f,"before");this.items.add(a,b);this.applyEmptyText().autoSize().manageClearBtn().validateValue()},manageClearBtn:function(){if(!this.renderFieldBtns||!this.rendered){return this}var a="x-superboxselect-btn-hide";if(this.items.getCount()===0){this.buttonClear.addClass(a)}else{this.buttonClear.removeClass(a)}return this},findInStore:function(b){var a=this.store.find(this.valueField,b);if(a>-1){return this.store.getAt(a)}return false},getSelectedRecords:function(){var a=[];if(this.removeValuesFromStore){a=this.usedRecords.getRange()}else{var b=[];this.items.each(function(c){b.push(c.value)});Ext.each(b,function(c){a.push(this.findInStore(c))},this)}return a},findSelectedItem:function(b){var a;this.items.each(function(c){if(c.el.dom===b){a=c;return false}});return a},findSelectedRecord:function(b){var a,c=this.findSelectedItem(b);if(c){a=this.findSelectedRecordByValue(c.value)}return a},findSelectedRecordByValue:function(b){var a;if(this.removeValuesFromStore){this.usedRecords.each(function(c){if(c.get(this.valueField)==b){a=c;return false}},this)}else{a=this.findInStore(b)}return a},getValue:function(){var a=[];this.items.each(function(b){a.push(b.value)});return a.join(this.valueDelimiter)},getCount:function(){return this.items.getCount()},getValueEx:function(){var a=[];this.items.each(function(c){var b={};b[this.valueField]=c.value;b[this.displayField]=c.display;if(this.classField){b[this.classField]=c.cls||""}if(this.styleField){b[this.styleField]=c.style||""}a.push(b)},this);return a},initValue:function(){if(Ext.isObject(this.value)||Ext.isArray(this.value)){this.setValueEx(this.value);this.originalValue=this.getValue()}else{Ext.ux.form.SuperBoxSelect.superclass.initValue.call(this)}if(this.mode==="remote"){this.setOriginal=true}},setValue:function(c){if(!this.rendered){this.value=c;return}this.removeAllItems().resetStore();this.remoteLookup=[];if(Ext.isEmpty(c)){return}var a=c;if(!Ext.isArray(c)){c=""+c;a=c.split(this.valueDelimiter)}Ext.each(a,function(j){var g={};g[this.displayField]=j;if(this.valueField!=this.displayField){var e=j.split(":");g[this.valueField]=j;g[this.displayField]=e[1]}var f=this.findRecord(this.valueField,j)||this.createRecord(g);if(f){this.addRecord(f)}else{if(this.mode==="remote"){this.remoteLookup.push(j)}}},this);if(this.mode==="remote"){var b=this.remoteLookup.join(this.queryValuesDelimiter);this.doQuery(b,false,true)}},setValueEx:function(a){if(!this.rendered){this.value=a;return}this.removeAllItems().resetStore();if(!Ext.isArray(a)){a=[a]}this.remoteLookup=[];if(this.allowAddNewData&&this.mode==="remote"){Ext.each(a,function(c){var b=this.findRecord(this.valueField,c[this.valueField])||this.createRecord(c);this.addRecord(b)},this);return}Ext.each(a,function(b){this.addItem(b)},this)},hasValue:function(b){var a=false;this.items.each(function(c){if(c.value==b){a=true;return false}},this);return a},onSelect:function(a,b){if(this.fireEvent("beforeselect",this,a,b)!==false){var c=a.data[this.valueField];if(this.preventDuplicates&&this.hasValue(c)){return}if(this.max&&this.items.getCount()>=this.max){alert(GO.lang.multiselectComboMaxItemsReachedWarning.replace("{max}",this.max));return}this.setRawValue("");this.lastSelectionText="";if(this.fireEvent("beforeadditem",this,c)!==false){this.addRecord(a)}if(this.store.getCount()===0||!this.multiSelectMode){this.collapse()}else{this.restrictHeight()}}},onDestroy:function(){this.items.purgeListeners();this.killItems();if(this.renderFieldBtns){Ext.destroy(this.buttonClear,this.buttonExpand,this.buttonWrap)}Ext.destroy(this.inputEl,this.wrapEl,this.outerWrapEl);Ext.ux.form.SuperBoxSelect.superclass.onDestroy.call(this)},autoSize:function(){if(!this.rendered){return this}if(!this.metrics){this.metrics=Ext.util.TextMetrics.createInstance(this.el)}var c=this.el,b=c.dom.value,e=document.createElement("div");if(b===""&&this.emptyText&&this.items.getCount()<1){b=this.emptyText}e.appendChild(document.createTextNode(b));b=e.innerHTML;e=null;b+="&#160;";var a=Math.max(this.metrics.getWidth(b)+24,24);if(typeof this._width!="undefined"){a=Math.min(this._width,a)}this.el.setWidth(a);if(Ext.isIE){this.el.dom.style.top="0"}this.fireEvent("autosize",this,a);return this},doQuery:function(e,d,a,c){e=Ext.isEmpty(e)?"":e;var b={query:e,forceAll:d,combo:this,cancel:false};if(this.fireEvent("beforequery",b)===false||b.cancel){return false}e=b.query;d=b.forceAll;if(d===true||(e.length>=this.minChars)||a&&!Ext.isEmpty(e)){if(c||this.forceSameValueQuery||this.lastQuery!==e){this.lastQuery=e;if(this.mode=="local"){this.selectedIndex=-1;if(d){this.store.clearFilter()}else{this.store.filter(this.displayField,e)}this.onLoad()}else{this.store.baseParams[this.queryParam]=e;this.store.baseParams[this.queryValuesIndicator]=a;this.store.load({params:this.getParams(e)});if(!c){this.expand()}}}else{this.selectedIndex=-1;this.onLoad()}}}});Ext.reg("superboxselect",Ext.ux.form.SuperBoxSelect);Ext.ux.form.SuperBoxSelectItem=function(a){Ext.apply(this,a);Ext.ux.form.SuperBoxSelectItem.superclass.constructor.call(this)};Ext.ux.form.SuperBoxSelectItem=Ext.extend(Ext.ux.form.SuperBoxSelectItem,Ext.Component,{initComponent:function(){Ext.ux.form.SuperBoxSelectItem.superclass.initComponent.call(this)},onElClick:function(b){var c=this.owner;c.clearCurrentFocus().collapse();if(c.navigateItemsWithTab){this.focus()}else{c.el.dom.focus();var a=this;(function(){this.onLnkFocus();c.currentFocus=this}).defer(10,this)}},onLnkClick:function(a){if(a){a.stopEvent()}this.preDestroy();if(!this.owner.navigateItemsWithTab){this.owner.el.focus()}},onLnkFocus:function(){this.el.addClass("x-superboxselect-item-focus");this.owner.outerWrapEl.addClass("x-form-focus")},onLnkBlur:function(){this.el.removeClass("x-superboxselect-item-focus");this.owner.outerWrapEl.removeClass("x-form-focus")},enableElListeners:function(){this.el.on("click",this.onElClick,this,{stopEvent:true})},enableLnkListeners:function(){this.lnk.on({click:this.onLnkClick,focus:this.onLnkFocus,blur:this.onLnkBlur,scope:this})},enableAllListeners:function(){this.enableElListeners();this.enableLnkListeners()},disableAllListeners:function(){this.el.removeAllListeners();this.lnk.un("click",this.onLnkClick,this);this.lnk.un("focus",this.onLnkFocus,this);this.lnk.un("blur",this.onLnkBlur,this)},onRender:function(c,a){Ext.ux.form.SuperBoxSelectItem.superclass.onRender.call(this,c,a);var e=this.el;if(e){e.remove()}this.el=e=c.createChild({tag:"li"},c.last());e.addClass("x-superboxselect-item");var d=this.owner.navigateItemsWithTab?(Ext.isSafari?"button":"a"):"span";var f=this.key;Ext.apply(e,{focus:function(){var g=this.down(d+".x-superboxselect-item-close");if(g){g.focus()}},preDestroy:function(){this.preDestroy()}.createDelegate(this)});this.enableElListeners();e.update(this.caption);var b={tag:d,"class":"x-superboxselect-item-close",tabIndex:this.owner.navigateItemsWithTab?"0":"-1"};if(d==="a"){b.href="#"}this.lnk=e.createChild(b);if(!this.disabled){this.enableLnkListeners()}else{this.disableAllListeners()}this.on({disable:this.disableAllListeners,enable:this.enableAllListeners,scope:this});this.setupKeyMap()},setupKeyMap:function(){this.keyMap=new Ext.KeyMap(this.lnk,[{key:[Ext.EventObject.BACKSPACE,Ext.EventObject.DELETE,Ext.EventObject.SPACE],fn:this.preDestroy,scope:this},{key:[Ext.EventObject.RIGHT,Ext.EventObject.DOWN],fn:function(){this.moveFocus("right")},scope:this},{key:[Ext.EventObject.LEFT,Ext.EventObject.UP],fn:function(){this.moveFocus("left")},scope:this},{key:[Ext.EventObject.HOME],fn:function(){var a=this.owner.items.get(0).el.focus();if(a){a.el.focus()}},scope:this},{key:[Ext.EventObject.END],fn:function(){this.owner.el.focus()},scope:this},{key:Ext.EventObject.ENTER,fn:function(){}}]);this.keyMap.stopEvent=true},moveFocus:function(a){var b=this.el[a=="left"?"prev":"next"]()||this.owner.el;b.focus.defer(100,b)},preDestroy:function(a){if(this.fireEvent("remove",this)===false){return}var b=function(){if(this.owner.navigateItemsWithTab){this.moveFocus("right")}this.hidden.remove();this.hidden=null;this.destroy()};if(a){b.call(this)}else{this.el.hide({duration:0.2,callback:b,scope:this})}return this},kill:function(){this.hidden.remove();this.hidden=null;this.purgeListeners();this.destroy()},onDisable:function(){if(this.hidden){this.hidden.dom.setAttribute("disabled","disabled")}this.keyMap.disable();Ext.ux.form.SuperBoxSelectItem.superclass.onDisable.call(this)},onEnable:function(){if(this.hidden){this.hidden.dom.removeAttribute("disabled")}this.keyMap.enable();Ext.ux.form.SuperBoxSelectItem.superclass.onEnable.call(this)},onDestroy:function(){Ext.destroy(this.lnk,this.el);Ext.ux.form.SuperBoxSelectItem.superclass.onDestroy.call(this)}});GO.form.SelectPriority=function(a){Ext.apply(this,a);GO.form.SelectPriority.superclass.constructor.call(this,{hiddenName:"priority",fieldLabel:GO.lang.priority,store:new Ext.data.SimpleStore({fields:["value","text"],data:[[0,GO.lang.priority_low],[1,GO.lang.priority_normal],[2,GO.lang.priority_high]]}),value:1,valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true})};Ext.extend(GO.form.SelectPriority,GO.form.ComboBox);Ext.ns("Ext.ux.form");Ext.ux.form.XCheckbox=Ext.extend(Ext.form.Checkbox,{submitOffValue:"0",submitOnValue:"1",onRender:function(a){this.inputValue=this.submitOnValue;Ext.ux.form.XCheckbox.superclass.onRender.apply(this,arguments);this.hiddenField=this.wrap.insertFirst({tag:"input",type:"hidden"});this.updateHidden()},setValue:function(a){Ext.ux.form.XCheckbox.superclass.setValue.apply(this,arguments);this.updateHidden()},updateHidden:function(){if(this.hiddenField){this.hiddenField.dom.value=this.checked?this.submitOnValue:this.submitOffValue;this.hiddenField.dom.name=this.checked?"":this.el.dom.name}}});Ext.reg("xcheckbox",Ext.ux.form.XCheckbox);GO.form.HtmlComponent=Ext.extend(Ext.BoxComponent,{onRender:function(b,a){this.el=b.createChild({tag:"div",html:this.html,cls:this.cls,style:this.style})}});Ext.reg("htmlcomponent",GO.form.HtmlComponent);GO.form.NumberField=Ext.extend(Ext.form.TextField,{decimals:2,initComponent:function(){GO.form.NumberField.superclass.initComponent.call(this);this.style="text-align:right";this.on("focus",function(a){this.fixPrecision();a.focus(true)})},beforeBlur:function(){this.fixPrecision()},fixPrecision:function(){var a=GO.util.unlocalizeNumber(this.getValue());this.setValue(GO.util.numberFormat(a,this.decimals))}});Ext.reg("numberfield",GO.form.NumberField);GO.grid.PermissionsPanel=Ext.extend(Ext.Panel,{fieldName:"acl_id",changed:false,loaded:false,managePermission:false,initComponent:function(){if(!this.title){this.title=GO.lang.strPermissions}this.showLevel=(this.hideLevel)?false:true;var d={store:new Ext.data.SimpleStore({id:0,fields:["value","text"],data:[[1,GO.lang.permissionRead],[2,GO.lang.permissionWrite],[3,GO.lang.permissionDelete],[4,GO.lang.permissionManage]]}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true};var g=new GO.form.ComboBox(d);var b=new GO.form.ComboBox(d);this.header=false;this.layout="anchor";this.border=false;this.anchor="100% 100%";this.disabled=true;this.aclGroupsStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"groups_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name","level"],remoteSort:true});this.aclGroupsStore.setDefaultSort("name","ASC");var a=function(j){var k=d.store.getById(j);return k.get("text")};var c=[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true}];if(this.showLevel){c.push({header:GO.lang.permissionsLevel,dataIndex:"level",menuDisabled:true,editor:g,renderer:a})}var e=new Ext.ux.grid.RowActions({header:"-",autoWidth:true,align:"center",actions:[{iconCls:"btn-users",qtip:GO.lang.users}]});c.push(e);this.aclGroupsStore.on("load",function(){this.managePermission=this.aclGroupsStore.reader.jsonData.manage_permission;this.aclGroupsGrid.getTopToolbar().setDisabled(!this.managePermission);this.aclUsersGrid.getTopToolbar().setDisabled(!this.managePermission)},this);this.aclGroupsGrid=new GO.grid.EditorGridPanel({plugins:e,clicksToEdit:1,anchor:"100% 50%",title:GO.lang.strAuthorizedGroups,store:this.aclGroupsStore,border:false,columns:c,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddGroupsDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclGroupsGrid.deleteSelected()},scope:this}]});e.on({scope:this,action:function(l,j,n,o,k){this.aclGroupsGrid.getSelectionModel().selectRow(o);switch(n){case"btn-users":this.showUsersInGroupDialog(j.data.id);break}}},this);this.aclGroupsGrid.on("beforeedit",function(j){return this.managePermission},this);this.aclGroupsGrid.on("afteredit",function(j){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"update_level",acl_id:this.store.baseParams.acl_id,group_id:j.record.get("id"),level:j.record.get("level")},success:function(k,l){var n=Ext.decode(k.responseText);if(!n.success){alert(n.feedback);this.store.rejectChanges()}else{this.store.commitChanges()}},scope:this})},this.aclGroupsGrid);this.aclUsersStore=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"users_in_acl",acl_id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name","level"],remoteSort:true});this.aclUsersStore.setDefaultSort("name","ASC");var f=[{header:GO.lang.strName,dataIndex:"name",menuDisabled:true}];if(this.showLevel){f.push({header:GO.lang.permissionsLevel,dataIndex:"level",menuDisabled:true,editor:b,renderer:a})}this.aclUsersGrid=new GO.grid.EditorGridPanel({anchor:"100% 50%",title:GO.lang.strAuthorizedUsers,store:this.aclUsersStore,border:false,columns:f,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({}),layout:"fit",tbar:[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.showAddUsersDialog()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.aclUsersGrid.deleteSelected()},scope:this}]});this.aclUsersGrid.on("beforeedit",function(j){return this.managePermission},this);this.aclUsersGrid.on("afteredit",function(j){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"update_level",acl_id:this.store.baseParams.acl_id,user_id:j.record.get("id"),level:j.record.get("level")},success:function(k,l){var n=Ext.decode(k.responseText);if(!n.success){alert(n.feedback);this.store.rejectChanges()}else{this.store.commitChanges()}},scope:this})},this.aclUsersGrid);this.items=[this.aclGroupsGrid,this.aclUsersGrid];GO.grid.PermissionsPanel.superclass.initComponent.call(this)},setAcl:function(a){this.acl_id=a?a:0;this.loaded=false;this.aclGroupsStore.baseParams.acl_id=a;this.aclUsersStore.baseParams.acl_id=a;this.setDisabled(GO.util.empty(a));if(this.isVisible()){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true}},onShow:function(){GO.grid.PermissionsPanel.superclass.onShow.call(this);if(!this.loaded){this.loadAcl()}},loadAcl:function(){this.aclGroupsStore.load();this.aclUsersStore.load();this.loaded=true},afterRender:function(){GO.grid.PermissionsPanel.superclass.afterRender.call(this);var a=this.isVisible();if(a&&!this.loaded){this.loadAcl()}},showUsersInGroupDialog:function(a){if(!this.usersInGroupDialog){this.usersInGroupDialog=new GO.dialog.UsersInGroup()}this.usersInGroupDialog.setGroupId(a);this.usersInGroupDialog.show()},showAddGroupsDialog:function(){if(!this.addGroupsDialog){this.addGroupsDialog=new GO.dialog.SelectGroups({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclGroupsStore.baseParams.add_groups=Ext.encode(a.selModel.selections.keys);this.aclGroupsStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclGroupsStore.baseParams.add_groups}},scope:this})}this.addGroupsDialog.show()},showAddUsersDialog:function(){if(!this.addUsersDialog){this.addUsersDialog=new GO.dialog.SelectUsers({handler:function(a){if(a.selModel.selections.keys.length>0){this.aclUsersStore.baseParams.add_users=Ext.encode(a.selModel.selections.keys);this.aclUsersStore.load({callback:function(){if(!this.reader.jsonData.addSuccess){alert(this.reader.jsonData.addFeedback)}}});delete this.aclUsersStore.baseParams.add_users}},scope:this})}this.addUsersDialog.show()}});GO.NewMenuButton=Ext.extend(Ext.Button,{panel:false,initComponent:function(){this.menu=new Ext.menu.Menu({items:GO.newMenuItems,panel:this.panel});this.text=GO.lang.cmdNew;this.iconCls="btn-add";this.disabled=true;this.hidden=GO.newMenuItems.length==0;GO.NewMenuButton.superclass.initComponent.call(this)},setLinkConfig:function(a){this.menu.link_config=a;this.menu.link_config.type_id=a.type+":"+a.id;if(!this.menu.link_config.scope){this.menu.link_config.scope=this}if(this.menu.link_config.callback){this.menu.link_config.callback=this.menu.link_config.callback.createDelegate(this.menu.link_config.scope)}this.setDisabled(GO.util.empty(a.id))}});GO.NewMenuItem=Ext.extend(Ext.menu.Item,{initComponent:function(){this.menu=new Ext.menu.Menu({items:GO.newMenuItems});this.text=GO.lang.cmdNew;this.iconCls="btn-add";this.disabled=true;this.hidden=GO.newMenuItems.length==0;GO.NewMenuButton.superclass.initComponent.call(this)},setLinkConfig:function(a){this.menu.link_config=a;this.menu.link_config.type_id=a.type+":"+a.id;if(!this.menu.link_config.scope){this.menu.link_config.scope=this}if(this.menu.link_config.callback){this.menu.link_config.callback=this.menu.link_config.callback.createDelegate(this.menu.link_config.scope)}this.setDisabled(GO.util.empty(a.id))}});GO.moduleManager.on("languageLoaded",function(){GO.newMenuItems.push({text:GO.lang.link,iconCls:"has-links",handler:function(a,b){if(!this.linksDialog){this.linksDialog=new GO.dialog.LinksDialog();this.linksDialog.on("link",function(){if(a.parentMenu.panel){a.parentMenu.panel.reload()}})}this.linksDialog.setSingleLink(a.parentMenu.link_config.id,a.parentMenu.link_config.type);this.linksDialog.show()}})});GO.LinkFolderWindow=function(a){if(!a){a={}}var b=function(){this.newFolderNameField.focus(true)};this.newFolderNameField=new Ext.form.TextField({fieldLabel:GO.lang.strName,name:"name",value:GO.lang.newFolder,allowBlank:false,anchor:"100%"});this.formPanel=new Ext.form.FormPanel({defaultType:"textfield",labelWidth:75,cls:"go-form-panel",waitMsgTarget:true,items:this.newFolderNameField,autoHeight:true,baseParams:{task:"link_folder",folder_id:0}});a.layout="fit";a.modal=false;a.resizable=false;a.width=400;a.autHeight=true;a.closeAction="hide";a.title=GO.lang.newFolder;a.items=this.formPanel;a.focus=b.createDelegate(this);a.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.LinkFolderWindow.superclass.constructor.call(this,a);this.addEvents({save:true})};Ext.extend(GO.LinkFolderWindow,Ext.Window,{show:function(a){if(!this.rendered){this.render(Ext.getBody())}if(!a.folder_id){a.folder_id=0}this.link_id=a.link_id?a.link_id:0;this.link_type=a.link_type?a.link_type:0;this.parent_id=a.parent_id?a.parent_id:0;this.setLinkFolderId(a.folder_id);if(this.folder_id>0){this.formPanel.load({url:BaseHref+"json.php",success:function(b,c){this.setLinkFolderId(c.result.data.id);this.link_id=c.result.data.link_id;this.link_type=c.result.data.link_type;this.parent_id=c.result.data.parent_id;GO.LinkFolderWindow.superclass.show.call(this)},failure:function(b,c){Ext.Msg.alert(GO.lang.strError,c.result.feedback)},scope:this})}else{this.formPanel.form.reset();GO.LinkFolderWindow.superclass.show.call(this)}},setLinkFolderId:function(a){if(!a){a=0}this.formPanel.form.baseParams.folder_id=a;this.folder_id=a},submitForm:function(a){this.formPanel.form.submit({url:BaseHref+"action.php",params:{task:"save_link_folder",link_id:this.link_id,link_type:this.link_type,parent_id:this.parent_id},waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.fireEvent("save",this);if(a){this.hide()}else{if(c.result.folder_id){this.setLinkFolderId(c.result.folder_id)}}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})}});GO.form.SelectLink=function(a){a=a||{};a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{query:"",task:"links"},root:"results",totalProperty:"total",fields:["link_id","link_type","link_and_type","type_name"],remoteSort:true});a.forceSelection=true;a.displayField="type_name";a.valueField="link_and_type",a.hiddenName="link";a.triggerAction="all";a.width=400;a.selectOnFocus=false;a.fieldLabel=GO.lang.cmdLink;a.pageSize=20;GO.form.SelectLink.superclass.constructor.call(this,a)};Ext.extend(GO.form.SelectLink,GO.form.ComboBoxReset,{onTriggerClick:function(){if(!GO.selectLinkDialog){GO.selectLinkDialog=new GO.dialog.LinksDialog({singleSelect:true,selectLinkField:this,linkItems:function(){var a=this.grid.searchGrid.getSelectionModel();var b=a.getSelected();this.selectLinkField.setValue(b.get("link_and_type"));this.selectLinkField.setRemoteText(b.get("type_name"));this.hide()}})}GO.selectLinkDialog.show()}});GO.LinksTree=function(a){if(!a){a={}}a.layout="fit";a.split=true;a.autoScroll=true;a.animate=true;a.loader=new Ext.tree.TreeLoader({dataUrl:BaseHref+"json.php",baseParams:{task:"link_folders_tree",link_type:0,link_id:0},preloadChildren:true});a.collapsed=a.treeCollapsed;a.containerScroll=true;a.rootVisible=true;a.collapsible=true;a.header=false;a.collapseMode="mini";a.ddAppendOnly=true;a.containerScroll=true;a.ddGroup="LinksDD";a.enableDD=true;GO.LinksTree.superclass.constructor.call(this,a);this.rootNode=new Ext.tree.AsyncTreeNode({text:GO.lang.root,draggable:false,iconCls:"folder-default",expanded:false});this.setRootNode(this.rootNode)};Ext.extend(GO.LinksTree,Ext.tree.TreePanel,{loadLinks:function(c,d,a,b){this.loader.baseParams.link_id=c;this.loader.baseParams.link_type=d;if(a){if(b){a=a.createDelegate(b)}}else{a=function(){}}if(this.rootNode.isExpanded()){this.rootNode.reload(a)}else{this.rootNode.expand(false,true,a)}}});GO.grid.LinksGrid=function(a){if(!a){a={}}if(!a.link_id){a.link_id=0}if(!a.link_type){a.link_type=0}if(!a.folder_id){a.folder_id=0}a.hideMode="offsets";a.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id,type_filter:"true",no_filter_save:a.noFilterSave},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls","link_description"],remoteSort:true});a.store.setDefaultSort("mtime","desc");if(!a.noSearchField){this.searchField=new GO.form.SearchField({store:a.store,width:240});a.tbar=[GO.lang.strSearch+": "," ",this.searchField]}a.clicksToEdit=1;a.enableDragDrop=true;a.ddGroup="LinksDD";a.columns=[{header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(c,d,b){return'<div class="go-grid-icon '+b.data.iconCls+'">'+c+"</div>"}},{header:GO.lang.strDescription,dataIndex:"link_description",sortable:true,editor:new GO.form.LinkDescriptionField()},{header:GO.lang.strType,dataIndex:"type",sortable:true,hidden:true},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:80}];a.paging=20;a.bbar=new Ext.PagingToolbar({cls:"go-paging-tb",store:a.store,pageSize:20,displayInfo:true,displayMsg:GO.lang.displayingItemsShort,emptyMsg:GO.lang.strNoItems});a.layout="fit";a.view=new Ext.grid.GridView({enableRowBody:true,showPreview:true,autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems,getRowClass:function(b,e,d,c){if(this.showPreview&&b.data.description.length){d.body='<div class="go-links-panel-description">'+b.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}});a.loadMask={msg:GO.lang.waitMsgLoad};a.sm=new Ext.grid.RowSelectionModel({});GO.grid.LinksGrid.superclass.constructor.call(this,a);this.addEvents({folderOpened:true,folderDrop:true})};Ext.extend(GO.grid.LinksGrid,GO.grid.EditorGridPanel,{write_permission:false,afterRender:function(){GO.grid.LinksGrid.superclass.afterRender.call(this);var a=new Ext.dd.DropTarget(this.getView().mainBody,{ddGroup:"LinksDD",copy:false,notifyOver:this.onGridNotifyOver,notifyDrop:this.onGridNotifyDrop.createDelegate(this)});this.on("afteredit",function(b){Ext.Ajax.request({url:GO.settings.config.host+"action.php",params:{task:"updatelink",link_id1:this.store.baseParams.link_id,link_type1:this.store.baseParams.link_type,link_id2:b.record.get("id"),link_type2:b.record.get("link_type"),description:b.record.get("link_description")},success:function(c,d){var e=Ext.decode(c.responseText);if(!e.success){alert(e.feedback)}else{this.store.commitChanges()}},scope:this})},this)},onGridNotifyOver:function(a,f,c){var d=a.getDragData(f);if(c.grid&&this.write_permission){var b=c.grid.store.data.items[d.rowIndex];if(b){if(b.data.link_type=="folder"){return this.dropAllowed}}}return false},onGridNotifyDrop:function(a,g,d){if(d.grid&&this.write_permission){var j=d.grid.getSelectionModel();var c=j.getSelections();var f=a.getDragData(g);var b=d.grid.store.data.items[f.rowIndex];if(b.data.link_type=="folder"){this.fireEvent("folderDrop",this,d.selections,b)}}else{return false}},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.dialog.LinksDialog=function(a){a=a||{};Ext.apply(this,a);this.grid=new GO.grid.SearchPanel({noTitle:true,noOpenLinks:true,dontLoadOnRender:true,singleSelect:a.singleSelect});this.grid.searchGrid.on("rowdblclick",this.linkItems,this);var b=function(){this.grid.searchField.focus(true)};GO.dialog.LinksDialog.superclass.constructor.call(this,{layout:"fit",focus:b.createDelegate(this),modal:false,minWidth:300,minHeight:300,height:500,width:700,border:false,plain:true,closeAction:"hide",title:GO.lang.strLinkItems,items:this.grid,listeners:{show:function(){this.grid.load()},scope:this},buttons:[{text:GO.lang.cmdOk,handler:function(){this.linkItems()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this.addEvents({link:true})};Ext.extend(GO.dialog.LinksDialog,Ext.Window,{folder_id:0,setLinkRecords:function(b){this.fromLinks=[];for(var a=0;a<b.length;a++){this.fromLinks.push({link_id:b[a].data.link_id,link_type:b[a].data.link_type})}},setSingleLink:function(a,b){this.fromLinks=[{link_id:a,link_type:b}]},selectFolder:function(a){},linkItems:function(){var a=this.grid.searchGrid.getSelectionModel();var b=a.getSelections();this.tolinks=[];for(var c=0;c<b.length;c++){this.tolinks.push({link_id:b[c].data.id,link_type:b[c].data.link_type})}if(this.tolinks.length==1){if(!this.selectFolderWindow){this.selectFolderTree=new GO.LinksTree();this.selectFolderTree.on("dblclick",function(e){var d=parseInt(e.id.replace("lt-folder-",""));this.sendLinkRequest(this.tolinks,d);this.selectFolderWindow.hide()},this);this.selectFolderWindow=new GO.Window({layout:"fit",title:GO.lang.selectFolder,items:this.selectFolderTree,closeAction:"hide",width:400,height:400,modal:true,closable:true,buttons:[{text:GO.lang.cmdOk,handler:function(){var e=this.selectFolderTree.getSelectionModel().getSelectedNode();if(!e){alert(GO.lang.selectFolder)}var d=parseInt(e.id.replace("lt-folder-",""));this.sendLinkRequest(this.tolinks,d);this.selectFolderWindow.hide()},scope:this}]})}this.selectFolderWindow.show();this.selectFolderTree.loadLinks(this.tolinks[0]["link_id"],this.tolinks[0]["link_type"],function(d){if(!d.childNodes.length){this.selectFolderWindow.hide();this.sendLinkRequest(this.tolinks)}},this)}else{this.sendLinkRequest(this.tolinks)}},sendLinkRequest:function(b,a){var a=a||0;Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"link",fromLinks:Ext.encode(this.fromLinks),toLinks:Ext.encode(b),description:this.grid.linkDescriptionField.getValue(),folder_id:this.folder_id,to_folder_id:a},callback:function(d,e,c){if(!e){Ext.MessageBox.alert(GO.lang.strError,c.result.errors)}else{this.fireEvent("link");this.grid.searchGrid.getSelectionModel().clearSelections();this.hide()}},scope:this})}});GO.grid.LinksPanel=function(a){if(!a){a={}}if(!this.link_id){this.link_id=0}if(!this.link_type){this.link_type=0}if(!this.folder_id){this.folder_id=0}if(!a.id){a.id="go-links-panel"}this.linksDialog=new GO.dialog.LinksDialog({linksStore:a.store});this.linksDialog.on("link",function(){this.linksGrid.store.reload()},this);this.linksTree=new GO.LinksTree({id:a.id+"_tree",region:"center",split:true});this.linksTree.on("click",function(b){this.setFolder(b.id.substr(10))},this);this.linksTree.on("contextmenu",function(d,g){g.stopEvent();var c=this.linksTree.getSelectionModel();if(!c.isSelected(d)){c.clearSelections();c.select(d)}var b=d.id.substr(10);if(b!=""){var f=g.getXY();this.linksContextMenu.showAt([f[0],f[1]],["folder:"+b],"folder")}},this);this.linksTree.on("beforenodedrop",function(j){if(!this.write_permission){return false}var g={folder_id:j.target.id.substr(10),link_id:this.link_id,link_type:this.link_type};var c=[];if(j.data.selections){for(var b=0;b<j.data.selections.length;b++){if(j.data.selections[b].data.link_and_type.substr(0,6)=="folder"){var k=j.data.selections[b].data.link_and_type.substr(7);var d=this.linksTree.getNodeById("lt-folder-"+k);var f=this.linksTree.getNodeById("lt-folder-"+g.folder_id);f.appendChild(d)}c.push(j.data.selections[b].data.link_and_type)}}else{c=["folder:"+j.data.node.id.substr(10)]}this.moveSelections(c,g)},this);this.linksGrid=new GO.grid.LinksGrid({region:"center",id:a.id+"_grid",noFilterSave:a.noFilterSave,deleteConfig:{scope:this,success:this.onDelete}});this.linksGrid.store.on("load",function(){var c=this.linksTree.getSelectionModel();var b=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b){c.select(b)}else{c.select(this.linksTree.getRootNode())}},this);this.linksGrid.on("folderDrop",function(d,e,b){var g={folder_id:b.data.id,link_id:this.link_id,link_type:this.link_type};var f=[];for(var c=0;c<e.length;c++){f.push(e[c].data.link_and_type)}this.moveSelections(f,g)},this);this.linksGrid.on("rowcontextmenu",function(b,g,d){d.stopEvent();var f=b.getSelectionModel();if(f.isSelected(g)!==true){f.clearSelections();f.selectRow(g)}var c=d.getXY();this.linksContextMenu.showAt([c[0],c[1]],f.selections.keys)},this);this.linksGrid.store.on("load",function(){this.setWritePermission(this.linksGrid.store.reader.jsonData.write_permission)},this);this.folderWindow=new GO.LinkFolderWindow();this.folderWindow.on("save",function(b){this.linksGrid.store.reload();var c=this.linksTree.getNodeById("lt-folder-"+this.folder_id);if(b.folder_id==this.folder_id&&c){c=c.parentNode}if(c){delete c.attributes.children;c.reload()}else{this.linksTree.rootNode.reload()}},this);this.linkPreviewPanels[0]=new Ext.Panel({bodyStyle:"padding:5px"});this.previewPanel=new Ext.Panel({id:a.id+"_preview",region:"east",width:420,split:true,layout:"card",items:[this.linkPreviewPanels[0]]});this.linkTypeFilter=new GO.LinkTypeFilterPanel({region:"south",height:300,store:new GO.data.JsonStore({root:"results",data:{results:GO.linkTypes},fields:["id","name","checked"],id:"id"})});this.linkTypeFilter.on("change",function(c,b){this.linksGrid.store.baseParams.types=Ext.encode(b);this.linksGrid.store.load()},this);a.items=[{region:"west",width:160,layout:"border",id:a.id+"_west",items:[this.linksTree,this.linkTypeFilter]},this.linksGrid,this.previewPanel];this.linksContextMenu=new GO.LinksContextMenu();this.linksContextMenu.on("properties",function(e,c){var d=c[0].indexOf(":");var b=c[0].substr(d+1);this.folderWindow.show({folder_id:b})},this);this.linksContextMenu.on("delete",function(d,b){if(b.indexOf("folder:"+this.folder_id)>-1){this.setFolder(0,true)}var c={store:this.linksGrid.store,params:{delete_keys:Ext.encode(b)},count:b.length,callback:this.onDelete,scope:this};GO.deleteItems(c)},this);this.linksContextMenu.on("unlink",function(c,b){this.unlinkSelected()},this);a.layout="border";a.border=false;a.hideMode="offsets";a.tbar=[this.linkButton=new Ext.Button({iconCls:"btn-link",text:GO.lang.cmdLink,cls:"x-btn-text-icon",handler:function(){this.linksDialog.show()},scope:this}),this.newFolderButton=new Ext.Button({iconCls:"btn-add",text:GO.lang.newFolder,cls:"x-btn-text-icon",handler:function(){this.folderWindow.show({link_id:this.link_id,link_type:this.link_type,parent_id:this.folder_id})},scope:this}),this.unlinkButton=new Ext.Button({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.unlinkSelected()},scope:this}),"-",{iconCls:"btn-refresh",text:GO.lang.cmdRefresh,cls:"x-btn-text-icon",handler:function(){this.linksGrid.store.load();this.linksTree.getRootNode().reload()},scope:this}];if(GO.links&&GO.links.SettingsDialog){a.tbar.push("-");a.tbar.push({text:GO.lang.cmdSettings,scope:this,iconCls:"btn-settings",handler:function(){if(!this.settingsWindow){this.settingsWindow=new GO.links.SettingsDialog()}this.settingsWindow.show()}})}this.linksGrid.on("rowdblclick",this.rowDoulbleClicked,this);this.linksGrid.on("delayedrowselect",this.rowClicked,this);GO.grid.LinksPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.LinksPanel,Ext.Panel,{linkPreviewPanels:[],onDelete:function(j){var f=Ext.decode(j.params.delete_keys);var g,c,d;for(var e=0;e<f.length;e++){g=f[e].indexOf(":");c=f[e].substr(g+1);d=this.linksTree.getNodeById("lt-folder-"+c);if(d){d.remove()}}var b={};for(var e=0;e<f.length;e++){var a=f[e].split(":");if(!b[a[0]]){b[a[0]]=[]}b[a[0]].push(a[1])}GO.mainLayout.fireEvent("linksDeleted",j,b)},afterRender:function(){GO.grid.LinksPanel.superclass.afterRender.call(this);if(this.isVisible()){this.onShow()}},unlinkSelected:function(){var a=this.linksGrid.getSelectionModel();var b=a.getSelections();if(b.length>0){this.linksGrid.store.baseParams.unlinks=Ext.encode(a.selections.keys);this.linksGrid.store.reload();delete this.linksGrid.store.baseParams.unlinks}},moveSelections:function(a,b){Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"move_links",selections:Ext.encode(a),target:Ext.encode(b)},callback:function(e,j,d){if(!j){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var g=Ext.decode(d.responseText);if(g.moved_links){for(var f=0;f<g.moved_links.length;f++){var c=this.linksGrid.store.getById(g.moved_links[f]);if(c){this.linksGrid.store.remove(c)}}}}},scope:this})},rowDoulbleClicked:function(b,c,d){var a=b.store.getAt(c);if(a.data.link_type=="folder"){this.setFolder(a.data.id)}else{this.previewPanel.getLayout().activeItem.editHandler()}},rowClicked:function(c,d,a){this.previewPanel.getLayout().setActiveItem(0);var b="link_pp_"+a.data.link_type;if(a.data.link_type!="folder"){if(!GO.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels[0].body.update("Sorry, the preview of this type not implemented yet.")}else{if(!this.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels[a.data.link_type]=GO.linkPreviewPanels[a.data.link_type].call(this,{id:b});this.previewPanel.add(this.linkPreviewPanels[a.data.link_type])}this.previewPanel.getLayout().setActiveItem(b);this.linkPreviewPanels[a.data.link_type].load(a.data.id)}}},onShow:function(){GO.grid.LinksPanel.superclass.onShow.call(this);this.previewPanel.getLayout().setActiveItem(0);if(!this.loaded&&this.link_id>0){this.linksGrid.store.baseParams.types=Ext.encode(this.linkTypeFilter.getSelected());this.linksGrid.store.load();var a=this.linksTree.getRootNode();if(a.isExpanded()){a.reload()}else{a.expand()}this.loaded=true}},setWritePermission:function(a){this.linkButton.setDisabled(!a);this.unlinkButton.setDisabled(!a);this.newFolderButton.setDisabled(!a);this.write_permission=a;this.linksGrid.write_permission=a},setFolder:function(a,b){var c=this.linksTree.getNodeById("lt-folder-"+a);if(c){c.expand()}this.linksDialog.folder_id=a;this.folder_id=a;this.linksGrid.store.baseParams.folder_id=a;if(!b){this.linksGrid.store.baseParams.types=Ext.encode(this.linkTypeFilter.getSelected());this.linksGrid.store.load()}},loadLinks:function(b,c,a){if(b>0){this.setDisabled(false)}else{this.setDisabled(true)}if(this.link_id!=b||this.link_type!=c){this.link_id=this.linksGrid.store.baseParams.link_id=b;this.link_type=this.linksGrid.store.baseParams.link_type=c;this.linksGrid.store.baseParams.folder_id=a;this.linksTree.loadLinks(b,c);this.linksDialog.setSingleLink(this.link_id,this.link_type);this.loaded=false;this.previewPanel.items.each(function(d){if(d.reset){d.reset()}})}}});GO.linksTemplate='<tpl if="values.links && values.links.length">{[this.collapsibleSectionHeader(GO.lang.latestLinks, "latestlinks-"+values.panelId, "links")]}<table class="display-panel" cellpadding="0" cellspacing="0" border="0" id="latestlinks-{panelId}"><tr><td colspan="2" class="display-panel-links-header">&nbsp;</td><td style="width: 100%" class="table_header_links">'+GO.lang.strName+'</td><td class="table_header_links" style="white-space:nowrap">'+GO.lang.strMtime+'</td></tr><tpl if="!links.length"><tr><td colspan="4">'+GO.lang.strNoItems+'</td></tr></tpl><tpl for="links"><tr class="display-panel-link"><td style="padding-right:0px !important;"><div class="display-panel-link-icon {iconCls}" ext:qtip="{type}"></div></td><td style="padding-right:0px !important;padding-left:0px !important;"><div class="display-panel-has-links <tpl if="link_count&gt;1">has-links</tpl>"></div></td><td><a href="#link_{[xindex-1]}">{name}</a><tpl if="link_description.length"><br />{link_description}</tpl></td><td style="white-space:nowrap">{mtime}</td></tr><tpl if="description.length"><tr class="display-panel-link-description"><td colspan="2">&nbsp;</td><td colspan="3">{description}</td></tr></tpl></tpl><tr><td colspan="4"><a class="display-panel-browse" href="#browselinks">'+GO.lang.browse+"</a></td></tr></table></tpl>";GO.linksTemplateConfig={};GO.LinksContextMenu=function(a){if(!a){a={}}a.shadow="frame";a.minWidth=180;this.deleteButton=new Ext.menu.Item({iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.fireEvent("delete",this,this.selected)},scope:this});this.unlinkButton=new Ext.menu.Item({iconCls:"btn-unlink",text:GO.lang.cmdUnlink,cls:"x-btn-text-icon",handler:function(){this.fireEvent("unlink",this,this.selected)},scope:this});this.propertiesButton=new Ext.menu.Item({iconCls:"btn-properties",text:GO.lang.strProperties,handler:function(){this.fireEvent("properties",this,this.selected)},scope:this});a.items=[this.propertiesButton,this.deleteButton,this.unlinkButton];GO.LinksContextMenu.superclass.constructor.call(this,a);this.addEvents({properties:true,unlink:true,"delete":true})};Ext.extend(GO.LinksContextMenu,Ext.menu.Menu,{clickedAt:"grid",showAt:function(d,a){this.link_type=c;this.selected=a;if(this.selected.length>1){c="mixed"}else{var b=a[0].indexOf(":");var c=a[0].substr(0,b)}switch(c){case"folder":this.propertiesButton.show();this.unlinkButton.hide();break;default:this.propertiesButton.hide();this.unlinkButton.show();break}GO.LinksContextMenu.superclass.showAt.call(this,d)}});GO.LinkBrowser=function(a){Ext.apply(this,a);this.linksPanel=new GO.grid.LinksPanel({noFilterSave:"true"});if(!this.id){this.id="go-link-browser"}GO.LinkBrowser.superclass.constructor.call(this,{layout:"fit",modal:false,minWidth:300,minHeight:300,height:500,width:950,border:false,plain:true,maximizable:true,collapsible:true,closeAction:"hide",title:GO.lang.cmdBrowseLinks,items:this.linksPanel});this.addEvents({link:true})};Ext.extend(GO.LinkBrowser,GO.Window,{show:function(a){this.linksPanel.loadLinks(a.link_id,a.link_type);if(a.folder_id){this.linksPanel.setFolder(a.folder_id)}GO.LinkBrowser.superclass.show.call(this)}});GO.LinkViewWindow=function(a){if(!a){a={}}a.collapsible=true;a.maximizable=true;a.layout="fit";a.modal=false;a.resizable=true;if(!a.width){a.width=500}if(!a.height){a.height=500}GO.LinkViewWindow.superclass.constructor.call(this,a);this.render(Ext.getBody())};Ext.extend(GO.LinkViewWindow,Ext.Window);GO.LinkTypeFilterPanel=function(a){if(!a){a={}}a.split=true;a.resizable=true;a.autoScroll=true;a.collapsible=true;a.collapseMode="mini";a.allowNoSelection=true;if(!a.title){a.title=GO.lang.strType}if(!GO.linkTypesStore){GO.linkTypesStore=new Ext.data.JsonStore({root:"results",data:{results:GO.linkTypes},fields:["id","name","checked"],id:"id"})}a.store=a.store||GO.linkTypesStore;GO.LinkTypeFilterPanel.superclass.constructor.call(this,a)};Ext.extend(GO.LinkTypeFilterPanel,GO.grid.MultiSelectGrid,{});GO.form.LinkDescriptionField=Ext.extend(function(a){a=a||{};a.store=new GO.data.JsonStore({url:GO.settings.config.host+"json.php",baseParams:{task:"link_descriptions"},root:"results",id:"id",totalProperty:"total",fields:["id","description"],remoteSort:true});a.displayField="description";a.triggerAction="all";a.selectOnFocus=false;a.pageSize=parseInt(GO.settings.max_rows_list);GO.form.LinkDescriptionField.superclass.constructor.call(this,a)},GO.form.ComboBoxReset,{hiddenName:"description",maxLength:100});GO.LinksAccordion=Ext.extend(Ext.Panel,{link_id:0,link_type:0,title:GO.lang.strLinks,disabled:true,initComponent:function(){this.layout="accordion";this.items=[];if(GO.calendar){var a=new GO.grid.LinksGrid({title:GO.calendar.lang.appointments,noSearchField:true});a.store.baseParams.types=Ext.encode([1]);this.items.push(a)}if(GO.tasks){var b=new GO.grid.LinksGrid({title:GO.tasks.lang.tasks,noSearchField:true});b.store.baseParams.types=Ext.encode([12]);this.items.push(b)}if(GO.notes){var d=new GO.grid.LinksGrid({title:GO.notes.lang.notes,noSearchField:true});d.store.baseParams.types=Ext.encode([4]);this.items.push(d)}var e;for(var c=0;c<this.items.length;c++){e=this.items[c];e.store.baseParams.no_filter_save=true;e.on("expand",function(){if(!e.store.loaded){e.store.load()}},this)}this.on("show",this.loadActivePanel,this);GO.LinksAccordion.superclass.initComponent.call(this)},setLinkID:function(a,b){this.setDisabled(GO.util.empty(a));this.link_id=a;this.items.each(function(c){c.store.loaded=false;c.store.baseParams.link_id=a;c.store.baseParams.link_type=b;c.store.baseParams.type_filter=true});if(this.isVisible()){this.loadActivePanel()}},loadActivePanel:function(){var a=this.layout.activeItem;if(!a.store.loaded){a.store.load()}}});GO.grid.SearchPanel=function(a){a=a||{};if(!this.query){this.query=""}if(!a.id){a.id=Ext.id()}a.border=false;if(!a.noTitle){a.title=GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.query)+'"'}a.iconCls="go-search-icon-tab";a.layout="border";this.filterPanel=new GO.LinkTypeFilterPanel({region:"west",split:true,border:true,width:160});this.filterPanel.on("change",function(d,c){this.searchGrid.store.baseParams.types=Ext.encode(c);this.searchGrid.store.load();delete this.searchGrid.store.baseParams.types},this);this.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"links",link_id:this.link_id,link_type:this.link_type,folder_id:this.folder_id,type_filter:"true"},root:"results",totalProperty:"total",id:"link_and_type",fields:["icon","link_and_type","link_type","name","type","url","mtime","id","module","description","iconCls","type_name"],remoteSort:true});this.searchField=new GO.form.SearchField({store:this.store,width:320});var b={border:true,region:"center",tbar:[GO.lang.strSearch+": "," ",this.searchField,"-",{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.searchGrid.deleteSelected()},scope:this}],store:this.store,columns:[{id:"name",header:GO.lang.strName,dataIndex:"name",css:"white-space:normal;",sortable:true,renderer:function(d,e,c){return'<div class="go-grid-icon '+c.data.iconCls+'">'+d+"</div>"}},{header:GO.lang.strType,dataIndex:"type",sortable:true,width:100},{header:GO.lang.strMtime,dataIndex:"mtime",sortable:true,width:100}],autoExpandMax:2500,autoExpandColumn:"name",paging:20,layout:"fit",view:new Ext.grid.GridView({enableRowBody:true,showPreview:true,emptyText:GO.lang.strNoItems,applyEmptyText:function(){if(this.emptyText&&!this.hasRows()){this.emptyText=this.ds.baseParams.query==""?GO.lang.pleaseEnterASearchTerm:GO.lang.strNoItems;this.mainBody.update('<div class="x-grid-empty">'+this.emptyText+"</div>")}},getRowClass:function(c,f,e,d){if(this.showPreview&&c.data.description.length){e.body='<div class="go-links-panel-description">'+c.data.description+"</div>";return"x-grid3-row-expanded"}return"x-grid3-row-collapsed"}}),loadMask:{msg:GO.lang.waitMsgLoad},sm:new Ext.grid.RowSelectionModel({single:a.singleSelect})};this.searchGrid=new GO.grid.GridPanel(b);this.searchGrid.store.setDefaultSort("mtime","desc");if(!a.noTitle){this.searchGrid.store.on("load",function(){this.setTitle(GO.lang.strSearch+': "'+Ext.util.Format.htmlEncode(this.searchGrid.store.baseParams.query)+'"')},this)}a.items=[this.filterPanel,this.searchGrid];if(!a.noOpenLinks){this.searchGrid.on("rowdblclick",function(c,d,f){this.previewPanel.getLayout().activeItem.editHandler()},this);this.linkPreviewPanels.search_pp_0=new Ext.Panel({bodyStyle:"padding:5px"});this.previewPanel=new Ext.Panel({id:a.id+"_preview",region:"east",width:420,split:true,layout:"card",items:[this.linkPreviewPanels.search_pp_0]});a.items.push(this.previewPanel);this.searchGrid.on("delayedrowselect",this.rowClicked,this)}if(a.noOpenLinks){a.items.push({region:"south",height:34,layout:"form",cls:"go-form-panel",split:true,items:this.linkDescriptionField=new GO.form.LinkDescriptionField({name:"description",fieldLabel:GO.lang.strDescription,anchor:"100%"})})}GO.grid.SearchPanel.superclass.constructor.call(this,a)};Ext.extend(GO.grid.SearchPanel,Ext.Panel,{linkPreviewPanels:[],rowClicked:function(c,d,a){this.previewPanel.getLayout().setActiveItem(0);var b="search_pp_"+a.data.link_type;if(a.data.link_type!="folder"){if(!GO.linkPreviewPanels[a.data.link_type]){this.linkPreviewPanels.search_pp_0.body.update("Sorry, the preview of this type not implemented yet.")}else{if(!this.linkPreviewPanels[b]){this.linkPreviewPanels[b]=GO.linkPreviewPanels[a.data.link_type].call(this,{id:b});this.previewPanel.add(this.linkPreviewPanels[b])}this.previewPanel.getLayout().setActiveItem(b);this.linkPreviewPanels[b].load(a.data.id)}}},afterRender:function(){GO.grid.SearchPanel.superclass.afterRender.call(this);if(!this.dontLoadOnRender){this.load()}},load:function(){this.searchField.setValue(this.query);this.searchGrid.store.baseParams.query=this.query;this.searchGrid.store.load()},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'}});GO.CheckerWindow=function(c){if(!c){c={}}c.title=GO.lang.reminders;c.maximizable=true;c.layout="fit";c.modal=false;c.resizable=true;c.closeAction="hide";if(!c.width){c.width=600}if(!c.height){c.height=500}c.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.checkerSnoozeTimes=[[300,"5 "+GO.lang.strMinutes],[600,"10 "+GO.lang.strMinutes],[1200,"20 "+GO.lang.strMinutes],[1800,"30 "+GO.lang.strMinutes],[3600,"1 "+GO.lang.strHour],[7200,"2 "+GO.lang.strHours],[10800,"3 "+GO.lang.strHours],[14400,"4 "+GO.lang.strHours],[86400,"1 "+GO.lang.strDay],[2*86400,"2 "+GO.lang.strDays],[3*86400,"3 "+GO.lang.strDays],[4*86400,"4 "+GO.lang.strDays],[5*86400,"5 "+GO.lang.strDays],[6*86400,"6 "+GO.lang.strDays],[7*86400,"7 "+GO.lang.strDays]];var e=[];for(var d=0,a=GO.checkerSnoozeTimes.length;d<a;d++){e.push({text:GO.checkerSnoozeTimes[d][1],value:GO.checkerSnoozeTimes[d][0],handler:function(f){this.checkerGrid.doTask("snooze_reminders",f.value)},scope:this})}var b=new Ext.menu.Menu({items:e});c.tbar=[{iconCls:"btn-delete",text:GO.lang.dismiss,handler:function(){this.checkerGrid.doTask("dismiss_reminders")},scope:this},{iconCls:"btn-dismiss",text:GO.lang.snooze,menu:b},"-",{iconCls:"btn-select-all",text:GO.lang.selectAll,handler:function(){this.checkerGrid.getSelectionModel().selectAll()},scope:this}];this.checkerGrid=new GO.CheckerPanel();c.items=this.checkerGrid;c.listeners={scope:this,show:function(){GO.blinkTitle.blink(this.checkerGrid.store.getCount()+" "+GO.lang.reminders)},hide:function(){GO.blinkTitle.blink(false)}};GO.CheckerWindow.superclass.constructor.call(this,c);this.addEvents({changed:true})};Ext.extend(GO.CheckerWindow,GO.Window,{});GO.CheckerPanel=Ext.extend(function(a){if(!a){a={}}a.id="go-checker-panel";a.store=new Ext.data.GroupingStore({reader:new Ext.data.JsonReader({totalProperty:"count",root:"results",id:"id",fields:["id","name","description","link_id","link_type","link_type_name","local_time","iconCls","time","snooze_time","text"]}),groupField:"link_type_name",sortInfo:{field:"time",direction:"ASC"}});var b=new Ext.ux.grid.RowActions({header:"-",autoWidth:true,align:"center",actions:[{iconCls:"btn-dismiss",qtip:GO.lang.snooze},{iconCls:"btn-delete",qtip:GO.lang.dismiss}]});b.on({scope:this,action:function(e,c,f,g,d){e.getSelectionModel().selectRow(g);switch(f){case"btn-dismiss":this.doTask("snooze_reminders",c.get("snooze_time"));break;case"btn-delete":this.doTask("dismiss_reminders");break}}},this);a.cm=new Ext.grid.ColumnModel([{dataIndex:"link_type_name",hideable:false},{header:"",width:28,dataIndex:"icon",renderer:this.iconRenderer,hideable:false},{header:GO.lang.strTime,dataIndex:"local_time",width:80},{header:GO.lang.strName,dataIndex:"name",id:"name"},{width:80,header:GO.lang.snooze,dataIndex:"snooze_time",renderer:this.renderSelect.createDelegate(this),editor:new GO.form.ComboBox({store:new Ext.data.ArrayStore({idIndex:0,fields:["value","text"],data:GO.checkerSnoozeTimes}),valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true})},b]);a.plugins=[b];a.clicksToEdit=1;a.autoExpandColumn="name";a.view=new Ext.grid.GridView({enableRowBody:true,showPreview:true,forceFit:true,autoFill:true,getRowClass:function(d,g,f,e){var c=g%2==0?"odd":"even";if(this.showPreview){f.body='<div class="description">'+d.data.content+"</div>";return"x-grid3-row-expanded "+c}return"x-grid3-row-collapsed"},emptyText:GO.lang.strNoItems});a.view=new Ext.grid.GroupingView({hideGroupedColumn:true,groupTextTpl:'{text} ({[values.rs.length]} {[values.rs.length > 1 ? "'+GO.lang.items+'" : "'+GO.lang.item+'"]})',emptyText:GO.lang.strNoItems,showGroupName:false,enableRowBody:true,getRowClass:function(c,f,e,d){if(!GO.util.empty(c.data.text)){e.body='<div class="description go-html-formatted">'+c.data.text+"</div>";return"x-grid3-row-expanded"}else{return"x-grid3-row-collapsed"}}});a.selModel=new Ext.grid.RowSelectionModel();a.loadMask=true;GO.grid.GridPanel.superclass.constructor.call(this,a);this.on("rowdblclick",function(f,e){var c=f.getSelectionModel();var d=c.getSelected();if(GO.linkHandlers[d.data.link_type]){GO.linkHandlers[d.data.link_type].call(this,d.data.link_id)}else{Ext.Msg.alert(GO.lang.strError,"No handler definded for link type: "+d.data.link_type)}},this)},Ext.grid.EditorGridPanel,{doTask:function(a,e){this.stopEditing();var d=this.selModel.getSelections();if(!d.length){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noItemSelected)}else{var b=[];for(var c=0;c<d.length;c++){b.push(d[c].get("id"))}Ext.Ajax.request({url:BaseHref+"action.php",params:{task:a,snooze_time:e,reminders:Ext.encode(b)},callback:function(){for(var f=0;f<d.length;f++){this.store.remove(d[f])}GO.checker.lastCount=this.store.getCount();if(!GO.checker.lastCount){this.ownerCt.hide();GO.checker.reminderIcon.setDisplayed(false)}},scope:this})}},iconRenderer:function(c,a,b){return'<div class="go-icon '+b.data.iconCls+' "></div>'},renderSelect:function(j,b,f,g,l,e){var k=this.getColumnModel();var c=k.getCellEditor(l,g);var d=j;if(c.field.store.getById(j)!==undefined){var a=c.field.store.getById(j);d=c.field.store.getById(j).get("text")}return d}});GO.Checker=function(){this.addEvents({alert:true,startcheck:true,endcheck:true});this.checkerWindow=new GO.CheckerWindow();this.reminderIcon=Ext.get("reminder-icon");this.reminderIcon.setDisplayed(false);this.reminderIcon.on("click",function(){this.checkerWindow.show()},this)};Ext.extend(GO.Checker,Ext.util.Observable,{lastCount:0,params:{task:"checker"},init:function(){Ext.TaskMgr.start({run:this.checkForReminders,scope:this,interval:120000})},checkForReminders:function(){Ext.Ajax.request({url:BaseHref+"json.php",params:this.params,callback:function(b,d,a){if(!d){}else{var c=Ext.decode(a.responseText);if(c){c.reminderText="";c.alarm=false;this.fireEvent("check",this,c);if(c.reminders){this.checkerWindow.checkerGrid.store.loadData({results:c.reminders});if(this.lastCount!=this.checkerWindow.checkerGrid.store.getCount()){this.lastCount=this.checkerWindow.checkerGrid.store.getCount();this.checkerWindow.show();this.reminderIcon.setDisplayed(true);if(GO.util.empty(GO.settings.mute_reminder_sound)){c.alarm=true}else{c.alarm=false}}}else{this.reminderIcon.setDisplayed(false)}if(c.alarm){GO.playAlarm();if(!GO.hasFocus&&!GO.util.empty(GO.settings.popup_reminders)){GO.reminderPopup=GO.util.popup({width:400,height:300,url:BaseHref+"reminder.php?count="+this.lastCount+"&reminder_text="+encodeURIComponent(c.reminderText),target:"groupofficeReminderPopup",position:"br",closeOnFocus:false})}}}}},scope:this})}});GO.grid.RowExpander=function(a){Ext.apply(this,a);GO.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={};this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true})};Ext.extend(GO.grid.RowExpander,Ext.util.Observable,{header:"",width:20,sortable:false,fixed:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",function(){a.mainBody.on("mousedown",this.onMouseDown,this)},this)},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){if(a.className=="x-grid3-row-expander"){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)}},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforcollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.GroupTab=Ext.extend(Ext.Container,{mainItem:0,expanded:true,deferredRender:true,activeTab:null,idDelimiter:"__",headerAsText:false,frame:false,hideBorders:true,initComponent:function(a){Ext.apply(this,a);this.frame=false;Ext.ux.GroupTab.superclass.initComponent.call(this);this.addEvents("activate","deactivate","changemainitem","beforetabchange","tabchange");this.setLayout(new Ext.layout.CardLayout({deferredRender:this.deferredRender}));if(!this.stack){this.stack=Ext.TabPanel.AccessStack()}this.initItems();this.on("beforerender",function(){this.groupEl=this.ownerCt.getGroupEl(this)},this);this.on("add",this.onAdd,this,{target:this});this.on("remove",this.onRemove,this,{target:this});if(this.mainItem!==undefined){var b=(typeof this.mainItem=="object")?this.mainItem:this.items.get(this.mainItem);delete this.mainItem;this.setMainItem(b)}},setActiveTab:function(c){c=this.getComponent(c);if(!c){return false}if(!this.rendered){this.activeTab=c;return true}if(this.activeTab!=c&&this.fireEvent("beforetabchange",this,c,this.activeTab)!==false){if(this.activeTab&&this.activeTab!=this.mainItem){var a=this.getTabEl(this.activeTab);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}}var b=this.getTabEl(c);Ext.fly(b).addClass("x-grouptabs-strip-active");this.activeTab=c;this.stack.add(c);this.layout.setActiveItem(c);if(this.layoutOnTabChange&&c.doLayout){c.doLayout()}if(this.scrolling){this.scrollToTab(c,this.animScroll)}this.fireEvent("tabchange",this,c);return true}return false},getTabEl:function(a){if(a==this.mainItem){return this.groupEl}return Ext.TabPanel.prototype.getTabEl.call(this,a)},onRender:function(b,a){Ext.ux.GroupTab.superclass.onRender.call(this,b,a);this.strip=Ext.fly(this.groupEl).createChild({tag:"ul",cls:"x-grouptabs-sub"});this.tooltip=new Ext.ToolTip({target:this.groupEl,delegate:"a.x-grouptabs-text",trackMouse:true,renderTo:document.body,listeners:{beforeshow:function(e){var d=(e.triggerElement.parentNode===this.mainItem.tabEl)?this.mainItem:this.findById(e.triggerElement.parentNode.id.split(this.idDelimiter)[1]);if(!d.tabTip){return false}e.body.dom.innerHTML=d.tabTip},scope:this}});if(!this.itemTpl){var c=new Ext.Template('<li class="{cls}" id="{id}">','<a onclick="return false;" class="x-grouptabs-text {iconCls}">{text}</a>',"</li>");c.disableFormats=true;c.compile();Ext.ux.GroupTab.prototype.itemTpl=c}this.items.each(this.initTab,this)},afterRender:function(){Ext.ux.GroupTab.superclass.afterRender.call(this);if(this.activeTab!==undefined){var a=(typeof this.activeTab=="object")?this.activeTab:this.items.get(this.activeTab);delete this.activeTab;this.setActiveTab(a)}},initTab:function(c,a){var d=this.strip.dom.childNodes[a];var e=Ext.TabPanel.prototype.getTemplateArgs.call(this,c);if(c===this.mainItem){c.tabEl=this.groupEl;e.cls+=" x-grouptabs-main-item"}var b=d?this.itemTpl.insertBefore(d,e):this.itemTpl.append(this.strip,e);c.tabEl=c.tabEl||b;c.on("disable",this.onItemDisabled,this);c.on("enable",this.onItemEnabled,this);c.on("titlechange",this.onItemTitleChanged,this);c.on("iconchange",this.onItemIconChanged,this);c.on("beforeshow",this.onBeforeShowItem,this)},setMainItem:function(a){a=this.getComponent(a);if(!a||this.fireEvent("changemainitem",this,a,this.mainItem)===false){return}this.mainItem=a},getMainItem:function(){return this.mainItem||null},onBeforeShowItem:function(a){if(a!=this.activeTab){this.setActiveTab(a);return false}},onAdd:function(a,c,b){if(this.rendered){this.initTab.call(this,c,b)}},onRemove:function(c,b){Ext.destroy(Ext.get(this.getTabEl(b)));this.stack.remove(b);b.un("disable",this.onItemDisabled,this);b.un("enable",this.onItemEnabled,this);b.un("titlechange",this.onItemTitleChanged,this);b.un("iconchange",this.onItemIconChanged,this);b.un("beforeshow",this.onBeforeShowItem,this);if(b==this.activeTab){var a=this.stack.next();if(a){this.setActiveTab(a)}else{if(this.items.getCount()>0){this.setActiveTab(0)}else{this.activeTab=null}}}},onBeforeAdd:function(b){var a=b.events?(this.items.containsKey(b.getItemId())?b:null):this.items.get(b);if(a){this.setActiveTab(b);return false}Ext.TabPanel.superclass.onBeforeAdd.apply(this,arguments);var c=b.elements;b.elements=c?c.replace(",header",""):c;b.border=(b.border===true)},onItemDisabled:Ext.TabPanel.prototype.onItemDisabled,onItemEnabled:Ext.TabPanel.prototype.onItemEnabled,onItemTitleChanged:function(b){var a=this.getTabEl(b);if(a){Ext.fly(a).child("a.x-grouptabs-text",true).innerHTML=b.title}},onItemIconChanged:function(d,a,c){var b=this.getTabEl(d);if(b){Ext.fly(b).child("a.x-grouptabs-text").replaceClass(c,a)}},beforeDestroy:function(){Ext.TabPanel.prototype.beforeDestroy.call(this);this.tooltip.destroy()}});Ext.reg("grouptab",Ext.ux.GroupTab);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ns("Ext.ux");Ext.ux.GroupTabPanel=Ext.extend(Ext.TabPanel,{tabPosition:"left",alternateColor:false,alternateCls:"x-grouptabs-panel-alt",defaultType:"grouptab",deferredRender:false,activeGroup:null,initComponent:function(){Ext.ux.GroupTabPanel.superclass.initComponent.call(this);this.addEvents("beforegroupchange","groupchange");this.elements="body,header";this.stripTarget="header";this.tabPosition=this.tabPosition=="right"?"right":"left";this.addClass("x-grouptabs-panel");if(this.tabStyle&&this.tabStyle!=""){this.addClass("x-grouptabs-panel-"+this.tabStyle)}if(this.alternateColor){this.addClass(this.alternateCls)}this.on("beforeadd",function(b,c,a){this.initGroup(c,a)})},initEvents:function(){this.mon(this.strip,"mousedown",this.onStripMouseDown,this)},onRender:function(c,a){Ext.TabPanel.superclass.onRender.call(this,c,a);if(this.plain){var f=this.tabPosition=="top"?"header":"footer";this[f].addClass("x-tab-panel-"+f+"-plain")}var b=this[this.stripTarget];this.stripWrap=b.createChild({cls:"x-tab-strip-wrap ",cn:{tag:"ul",cls:"x-grouptabs-strip x-grouptabs-tab-strip-"+this.tabPosition}});var e=(this.tabPosition=="bottom"?this.stripWrap:null);this.strip=new Ext.Element(this.stripWrap.dom.firstChild);this.header.addClass("x-grouptabs-panel-header");this.bwrap.addClass("x-grouptabs-bwrap");this.body.addClass("x-tab-panel-body-"+this.tabPosition+" x-grouptabs-panel-body");if(!this.groupTpl){var d=new Ext.Template('<li class="{cls}" id="{id}">','<a class="x-grouptabs-expand" onclick="return false;"></a>','<a class="x-grouptabs-text {iconCls}" href="#" onclick="return false;">',"<span>{text}</span></a>","</li>");d.disableFormats=true;d.compile();Ext.ux.GroupTabPanel.prototype.groupTpl=d}this.items.each(this.initGroup,this)},afterRender:function(){Ext.ux.GroupTabPanel.superclass.afterRender.call(this);this.tabJoint=Ext.fly(this.body.dom.parentNode).createChild({cls:"x-tab-joint"});this.addClass("x-tab-panel-"+this.tabPosition);this.header.setWidth(this.tabWidth);if(this.activeGroup!==undefined){var a=(typeof this.activeGroup=="object")?this.activeGroup:this.items.get(this.activeGroup);delete this.activeGroup;this.setActiveGroup(a);a.setActiveTab(a.getMainItem())}},getGroupEl:Ext.TabPanel.prototype.getTabEl,findTargets:function(c){var b=null,a=c.getTarget("li",this.strip);if(a){b=this.findById(a.id.split(this.idDelimiter)[1]);if(b.disabled){return{expand:null,item:null,el:null}}}return{expand:c.getTarget(".x-grouptabs-expand",this.strip),isGroup:!c.getTarget("ul.x-grouptabs-sub",this.strip),item:b,el:a}},onStripMouseDown:function(b){if(b.button!=0){return}b.preventDefault();var a=this.findTargets(b);if(a.expand){this.toggleGroup(a.el)}else{if(a.item){if(a.isGroup){a.item.setActiveTab(a.item.getMainItem())}else{a.item.ownerCt.setActiveTab(a.item)}}}},expandGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).addClass("x-grouptabs-expanded");this.syncTabJoint()},toggleGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).toggleClass("x-grouptabs-expanded");this.syncTabJoint()},collapseGroup:function(a){if(a.isXType){a=this.getGroupEl(a)}Ext.fly(a).removeClass("x-grouptabs-expanded");this.syncTabJoint()},syncTabJoint:function(b){if(!this.tabJoint){return}b=b||this.getGroupEl(this.activeGroup);if(b){this.tabJoint.setHeight(Ext.fly(b).getHeight()-2);var a=Ext.isGecko2?0:1;if(this.tabPosition=="left"){this.tabJoint.alignTo(b,"tl-tr",[-2,a])}else{this.tabJoint.alignTo(b,"tr-tl",[1,a])}}else{this.tabJoint.hide()}},getActiveTab:function(){if(!this.activeGroup){return null}return this.activeGroup.getTabEl(this.activeGroup.activeTab)||null},onResize:function(){Ext.ux.GroupTabPanel.superclass.onResize.apply(this,arguments);this.syncTabJoint()},createCorner:function(a,b){return Ext.fly(a).createChild({cls:"x-grouptabs-corner x-grouptabs-corner-"+b})},initGroup:function(f,b){var d=this.strip.dom.childNodes[b],e=this.getTemplateArgs(f);if(b===0){e.cls+=" x-tab-first"}e.cls+=" x-grouptabs-main";e.text=f.getMainItem().title;var c=d?this.groupTpl.insertBefore(d,e):this.groupTpl.append(this.strip,e),a=this.createCorner(c,"top-"+this.tabPosition),g=this.createCorner(c,"bottom-"+this.tabPosition);f.tabEl=c;if(f.expanded){this.expandGroup(c)}if(Ext.isIE6||(Ext.isIE&&!Ext.isStrict)){g.setLeft("-10px");g.setBottom("-5px");a.setLeft("-10px");a.setTop("-5px")}this.mon(f,{scope:this,changemainitem:this.onGroupChangeMainItem,beforetabchange:this.onGroupBeforeTabChange})},setActiveGroup:function(b){b=this.getComponent(b);if(!b){return false}if(!this.rendered){this.activeGroup=b;return true}if(this.activeGroup!=b&&this.fireEvent("beforegroupchange",this,b,this.activeGroup)!==false){if(this.activeGroup){this.activeGroup.activeTab=null;var a=this.getGroupEl(this.activeGroup);if(a){Ext.fly(a).removeClass("x-grouptabs-strip-active")}}var c=this.getGroupEl(b);Ext.fly(c).addClass("x-grouptabs-strip-active");this.activeGroup=b;this.stack.add(b);this.layout.setActiveItem(b);this.syncTabJoint(c);this.fireEvent("groupchange",this,b);return true}return false},onGroupBeforeTabChange:function(a,c,b){if(a!==this.activeGroup||c!==b){this.strip.select(".x-grouptabs-sub > li.x-grouptabs-strip-active",true).removeClass("x-grouptabs-strip-active")}this.expandGroup(this.getGroupEl(a));if(a!==this.activeGroup){return this.setActiveGroup(a)}},getFrameHeight:function(){var a=this.el.getFrameWidth("tb");a+=(this.tbar?this.tbar.getHeight():0)+(this.bbar?this.bbar.getHeight():0);return a},adjustBodyWidth:function(a){return a-this.tabWidth}});Ext.reg("grouptabpanel",Ext.ux.GroupTabPanel);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portal=Ext.extend(Ext.Panel,{layout:"column",autoScroll:true,cls:"x-portal",defaultType:"portalcolumn",initComponent:function(){Ext.ux.Portal.superclass.initComponent.call(this);this.addEvents({validatedrop:true,beforedragover:true,dragover:true,beforedrop:true,drop:true})},initEvents:function(){Ext.ux.Portal.superclass.initEvents.call(this);this.dd=new Ext.ux.Portal.DropZone(this,this.dropConfig)},beforeDestroy:function(){if(this.dd){this.dd.unreg()}Ext.ux.Portal.superclass.beforeDestroy.call(this)}});Ext.reg("portal",Ext.ux.Portal);Ext.ux.Portal.DropZone=function(a,b){this.portal=a;Ext.dd.ScrollManager.register(a.body);Ext.ux.Portal.DropZone.superclass.constructor.call(this,a.bwrap.dom,b);a.body.ddScrollConfig=this.ddScrollConfig};Ext.extend(Ext.ux.Portal.DropZone,Ext.dd.DropTarget,{ddScrollConfig:{vthresh:50,hthresh:-1,animate:true,increment:200},createEvent:function(a,f,d,b,j,g){return{portal:this.portal,panel:d.panel,columnIndex:b,column:j,position:g,data:d,source:a,rawEvent:f,status:this.dropAllowed}},notifyOver:function(z,x,A){var f=x.getXY(),a=this.portal,q=z.proxy;if(!this.grid){this.grid=this.getGrid()}var b=a.body.dom.clientWidth;if(!this.lastCW){this.lastCW=b}else{if(this.lastCW!=b){this.lastCW=b;a.doLayout();this.grid=this.getGrid()}}var d=0,n=this.grid.columnX,o=false;for(var w=n.length;d<w;d++){if(f[0]<(n[d].x+n[d].w)){o=true;break}}if(!o){d--}var u,l=false,j=0,y=a.items.itemAt(d),r=y.items.items,k=false;for(var w=r.length;j<w;j++){u=r[j];var v=u.el.getHeight();if(v===0){k=true}else{if((u.el.getY()+(v/2))>f[1]){l=true;break}}}j=(l&&u?j:y.items.getCount())+(k?-1:0);var g=this.createEvent(z,x,A,d,y,j);if(a.fireEvent("validatedrop",g)!==false&&a.fireEvent("beforedragover",g)!==false){q.getProxy().setWidth("auto");if(u){q.moveProxy(u.el.dom.parentNode,l?u.el.dom:null)}else{q.moveProxy(y.el.dom,null)}this.lastPos={c:y,col:d,p:k||(l&&u)?j:false};this.scrollPos=a.body.getScroll();a.fireEvent("dragover",g);return g.status}else{return g.status}},notifyOut:function(){delete this.grid},notifyDrop:function(n,g,f){delete this.grid;if(!this.lastPos){return}var k=this.lastPos.c,b=this.lastPos.col,l=this.lastPos.p;var a=this.createEvent(n,g,f,b,k,l!==false?l:k.items.getCount());if(this.portal.fireEvent("validatedrop",a)!==false&&this.portal.fireEvent("beforedrop",a)!==false){n.proxy.getProxy().remove();n.panel.el.dom.parentNode.removeChild(n.panel.el.dom);if(l!==false){if(k==n.panel.ownerCt&&(k.items.items.indexOf(n.panel)<=l)){l++}k.insert(l,n.panel)}else{k.add(n.panel)}k.doLayout();this.portal.fireEvent("drop",a);var o=this.scrollPos.top;if(o){var j=this.portal.body.dom;setTimeout(function(){j.scrollTop=o},10)}}delete this.lastPos},getGrid:function(){var a=this.portal.bwrap.getBox();a.columnX=[];this.portal.items.each(function(b){a.columnX.push({x:b.el.getX(),w:b.el.getWidth()})});return a},unreg:function(){Ext.ux.Portal.DropZone.superclass.unreg.call(this)}});
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.PortalColumn=Ext.extend(Ext.Container,{layout:"anchor",defaultType:"portlet",cls:"x-portal-column"});Ext.reg("portalcolumn",Ext.ux.PortalColumn);
/*
 * Ext JS Library 3.1.1
 * Copyright(c) 2006-2010 Ext JS, LLC
 * licensing@extjs.com
 * http://www.extjs.com/license
 */
Ext.ux.Portlet=Ext.extend(Ext.Panel,{anchor:"100%",frame:true,collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("portlet",Ext.ux.Portlet);if(typeof deconcept=="undefined"){var deconcept=new Object()}if(typeof deconcept.util=="undefined"){deconcept.util=new Object()}if(typeof deconcept.SWFObjectUtil=="undefined"){deconcept.SWFObjectUtil=new Object()}deconcept.SWFObject=function(o,b,p,e,k,l,g,f,d,n){if(!document.getElementById){return}this.DETECT_KEY=n?n:"detectflash";this.skipDetect=deconcept.util.getRequestParameter(this.DETECT_KEY);this.params=new Object();this.variables=new Object();this.attributes=new Array();if(o){this.setAttribute("swf",o)}if(b){this.setAttribute("id",b)}if(p){this.setAttribute("width",p)}if(e){this.setAttribute("height",e)}if(k){this.setAttribute("version",new deconcept.PlayerVersion(k.toString().split(".")))}this.installedVer=deconcept.SWFObjectUtil.getPlayerVersion();if(!window.opera&&document.all&&this.installedVer.major>7){deconcept.SWFObject.doPrepUnload=true}if(l){this.addParam("bgcolor",l)}var a=g?g:"high";this.addParam("quality",a);this.setAttribute("useExpressInstall",false);this.setAttribute("doExpressInstall",false);var j=(f)?f:window.location;this.setAttribute("xiRedirectUrl",j);this.setAttribute("redirectUrl","");if(d){this.setAttribute("redirectUrl",d)}};deconcept.SWFObject.prototype={useExpressInstall:function(a){this.xiSWFPath=!a?"expressinstall.swf":a;this.setAttribute("useExpressInstall",true)},setAttribute:function(a,b){this.attributes[a]=b},getAttribute:function(a){return this.attributes[a]},addParam:function(b,a){this.params[b]=a},getParams:function(){return this.params},addVariable:function(b,a){this.variables[b]=a},getVariable:function(a){return this.variables[a]},getVariables:function(){return this.variables},getVariablePairs:function(){var c=new Array();var b;var a=this.getVariables();for(b in a){c[c.length]=b+"="+a[b]}return c},getSWFHTML:function(){var b="";if(navigator.plugins&&navigator.mimeTypes&&navigator.mimeTypes.length){if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","PlugIn");this.setAttribute("swf",this.xiSWFPath)}b='<embed type="application/x-shockwave-flash" src="'+this.getAttribute("swf")+'" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'"';b+=' id="'+this.getAttribute("id")+'" name="'+this.getAttribute("id")+'" ';var f=this.getParams();for(var e in f){b+=[e]+'="'+f[e]+'" '}var d=this.getVariablePairs().join("&");if(d.length>0){b+='flashvars="'+d+'"'}b+="/>"}else{if(this.getAttribute("doExpressInstall")){this.addVariable("MMplayerType","ActiveX");this.setAttribute("swf",this.xiSWFPath)}b='<object id="'+this.getAttribute("id")+'" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="'+this.getAttribute("width")+'" height="'+this.getAttribute("height")+'" style="'+this.getAttribute("style")+'">';b+='<param name="movie" value="'+this.getAttribute("swf")+'" />';var c=this.getParams();for(var e in c){b+='<param name="'+e+'" value="'+c[e]+'" />'}var a=this.getVariablePairs().join("&");if(a.length>0){b+='<param name="flashvars" value="'+a+'" />'}b+="</object>"}return b},write:function(b){if(this.getAttribute("useExpressInstall")){var a=new deconcept.PlayerVersion([6,0,65]);if(this.installedVer.versionIsValid(a)&&!this.installedVer.versionIsValid(this.getAttribute("version"))){this.setAttribute("doExpressInstall",true);this.addVariable("MMredirectURL",escape(this.getAttribute("xiRedirectUrl")));document.title=document.title.slice(0,47)+" - Flash Player Installation";this.addVariable("MMdoctitle",document.title)}}if(this.skipDetect||this.getAttribute("doExpressInstall")||this.installedVer.versionIsValid(this.getAttribute("version"))){var c=(typeof b=="string")?document.getElementById(b):b;c.innerHTML=this.getSWFHTML();return true}else{if(this.getAttribute("redirectUrl")!=""){document.location.replace(this.getAttribute("redirectUrl"))}}return false}};deconcept.SWFObjectUtil.getPlayerVersion=function(){var f=new deconcept.PlayerVersion([0,0,0]);if(navigator.plugins&&navigator.mimeTypes.length){var a=navigator.plugins["Shockwave Flash"];if(a&&a.description){f=new deconcept.PlayerVersion(a.description.replace(/([a-zA-Z]|\s)+/,"").replace(/(\s+r|\s+b[0-9]+)/,".").split("."))}}else{if(navigator.userAgent&&navigator.userAgent.indexOf("Windows CE")>=0){var b=1;var c=3;while(b){try{c++;b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash."+c);f=new deconcept.PlayerVersion([c,0,0])}catch(d){b=null}}}else{try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.7")}catch(d){try{var b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6");f=new deconcept.PlayerVersion([6,0,21]);b.AllowScriptAccess="always"}catch(d){if(f.major==6){return f}}try{b=new ActiveXObject("ShockwaveFlash.ShockwaveFlash")}catch(d){}}if(b!=null){f=new deconcept.PlayerVersion(b.GetVariable("$version").split(" ")[1].split(","))}}}return f};deconcept.PlayerVersion=function(a){this.major=a[0]!=null?parseInt(a[0]):0;this.minor=a[1]!=null?parseInt(a[1]):0;this.rev=a[2]!=null?parseInt(a[2]):0};deconcept.PlayerVersion.prototype.versionIsValid=function(a){if(this.major<a.major){return false}if(this.major>a.major){return true}if(this.minor<a.minor){return false}if(this.minor>a.minor){return true}if(this.rev<a.rev){return false}return true};deconcept.util={getRequestParameter:function(c){var d=document.location.search||document.location.hash;if(c==null){return d}if(d){var b=d.substring(1).split("&");for(var a=0;a<b.length;a++){if(b[a].substring(0,b[a].indexOf("="))==c){return b[a].substring((b[a].indexOf("=")+1))}}}return""}};deconcept.SWFObjectUtil.cleanupSWFs=function(){var b=document.getElementsByTagName("OBJECT");for(var c=b.length-1;c>=0;c--){b[c].style.display="none";for(var a in b[c]){if(typeof b[c][a]=="function"){b[c][a]=function(){}}}}};if(deconcept.SWFObject.doPrepUnload){if(!deconcept.unloadSet){deconcept.SWFObjectUtil.prepUnload=function(){__flash_unloadHandler=function(){};__flash_savedUnloadHandler=function(){};window.attachEvent("onunload",deconcept.SWFObjectUtil.cleanupSWFs)};window.attachEvent("onbeforeunload",deconcept.SWFObjectUtil.prepUnload);deconcept.unloadSet=true}}if(!document.getElementById&&document.all){document.getElementById=function(a){return document.all[a]}}var getQueryParamValue=deconcept.util.getRequestParameter;var FlashObject=deconcept.SWFObject;var SWFObject=deconcept.SWFObject;var SWFUpload;if(SWFUpload==undefined){SWFUpload=function(a){this.initSWFUpload(a)}}SWFUpload.prototype.initSWFUpload=function(b){try{this.customSettings={};this.settings=b;this.eventQueue=[];this.movieName="SWFUpload_"+SWFUpload.movieCount++;this.movieElement=null;SWFUpload.instances[this.movieName]=this;this.initSettings();this.loadFlash();this.displayDebugInfo()}catch(a){delete SWFUpload.instances[this.movieName];throw a}};SWFUpload.instances={};SWFUpload.movieCount=0;SWFUpload.version="2.2.0 2009-03-25";SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130};SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290};SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5};SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120};SWFUpload.CURSOR={ARROW:-1,HAND:-2};SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"};SWFUpload.completeURL=function(a){if(typeof(a)!=="string"||a.match(/^https?:\/\//i)||a.match(/^\//)){return a}var c=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:"");var b=window.location.pathname.lastIndexOf("/");if(b<=0){path="/"}else{path=window.location.pathname.substr(0,b)+"/"}return path+a};SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(b,a){this.settings[b]=(this.settings[b]==undefined)?a:this.settings[b]};this.ensureDefault("upload_url","");this.ensureDefault("preserve_relative_urls",false);this.ensureDefault("file_post_name","Filedata");this.ensureDefault("post_params",{});this.ensureDefault("use_query_string",false);this.ensureDefault("requeue_on_error",false);this.ensureDefault("http_success",[]);this.ensureDefault("assume_success_timeout",0);this.ensureDefault("file_types","*.*");this.ensureDefault("file_types_description","All Files");this.ensureDefault("file_size_limit",0);this.ensureDefault("file_upload_limit",0);this.ensureDefault("file_queue_limit",0);this.ensureDefault("flash_url","swfupload.swf");this.ensureDefault("prevent_swf_caching",true);this.ensureDefault("button_image_url","");this.ensureDefault("button_width",1);this.ensureDefault("button_height",1);this.ensureDefault("button_text","");this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;");this.ensureDefault("button_text_top_padding",0);this.ensureDefault("button_text_left_padding",0);this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES);this.ensureDefault("button_disabled",false);this.ensureDefault("button_placeholder_id","");this.ensureDefault("button_placeholder",null);this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW);this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW);this.ensureDefault("debug",false);this.settings.debug_enabled=this.settings.debug;this.settings.return_upload_start_handler=this.returnUploadStart;this.ensureDefault("swfupload_loaded_handler",null);this.ensureDefault("file_dialog_start_handler",null);this.ensureDefault("file_queued_handler",null);this.ensureDefault("file_queue_error_handler",null);this.ensureDefault("file_dialog_complete_handler",null);this.ensureDefault("upload_start_handler",null);this.ensureDefault("upload_progress_handler",null);this.ensureDefault("upload_error_handler",null);this.ensureDefault("upload_success_handler",null);this.ensureDefault("upload_complete_handler",null);this.ensureDefault("debug_handler",this.debugMessage);this.ensureDefault("custom_settings",{});this.customSettings=this.settings.custom_settings;if(!!this.settings.prevent_swf_caching){this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+new Date().getTime()}if(!this.settings.preserve_relative_urls){this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url);this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)}delete this.ensureDefault};SWFUpload.prototype.loadFlash=function(){var a,b;if(document.getElementById(this.movieName)!==null){throw"ID "+this.movieName+" is already in use. The Flash Object could not be added"}a=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder;if(a==undefined){throw"Could not find the placeholder element: "+this.settings.button_placeholder_id}b=document.createElement("div");b.innerHTML=this.getFlashHTML();a.parentNode.replaceChild(b.firstChild,a);if(window[this.movieName]==undefined){window[this.movieName]=this.getMovieElement()}};SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")};SWFUpload.prototype.getFlashVars=function(){var b=this.buildParamString();var a=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(a),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(b),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")};SWFUpload.prototype.getMovieElement=function(){if(this.movieElement==undefined){this.movieElement=document.getElementById(this.movieName)}if(this.movieElement===null){throw"Could not find Flash element"}return this.movieElement};SWFUpload.prototype.buildParamString=function(){var c=this.settings.post_params;var b=[];if(typeof(c)==="object"){for(var a in c){if(c.hasOwnProperty(a)){b.push(encodeURIComponent(a.toString())+"="+encodeURIComponent(c[a].toString()))}}}return b.join("&amp;")};SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,false);var a=null;a=this.getMovieElement();if(a&&typeof(a.CallFunction)==="unknown"){for(var c in a){try{if(typeof(a[c])==="function"){a[c]=null}}catch(e){}}try{a.parentNode.removeChild(a)}catch(b){}}window[this.movieName]=null;SWFUpload.instances[this.movieName]=null;delete SWFUpload.instances[this.movieName];this.movieElement=null;this.settings=null;this.customSettings=null;this.eventQueue=null;this.movieName=null;return true}catch(d){return false}};SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","\t","upload_url:               ",this.settings.upload_url,"\n","\t","flash_url:                ",this.settings.flash_url,"\n","\t","use_query_string:         ",this.settings.use_query_string.toString(),"\n","\t","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","\t","http_success:             ",this.settings.http_success.join(", "),"\n","\t","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","\t","file_post_name:           ",this.settings.file_post_name,"\n","\t","post_params:              ",this.settings.post_params.toString(),"\n","\t","file_types:               ",this.settings.file_types,"\n","\t","file_types_description:   ",this.settings.file_types_description,"\n","\t","file_size_limit:          ",this.settings.file_size_limit,"\n","\t","file_upload_limit:        ",this.settings.file_upload_limit,"\n","\t","file_queue_limit:         ",this.settings.file_queue_limit,"\n","\t","debug:                    ",this.settings.debug.toString(),"\n","\t","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","\t","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","\t","button_placeholder:       ",(this.settings.button_placeholder?"Set":"Not Set"),"\n","\t","button_image_url:         ",this.settings.button_image_url.toString(),"\n","\t","button_width:             ",this.settings.button_width.toString(),"\n","\t","button_height:            ",this.settings.button_height.toString(),"\n","\t","button_text:              ",this.settings.button_text.toString(),"\n","\t","button_text_style:        ",this.settings.button_text_style.toString(),"\n","\t","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","\t","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","\t","button_action:            ",this.settings.button_action.toString(),"\n","\t","button_disabled:          ",this.settings.button_disabled.toString(),"\n","\t","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","\t","swfupload_loaded_handler assigned:  ",(typeof this.settings.swfupload_loaded_handler==="function").toString(),"\n","\t","file_dialog_start_handler assigned: ",(typeof this.settings.file_dialog_start_handler==="function").toString(),"\n","\t","file_queued_handler assigned:       ",(typeof this.settings.file_queued_handler==="function").toString(),"\n","\t","file_queue_error_handler assigned:  ",(typeof this.settings.file_queue_error_handler==="function").toString(),"\n","\t","upload_start_handler assigned:      ",(typeof this.settings.upload_start_handler==="function").toString(),"\n","\t","upload_progress_handler assigned:   ",(typeof this.settings.upload_progress_handler==="function").toString(),"\n","\t","upload_error_handler assigned:      ",(typeof this.settings.upload_error_handler==="function").toString(),"\n","\t","upload_success_handler assigned:    ",(typeof this.settings.upload_success_handler==="function").toString(),"\n","\t","upload_complete_handler assigned:   ",(typeof this.settings.upload_complete_handler==="function").toString(),"\n","\t","debug_handler assigned:             ",(typeof this.settings.debug_handler==="function").toString(),"\n"].join(""))};SWFUpload.prototype.addSetting=function(b,c,a){if(c==undefined){return(this.settings[b]=a)}else{return(this.settings[b]=c)}};SWFUpload.prototype.getSetting=function(a){if(this.settings[a]!=undefined){return this.settings[a]}return""};SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement();var returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>");returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}if(returnValue!=undefined&&typeof returnValue.post==="object"){returnValue=this.unescapeFilePostParams(returnValue)}return returnValue};SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")};SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")};SWFUpload.prototype.startUpload=function(a){this.callFlash("StartUpload",[a])};SWFUpload.prototype.cancelUpload=function(a,b){if(b!==false){b=true}this.callFlash("CancelUpload",[a,b])};SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")};SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")};SWFUpload.prototype.setStats=function(a){this.callFlash("SetStats",[a])};SWFUpload.prototype.getFile=function(a){if(typeof(a)==="number"){return this.callFlash("GetFileByIndex",[a])}else{return this.callFlash("GetFile",[a])}};SWFUpload.prototype.addFileParam=function(a,b,c){return this.callFlash("AddFileParam",[a,b,c])};SWFUpload.prototype.removeFileParam=function(a,b){this.callFlash("RemoveFileParam",[a,b])};SWFUpload.prototype.setUploadURL=function(a){this.settings.upload_url=a.toString();this.callFlash("SetUploadURL",[a])};SWFUpload.prototype.setPostParams=function(a){this.settings.post_params=a;this.callFlash("SetPostParams",[a])};SWFUpload.prototype.addPostParam=function(a,b){this.settings.post_params[a]=b;this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.removePostParam=function(a){delete this.settings.post_params[a];this.callFlash("SetPostParams",[this.settings.post_params])};SWFUpload.prototype.setFileTypes=function(a,b){this.settings.file_types=a;this.settings.file_types_description=b;this.callFlash("SetFileTypes",[a,b])};SWFUpload.prototype.setFileSizeLimit=function(a){this.settings.file_size_limit=a;this.callFlash("SetFileSizeLimit",[a])};SWFUpload.prototype.setFileUploadLimit=function(a){this.settings.file_upload_limit=a;this.callFlash("SetFileUploadLimit",[a])};SWFUpload.prototype.setFileQueueLimit=function(a){this.settings.file_queue_limit=a;this.callFlash("SetFileQueueLimit",[a])};SWFUpload.prototype.setFilePostName=function(a){this.settings.file_post_name=a;this.callFlash("SetFilePostName",[a])};SWFUpload.prototype.setUseQueryString=function(a){this.settings.use_query_string=a;this.callFlash("SetUseQueryString",[a])};SWFUpload.prototype.setRequeueOnError=function(a){this.settings.requeue_on_error=a;this.callFlash("SetRequeueOnError",[a])};SWFUpload.prototype.setHTTPSuccess=function(a){if(typeof a==="string"){a=a.replace(" ","").split(",")}this.settings.http_success=a;this.callFlash("SetHTTPSuccess",[a])};SWFUpload.prototype.setAssumeSuccessTimeout=function(a){this.settings.assume_success_timeout=a;this.callFlash("SetAssumeSuccessTimeout",[a])};SWFUpload.prototype.setDebugEnabled=function(a){this.settings.debug_enabled=a;this.callFlash("SetDebugEnabled",[a])};SWFUpload.prototype.setButtonImageURL=function(a){if(a==undefined){a=""}this.settings.button_image_url=a;this.callFlash("SetButtonImageURL",[a])};SWFUpload.prototype.setButtonDimensions=function(c,a){this.settings.button_width=c;this.settings.button_height=a;var b=this.getMovieElement();if(b!=undefined){b.style.width=c+"px";b.style.height=a+"px"}this.callFlash("SetButtonDimensions",[c,a])};SWFUpload.prototype.setButtonText=function(a){this.settings.button_text=a;this.callFlash("SetButtonText",[a])};SWFUpload.prototype.setButtonTextPadding=function(b,a){this.settings.button_text_top_padding=a;this.settings.button_text_left_padding=b;this.callFlash("SetButtonTextPadding",[b,a])};SWFUpload.prototype.setButtonTextStyle=function(a){this.settings.button_text_style=a;this.callFlash("SetButtonTextStyle",[a])};SWFUpload.prototype.setButtonDisabled=function(a){this.settings.button_disabled=a;this.callFlash("SetButtonDisabled",[a])};SWFUpload.prototype.setButtonAction=function(a){this.settings.button_action=a;this.callFlash("SetButtonAction",[a])};SWFUpload.prototype.setButtonCursor=function(a){this.settings.button_cursor=a;this.callFlash("SetButtonCursor",[a])};SWFUpload.prototype.queueEvent=function(b,c){if(c==undefined){c=[]}else{if(!(c instanceof Array)){c=[c]}}var a=this;if(typeof this.settings[b]==="function"){this.eventQueue.push(function(){this.settings[b].apply(this,c)});setTimeout(function(){a.executeNextEvent()},0)}else{if(this.settings[b]!==null){throw"Event handler "+b+" is unknown or is not a function"}}};SWFUpload.prototype.executeNextEvent=function(){var a=this.eventQueue?this.eventQueue.shift():null;if(typeof(a)==="function"){a.apply(this)}};SWFUpload.prototype.unescapeFilePostParams=function(c){var e=/[$]([0-9a-f]{4})/i;var f={};var d;if(c!=undefined){for(var a in c.post){if(c.post.hasOwnProperty(a)){d=a;var b;while((b=e.exec(d))!==null){d=d.replace(b[0],String.fromCharCode(parseInt("0x"+b[1],16)))}f[d]=c.post[a]}}c.post=f}return c};SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(a){return false}};SWFUpload.prototype.flashReady=function(){var a=this.getMovieElement();if(!a){this.debug("Flash called back ready but the flash movie can't be found.");return}this.cleanUp(a);this.queueEvent("swfupload_loaded_handler")};SWFUpload.prototype.cleanUp=function(a){try{if(this.movieElement&&typeof(a.CallFunction)==="unknown"){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var c in a){try{if(typeof(a[c])==="function"){a[c]=null}}catch(b){}}}}catch(d){}window.__flash__removeCallback=function(e,f){try{if(e){e[f]=null}}catch(g){}}};SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")};SWFUpload.prototype.fileQueued=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("file_queued_handler",a)};SWFUpload.prototype.fileQueueError=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("file_queue_error_handler",[a,c,b])};SWFUpload.prototype.fileDialogComplete=function(b,c,a){this.queueEvent("file_dialog_complete_handler",[b,c,a])};SWFUpload.prototype.uploadStart=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("return_upload_start_handler",a)};SWFUpload.prototype.returnUploadStart=function(a){var b;if(typeof this.settings.upload_start_handler==="function"){a=this.unescapeFilePostParams(a);b=this.settings.upload_start_handler.call(this,a)}else{if(this.settings.upload_start_handler!=undefined){throw"upload_start_handler must be a function"}}if(b===undefined){b=true}b=!!b;this.callFlash("ReturnUploadStart",[b])};SWFUpload.prototype.uploadProgress=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("upload_progress_handler",[a,c,b])};SWFUpload.prototype.uploadError=function(a,c,b){a=this.unescapeFilePostParams(a);this.queueEvent("upload_error_handler",[a,c,b])};SWFUpload.prototype.uploadSuccess=function(b,a,c){b=this.unescapeFilePostParams(b);this.queueEvent("upload_success_handler",[b,a,c])};SWFUpload.prototype.uploadComplete=function(a){a=this.unescapeFilePostParams(a);this.queueEvent("upload_complete_handler",a)};SWFUpload.prototype.debug=function(a){this.queueEvent("debug_handler",a)};SWFUpload.prototype.debugMessage=function(c){if(this.settings.debug){var a,d=[];if(typeof c==="object"&&typeof c.name==="string"&&typeof c.message==="string"){for(var b in c){if(c.hasOwnProperty(b)){d.push(b+": "+c[b])}}a=d.join("\n")||"";d=a.split("\n");a="EXCEPTION: "+d.join("\nEXCEPTION: ");SWFUpload.Console.writeLine(a)}else{SWFUpload.Console.writeLine(c)}}};SWFUpload.Console={};SWFUpload.Console.writeLine=function(d){var b,a;try{b=document.getElementById("SWFUpload_Console");if(!b){a=document.createElement("form");document.getElementsByTagName("body")[0].appendChild(a);b=document.createElement("textarea");b.id="SWFUpload_Console";b.style.fontFamily="monospace";b.setAttribute("wrap","off");b.wrap="off";b.style.overflow="auto";b.style.width="700px";b.style.height="350px";b.style.margin="5px";a.appendChild(b)}b.value+=d+"\n";b.scrollTop=b.scrollHeight-b.clientHeight}catch(c){alert("Exception: "+c.name+" Message: "+c.message)}};var SWFUpload;if(typeof(SWFUpload)==="function"){SWFUpload.prototype.initSettings=function(a){return function(b){if(typeof(a)==="function"){a.call(this,b)}this.refreshCookies(false)}}(SWFUpload.prototype.initSettings);SWFUpload.prototype.refreshCookies=function(l){if(l===undefined){l=true}l=!!l;var f=this.settings.post_params;var d,k=document.cookie.split(";"),b=k.length,e,j,a,g;for(d=0;d<b;d++){e=k[d];while(e.charAt(0)===" "){e=e.substring(1,e.length)}j=e.indexOf("=");if(j>0){a=e.substring(0,j);g=e.substring(j+1);f[a]=g}}if(l){this.setPostParams(f)}}}Ext.namespace("Ext.ux");Ext.ux.SwfUploadPanel=Ext.extend(Ext.grid.GridPanel,{strings:{text_add:"Add File(s)",text_upload:"Upload File(s)",text_cancel:"Cancel Upload",text_clear:"Clear Queue",text_progressbar:"Progress Bar",text_remove:"Remove File",text_remove_sure:"Are you sure you wish to remove this file from queue?",text_error:"Error",text_uploading:"Uploading file: {0} ({1} of {2})",header_filename:"Filename",header_size:"Size",header_status:"Status",header_progress:"Progress",status:{0:"Queued",1:"Uploading...",2:"Completed",3:"Error",4:"Cancelled"},error_queue_exceeded:"The selected file(s) exceed(s) the maximum number of {0} queued files.",error_queue_slots_0:"There is no slot left",error_queue_slots_1:"There is only one slot left",error_queue_slots_2:"There are only {0} slots left",error_size_exceeded:"The selected files size exceeds the allowed limit of 1 MB.",error_zero_byte_file:"Zero byte file selected.",error_invalid_filetype:"Invalid filetype selected.",error_file_not_found:"File not found 404.",error_security_error:"Security Error. Not allowed to post to different url."},single_select:false,confirm_delete:true,file_types:"*.*",file_types_description:"All Files",file_size_limit:"1MB",file_upload_limit:"0",file_queue_limit:"0",file_post_name:"Filedata",flash_url:BaseHref+"javascript/SWFUpload/swfupload.swf",debug:false,autoExpandColumn:"name",enableColumnResize:false,enableColumnMove:false,upload_cancelled:false,initComponent:function(){Ext.apply(this.strings,GO.lang.swfUploadPanelStrings);this.addEvents("swfUploadLoaded","fileQueued","startUpload","fileUploadError","fileUploadSuccess","fileUploadComplete","allUploadsComplete","removeFiles","removeAllFiles");this.rec=Ext.data.Record.create([{name:"name"},{name:"size"},{name:"id"},{name:"type"},{name:"creationdate",type:"date",dateFormat:"m/d/Y"},{name:"status"}]);this.store=new Ext.data.Store({reader:new Ext.data.JsonReader({id:"id"},this.rec)});this.columns=[{id:"name",header:this.strings.header_filename,dataIndex:"name"},{id:"size",header:this.strings.header_size,width:80,dataIndex:"size",renderer:this.formatBytes},{id:"status",header:this.strings.header_status,width:100,dataIndex:"status",renderer:this.formatStatus.createDelegate(this)},{id:"progress",header:this.strings.header_progress,width:150,renderer:this.formatProgressBar}];this.sm=new Ext.grid.RowSelectionModel({singleSelect:this.single_select});this.progress_bar=new Ext.ProgressBar({text:this.strings.text_progressbar,listeners:{render:function(){this.resizeProgressBar()},scope:this}});this.tbar=[{text:this.strings.text_add,iconCls:"SwfUploadPanel_iconAdd",xhandler:function(){if(this.single_select){this.suo.selectFile()}else{this.suo.selectFiles()}},xscope:this,listeners:{render:function(){this.initButton()},scope:this}},"->",{text:this.strings.text_cancel,iconCls:"SwfUploadPanel_iconCancel",handler:this.stopUpload,scope:this,hidden:true},{text:this.strings.text_upload,iconCls:"SwfUploadPanel_iconUpload",handler:this.startUpload,scope:this,hidden:true},{text:this.strings.text_clear,iconCls:"SwfUploadPanel_iconDelete",handler:this.removeAllFiles,scope:this,hidden:false}];this.addListener({keypress:{fn:function(a){if(this.confirm_delete){if(a.getKey()==a.DELETE){Ext.MessageBox.confirm(this.strings.text_remove,this.strings.text_remove_sure,function(b){if(b=="yes"){this.removeFiles()}},this)}}else{this.removeFiles(this)}},scope:this},contextmenu:function(a){a.stopEvent()},render:function(){this.addBtn=this.getTopToolbar().items.items[0];this.cancelBtn=this.getTopToolbar().items.items[2];this.uploadBtn=this.getTopToolbar().items.items[3];this.clearBtn=this.getTopToolbar().items.items[4];(function(){this.on("resize",this.resizeProgressBar,this)}).defer(100,this)}});Ext.ux.SwfUploadPanel.superclass.initComponent.call(this)},initButton:function(){var b=Ext.id();var a=this.addBtn.el.child("em");a.setStyle({position:"relative",display:"block"});a.createChild({tag:"div",id:b});this.suo=new SWFUpload({button_placeholder_id:b,button_width:a.getWidth(),button_height:a.getHeight(),button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,upload_url:this.upload_url,post_params:this.post_params,file_post_name:this.file_post_name,file_size_limit:this.file_size_limit,file_queue_limit:this.file_queue_limit,file_types:this.file_types,file_types_description:this.file_types_description,file_upload_limit:this.file_upload_limit,flash_url:this.flash_url,swfupload_loaded_handler:this.swfUploadLoaded.createDelegate(this),file_dialog_start_handler:this.fileDialogStart.createDelegate(this),file_queued_handler:this.fileQueue.createDelegate(this),file_queue_error_handler:this.fileQueueError.createDelegate(this),file_dialog_complete_handler:this.fileDialogComplete.createDelegate(this),upload_start_handler:this.uploadStart.createDelegate(this),upload_progress_handler:this.uploadProgress.createDelegate(this),upload_error_handler:this.uploadError.createDelegate(this),upload_success_handler:this.uploadSuccess.createDelegate(this),upload_complete_handler:this.uploadComplete.createDelegate(this),debug:this.debug,debug_handler:this.debug?this.debugHandler:Ext.emptyFn});Ext.get(this.suo.movieName).setStyle({position:"absolute",top:0,left:0})},formatProgressBar:function(c,d,a){var b;switch(a.data.fileState){case SWFUpload.FILE_STATUS.COMPLETE:if(Ext.isIE){b='<div class="x-progress-wrap" style="height: 18px"><div class="x-progress-inner"><div style="width: 100%;" class="x-progress-bar x-progress-text">100 %';"</div></div></div>"}else{b='<div class="x-progress-wrap" style="height: 18px"><div class="x-progress-inner"><div id="progressBar_'+a.data.id+'" style="width: 100%;" class="x-progress-bar"></div><div id="progressText_'+a.data.id+'" style="width: 100%;" class="x-progress-text x-progress-text-back" />100 %</div>';"</div></div>"}break;default:b='<div class="x-progress-wrap" style="height: 18px"><div class="x-progress-inner"><div id="progressBar_'+a.data.id+'" style="width: 0%;" class="x-progress-bar"></div><div id="progressText_'+a.data.id+'" style="width: 100%;" class="x-progress-text x-progress-text-back" />0 %</div>';"</div></div>";break}return b},resizeProgressBar:function(){this.progress_bar.setWidth(this.getBottomToolbar().el.getWidth()-5);Ext.fly(this.progress_bar.el.dom.firstChild.firstChild).applyStyles("height: 18px")},debugHandler:function(a){console.log(a)},formatStatus:function(a){return this.strings.status[a]},formatBytes:function(c){if(!c){c=0}var d=["B","KB","MB","GB"];var a=c;c=parseInt(c,10);a=c+" "+d[0];var b=0;while(c/1024>1){c=c/1024;b++}a=Math.round(c)+" "+d[b];return a},swfUploadLoaded:function(){if(this.debug){console.info("SWFUPLOAD LOADED")}this.fireEvent("swfUploadLoaded",this)},fileDialogStart:function(){if(this.debug){console.info("FILE DIALOG START")}this.fireEvent("fileDialogStart",this)},fileQueue:function(a){if(this.debug){console.info("FILE QUEUE")}a.status=0;var b=new this.rec(a);b.id=a.id;this.store.add(b);this.fireEvent("fileQueued",this,a)},fileQueueError:function(a,d,c){if(this.debug){console.info("FILE QUEUE ERROR")}switch(d){case -100:var b;switch(c){case"0":b=this.strings.error_queue_slots_0;break;case"1":b=this.strings.error_queue_slots_1;break;default:b=String.format(this.strings.error_queue_slots_2,c)}Ext.MessageBox.alert(this.strings.text_error,String.format(this.strings.error_queue_exceeded+" "+b,this.file_queue_limit));break;case -110:Ext.MessageBox.alert(this.strings.text_error,String.format(this.strings.error_size_exceeded,this.formatBytes(this.file_size_limit*1024)));break;case -120:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_zero_byte_file);break;case -130:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_invalid_filetype);break}this.fireEvent("fileQueueError",this,a,d)},fileDialogComplete:function(a){if(this.debug){console.info("FILE DIALOG COMPLETE")}if(a>0){}this.addBtn.show();this.clearBtn.show();this.fireEvent("fileDialogComplete",this,a)},uploadStart:function(a){if(this.debug){console.info("UPLOAD START")}this.fireEvent("uploadStart",this,a);return true},progressCount:0,uploadProgress:function(a,d,c){var b=Math.ceil((d/c)*100);if(b!=this.progressCount){Ext.getDom("progressBar_"+a.id).style.width=b+"%";Ext.getDom("progressText_"+a.id).innerHTML=b+" %";this.progressCount=b}this.store.getById(a.id).set("status",1);this.fireEvent("uploadProgress",this,a,d,c)},uploadError:function(b,a,c){if(this.debug){console.info("UPLOAD ERROR")}if(c==500){Ext.MessageBox.alert(this.strings.text_error,"File too big");this.fireEvent("fileUploadError",this,b,a,c);return}switch(a){case -200:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_file_not_found);break;case -230:Ext.MessageBox.alert(this.strings.text_error,this.strings.error_security_error);break;case -290:this.store.getById(b.id).set("status",4);this.store.getById(b.id).commit();break}this.fireEvent("fileUploadError",this,b,a,c)},uploadSuccess:function(b,a){if(this.debug){console.info("UPLOAD SUCCESS")}var c=Ext.decode(a);if(c.success){this.store.getById(b.id).data.fileState=SWFUpload.FILE_STATUS.COMPLETE;this.store.getById(b.id).set("status",2)}else{this.store.getById(b.id).set("status",3);this.store.getById(b.id).commit();if(c.msg){Ext.MessageBox.alert(this.strings.text_error,c.msg)}}this.fireEvent("fileUploadSuccess",this,b,c)},uploadComplete:function(a){if(this.debug){console.info("UPLOAD COMPLETE")}this.progress_bar.reset();this.progress_bar.updateText(this.strings.text_progressbar);if(this.suo.getStats().files_queued&&!this.upload_cancelled){this.suo.startUpload()}else{this.fireEvent("fileUploadComplete",this,a);this.allUploadsComplete()}},allUploadsComplete:function(){this.cancelBtn.hide();this.addBtn.show();this.clearBtn.show();this.fireEvent("allUploadsComplete",this)},addPostParam:function(a,b){if(this.suo){this.suo.settings.post_params[a]=b;this.suo.setPostParams(this.suo.settings.post_params)}else{this.post_params[a]=b}},startUpload:function(){if(this.debug){console.info("START UPLOAD")}this.cancelBtn.show();this.uploadBtn.hide();this.clearBtn.hide();this.upload_cancelled=false;this.fireEvent("startUpload",this);this.suo.startUpload()},stopUpload:function(a){if(this.debug){console.info("STOP UPLOAD")}this.suo.stopUpload();this.upload_cancelled=true;this.getStore().each(function(){if(this.data.status==1){this.set("status",0);this.commit()}});this.cancelBtn.hide();if(this.suo.getStats().files_queued>0){this.uploadBtn.show()}this.addBtn.show();this.clearBtn.show();this.progress_bar.reset();this.progress_bar.updateText(this.strings.text_progressbar)},removeFiles:function(){if(this.debug){console.info("REMOVE FILES")}var b=this.getSelectionModel().getSelections();for(var a=0;a<b.length;a++){if(b[a].data.status!=1){this.suo.cancelUpload(b[a].id);this.store.remove(b[a])}}if(this.suo.getStats().files_queued===0){}this.fireEvent("removeFiles",this)},removeAllFiles:function(){if(this.debug){console.info("REMOVE ALL")}var a=this.suo.getStats().files_queued;while(a>0){this.suo.cancelUpload();a=this.suo.getStats().files_queued}this.store.removeAll();this.cancelBtn.hide();this.uploadBtn.hide();this.fireEvent("removeAllFiles",this)}});GO.UploadFlashDialog=function(a){if(!a){a={}}this.uploadPanel=a.uploadPanel;a.items=[this.uploadPanel];a.layout="fit";a.maximizable=true;a.modal=false;a.width=500;a.height=400;a.resizable=false;a.minizable=true;a.closeAction="hide";a.html="items";a.buttons=[{text:GO.lang.uploadFiles,handler:function(){if(this.uploadPanel.store.getCount()>0){this.uploadPanel.startUpload()}else{this.hide()}},scope:this},{text:GO.lang.cmdCancel,handler:function(){this.uploadPanel.removeAllFiles();this.hide()},scope:this}];GO.UploadFlashDialog.superclass.constructor.call(this,a);this.addEvents({fileUploadSuccess:true,fileUploadComplete:true});this.uploadPanel.on("fileUploadSuccess",function(d,b,c){this.fireEvent("fileUploadSuccess",d,b,c)},this);this.uploadPanel.on("fileUploadComplete",function(){this.removeAllFiles()});this.uploadPanel.on("fileUploadComplete",function(){this.fireEvent("fileUploadComplete");this.hide()},this);this.uploadPanel.on("swfUploadLoaded",function(){},this)};Ext.extend(GO.UploadFlashDialog,Ext.Window,{show:function(){if(!this.rendered){this.render(Ext.getBody())}GO.UploadFlashDialog.superclass.show.call(this)}});GO.UploadPCForm=function(a){if(!a){a={}}if(!a.addText){a.addText=GO.email.lang.attachFilesPC}if(!a.iconCls){a.iconCls="btn-computer go-upload-pc-form"}a.width=200;this.uploadFile=new GO.form.UploadFile({addText:a.addText,cls:"email-upload-pc",inputName:"attachments",createNoRows:true}),this.uploadFile.on("fileAdded",function(c,b){this.uploadHandler()},this);a.border=false;a.fileUpload=true;a.autoScroll=true;a.items=[this.uploadFile];GO.UploadPCForm.superclass.constructor.call(this,a);this.addEvents({upload:true})};Ext.extend(GO.UploadPCForm,Ext.form.FormPanel,{uploadHandler:function(){this.form.submit({waitMsg:GO.lang.waitMsgUpload,success:function(b,c){this.uploadFile.clearQueue();var a=(c.result.files)?c.result.files[0]:c.result.file;this.fireEvent("upload",this,a)},failure:function(b,c){this.uploadFile.clearQueue();var a="";if(c.failureType=="client"){a=GO.lang.strErrorsInForm}else{a=c.result.feedback}Ext.MessageBox.alert(GO.lang.strError,a)},scope:this})}});GO.ExportQueryDialog=Ext.extend(Ext.Window,{customTypes:[],initComponent:function(){this.formPanelItems[0].items=[{boxLabel:"CSV",name:"type",inputValue:"csv_export_query",checked:true},{boxLabel:"PDF",name:"type",inputValue:"pdf_export_query",supportsOrientation:true},{boxLabel:GO.lang.toScreen,name:"type",inputValue:"html_export_query"},this.hiddenParamsField=new Ext.form.Hidden({name:"params"})];if(this.query&&GO.customexports[this.query]){for(var b=0;b<GO.customexports[this.query].length;b++){this.formPanelItems[0].items.push({boxLabel:GO.customexports[this.query][b].name,name:"type",inputValue:GO.customexports[this.query][b].cls})}}for(var b=0,a=this.customTypes.length;b<a;b++){this.formPanelItems[0].items.push(this.customTypes[b])}if(!this.title){this.title=GO.lang.cmdExport}Ext.apply(this,{items:this.formPanel=new Ext.FormPanel({url:BaseHref+"export_query.php",items:this.formPanelItems,bodyStyle:"padding:5px"}),autoHeight:true,closeAction:"hide",closeable:true,height:400,width:400,buttons:[{text:GO.lang.strEmail,handler:function(){this.hide();this.beforeRequest();GO.email.showComposer({loadUrl:BaseHref+"json.php",loadParams:this.loadParams})},scope:this},{text:GO.lang.download,handler:function(){this.beforeRequest();this.formPanel.form.standardSubmit=true;this.formPanel.form.getEl().dom.target="_blank";this.hiddenParamsField.setValue(Ext.encode(this.loadParams));this.formPanel.form.el.dom.target="_blank";this.formPanel.form.submit({url:BaseHref+"export_query.php",params:this.loadParams});this.hide()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});GO.ExportQueryDialog.superclass.initComponent.call(this)},loadParams:{},downloadUrl:"",showAllFields:false,formPanelItems:[{autoHeight:true,xtype:"radiogroup",fieldLabel:GO.lang.strType,listeners:{scope:this,change:function(b,a){this.orientationCombo.setDisabled(!a.supportsOrientation)}},columns:2,items:[]},{xtype:"checkbox",name:"export_hidden",hideLabel:true,boxLabel:GO.lang.exportHiddenColumns},this.orientationCombo=new GO.form.ComboBox({xtype:"combo",disabled:true,fieldLabel:GO.lang.orientation,hiddenName:"orientation",store:new Ext.data.SimpleStore({fields:["value","text"],data:[["L",GO.lang.landscape],["P",GO.lang.portrait]]}),value:"landscape",valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true})],show:function(a){GO.ExportQueryDialog.superclass.show.call(this);var a=a||{};Ext.apply(this,a)},beforeRequest:function(){var d=[];var f=(this.showAllFields)?true:this.formPanel.form.findField("export_hidden").getValue();if(this.colModel){for(var b=0;b<this.colModel.getColumnCount();b++){var e=this.colModel.config[b];if((f||!e.hidden)&&!e.hideInExport){d.push(e.dataIndex+":"+e.header)}}}if(GO.util.empty(this.title)){this.title=this.query}Ext.apply(this.loadParams,{task:"email_export_query",query:this.query,columns:d.join(","),title:this.title});if(this.subtitle){this.loadParams.subtitle=this.subtitle}if(this.text){this.loadParams.text=this.text}if(this.html){this.loadParams.html=this.html}var a=this.formPanel.form.getValues();Ext.apply(this.loadParams,a)}});Ext.ns("GO.advancedquery");GO.advancedquery.AdvancedQueryPanel=function(b){if(!b){b={}}b.tbar=[{handler:function(){Ext.Msg.prompt(GO.lang.searchQueryName,GO.lang.enterSearchQueryName,function(c,d){Ext.Ajax.request({url:BaseHref+"action.php",params:{task:"save_advanced_query",sql:this.searchQueryPanel.queryField.getValue(),type:this.type,name:d},success:function(e,f){var g=Ext.decode(e.responseText);if(!g.success){alert(g.feedback)}else{this.savedQueryGrid.store.load()}},scope:this})},this)},iconCls:"btn-save",cls:"x-btn-text-icon",text:GO.lang.cmdSave,scope:this},{handler:function(){this.searchQueryPanel.queryField.setValue("")},iconCls:"btn-delete",cls:"x-btn-text-icon",text:GO.lang.cmdReset,scope:this},"-",{iconCls:"btn-search",text:GO.lang.strSearch,handler:function(){var c="";var d=false;if(this.matchDuplicates){c=this.searchQueryPanel.matchDuplicatesCombo.getValue();d=this.searchQueryPanel.showFirstDuplicateOnlyCheckbox.getValue()}this.fireEvent("search",this.ownerCt,this.searchQueryPanel.queryField.getValue(),c,d)},scope:this}];var a=b.matchDuplicates?270:190;this.searchQueryPanel=new GO.advancedquery.SearchQueryPanel({region:"north",height:a,autoScroll:true,fieldsUrl:b.fieldsUrl,matchDuplicates:b.matchDuplicates,type:b.type});b.items=[this.searchQueryPanel];this.savedQueryGrid=new GO.advancedquery.SavedQueriesGrid({region:"center",type:b.type});b.items.push(this.savedQueryGrid);b.forceLayout=true;b.layout="border";b.modal=false;b.resizable=true;b.closeAction="hide";GO.advancedquery.AdvancedQueryPanel.superclass.constructor.call(this,b);this.addEvents({search:true})};Ext.extend(GO.advancedquery.AdvancedQueryPanel,Ext.Panel);GO.advancedquery.SearchQueryPanel=function(a){if(!a){a={}}this.typesStore=new GO.data.JsonStore({url:a.fieldsUrl,baseParams:{task:"advanced_query_fields"},root:"results",id:"name",fields:["name","value","type","fields","custom","id"],remoteSort:true});a.border=false;a.layout="form";a.labelAlign="top";a.defaults={border:false};a.bodyStyle="padding:5px;";this.queryField=new Ext.form.TextArea({name:"query",anchor:"-20",height:100,hideLabel:true});var b=[this.currentCriteriumField=this.criteriumComboBox=new GO.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value"],data:new Array()}),valueField:"value",displayField:"value",width:295,mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,hideLabel:true}),this.criteriumTextField=new Ext.form.TextField({hidden:true,name:"textfield",hideLabel:true,emptyText:GO.lang.keyword,width:295,panel:this}),this.criteriumFileField=new GO.files.SelectFile({filesFilter:"foldersonly",width:295,hidden:true}),this.criteriumUserField=new GO.form.SelectUser({allowBlank:true,width:295,hidden:true,listeners:{scope:this,select:function(d,c){d.setValue(c.data.id+":"+c.data.name)}}}),this.criteriumContactField=new GO.addressbook.SelectContact({width:295,hidden:true,listeners:{scope:this,select:function(d,c){d.setValue(c.data.id+":"+c.data.name)}}}),this.criteriumDatePanel=new Ext.Panel({border:false,style:"padding:0px;",hidden:true,width:295,items:[{name:"date",dataname:"date",xtype:"datefield",format:GO.settings.date_format,width:100}],hidden:true}),this.criteriumNumberPanel=new Ext.Panel({border:false,style:"padding:0px;",hidden:true,width:295,items:[{xtype:"numberfield",hideLabel:true,width:295}],hidden:true}),this.criteriumCheckboxPanel=new Ext.Panel({border:false,style:"padding:0px;",hidden:true,width:295,items:[{name:"checkbox",xtype:"xcheckbox",hideLabel:true}],hidden:true})];a.items=[this.queryField,{xtype:"compositefield",hideLabel:true,anchor:"-20",items:[this.operatorBox=new GO.form.ComboBox({store:new Ext.data.ArrayStore({idIndex:0,fields:["value"],data:[["AND"],["OR"]]}),value:"AND",valueField:"value",displayField:"value",name:"query_operator",width:60,mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true}),this.typesBox=new GO.form.ComboBox({store:this.typesStore,valueField:"value",displayField:"name",mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true,name:"query_type",flex:1}),this.comparatorBox=new Ext.form.ComboBox({store:new Ext.data.SimpleStore({fields:["value"],data:this.getComparators()}),name:"query_comparator",valueField:"value",displayField:"value",width:85,mode:"local",triggerAction:"all",editable:true,selectOnFocus:true,forceSelection:true})]},{hideLabel:true,anchor:"-20",layout:"table",defaults:{border:false},items:[{defaults:{border:false},items:this.criteriumPanel=new Ext.Panel({border:false,items:b})},{bodyStyle:"padding-left:5px;",items:new Ext.Button({handler:function(){var d=this.queryField.getValue();if(this.queryField.getValue()&&this.operatorBox.value){d=d+"\r\n"+this.operatorBox.value}if(this.typesBox.value){d=d+" "+this.typesBox.value}if(this.comparatorBox.value){d=d+" "+this.comparatorBox.value}if(this.currentCriteriumField.name=="checkbox"){if(this.currentCriteriumField.items.items[0].getValue()){d=d+" '1'"}else{d=d+" '0'"}}else{if(this.typesBox.getValue()=="`creation_time`"||this.typesBox.getValue()=="`last_modified_time`"){d=d+" unix_timestamp('"+this.currentCriteriumField.items.items[0].getValue().dateFormat("Y-m-d")+"')"}else{if(this.currentCriteriumField.items&&this.currentCriteriumField.items.items[0].name=="date"){d=d+" '"+this.currentCriteriumField.items.items[0].getValue().dateFormat("Y-m-d")+"'"}else{if(this.currentCriteriumField.name=="textfield"){var c=this.currentCriteriumField.getValue();if(c.substring(c.length-1)!="%"){}c=c+"%";if(c.substring(0,1)!="%"){}c="%"+c;d=d+" '"+c+"'"}else{if(typeof(this.currentCriteriumField.getValue)!="undefined"){d=d+" '"+this.currentCriteriumField.value+"'"}else{d=d+" '"+this.currentCriteriumField.items.items[0].getValue()+"'"}}}}}this.queryField.setValue(d)},text:"+",scope:this})}]}];if(a.matchDuplicates){a.items.push(this.matchDuplicatesCombo=new Ext.ux.form.SuperBoxSelect({allowAddNewData:true,xtype:"superboxselect",resizable:true,store:new GO.data.JsonStore({url:a.fieldsUrl,baseParams:{task:"advanced_query_fields",match_duplicates:true},root:"results",id:"name",fields:["name","value","type","fields","custom","id"],remoteSort:true}),removeValuesFromStore:false,mode:"remote",valueField:"value",displayField:"name",forceSelection:true,valueDelimiter:"|",hiddenName:"duplicate_fields[]",anchor:"-20",fieldLabel:GO.lang.matchDuplicates,hideLabel:false,queryDelay:0,triggerAction:"all"}));a.items.push(this.showFirstDuplicateOnlyCheckbox=new Ext.form.Checkbox({boxLabel:GO.lang.showFirstDuplicateOnly,name:"show_first_duplicate_only",hideLabel:true}))}GO.advancedquery.SearchQueryPanel.superclass.constructor.call(this,a);this.typesBox.on("select",function(e,c,d){this.typeChange(c)},this);this.typesBox.store.on("load",function(){this.typesBox.selectFirst();this.typeChange(this.typesBox.store.getAt(0));this.typesBox.originalValue=this.typesBox.getValue()},this);this.on("render",function(){this.typesStore.load()},this)};Ext.extend(GO.advancedquery.SearchQueryPanel,Ext.Panel,{criteriumFields:{},customCriteriumPanels:{},dynamicCriteriumPanels:{},typeChange:function(a){if(a.data.type=="combobox"){this.criteriumComboBox.store=new Ext.data.SimpleStore({fields:["value","text"],data:a.data.fields});this.criteriumComboBox.setValue(a.data.fields[0][0])}this.currentCriteriumField.hide();this.currentCriteriumField=this.getCriteriumField(a.data);if(this.currentCriteriumField.name=="textfield"){this.currentCriteriumField.reset()}this.currentCriteriumField.show();var b=this.getComparators(a.data);this.comparatorBox.store.loadData(b);this.comparatorBox.setValue(b[0][0]);this.comparatorBox.originalValue=this.comparatorBox.getValue()},getComparators:function(a){if(!a){var a={type:""}}switch(a.type){case"combobox":case"checkbox":case"file":case"user":case"contact":return[["INCLUDES"],["NOT INCLUDES"]];break;case"number":return[["INCLUDES"],["NOT INCLUDES"],[">"],["AT LEAST"],["<"],["AT MOST"]];break;case"date":return[["AT LEAST"],["AT MOST"],];break;default:return[["LIKE"],["NOT LIKE"],["INCLUDES"],["NOT INCLUDES"]];break}},getCriteriumField:function(a){if(!a){var a={type:"textfield"}}switch(a.type){case"combobox":return this.criteriumComboBox;break;case"file":return this.criteriumFileField;break;case"contact":return this.criteriumContactField;break;case"user":return this.criteriumUserField;break;case"date":return this.criteriumDatePanel;break;case"datetime":this.criteriumDatePanel.items.items[0].items.items[0].on("select",function(e,c){var b=this.criteriumDateTimePanel.items.items[0].items.items[1].value;var d=this.criteriumDateTimePanel.items.items[0].items.items[2].value;this.criteriumDateTimePanel.value=c},this);this.criteriumDateTimePanel.items.items[0].items.items[1].on("select",function(d,c){var e=this.criteriumDateTimePanel.items.items[0];var b=this.criteriumDateTimePanel.items.items[0].items.items[1].value;var f=this.criteriumDateTimePanel.items.items[0].items.items[2].value;e.add(Date.HOUR,b);e.add(Date.MINUTE,f);this.criteriumDateTimePanel.value=e},this);this.criteriumDateTimePanel.items.items[0].items.items[2].on("select",function(d,c){var e=this.criteriumDateTimePanel.items.items[0];var b=this.criteriumDateTimePanel.items.items[0].items.items[1].value;var f=this.criteriumDateTimePanel.items.items[0].items.items[2].value;e.add(Date.HOUR,b);e.add(Date.MINUTE,f);this.criteriumDateTimePanel.value=e},this);return this.criteriumDateTimePanel;break;case"number":return this.criteriumNumberPanel;break;case"checkbox":return this.criteriumCheckboxPanel;break;case"textfield":case"textarea":case"text":return this.criteriumTextField;break;default:if(a.custom){if(!this.customCriteriumPanels[a.id]){this.customCriteriumPanels[a.id]=this.criteriumPanel.add(GO.customfields.dataTypes[a.type].getFormField({id:a.id,name:a.type,dataname:""}));this.criteriumPanel.doLayout()}return this.customCriteriumPanels[a.id]}else{if(!this.dynamicCriteriumPanels[a.type]){this.dynamicCriteriumPanels[a.type]=this.criteriumPanel.add({xtype:a.type});this.criteriumPanel.doLayout()}return this.dynamicCriteriumPanels[a.type]}break}}});GO.advancedquery.SavedQueriesGrid=function(b){if(!b){b={}}b.title=GO.lang.savedQueries;b.border=true;b.store=new GO.data.JsonStore({url:BaseHref+"json.php",baseParams:{task:"saved_advanced_queries",type:b.type},root:"results",id:"id",fields:["id","name","sql"],remoteSort:true,autoLoad:true});var a=new Ext.grid.ColumnModel({defaults:{sortable:true},columns:[{header:GO.lang.strName,dataIndex:"name"}]});b.cm=a;b.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems}),b.sm=new Ext.grid.RowSelectionModel();b.loadMask=true;b.tbar=[{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.advancedquery.SavedQueriesGrid.superclass.constructor.call(this,b);this.on("rowdblclick",function(c,f,d){this.ownerCt.searchQueryPanel.queryField.setValue(c.store.data.items[f].data.sql)})};Ext.extend(GO.advancedquery.SavedQueriesGrid,GO.grid.GridPanel,{});GO.dialog.UsersInGroup=function(a){Ext.apply(this,a);this.store=new GO.data.JsonStore({url:GO.url("groups/group/getUsers"),baseParams:{id:0},root:"results",totalProperty:"total",id:"id",fields:["id","name","username"],remoteSort:true});this.searchField=new GO.form.SearchField({store:this.store,width:320});this.grid=new GO.grid.GridPanel({paging:true,border:false,store:this.store,view:new Ext.grid.GridView({autoFill:true,forceFit:true}),columns:[{header:GO.lang.strName,dataIndex:"name",sortable:true},{header:GO.lang.strUsername,dataIndex:"username",sortable:true}],sm:new Ext.grid.RowSelectionModel(),tbar:[GO.lang.strSearch+": "," ",this.searchField]});var b=function(){this.searchField.focus(true)};GO.dialog.UsersInGroup.superclass.constructor.call(this,{layout:"fit",modal:false,height:350,width:550,closeAction:"hide",focus:b.createDelegate(this),title:GO.lang.strUsersInGroup,items:this.grid,buttons:[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]})};Ext.extend(GO.dialog.UsersInGroup,Ext.Window,{setGroupId:function(a){this.grid.store.setBaseParam("id",a);this.grid.store.load()},show:function(){if(!this.grid.store.loaded){this.grid.store.load()}GO.dialog.UsersInGroup.superclass.show.call(this)},callHandler:function(a){if(this.handler){if(!this.scope){this.scope=this}var b=this.handler.createDelegate(this.scope,[this.grid]);b.call()}if(a){this.hide()}}});GO.dialog.TabbedFormDialog=Ext.extend(GO.Window,{remoteModelId:0,remoteModelIdName:"id",formControllerUrl:"undefined",customFieldType:0,permissionsPanel:false,_panels:false,initComponent:function(){Ext.applyIf(this,{collapsible:true,layout:"fit",modal:false,resizable:true,maximizable:true,width:600,height:400,closeAction:"hide",buttons:[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]});this._panels=[];this.buildForm();this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,border:false,baseParams:{}});this.addCustomFields();if(this._panels.length){this._tabPanel=new Ext.TabPanel({activeTab:0,enableTabScroll:true,deferredRender:false,border:false,anchor:"100% 100%",items:this._panels});this.formPanel.add(this._tabPanel)}this.items=this.formPanel;GO.dialog.TabbedFormDialog.superclass.initComponent.call(this);this.addEvents({submit:true})},focus:function(){var a=this._tabPanel?this._tabPanel.items.items[0]:this.formPanel;if(a){var b=a.items.items[0];if(b){b.focus()}}},addCustomFields:function(){if(this.customFieldType&&GO.customfields&&GO.customfields.types[this.customFieldType]){for(var a=0;a<GO.customfields.types[this.customFieldType].panels.length;a++){this.addPanel(GO.customfields.types[this.customFieldType].panels[a])}}},getSubmitParams:function(){},submitForm:function(a){this.formPanel.form.submit({url:this.formControllerUrl+"/submit",params:this.getSubmitParams(),waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.setRemoteModelId(c.result[this.remoteModelIdName]);if(this.permissionsPanel&&c.result[this.permissionsPanel.fieldName]){this.permissionsPanel.setAcl(c.result[this.permissionsPanel.fieldName])}this.afterSubmit(c);if(a){this.hide()}this.fireEvent("submit",this,this.remoteModelId);this.fireEvent("save",this,this.remoteModelId);if(this.link_config&&this.link_config.callback){this.link_config.callback.call(this)}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},beforeLoad:function(b,a){},afterLoad:function(c,a,b){},afterSubmit:function(a){},show:function(b,a){a=a||{};this.beforeLoad(b,a);this.formPanel.baseParams.tmp_files=a.tmp_files?Ext.encode(a.tmp_files):"";if(!this.rendered){this.render(Ext.getBody())}if(!b){b=0}delete this.link_config;this.formPanel.form.reset();if(this._tabPanel){this._tabPanel.items.items[0].show()}this.setRemoteModelId(b);if(this.remoteModelId>0){this.formPanel.load({url:this.formControllerUrl+"/load",success:function(d,g){if(g.result.remoteComboTexts){var c=g.result.remoteComboTexts;for(var j in c){var e=this.formPanel.form.findField(j);if(e){e.setRemoteText(c[j])}}}if(this.permissionsPanel&&g.result.data[this.permissionsPanel.fieldName]){this.permissionsPanel.setAcl(g.result.data[this.permissionsPanel.fieldName])}this.afterLoad(b,a,g);GO.dialog.TabbedFormDialog.superclass.show.call(this)},failure:function(c,d){Ext.Msg.alert(GO.lang.strError,d.result.feedback)},scope:this})}else{this.formPanel.form.setValues(a.values);if(this.permissionsPanel){this.permissionsPanel.setAcl(0)}this.afterLoad(b,a);GO.dialog.TabbedFormDialog.superclass.show.call(this)}if(this.selectLinkField&&a&&a.link_config){this.selectLinkField.container.up("div.x-form-item").setDisplayed(b==0);this.link_config=a.link_config;if(a.link_config.type_id){this.selectLinkField.setValue(a.link_config.type_id);this.selectLinkField.setRemoteText(a.link_config.text)}}},setRemoteModelId:function(a){this.formPanel.form.baseParams[this.remoteModelIdName]=a;this.remoteModelId=a},addPanel:function(a){this._panels.push(a)},addPermissionsPanel:function(a){this.permissionsPanel=a;this.addPanel(a)},buildForm:function(){}});