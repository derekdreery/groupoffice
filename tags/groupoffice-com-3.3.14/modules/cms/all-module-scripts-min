(function(){var addListener=function(){if(window.addEventListener){return function(el,eventName,fn,capture){el.addEventListener(eventName,fn,!!capture)}}else{if(window.attachEvent){return function(el,eventName,fn,capture){el.attachEvent("on"+eventName,fn)}}else{return function(){}}}}(),removeListener=function(){if(window.removeEventListener){return function(el,eventName,fn,capture){el.removeEventListener(eventName,fn,(capture))}}else{if(window.detachEvent){return function(el,eventName,fn){el.detachEvent("on"+eventName,fn)}}else{return function(){}}}}();var EV=Ext.lib.Event;var MIM;var MASK_TARGET="x-frame-mask-target";Ext.ux.ManagedIFrame=function(){var args=Array.prototype.slice.call(arguments,0),el=Ext.get(args[0]),config=args[0];if(el&&el.dom&&el.dom.tagName=="IFRAME"){config=args[1]||{}}else{config=args[0]||args[1]||{};el=config.autoCreate?Ext.get(Ext.DomHelper.append(config.autoCreate.parent||Ext.getBody(),Ext.apply({tag:"iframe",frameborder:0,src:(Ext.isIE&&Ext.isSecure)?Ext.SSL_SECURE_URL:"about:blank"},config.autoCreate))):null;if(el&&this.unsupportedText){Ext.DomHelper.append(el.dom.parentNode,{tag:"noframes",html:this.unsupportedText})}}if(!el||el.dom.tagName!="IFRAME"){return el}el.dom.name||(el.dom.name=el.dom.id);el.dom.ownerEl=el;this.addEvents({focus:true,blur:true,unload:true,domready:true,documentloaded:true,exception:true,message:true});if(config.listeners){this.listeners=config.listeners;Ext.ux.ManagedIFrame.superclass.constructor.call(this)}Ext.apply(el,this);el.addClass("x-managed-iframe");if(config.style){el.applyStyles(config.style)}Ext.apply(el,{disableMessaging:config.disableMessaging===true,loadMask:!!config.loadMask?Ext.apply({msg:"Loading..",maskEl:null,hideOnReady:false,disabled:false},config.loadMask):false,_windowContext:null,eventsFollowFrameLinks:typeof config.eventsFollowFrameLinks=="undefined"?true:config.eventsFollowFrameLinks});if(el.loadMask){el.loadMask.maskEl||(el.loadMask.maskEl=el.parent("."+MASK_TARGET)||el.parent());el.loadMask.maskEl.addClass(MASK_TARGET)}var um=el.updateManager=new Ext.UpdateManager(el,true);um.showLoadIndicator=config.showLoadIndicator||false;Ext.ux.ManagedIFrame.Manager.register(el);if(config.src){el.setSrc(config.src)}else{var content=config.html||config.content||false;if(content){el.reset(null,function(frame){frame.update.apply(el,[].concat(content))})}}return el};Ext.extend(Ext.ux.ManagedIFrame,Ext.util.Observable,{src:null,CSS:null,manager:null,disableMessaging:true,domReadyRetries:7500,resetUrl:(function(){if(Ext.isIE&&Ext.isSecure){return Ext.SSL_SECURE_URL}else{return"about:blank"}})(),unsupportedText:"Inline frames are NOT enabled/supported by your browser.",setSrc:function(url,discardUrl,callback,scope){if(url&&typeof url=="object"){callback=url.callback||false;discardUrl=url.discardUrl||false;url=url.url||false;scope=url.scope||null}var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=false;this.showMask();var s=this._targetURI=typeof src=="function"?src()||"":src;try{this._frameAction=true;this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;this.dom.src=s;this.frameInit=true;this.checkDOM()}catch(ex){this.fireEvent("exception",this,ex)}if(discardUrl!==true){this.src=src}return this},setLocation:function(url,discardUrl,callback,scope){if(url&&typeof url=="object"){callback=url.callback||false;discardUrl=url.discardUrl||false;url=url.url||false;scope=url.scope||null}var src=url||this.src||this.resetUrl;this._windowContext=null;this._unHook();this._frameAction=this.frameInit=this._domReady=false;this.showMask();var s=this._targetURI=typeof src=="function"?src()||"":src;try{this._frameAction=true;this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;this.getWindow().location.replace(s);this.frameInit=true;this.checkDOM()}catch(ex){this.fireEvent("exception",this,ex)}if(discardUrl!==true){this.src=src}return this},reset:function(src,callback,scope){this._unHook();var loadMaskOff=false;if(this.loadMask){loadMaskOff=this.loadMask.disabled;this.loadMask.disabled=false}this._callBack=function(frame){if(frame.loadMask){frame.loadMask.disabled=loadMaskOff}frame._frameAction=false;frame.frameInit=true;this._isReset=false;if(callback){callback.call(scope||window,frame)}};this.hideMask(true);this._frameAction=false;this.frameInit=true;this._isReset=true;var s=src;if(typeof src=="function"){s=src()}s=this._targetURI=Ext.isEmpty(s,true)?this.resetUrl:s;this.getWindow().location.href=s;return this},scriptRE:/(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)/gi,update:function(content,loadScripts,callback,scope){loadScripts=loadScripts||this.getUpdateManager().loadScripts||false;content=Ext.DomHelper.markup(content||"");content=loadScripts===true?content:content.replace(this.scriptRE,"");var doc;if((doc=this.getDocument())&&!!content.length){this._unHook();this._windowContext=this.src=null;this._targetURI=location.href;this.src=null;this.frameInit=true;this.showMask();this._callBack=typeof callback=="function"?callback.createDelegate(scope):null;doc.open();this._frameAction=true;doc.write(content);doc.close();this.checkDOM()}else{this.hideMask(true);if(callback){callback.call(scope,this)}}return this},disableMessaging:true,_XFrameMessaging:function(){var tagStack={"$":[]};var isEmpty=function(v,allowBlank){return v===null||v===undefined||(!allowBlank?v==="":false)};var apply=function(o,c,defaults){if(defaults){apply(o,defaults)}if(o&&c&&typeof c=="object"){for(var p in c){o[p]=c[p]}}return o};window.sendMessage=function(message,tag,origin){var MIF;if(MIF=arguments.callee.manager){if(message._fromHost){var fn,result;var compTag=message.tag||tag||null;var mstack=!isEmpty(compTag)?tagStack[compTag.toLowerCase()]||[]:tagStack["$"];for(var i=0,l=mstack.length;i<l;i++){if(fn=mstack[i]){result=fn.apply(fn.__scope,arguments)===false?false:result;if(fn.__single){mstack[i]=null}if(result===false){break}}}return result}else{message={type:isEmpty(tag)?"message":"message:"+tag.toLowerCase().replace(/^\s+|\s+$/g,""),data:message,domain:origin||document.domain,uri:document.documentURI,source:window,tag:isEmpty(tag)?null:tag.toLowerCase()};try{return MIF.disableMessaging!==true?MIF.fireEvent.call(MIF,message.type,MIF,message):null}catch(ex){}return null}}};window.onhostmessage=function(fn,scope,single,tag){if(typeof fn=="function"){if(!isEmpty(fn.__index)){throw"onhostmessage: duplicate handler definition"+(tag?" for tag:"+tag:"")}var k=isEmpty(tag)?"$":tag.toLowerCase();tagStack[k]||(tagStack[k]=[]);apply(fn,{__tag:k,__single:single||false,__scope:scope||window,__index:tagStack[k].length});tagStack[k].push(fn)}else{throw"onhostmessage: function required"}};window.unhostmessage=function(fn){if(typeof fn=="function"&&typeof fn.__index!="undefined"){var k=fn.__tag||"$";tagStack[k][fn.__index]=null}}},getHistory:function(){var h=null;try{h=this.getWindow().history}catch(eh){}return h},get:function(el){return MIM.El.get(this,el)},fly:function(el,named){named=named||"_global";el=this.getDom(el);if(!el){return null}if(!MIM._flyweights[named]){MIM._flyweights[named]=new Ext.Element.Flyweight()}MIM._flyweights[named].dom=el;return MIM._flyweights[named]},getDom:function(el){var d;if(!el||!(d=this.getDocument())){return null}return el.dom?el.dom:(typeof el=="string"?d.getElementById(el):el)},select:function(selector,unique){var d;return(d=this.getDocument())?Ext.Element.select(selector,unique,d):null},query:function(selector){var d;return(d=this.getDocument())?Ext.DomQuery.select(selector,d):null},getDoc:function(){return this.get(this.getDocument())},removeNode:function(node){MIM.removeNode(this,this.getDom(node))},_unHook:function(){var elcache,h=MIM.getFrameHash(this)||{};if(this._hooked){if(h&&(elcache=h.elCache)){for(var id in elcache){var el=elcache[id];if(el.removeAllListeners){el.removeAllListeners()}delete elcache[id]}if(h.docEl){h.docEl.removeAllListeners();h.docEl=null;delete h.docEl}}var w;if(this._frameProxy&&(w=this.getWindow())){removeListener(w,"focus",this._frameProxy);removeListener(w,"blur",this._frameProxy);removeListener(w,"resize",this._frameProxy);removeListener(w,"unload",this._frameProxy)}}this._hooked=this._domReady=this._domFired=this._frameAction=false;MIM._flyweights={};this.CSS=this.CSS?this.CSS.destroy():null},_renderHook:function(){this._windowContext=null;this.CSS=this.CSS?this.CSS.destroy():null;this._hooked=false;try{if(this.writeScript('(function(){(window.hostMIF = parent.Ext.get("'+this.dom.id+'"))._windowContext='+(Ext.isIE?"window":"{eval:function(s){return eval(s);}}")+";})();")){this._frameProxy||(this._frameProxy=MIM.eventProxy.createDelegate(this));var w;if(w=this.getWindow()){addListener(w,"focus",this._frameProxy);addListener(w,"blur",this._frameProxy);addListener(w,"resize",this._frameProxy);addListener(w,"unload",this._frameProxy)}if(this.disableMessaging!==true){this.loadFunction({name:"XMessage",fn:this._XFrameMessaging},false,true);var sm;if(sm=w.sendMessage){sm.manager=this}}this.CSS=new CSSInterface(this.getDocument())}}catch(ex){console.warn(ex)}return(this._hooked=this.domWritable())},sendMessage:function(message,tag,origin){var win;if(this.disableMessaging!==true&&(win=this.getWindow())){tag||(tag=message.tag||"");tag=tag.toLowerCase();message=Ext.applyIf(message.data?message:{data:message},{type:Ext.isEmpty(tag)?"message":"message:"+tag,domain:origin||document.domain,uri:document.documentURI,source:window,tag:tag||null,_fromHost:this});return win.sendMessage?win.sendMessage.call(null,message,tag,origin):null}return null},_windowContext:null,getDocument:function(){var win=this.getWindow(),doc=null;try{doc=(Ext.isIE&&win?win.document:null)||this.dom.contentDocument||window.frames[this.id].document||null}catch(gdEx){return false}return doc},getBody:function(){var d;return(d=this.getDocument())?d.body:null},getDocumentURI:function(){var URI,d;try{URI=this.src&&(d=this.getDocument())?d.location.href:null}catch(ex){}return URI||(typeof this.src=="function"?this.src():this.src)},getWindowURI:function(){var URI,w;try{URI=(w=this.getWindow())?w.location.href:null}catch(ex){}return URI||(typeof this.src=="function"?this.src():this.src)},getWindow:function(){var dom=this.dom,win=null;try{win=dom.contentWindow||window.frames[dom.name]||null}catch(gwEx){}return win},print:function(){var win;try{if(win=this.getWindow()){if(Ext.isIE){win.focus()}win.print()}}catch(ex){throw"print exception: "+(ex.description||ex.message||ex)}},destroy:function(){this.removeAllListeners();if(this.loadMask){this.hideMask(true);Ext.apply(this.loadMask,{masker:null,maskEl:null})}if(this.dom){Ext.ux.ManagedIFrame.Manager.deRegister(this);this.dom.ownerEl=this._windowContext=null;if(Ext.isIE&&this.dom.src){this.dom.src="javascript:false"}this._maskEl=null;this.remove()}},domWritable:function(){return !!this._windowContext},execScript:function(block,useDOM){try{if(this.domWritable()){if(useDOM){this.writeScript(block)}else{return this._windowContext.eval(block)}}else{throw"execScript:non-secure context"}}catch(ex){this.fireEvent("exception",this,ex);return false}return true},writeScript:function(block,attributes){attributes=Ext.apply({},attributes||{},{type:"text/javascript",text:block});try{var head,script,doc=this.getDocument();if(doc&&typeof doc.getElementsByTagName!="undefined"){if(!(head=doc.getElementsByTagName("head")[0])){head=doc.createElement("head");doc.getElementsByTagName("html")[0].appendChild(head)}if(head&&(script=doc.createElement("script"))){for(var attrib in attributes){if(attributes.hasOwnProperty(attrib)&&attrib in script){script[attrib]=attributes[attrib]}}return !!head.appendChild(script)}}}catch(ex){this.fireEvent("exception",this,ex)}return false},loadFunction:function(fn,useDOM,invokeIt){var name=fn.name||fn;var fn=fn.fn||window[fn];this.execScript(name+"="+fn,useDOM);if(invokeIt){this.execScript(name+"()")}},mask:function(msg,msgCls,maskCls){this._mask&&this.unmask();var p=this.parent("."+MASK_TARGET)||this.parent();if(p.getStyle("position")=="static"&&!p.select("iframe,frame,object,embed").elements.length){p.addClass("x-masked-relative")}p.addClass("x-masked");this._mask=Ext.DomHelper.append(p,{cls:maskCls||"ext-el-mask"},true);this._mask.setDisplayed(true);this._mask._agent=p;var delay=(this.loadMask?this.loadMask.delay:0)||10;if(typeof msg=="string"){this._maskMsg=Ext.DomHelper.append(p,{cls:msgCls||"ext-el-mask-msg x-mask-loading",style:{visibility:"hidden"},cn:{tag:"div",html:msg}},true);this._maskMsg.setVisibilityMode(Ext.Element.VISIBILITY);(function(){this._mask&&this._maskMsg&&this._maskMsg.center(p).setVisible(true)}).defer(delay,this)}if(Ext.isIE&&!(Ext.isIE7&&Ext.isStrict)&&this.getStyle("height")=="auto"){this._mask.setSize(undefined,this._mask.getHeight())}return this._mask},unmask:function(){var a;if(this._mask){(a=this._mask._agent)&&a.removeClass(["x-masked-relative","x-masked"]);if(this._maskMsg){this._maskMsg.remove();delete this._maskMsg}this._mask.remove();delete this._mask}},showMask:function(msg,msgCls,maskCls){var lmask=this.loadMask;if(lmask&&!lmask.disabled&&!this._mask){this.mask(msg||lmask.msg,msgCls||lmask.msgCls,maskCls||lmask.maskCls)}},hideMask:function(forced){var tlm=this.loadMask;if(tlm&&!!this._mask){if(forced||(tlm.hideOnReady&&this._domReady)){this.unmask()}}},submitAsTarget:function(submitCfg){var opt=submitCfg||{},D=document;var form=opt.form||Ext.DomHelper.append(D.body,{tag:"form",cls:"x-hidden"});form=Ext.getDom(form.form||form);form.target=this.dom.name;form.method=opt.method||"POST";opt.encoding&&(form.enctype=form.encoding=String(opt.encoding));opt.url&&(form.action=opt.url);var hiddens,hd;if(opt.params){hiddens=[];var ps=typeof opt.params=="string"?Ext.urlDecode(params,false):opt.params;for(var k in ps){if(ps.hasOwnProperty(k)){hd=D.createElement("input");hd.type="hidden";hd.name=k;hd.value=ps[k];form.appendChild(hd);hiddens.push(hd)}}}this._callBack=typeof opt.callback=="function"?opt.callback.createDelegate(opt.scope):null;this._frameAction=this.frameInit=true;this._targetURI=location.href;this.showMask();(function(){form.submit();hiddens&&Ext.each(hiddens,Ext.removeNode,Ext);Ext.fly(form,"_dynaForm").hasClass("x-hidden")&&Ext.removeNode(form);this.hideMask(true)}).defer(100,this)},loadHandler:function(e,target){target||(target={});var rstatus=(e&&typeof e.type!=="undefined"?e.type:this.dom.readyState);if(!this.frameInit||(!this._frameAction&&!this.eventsFollowFrameLinks)){return}switch(rstatus){case"domready":var M;try{M=this.getWindow()?this.getWindow().hostMIF:null}catch(access){}if(this._frameAction&&!M){this.frameInit&&this._renderHook()&&this.fireEvent.defer(1,this,["domready",this]);this._domFired=this._hooked}case"domfail":this._domReady=true;this.hideMask();break;case"load":case"complete":if(!this._domFired){this.loadHandler({type:"domready",id:this.id},this.dom)}Ext.isIE&&this.getWindow()&&this.getWindow().focus();if(this._frameAction||this.eventsFollowFrameLinks){this.fireEvent.defer(1,this,["documentloaded",this]);if(this._callBack){this._callBack.defer(1,null,[this])}}this._frameAction=this.frameInit=false;if(this.eventsFollowFrameLinks){this._domFired=this._domReady=false}this.hideMask(true);break;default:}this.frameState=rstatus},checkDOM:function(win){if(Ext.isOpera||Ext.isGecko||!this._frameAction){return}var n=0,manager=this,domReady=false,b,l,d,max=this.domReadyRetries,polling=false,startLocation=(this.getDocument()||{location:{}}).location.href;(function(){d=manager.getDocument()||{location:{}};polling=(d.location.href!==startLocation||d.location.href===manager._targetURI);if(!manager._frameAction||manager._domReady){return}domReady=polling&&((b=manager.getBody())&&!!(b.innerHTML||"").length)||false;if(d.location.href&&!domReady&&(++n<max)){setTimeout(arguments.callee,2);return}manager.loadHandler({type:domReady?"domready":"domfail"})})()}});var styleCamelRe=/(-[a-z])/gi;var styleCamelFn=function(m,a){return a.charAt(1).toUpperCase()};var CSSInterface=function(hostDocument){var doc;if(hostDocument){doc=hostDocument;return{rules:null,destroy:function(){return doc=null},createStyleSheet:function(cssText,id){var ss;if(!doc){return}var head=doc.getElementsByTagName("head")[0];var rules=doc.createElement("style");rules.setAttribute("type","text/css");if(id){rules.setAttribute("id",id)}if(Ext.isIE){head.appendChild(rules);ss=rules.styleSheet;ss.cssText=cssText}else{try{rules.appendChild(doc.createTextNode(cssText))}catch(e){rules.cssText=cssText}head.appendChild(rules);ss=rules.styleSheet?rules.styleSheet:(rules.sheet||doc.styleSheets[doc.styleSheets.length-1])}this.cacheStyleSheet(ss);return ss},removeStyleSheet:function(id){if(!doc){return}var existing=doc.getElementById(id);if(existing){existing.parentNode.removeChild(existing)}},swapStyleSheet:function(id,url){this.removeStyleSheet(id);if(!doc){return}var ss=doc.createElement("link");ss.setAttribute("rel","stylesheet");ss.setAttribute("type","text/css");ss.setAttribute("id",id);ss.setAttribute("href",url);doc.getElementsByTagName("head")[0].appendChild(ss)},refreshCache:function(){return this.getRules(true)},cacheStyleSheet:function(ss){if(this.rules){this.rules={}}try{var ssRules=ss.cssRules||ss.rules;for(var j=ssRules.length-1;j>=0;--j){this.rules[ssRules[j].selectorText]=ssRules[j]}}catch(e){}},getRules:function(refreshCache){if(this.rules==null||refreshCache){this.rules={};if(doc){var ds=doc.styleSheets;for(var i=0,len=ds.length;i<len;i++){try{this.cacheStyleSheet(ds[i])}catch(e){}}}}return this.rules},getRule:function(selector,refreshCache){var rs=this.getRules(refreshCache);if(!Ext.isArray(selector)){return rs[selector]}for(var i=0;i<selector.length;i++){if(rs[selector[i]]){return rs[selector[i]]}}return null},updateRule:function(selector,property,value){if(!Ext.isArray(selector)){var rule=this.getRule(selector);if(rule){rule.style[property.replace(styleCamelRe,styleCamelFn)]=value;return true}}else{for(var i=0;i<selector.length;i++){if(this.updateRule(selector[i],property,value)){return true}}}return false}}}};Ext.ux.ManagedIframePanel=Ext.extend(Ext.Panel,{defaultSrc:null,bodyStyle:{position:"relative"},frameStyle:{overflow:"auto"},frameConfig:null,hideMode:!Ext.isIE?"nosize":"display",shimCls:"x-frame-shim",shimUrl:null,loadMask:false,stateful:false,animCollapse:Ext.isIE&&Ext.enableFx,autoScroll:false,closable:true,ctype:"Ext.ux.ManagedIframePanel",showLoadIndicator:false,unsupportedText:"Inline frames are NOT enabled/supported by your browser.",initComponent:function(){var f=this.frameConfig?this.frameConfig.autoCreate||this.frameConfig:{};var frCfg=Ext.apply(f,{id:f.id||Ext.id()});frCfg.name=f.name||frCfg.id;if(Ext.isIE&&Ext.isSecure){frCfg.src=Ext.SSL_SECURE_URL}var frameTag=Ext.apply({tag:"iframe",frameborder:0,cls:"x-managed-iframe",style:this.frameStyle||f.style||{}},frCfg);var unsup=this.unsupportedText?{tag:"noframes",html:this.unsupportedText}:[];this.bodyCfg||(this.bodyCfg={cls:this.baseCls+"-body",children:this.contentEl?[]:[frameTag].concat(unsup)});this.autoScroll=false;this.items=null;if(this.stateful!==false){this.stateEvents||(this.stateEvents=["documentloaded"])}Ext.ux.ManagedIframePanel.superclass.initComponent.call(this);this.monitorResize||(this.monitorResize=!!this.fitToParent);this.addEvents({documentloaded:true,domready:true,message:true,exception:true,blur:true,focus:true});this.addListener=this.on},doLayout:function(){if(this.fitToParent&&!this.ownerCt){var pos=this.getPosition(),size=(Ext.get(this.fitToParent)||this.getEl().parent()).getViewSize();this.setSize(size.width-pos[0],size.height-pos[1])}Ext.ux.ManagedIframePanel.superclass.doLayout.apply(this,arguments)},beforeDestroy:function(){if(this.rendered){if(this.tools){for(var k in this.tools){Ext.destroy(this.tools[k])}}if(this.header&&this.headerAsText){var s;if(s=this.header.child("span")){s.remove(true,true)}this.header.update("")}Ext.each(["iframe","shim","header","topToolbar","bottomToolbar","footer","loadMask","body","bwrap"],function(elName){if(this[elName]){if(typeof this[elName].destroy=="function"){this[elName].destroy()}else{Ext.destroy(this[elName])}this[elName]=null;delete this[elName]}},this)}Ext.ux.ManagedIframePanel.superclass.beforeDestroy.call(this)},onDestroy:function(){Ext.Panel.superclass.onDestroy.call(this)},afterRender:function(container){var html=this.html;delete this.html;Ext.ux.ManagedIframePanel.superclass.afterRender.apply(this,arguments);if(this.iframe=this.body.child("iframe")){this.iframe.ownerCt=this;if(this.loadMask){var mEl;if(mEl=this.loadMask.maskEl){(this[mEl]||mEl||this.body).addClass(MASK_TARGET)}this.loadMask=Ext.apply({disabled:false,hideOnReady:false},this.loadMask)}this.getUpdater().showLoadIndicator=this.showLoadIndicator||false;var ownerCt=this.ownerCt;while(ownerCt){ownerCt.on("afterlayout",function(container,layout){var MIM=Ext.ux.ManagedIFrame.Manager,st=false;Ext.each(["north","south","east","west"],function(region){var reg;if((reg=layout[region])&&reg.splitEl){st=true;if(!reg.split._splitTrapped){reg.split.on("beforeresize",MIM.showShims,MIM);reg.split._splitTrapped=true}}},this);if(st&&!this._splitTrapped){this.on("resize",MIM.hideShims,MIM);this._splitTrapped=true}},this,{single:true});ownerCt=ownerCt.ownerCt}this.shim=Ext.get(this.body.child("."+this.shimCls))||Ext.DomHelper.append(this.body,{tag:"img",src:this.shimUrl||Ext.BLANK_IMAGE_URL,cls:this.shimCls,galleryimg:"no"},true);var El=Ext.Element;var mode=El[this.hideMode.toUpperCase()]||"x-hide-nosize";Ext.each([this[this.collapseEl],this.floating?null:this.getActionEl(),this.iframe],function(el){if(el){el.setVisibilityMode(mode)}},this);if(this.iframe=new Ext.ux.ManagedIFrame(this.iframe,{loadMask:this.loadMask,showLoadIndicator:this.showLoadIndicator,disableMessaging:this.disableMessaging,style:this.frameStyle,src:this.defaultSrc,html:html})){this.loadMask=this.iframe.loadMask;this.iframe.ownerCt=this;this.relayEvents(this.iframe,["blur","focus","unload","documentloaded","domready","exception","message"].concat(this._msgTagHandlers||[]));delete this._msgTagHandlers}}},sendMessage:function(){if(this.iframe){this.iframe.sendMessage.apply(this.iframe,arguments)}},filterOptRe:/^(?:scope|delay|buffer|single|stopEvent|preventDefault|stopPropagation|normalized|args|delegate)$/,on:function(name){var tagRE=/^message\:/i,n=null;if(typeof name=="object"){for(var na in name){if(!this.filterOptRe.test(na)&&tagRE.test(na)){n||(n=[]);n.push(na.toLowerCase())}}}else{if(tagRE.test(name)){n=[name.toLowerCase()]}}if(this.getFrame()&&n){this.relayEvents(this.iframe,n)}else{this._msgTagHandlers||(this._msgTagHandlers=[]);if(n){this._msgTagHandlers=this._msgTagHandlers.concat(n)}}Ext.ux.ManagedIframePanel.superclass.on.apply(this,arguments)},setSrc:function(url,discardUrl,callback,scope){url=url||this.defaultSrc||false;if(url&&this.rendered&&this.iframe){this.iframe.setSrc.call(this.iframe,url,discardUrl,callback,scope)}return this},setLocation:function(url,discardUrl,callback,scope){url=url||this.defaultSrc||false;if(url&&this.rendered&&this.iframe){this.iframe.setLocation.call(this.iframe,url,discardUrl,callback,scope)}return this},getState:function(){var URI=this.iframe?this.iframe.getDocumentURI()||null:null;return Ext.apply(Ext.ux.ManagedIframePanel.superclass.getState.call(this)||{},URI?{defaultSrc:typeof URI=="function"?URI():URI}:null)},getUpdater:function(){return this.rendered?(this.iframe||this.body).getUpdater():null},getFrame:function(){return this.rendered?this.iframe:null},getFrameWindow:function(){return this.rendered&&this.iframe?this.iframe.getWindow():null},getFrameDocument:function(){return this.rendered&&this.iframe?this.iframe.getDocument():null},getFrameDoc:function(){return this.rendered&&this.iframe?this.iframe.getDoc():null},getFrameBody:function(){return this.rendered&&this.iframe?this.iframe.getBody():null},load:function(loadCfg){var um;if(um=this.getUpdater()){if(loadCfg&&loadCfg.renderer){um.setRenderer(loadCfg.renderer);delete loadCfg.renderer}um.update.apply(um,arguments)}return this},doAutoLoad:function(){this.load(typeof this.autoLoad=="object"?this.autoLoad:{url:this.autoLoad})}});Ext.ux.ManagedIFrame.Manager=MIM=function(){var frames={};var implementation={readyHandler:function(e){try{var $frame=e.target.ownerEl;if($frame&&$frame._frameAction){$frame.loadHandler.call($frame,{type:"domready"})}}catch(rhEx){return}},shimCls:"x-frame-shim",register:function(frame){frame.manager=this;frames[frame.id]=frames[frame.dom.name]={ref:frame,elCache:{}};frame.dom[Ext.isIE?"onreadystatechange":"onload"]=frame.loadHandler.createDelegate(frame);return frame},deRegister:function(frame){frame._unHook();frame.dom.onload=frame.dom.onreadystatechange=null;delete frames[frame.id];delete frames[frame.dom.name]},hideShims:function(){if(!this.shimApplied){return}Ext.select("."+this.shimCls,true).removeClass(this.shimCls+"-on");this.shimApplied=false},showShims:function(){if(!this.shimApplied){this.shimApplied=true;Ext.select("."+this.shimCls,true).addClass(this.shimCls+"-on")}},getFrameById:function(id){return typeof id=="string"?(frames[id]?frames[id].ref||null:null):null},getFrameByName:function(name){return this.getFrameById(name)},getFrameHash:function(frame){return frame.id?frames[frame.id]:null},eventProxy:function(e){if(!e){return}e=Ext.EventObject.setEvent(e);var be=e.browserEvent||e;(e.type=="unload")&&this._unHook();if(!be.eventPhase||(be.eventPhase==(be.AT_TARGET||2))){return this.fireEvent(e.type,e)}},_flyweights:{},destroy:function(){if(document.addEventListener){window.removeEventListener("DOMFrameContentLoaded",this.readyHandler,true)}delete this._flyweights},removeNode:Ext.isIE?function(frame,n){frame=MIM.getFrameHash(frame);if(frame&&n&&n.tagName!="BODY"){d=frame.scratchDiv||(frame.scratchDiv=frame.getDocument().createElement("div"));d.appendChild(n);d.innerHTML=""}}:function(frame,n){if(n&&n.parentNode&&n.tagName!="BODY"){n.parentNode.removeChild(n)}}};if(document.addEventListener){window.addEventListener("DOMFrameContentLoaded",implementation.readyHandler,true)}Ext.EventManager.on(window,"beforeunload",implementation.destroy,implementation);return implementation}();MIM.showDragMask=MIM.showShims;MIM.hideDragMask=MIM.hideShims;MIM.El=function(frame,el,forceNew){var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});var dom=frame.getDom(el);if(!dom){return null}var id=dom.id;if(forceNew!==true&&id&&elCache[id]){return elCache[id]}this.dom=dom;this.id=id||Ext.id(dom)};MIM.El.get=function(frame,el){var ex,elm,id,doc;if(!frame||!el){return null}var frameObj;frame=(frameObj=MIM.getFrameHash(frame))?frameObj.ref:null;if(!frame){return null}var elCache=frameObj.elCache||(frameObj.elCache={});if(!(doc=frame.getDocument())){return null}if(typeof el=="string"){if(!(elm=frame.getDom(el))){return null}if(ex=elCache[el]){ex.dom=elm}else{ex=elCache[el]=new MIM.El(frame,elm)}return ex}else{if(el.tagName){if(!(id=el.id)){id=Ext.id(el)}if(ex=elCache[id]){ex.dom=el}else{ex=elCache[id]=new MIM.El(frame,el)}return ex}else{if(el instanceof MIM.El){if(el!=frameObj.docEl){el.dom=frame.getDom(el.id)||el.dom;elCache[el.id]=el}return el}else{if(el.isComposite){return el}else{if(Ext.isArray(el)){return frame.select(el)}else{if(el==doc){if(!frameObj.docEl){var f=function(){};f.prototype=MIM.El.prototype;frameObj.docEl=new f();frameObj.docEl.dom=doc}return frameObj.docEl}}}}}}return null};Ext.apply(MIM.El.prototype,Ext.Element.prototype);Ext.ns("Ext.ux.panel","Ext.ux.portlet");Ext.reg("iframepanel",Ext.ux.panel.ManagedIframe=Ext.ux.ManagedIframePanel);Ext.ux.ManagedIframePortlet=Ext.extend(Ext.ux.ManagedIframePanel,{anchor:"100%",frame:true,collapseEl:"bwrap",collapsible:true,draggable:true,cls:"x-portlet"});Ext.reg("iframeportlet",Ext.ux.portlet.ManagedIframe=Ext.ux.ManagedIframePortlet);Ext.apply(Ext.Element.prototype,{setVisible:function(visible,animate){if(!animate||!Ext.lib.Anim){if(this.visibilityMode==Ext.Element.DISPLAY){this.setDisplayed(visible)}else{if(this.visibilityMode==Ext.Element.VISIBILITY){this.fixDisplay();this.dom.style.visibility=visible?"visible":"hidden"}else{this[visible?"removeClass":"addClass"](String(this.visibilityMode))}}}else{var dom=this.dom;var visMode=this.visibilityMode;if(visible){this.setOpacity(0.01);this.setVisible(true)}this.anim({opacity:{to:(visible?1:0)}},this.preanim(arguments,1),null,0.35,"easeIn",function(){if(!visible){if(visMode==Ext.Element.DISPLAY){dom.style.display="none"}else{if(visMode==Ext.Element.VISIBILITY){dom.style.visibility="hidden"}else{Ext.get(dom).addClass(String(visMode))}}Ext.get(dom).setOpacity(1)}})}return this},isVisible:function(deep){var vis=!(this.hasClass(this.visibilityMode)||this.getStyle("visibility")=="hidden"||this.getStyle("display")=="none");if(deep!==true||!vis){return vis}var p=this.dom.parentNode;while(p&&p.tagName.toLowerCase()!="body"){if(!Ext.fly(p,"_isVisible").isVisible()){return false}p=p.parentNode}return true}});Ext.onReady(function(){var CSS=Ext.util.CSS,rules=[];CSS.getRule(".x-managed-iframe")||(rules.push(".x-managed-iframe {height:100%;width:100%;overflow:auto;position:relative;}"));CSS.getRule("."+MASK_TARGET)||(rules.push("."+MASK_TARGET+"{position:relative;zoom:1;}","."+MASK_TARGET+" .ext-el-mask-msg{z-index:101!important;} "));if(!CSS.getRule(".x-frame-shim")){rules.push(".x-frame-shim {z-index:8500;position:absolute;top:0px;left:0px;background:transparent!important;overflow:hidden;display:none;}");rules.push(".x-frame-shim-on{width:100%;height:100%;display:block;zoom:1;}");rules.push(".ext-ie6 .x-frame-shim{margin-left:5px;margin-top:3px;}")}CSS.getRule(".x-hide-nosize")||(rules.push(".x-hide-nosize,.x-hide-nosize *{height:0px!important;width:0px!important;border:none;}"));if(!!rules.length){CSS.createStyleSheet(rules.join(" "))}})})();if(Ext.provide){Ext.provide("miframe")}GO.cms.SitesDialog=function(a){if(!a){a={}}this.sitesGrid=new GO.cms.SitesGrid();a.layout="fit";a.modal=false;a.resizable=false;a.width=500;a.height=400;a.closeAction="hide";a.title=GO.cms.lang.sites;a.items=this.sitesGrid;a.buttons=[{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.cms.SitesDialog.superclass.constructor.call(this,a)};Ext.extend(GO.cms.SitesDialog,Ext.Window,{show:function(){if(!this.sitesGrid.store.loaded){this.sitesGrid.store.load()}GO.cms.SitesDialog.superclass.show.call(this)}});GO.cms.SitesGrid=function(a){if(!a){a={}}a.border=false;a.layout="fit";a.autoScroll=true;a.split=true;a.store=new GO.data.JsonStore({url:GO.settings.modules.cms.url+"json.php",baseParams:{task:"sites"},root:"results",id:"id",totalProperty:"total",fields:["id","user_name","acl_write","allow_properties","domain","webmaster","publish_style","publish_path","template_id","root_folder_id","start_file_id","language","name"],remoteSort:true});a.paging=true;var b=new Ext.grid.ColumnModel([{header:GO.lang.strName,dataIndex:"name"}]);b.defaultSortable=true;a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});a.sm=new Ext.grid.RowSelectionModel();a.loadMask=true;this.siteDialog=new GO.cms.SiteDialog();this.siteDialog.on("save",function(){this.store.reload()},this);a.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.siteDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.cms.SitesGrid.superclass.constructor.call(this,a);this.on("rowdblclick",function(e,f){var c=e.getStore().getAt(f);this.siteDialog.show(c.data.id)},this)};Ext.extend(GO.cms.SitesGrid,GO.grid.GridPanel,{loaded:false,afterRender:function(){GO.cms.SitesGrid.superclass.afterRender.call(this);if(this.isVisible()){this.onGridShow()}},onGridShow:function(){if(!this.loaded&&this.rendered){this.store.load();this.loaded=true}}});GO.cms.SiteDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.propertiesPanel.items.items[0].focus()};b.maximizable=true;b.layout="fit";b.modal=false;b.resizable=false;b.width=400;b.height=400;b.closeAction="hide";b.title=GO.cms.lang.site;b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.cms.SiteDialog.superclass.constructor.call(this,b);this.addEvents({save:true})};Ext.extend(GO.cms.SiteDialog,Ext.Window,{show:function(a){if(!this.rendered){this.render(Ext.getBody())}this.tabPanel.setActiveTab(0);if(!a){a=0}this.setSiteId(a);if(this.site_id>0){this.formPanel.load({url:GO.settings.modules.cms.url+"json.php",success:function(b,c){this.writePermissionsTab.setAcl(c.result.data.acl_write);GO.cms.SiteDialog.superclass.show.call(this)},failure:function(b,c){Ext.Msg.alert(GO.lang.strError,c.result.feedback)},scope:this})}else{this.formPanel.form.reset();this.writePermissionsTab.setAcl(0);GO.cms.SiteDialog.superclass.show.call(this)}},setSiteId:function(a){this.formPanel.form.baseParams.site_id=a;this.site_id=a},submitForm:function(a){this.formPanel.form.submit({url:GO.settings.modules.cms.url+"action.php",params:{task:"save_site"},waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.fireEvent("save",this);if(a){this.hide()}else{if(c.result.site_id){this.setSiteId(c.result.site_id);this.writePermissionsTab.setAcl(c.result.acl_write)}}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},buildForm:function(){this.propertiesPanel=new Ext.Panel({title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,layout:"form",autoScroll:true,items:[{xtype:"textfield",name:"name",anchor:"-20",allowBlank:false,fieldLabel:GO.lang.strName},{xtype:"textfield",name:"domain",anchor:"-20",allowBlank:false,fieldLabel:GO.cms.lang.domain},{xtype:"textfield",name:"webmaster",anchor:"-20",allowBlank:false,fieldLabel:GO.cms.lang.webmaster},new Ext.form.ComboBox({fieldLabel:GO.cms.lang.template,hiddenName:"template",store:new GO.data.JsonStore({fields:["name"],url:GO.settings.modules.cms.url+"json.php",root:"results",baseParams:{task:"templates"}}),valueField:"name",displayField:"name",mode:"remote",triggerAction:"all",editable:false,forceSelection:true,anchor:"-20",allowBlank:false}),new Ext.form.ComboBox({fieldLabel:GO.lang.strLanguage,name:"language",store:new Ext.data.SimpleStore({fields:["id","language"],data:GO.Languages}),displayField:"language",valueField:"id",hiddenName:"language",mode:"local",triggerAction:"all",editable:false,selectOnFocus:true,forceSelection:true,value:GO.settings.language}),{xtype:"plainfield",fieldLabel:GO.cms.lang.siteId,name:"id"}]});var a=[this.propertiesPanel];this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions});a.push(this.writePermissionsTab);this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:a,anchor:"100% 100%"});this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,url:GO.settings.modules.cms.url+"action.php",border:false,baseParams:{task:"site"},items:this.tabPanel})}});GO.cms.FoldersGrid=function(a){if(!a){a={}}a.title=GO.cms.lang.folders;a.layout="fit";a.autoScroll=true;a.split=true;a.store=new GO.data.JsonStore({url:GO.settings.modules.cms.url+"json.php",baseParams:{task:"folders",site_id:0},root:"results",id:"id",totalProperty:"total",fields:["id","parent_id","ctime","mtime","name","disabled","priority","multipage","template_item_id","acl"],remoteSort:true});a.paging=true;var b=new Ext.grid.ColumnModel([{header:GO.cms.lang.parentId,dataIndex:"parent_id"},{header:GO.lang.strCtime,dataIndex:"ctime"},{header:GO.lang.strMtime,dataIndex:"mtime"},{header:GO.lang.strName,dataIndex:"name"},{header:GO.cms.lang.disabled,dataIndex:"disabled"},{header:GO.cms.lang.priority,dataIndex:"priority"},{header:GO.cms.lang.multipage,dataIndex:"multipage"},{header:GO.cms.lang.templateItemId,dataIndex:"template_item_id"},{header:GO.cms.lang.acl,dataIndex:"acl"}]);b.defaultSortable=true;a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});a.sm=new Ext.grid.RowSelectionModel();a.loadMask=true;this.folderDialog=new GO.cms.FolderDialog();this.folderDialog.on("save",function(){this.store.reload()},this);a.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.folderDialog.show();this.folderDialog.formPanel.form.setValues({site_id:this.store.baseParams.site_id})},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.cms.FoldersGrid.superclass.constructor.call(this,a);this.on("rowdblclick",function(e,f){var c=e.getStore().getAt(f);this.folderDialog.show(c.data.id)},this)};Ext.extend(GO.cms.FoldersGrid,GO.grid.GridPanel,{});GO.cms.FolderDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.propertiesPanel.items.items[0].focus()};b.maximizable=true;b.layout="fit";b.modal=false;b.resizable=false;b.width=400;b.height=500;b.closeAction="hide";b.title=GO.cms.lang.folder;b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.cms.FolderDialog.superclass.constructor.call(this,b);this.addEvents({save:true})};Ext.extend(GO.cms.FolderDialog,Ext.Window,{nodeAttributes:[],show:function(a,c,b){if(!this.rendered){this.render(Ext.getBody())}this.tabPanel.setActiveTab(0);if(c){this.formPanel.baseParams.parent_id=c}else{delete this.formPanel.baseParams.parent_id}if(b){this.formPanel.baseParams.site_id=b}else{delete this.formPanel.baseParams.site_id}if(!a){a=0}this.setFolderId(a);if(this.folder_id==0){this.formPanel.form.reset();this.writePermissionsTab.setAcl(0)}this.formPanel.load({url:GO.settings.modules.cms.url+"json.php",success:function(e,f){this.formPanel.baseParams.parent_id=f.result.data.parent_id;this.writePermissionsTab.setAcl(f.result.data.acl);this.optionsPanel.loadConfig(f.result.data.config,f.result.data.option_values,f.result.data.type,f.result.data.default_template);GO.cms.FolderDialog.superclass.show.call(this)},failure:function(e,f){Ext.Msg.alert(GO.lang.strError,f.result.feedback)},scope:this})},setFolderId:function(a){this.formPanel.form.baseParams.folder_id=a;this.folder_id=a},submitForm:function(a){this.formPanel.form.submit({url:GO.settings.modules.cms.url+"action.php",params:{task:"save_folder"},waitMsg:GO.lang.waitMsgSave,success:function(b,c){if(c.result.folder_id){this.setFolderId(c.result.folder_id)}if(a){this.hide()}else{if(c.result.folder_id){this.writePermissionsTab.setAcl(c.result.acl)}}this.fireEvent("save",this.folder_id,this.formPanel.form.getValues(),this.formPanel.baseParams.parent_id)},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},buildForm:function(){this.propertiesPanel=new Ext.Panel({title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,layout:"form",autoScroll:true,items:[{xtype:"textfield",name:"name",anchor:"-20",allowBlank:false,fieldLabel:GO.lang.strName},{xtype:"checkbox",name:"disabled",anchor:"-20",allowBlank:false,boxLabel:GO.cms.lang.disabled,hideLabel:true},{xtype:"checkbox",name:"authentication",anchor:"-20",allowBlank:false,boxLabel:GO.cms.lang.authentication,hideLabel:true},new Ext.form.FieldSet({title:GO.cms.lang.defaultTemplateOptions,autoHeight:true,items:[this.optionsPanel=new GO.cms.TemplateOptionsPanel({isFolder:true})]})]});var a=[this.propertiesPanel];this.writePermissionsTab=new GO.grid.PermissionsPanel({title:GO.lang.strWritePermissions});a.push(this.writePermissionsTab);this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:a,anchor:"100% 100%"});this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,url:GO.settings.modules.cms.url+"action.php",border:false,baseParams:{task:"folder"},items:this.tabPanel})}});GO.cms.CommentsGrid=function(a){if(!a){a={}}a.title=GO.cms.lang.comments;a.layout="fit";a.autoScroll=true;a.split=true;a.store=new GO.data.JsonStore({url:GO.settings.modules.cms.url+"json.php",baseParams:{task:"comments"},root:"results",id:"id",totalProperty:"total",fields:["id","file_id","user_name","name","comments","ctime"],remoteSort:true});a.paging=true;var b=new Ext.grid.ColumnModel([{header:GO.cms.lang.fileId,dataIndex:"file_id"},{header:GO.lang.strOwner,dataIndex:"user_name",sortable:false},{header:GO.lang.strName,dataIndex:"name"},{header:GO.cms.lang.comments,dataIndex:"comments"},{header:GO.lang.strCtime,dataIndex:"ctime"}]);b.defaultSortable=true;a.cm=b;a.view=new Ext.grid.GridView({autoFill:true,forceFit:true,emptyText:GO.lang.strNoItems});a.sm=new Ext.grid.RowSelectionModel();a.loadMask=true;this.commentDialog=new GO.cms.CommentDialog();this.commentDialog.on("save",function(){this.store.reload()},this);a.tbar=[{iconCls:"btn-add",text:GO.lang.cmdAdd,cls:"x-btn-text-icon",handler:function(){this.commentDialog.show()},scope:this},{iconCls:"btn-delete",text:GO.lang.cmdDelete,cls:"x-btn-text-icon",handler:function(){this.deleteSelected()},scope:this}];GO.cms.CommentsGrid.superclass.constructor.call(this,a);this.on("rowdblclick",function(e,f){var c=e.getStore().getAt(f);this.commentDialog.show(c.data.id)},this)};Ext.extend(GO.cms.CommentsGrid,GO.grid.GridPanel,{});GO.cms.CommentDialog=function(b){if(!b){b={}}this.buildForm();var a=function(){this.propertiesPanel.items.items[0].focus()};b.maximizable=true;b.layout="fit";b.modal=false;b.resizable=false;b.width=700;b.height=500;b.closeAction="hide";b.title=GO.cms.lang.comment;b.items=this.formPanel;b.focus=a.createDelegate(this);b.buttons=[{text:GO.lang.cmdOk,handler:function(){this.submitForm(true)},scope:this},{text:GO.lang.cmdApply,handler:function(){this.submitForm()},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}];GO.cms.CommentDialog.superclass.constructor.call(this,b);this.addEvents({save:true})};Ext.extend(GO.cms.CommentDialog,Ext.Window,{show:function(a){if(!this.rendered){this.render(Ext.getBody())}this.tabPanel.setActiveTab(0);if(!a){a=0}this.setCommentId(a);if(this.comment_id>0){this.formPanel.load({url:GO.settings.modules.cms.url+"json.php",success:function(b,c){this.selectUser.setRemoteText(c.result.data.user_name);GO.cms.CommentDialog.superclass.show.call(this)},failure:function(b,c){Ext.Msg.alert(GO.lang.strError,c.result.feedback)},scope:this})}else{this.formPanel.form.reset();GO.cms.CommentDialog.superclass.show.call(this)}},setCommentId:function(a){this.formPanel.form.baseParams.comment_id=a;this.comment_id=a},submitForm:function(a){this.formPanel.form.submit({url:GO.settings.modules.cms.url+"action.php",params:{task:"save_comment"},waitMsg:GO.lang.waitMsgSave,success:function(b,c){this.fireEvent("save",this);if(a){this.hide()}else{if(c.result.comment_id){this.setCommentId(c.result.comment_id)}}},failure:function(b,c){if(c.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,c.result.feedback)}},scope:this})},buildForm:function(){this.propertiesPanel=new Ext.Panel({title:GO.lang.strProperties,cls:"go-form-panel",waitMsgTarget:true,layout:"form",autoScroll:true,items:[{xtype:"textfield",name:"file_id",anchor:"-20",allowBlank:false,fieldLabel:GO.cms.lang.fileId},this.selectUser=new GO.form.SelectUser({fieldLabel:GO.lang.strUser,disabled:!GO.settings.modules.cms["write_permission"],value:GO.settings.user_id,anchor:"-20"}),{xtype:"textfield",name:"name",anchor:"-20",allowBlank:false,fieldLabel:GO.lang.strName},{xtype:"textarea",name:"comments",anchor:"-20",allowBlank:true,fieldLabel:GO.cms.lang.comments}]});var a=[this.propertiesPanel];this.tabPanel=new Ext.TabPanel({activeTab:0,deferredRender:false,border:false,items:a,anchor:"100% 100%"});this.formPanel=new Ext.form.FormPanel({waitMsgTarget:true,url:GO.settings.modules.cms.url+"action.php",border:false,baseParams:{task:"comment"},items:this.tabPanel})}});GO.cms.TreePanel=function(a){if(!a){a={}}if(!a.rootNodeId){a.rootNodeId="root"}a.title=GO.cms.lang.categories;a.layout="fit";a.split=true;a.autoScroll=true;a.width=200;a.animate=true;a.loader=new Ext.tree.TreeLoader({dataUrl:GO.settings.modules.cms.url+"json.php",baseParams:{task:"tree"},preloadChildren:true});a.containerScroll=true;a.rootVisible=false;a.collapseFirst=false;a.collapsible=true;a.containerScroll=true;a.enableDD=true;a.ddGroup="cmsDD";GO.cms.TreePanel.superclass.constructor.call(this,a);this.rootNode=new Ext.tree.AsyncTreeNode({text:GO.lang.root,id:a.rootNodeId,draggable:false,iconCls:"folder-default",expanded:false});this.setRootNode(this.rootNode);this.on("nodedrop",function(j){var m={};if(j.dropNode.attributes.file_id){m.task="move_file";m.file_id=j.dropNode.attributes.file_id;if(j.point=="append"){m.folder_id=j.target.attributes.folder_id}else{m.folder_id=j.target.parentNode.attributes.folder_id}j.dropNode.attributes.folder_id=j.target.attributes.folder_id;var h=this.getNodeById("folder_"+m.folder_id)}else{m.task="move_folder";m.folder_id=j.dropNode.attributes.folder_id;if(j.point=="append"){m.parent_id=j.target.attributes.folder_id}else{m.parent_id=j.target.parentNode.attributes.folder_id}var h=this.getNodeById("folder_"+m.parent_id)}j.dropNode.attributes.site_id=j.target.attributes.site_id;var c=[];for(var g=0;g<h.childNodes.length;g++){var f=h.childNodes[g];if(f.attributes.file_id){var k="file";var b=f.attributes.file_id}else{var k="folder";var b=f.attributes.folder_id}var l={fstype:k,id:b,sort_order:g};c.push(l)}m.sort_order=Ext.encode(c);Ext.Ajax.request({url:GO.settings.modules.cms.url+"action.php",params:m,callback:function(i,p,e){var n=Ext.decode(e.responseText);if(!p||!n.success){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strSaveError)}},scope:this})},this)};Ext.extend(GO.cms.TreePanel,Ext.tree.TreePanel,{resetRootNode:function(a){this.rootNode.id=a;this.rootNode.attributes.id=a;this.rootNode.reload()},getActivePath:function(){var a=this.getSelectionModel();if(a.selNodes[0]==null){return""}var b=a.selNodes[0];var c="/"+b.text;if(!b.parentNode||!b.parentNode.parentNode){return""}while(!b.parentNode.parentNode.isRoot){b=b.parentNode;c="/"+b.text+c}return c}});GO.cms.SelectFile=Ext.extend(function(a){this.treePanel=new GO.cms.TreePanel({region:"west",title:GO.lang.menu,autoScroll:true,width:250,split:true,rootNodeId:"site_"+GO.cms.site_id});var b={title:GO.cms.lang.selectPage,height:400,width:600,layout:"fit",border:false,closeAction:"hide",tbar:[{iconCls:"cms-folder-properties",text:GO.cms.lang.files,handler:function(){GO.cms.createFileBrowser(GO.cms.editorPanel.root_folder_id,"",function(){var c=GO.cms.fb.getSelectedGridRecords();GO.cms.popupWin.document.getElementById(GO.cms.popupField).value=GO.settings.modules.files.full_url+"download.php?id="+c[0].data.id;GO.cms.fileBrowserWindow.hide()},GO.cms.editorPanel.files_folder_id);this.hide()},scope:this}],items:this.treePanel,buttons:[{text:GO.lang.cmdOk,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNode==null){Ext.MessageBox.alert(GO.lang.strError,GO.lang.noItemSelected)}else{this.fireEvent("fileselected",c.selNode.attributes);this.hide()}},scope:this},{text:GO.lang.cmdClose,handler:function(){this.hide()},scope:this}]};Ext.apply(a,b);this.addEvents({fileselected:true});GO.cms.SelectFile.superclass.constructor.call(this,b)},Ext.Window,{show:function(){this.treePanel.resetRootNode("site_"+GO.cms.site_id);GO.cms.SelectFile.superclass.show.call(this)}});GO.cms.EditorPanel=Ext.extend(function(a){var f={};for(var c=0;c<GO.Languages.length;c++){f[GO.Languages[c][0]]=GO.Languages[c][1]}var g="+"+f[GO.settings.language]+"="+GO.settings.language;for(var e in f){if(e!=GO.settings.language){g+=","+f[e]+"="+e}}this.editor=new Ext.ux.TinyMCE({name:"content",tinymceSettings:{mode:"textareas",theme:"advanced",plugins:"spellchecker,safari,pagebreak,style,layer,table,save,advhr,advimage,advlink,emotions,iespell,inlinepopups,insertdatetime,preview,media,searchreplace,print,contextmenu,paste,directionality,fullscreen,noneditable,visualchars,nonbreaking,xhtmlxtras,template",theme_advanced_buttons1:"bold,italic,underline,strikethrough,|,justifyleft,justifycenter,justifyright,justifyfull,styleselect,formatselect",theme_advanced_buttons2:"cut,copy,paste,pastetext,pasteword,|,search,replace,|,bullist,numlist,|,outdent,indent,blockquote,|,undo,redo,|,link,unlink,anchor,image,cleanup,code,|,forecolor,backcolor",theme_advanced_buttons3:"tablecontrols,|,hr,removeformat,visualaid,|,sub,sup,|,charmap,spellchecker,media,advhr,|,ltr,rtl,|,fullscreen",file_browser_callback:"GO.cms.fileBrowser",theme_advanced_toolbar_location:"top",theme_advanced_toolbar_align:"left",theme_advanced_statusbar_location:"bottom",theme_advanced_resizing:false,convert_urls:false,relative_urls:false,spellchecker_languages:g,spellchecker_rpc_url:BaseHref+"javascript/tiny_mce/plugins/spellchecker/rpc.php"}});var b={disabled:true,waitMsgTarget:true,url:GO.settings.modules.cms.url+"json.php",baseParams:{task:"file"},region:"center",border:false,labelAlign:"top",items:{anchor:"100% 100%",layout:"border",border:false,items:[{region:"center",layout:"fit",border:false,items:this.editor},{region:"east",split:true,width:300,cls:"go-form-panel",waitMsgTarget:true,layout:"form",autoScroll:true,defaults:{anchor:"-20",listeners:{change:function(){this.dirty=true},scope:this}},defaultType:"textfield",items:[{fieldLabel:GO.lang.strName,name:"name",allowBlank:false},{xtype:"datefield",format:GO.settings.date_format,fieldLabel:GO.cms.lang.showUntil,name:"show_until",allowBlank:true,emptyText:GO.cms.lang.alwaysShow},{hideLabel:true,xtype:"checkbox",checked:true,name:"auto_meta",boxLabel:GO.cms.lang.autoMeta,listeners:{check:function(h,i){this.setAutoMeta(i)},scope:this}},{fieldLabel:GO.cms.lang.title,xtype:"textarea",name:"title",height:60},{fieldLabel:GO.lang.strDescription,xtype:"textarea",name:"description",height:80},{fieldLabel:GO.cms.lang.keywords,xtype:"textarea",name:"keywords",height:80},this.optionsPanel=new GO.cms.TemplateOptionsPanel()]}]}};this.optionsPanel.on("htmlTemplateSelected",function(h){tinyMCE.execCommand("mceInsertContent",false,h.get("html"))},this);Ext.apply(b,a);GO.cms.EditorPanel.superclass.constructor.call(this,b);this.addEvents({save:true,disabled:true,load:true})},Ext.FormPanel,{files_folder_id:0,root_folder_id:0,currentTemplate:"",dirty:false,file_id:0,loadFile:function(c,b){this.setDisabled(false);if(this.currentTemplate!=b){if(this.currentTemplate!=""){this.editor.reInit()}var a=tinyMCE.activeEditor.dom;this.currentTemplate=b;a.remove(a.select("link"));if(b!=""){a.add(a.select("head")[0],"link",{rel:"stylesheet",href:GO.settings.modules.cms.url+"templates/"+b+"/css/editor.css"})}}this.file_id=c;this.baseParams.file_id=c;if(c>0){this.baseParams.folder_id=0}this.dirty=false;this.load({success:function(e,f){this.root_folder_id=f.result.data.root_folder_id;this.files_folder_id=f.result.data.files_folder_id;if(f.result.data.folder_id){this.baseParams.folder_id=f.result.data.folder_id}this.setAutoMeta(f.result.data.auto_meta=="1");this.optionsPanel.loadConfig(f.result.data.config,f.result.data.option_values,f.result.data.type);this.fireEvent("load",this)},scope:this})},saveFile:function(){tinyMCE.triggerSave();this.form.submit({url:GO.settings.modules.cms.url+"action.php",params:{task:"save_file"},success:function(a,b){if(b.result.file_id){this.baseParams.file_id=b.result.file_id}if(b.result.title){this.form.findField("title").setValue(b.result.title)}if(b.result.keywords){this.form.findField("keywords").setValue(b.result.keywords)}if(b.result.description){this.form.findField("description").setValue(b.result.description)}if(b.result.files_folder_id){this.files_folder_id=b.result.files_folder_id}this.dirty=false;this.editor.ed.isNotDirty=1;this.fireEvent("save",this.baseParams.file_id,this.form.getValues(),this.baseParams.folder_id)},failure:function(a,b){if(b.failureType=="client"){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strErrorsInForm)}else{Ext.MessageBox.alert(GO.lang.strError,b.result.feedback)}},scope:this})},newFile:function(a,b){this.form.reset();this.baseParams.folder_id=a;this.loadFile(0,b)},setDisabled:function(a){this.fireEvent("disabled",a);GO.cms.EditorPanel.superclass.setDisabled.call(this,a)},isDirty:function(){return this.dirty||this.editor.isDirty()},setAutoMeta:function(a){var b=this.form;b.findField("title").setDisabled(a);b.findField("description").setDisabled(a);b.findField("keywords").setDisabled(a)}});GO.cms.createFileBrowser=function(c,b,a,e){if(!GO.cms.fb){GO.cms.fb=new GO.files.FileBrowser({border:false,treeCollapsed:false});GO.cms.fileBrowserWindow=new Ext.Window({title:GO.lang.strSelectFiles,height:500,width:750,layout:"fit",border:false,collapsible:true,maximizable:true,closeAction:"hide",items:GO.cms.fb,buttons:[{text:GO.lang.cmdOk,handler:function(){GO.cms.fb.fileClickHandler()},scope:this},{text:GO.lang.cmdClose,handler:function(){GO.cms.fileBrowserWindow.hide()},scope:this}]})}GO.cms.fb.setFilesFilter(b);GO.cms.fb.setFileClickHandler(a,this);GO.cms.fileBrowserWindow.buttons[0].setVisible(a!=false);if(!e){e=c}GO.cms.fb.setRootID(c,e);GO.cms.fileBrowserWindow.show()};GO.cms.fileBrowser=function(c,a,b,e){GO.cms.popupWin=e;GO.cms.popupField=c;if(b=="image"){GO.cms.createFileBrowser(GO.cms.editorPanel.root_folder_id,"png,jpg,jpeg,gif,bmp",function(){var f=GO.cms.fb.getSelectedGridRecords();GO.cms.popupWin.document.getElementById(GO.cms.popupField).value=GO.settings.modules.files.full_url+"download.php?id="+f[0].data.id;GO.cms.fileBrowserWindow.hide()})}else{if(!GO.cms.selectFile){GO.cms.selectFile=new GO.cms.SelectFile();GO.cms.selectFile.on("fileselected",function(f){GO.cms.popupWin.document.getElementById(GO.cms.popupField).value="/{site_url}?site_id="+f.site_id+"&path="+f.path},this)}GO.cms.selectFile.show()}};GO.cms.TemplateOptionsPanel=Ext.extend(function(a){var b={layout:"form",border:false,bodyStyle:"padding:0px;",autoHeight:true};Ext.apply(b,a);GO.cms.TemplateOptionsPanel.superclass.constructor.call(this,b);this.addEvents({htmlTemplateSelected:true})},Ext.Panel,{templateConfig:false,options:[],loadConfig:function(b,a,f,e){var c,h;this.templateConfig=b;this.optionValues=a;if(this.items){this.items.each(function(j){var i=j.container.up("div.x-form-item");j.destroy();if(i){i.remove()}})}if(b.templates&&b.templates.length){var g={fieldLabel:GO.cms.lang.insertTemplate,store:new Ext.data.SimpleStore({fields:["name","html"],data:b.templates}),name:"default_template",displayField:"name",mode:"local",triggerAction:"all",editable:false,forceSelection:false,anchor:"-20"};if(!this.isFolder){g.listeners={select:function(k,i,j){this.fireEvent("htmlTemplateSelected",i);k.reset()},scope:this}}else{if(e){g.value=e}}this.add(new GO.form.ComboBoxReset(g))}if(b.types&&b.types.length){var g={fieldLabel:GO.lang.strType,store:new Ext.data.SimpleStore({fields:["name","options"],data:b.types}),name:"type",value:f,displayField:"name",mode:"local",triggerAction:"all",editable:false,forceSelection:false,anchor:"-20",listeners:{select:function(k,i,j){this.addOptions(i.get("name"))},scope:this}};this.add(new GO.form.ComboBoxReset(g));if(this.isFolder){this.add(new Ext.form.Checkbox({hideLabel:true,boxLabel:GO.cms.lang.applyRecursive,name:"recursive"}))}}this.addOptions(f)},removeOptions:function(){for(var b=0;b<this.options.length;b++){var a=this.options[b].container.up("div.x-form-item");this.options[b].destroy();if(a){a.remove()}}this.options=[]},addOptions:function(c){this.removeOptions();var a=[];for(var b=0;b<this.templateConfig.types.length;b++){if(this.templateConfig.types[b][0]==c){a=this.templateConfig.types[b][1];break}}var e;if(a.length){for(var b=0;b<a.length;b++){o=a[b];if(o.type=="select"){e=this.optionValues[o.name]?this.optionValues[o.name]:o.options[0][0];this.options.push(new GO.form.ComboBoxReset({fieldLabel:o.fieldLabel,hiddenName:o.name,store:new Ext.data.SimpleStore({fields:["value","text"],data:o.options}),value:e,valueField:"value",displayField:"text",mode:"local",triggerAction:"all",editable:false,forceSelection:true,anchor:"-20"}))}else{if(o.type=="file"){e=this.optionValues[o.name]?this.optionValues[o.name]:"";this.options.push(new GO.files.SelectFile({fieldLabel:o.fieldLabel,root_folder_id:this.ownerCt.ownerCt.ownerCt.root_folder_id,name:o.name,value:e,anchor:"-20"}))}else{if(o.type=="checkbox"){e=this.optionValues[o.name]?this.optionValues[o.name]:"";this.options.push(new Ext.form.Checkbox({boxLabel:o.fieldLabel,hideLabel:true,name:o.name,checked:!GO.util.empty(e),anchor:"-20"}))}else{if(o.type=="textarea"){e=this.optionValues[o.name]?this.optionValues[o.name]:"";this.options.push(new Ext.form.TextArea({fieldLabel:o.fieldLabel,name:o.name,value:e,anchor:"-20"}))}else{e=this.optionValues[o.name]?this.optionValues[o.name]:"";this.options.push(new Ext.form.TextField({fieldLabel:o.fieldLabel,name:o.name,value:e,anchor:"-20"}))}}}}this.add(this.options[this.options.length-1])}}this.doLayout()}});GO.cms.MainPanel=function(a){if(!a){a={}}this.folderDialog=new GO.cms.FolderDialog();this.folderDialog.on("save",function(e,h,g){var c=this.treePanel.getNodeById("folder_"+e);if(c){c.setText(h.name)}else{var c=this.treePanel.getNodeById("folder_"+g);var f=new Ext.tree.AsyncTreeNode({text:h.name,id:"folder_"+e,iconCls:"filetype-folder",site_id:c.attributes.site_id,file_id:0,folder_id:e,template:c.attributes.template,expanded:true,children:[]});c.appendChild(f)}},this);this.treePanel=GO.cms.treePanel=new GO.cms.TreePanel({region:"west",title:GO.lang.menu,autoScroll:true,width:250,split:true,selModel:new Ext.tree.MultiSelectionModel()});this.treePanel.on("beforeclick",function(c){if(c.attributes.file==0){return false}},this);this.treePanel.on("click",function(c,f){if(!f.ctrlKey){if(!c.expanded){c.expand()}if(c.attributes.site_id){GO.cms.site_id=c.attributes.site_id}if(c.attributes.file_id>0){this.checkChanges.defer(100,this,[function(){this.getEl().mask(GO.lang.waitMsgLoad);this.editorPanel.loadFile(c.attributes.file_id,c.attributes.template)},this])}}},this);this.editorPanel=new GO.cms.EditorPanel();GO.cms.editorPanel=this.editorPanel;this.editorPanel.on("disabled",function(c){this.saveButton.setDisabled(c);this.viewButton.setDisabled(c);if(c){this.filesButton.setDisabled(true)}},this);this.editorPanel.on("save",function(h,i,e){var f=this.treePanel.getNodeById("file_"+h);if(f){f.setText(i.name)}else{var c=this.treePanel.getNodeById("folder_"+e);var g=new Ext.tree.AsyncTreeNode({text:i.name,id:"file_"+h,iconCls:"filetype-html",site_id:c.attributes.site_id,file_id:h,folder_id:c.attributes.folder_id,template:c.attributes.template,leaf:true});c.appendChild(g);this.treePanel.getSelectionModel().select(g)}},this);a.items=[this.treePanel,this.editorPanel];a.layout="border";var b=[{iconCls:"btn-add",text:GO.cms.lang.newPage,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNodes[0]==null){Ext.MessageBox.alert(GO.lang.strError,GO.cms.lang.selectFolderAdd)}else{this.checkChanges.defer(100,this,[function(){this.editorPanel.newFile(c.selNodes[0].attributes.folder_id,c.selNodes[0].attributes.template)},this])}},scope:this},{iconCls:"btn-add",text:GO.cms.lang.newFolder,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNodes[0]==null){Ext.MessageBox.alert(GO.lang.strError,GO.cms.lang.selectFolderAdd)}else{this.folderDialog.show(0,c.selNodes[0].attributes.folder_id,c.selNodes[0].attributes.site_id)}},scope:this},{iconCls:"cms-btn-copy",text:GO.lang.copy,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNodes[0]==null){Ext.MessageBox.alert(GO.lang.strError,GO.cms.lang.selectFolderAdd)}else{this.copyFolders=[];this.copyFiles=[];for(var e=0;e<c.selNodes.length;e++){if(c.selNodes[e].attributes.file_id>0){this.copyFiles.push(c.selNodes[e].attributes.file_id)}else{this.copyFolders.push(c.selNodes[e].attributes.folder_id)}}this.pasteButton.setDisabled(false)}},scope:this},this.pasteButton=new Ext.Button({disabled:true,iconCls:"cms-btn-paste",text:GO.lang.paste,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNodes[0]==null){Ext.MessageBox.alert(GO.lang.strError,GO.cms.lang.selectFolderAdd)}else{var f=c.selNodes[0].attributes.folder_id;var e={task:"copy",copy_folders:Ext.encode(this.copyFolders),copy_files:Ext.encode(this.copyFiles),destination_folder_id:c.selNodes[0].attributes.folder_id};Ext.Ajax.request({url:GO.settings.modules.cms.url+"action.php",params:e,callback:function(h,j,g){if(!j){Ext.MessageBox.alert(GO.lang.strError,GO.lang.strRequestError)}else{var i=Ext.decode(g.responseText);if(!i.success){Ext.MessageBox.alert(GO.lang.strError,i.feedback)}else{this.treePanel.rootNode.reload();this.copyFolders=[];this.copyFiles=[];this.pasteButton.setDisabled(true)}}},scope:this})}},scope:this}),{text:GO.lang.cmdDelete,iconCls:"btn-delete",handler:function(){var e=this.treePanel.getSelectionModel();var c=[];if(e.selNodes){for(var f=0;f<e.selNodes.length;f++){c.push(e.selNodes[f].id)}}GO.deleteItems({count:c.length,url:GO.settings.modules.cms.url+"action.php",params:{task:"delete",delete_items:Ext.encode(c)},callback:function(j){if(j.deleted_nodes){for(var g=0;g<j.deleted_nodes.length;g++){var h=this.treePanel.getNodeById(j.deleted_nodes[g]);if(h){if(h.attributes.file_id==this.editorPanel.baseParams.file_id){this.editorPanel.form.reset();this.editorPanel.setDisabled(true)}h.remove()}}}},scope:this})},scope:this},"-",this.saveButton=new Ext.Button({iconCls:"btn-save",text:GO.lang.cmdSave,handler:function(){this.el.mask(GO.lang.waitMsgSave);this.editorPanel.saveFile()},scope:this,disabled:true}),this.viewButton=new Ext.Button({iconCls:"cms-btn-view",text:GO.cms.lang.view,handler:function(){window.open(GO.settings.modules.cms.url+"run.php?file_id="+this.editorPanel.baseParams.file_id+"&basehref="+encodeURIComponent(GO.settings.modules.cms.url))},scope:this,disabled:true}),"-",{iconCls:"cms-folder-properties",text:GO.cms.lang.folderProperties,handler:function(){var c=this.treePanel.getSelectionModel();if(c.selNodes[0]==null){Ext.MessageBox.alert(GO.lang.strError,GO.cms.lang.selectFolder)}else{this.folderDialog.show(c.selNodes[0].attributes.folder_id)}},scope:this}];if(GO.files){b.push(this.filesButton=new Ext.Button({iconCls:"cms-folder-properties",text:GO.cms.lang.files,disabled:true,handler:function(){GO.cms.createFileBrowser(GO.cms.editorPanel.root_folder_id,"",false,GO.cms.editorPanel.files_folder_id)},scope:this}));this.editorPanel.on("load",function(){this.filesButton.setDisabled(this.editorPanel.files_folder_id==0);this.getEl().unmask()},this);this.editorPanel.on("save",function(){this.filesButton.setDisabled(this.editorPanel.files_folder_id==0);this.el.unmask()},this)}if(GO.settings.modules.cms.write_permission){b.push("-");b.push({iconCls:"cms-btn-sites",text:GO.cms.lang.sites,handler:function(){if(!this.sitesDialog){this.sitesDialog=new GO.cms.SitesDialog();this.sitesDialog.sitesGrid.store.on("load",function(){this.sitesDialog.sitesGrid.store.on("load",function(){this.treePanel.rootNode.reload()},this)},this)}this.sitesDialog.show()},scope:this})}if(GO.webshop){b.push({iconCls:"ws-btn-webshop",text:GO.webshop.lang.webshops,handler:function(){if(!this.webshopsDialog){this.webshopsDialog=new Ext.Window({layout:"fit",width:500,height:400,closeAction:"hide",title:GO.webshop.lang.webshops,items:new GO.webshop.WebshopsGrid(),buttons:[{text:GO.lang.cmdClose,handler:function(){this.webshopsDialog.hide()},scope:this}]})}this.webshopsDialog.show()},scope:this})}if(GO.mailings){b.push({iconCls:"ml-btn-mailings",text:GO.addressbook.lang.sendMailing,cls:"x-btn-text-icon",handler:function(){if(!this.selectMailingGroupWindow){this.selectMailingGroupWindow=new GO.mailings.SelectMailingGroupWindow();this.selectMailingGroupWindow.on("select",function(e,c){GO.email.showComposer({loadUrl:GO.settings.modules.mailings.url+"json.php",loadParams:{task:"sendcmsfile",file_id:this.editorPanel.baseParams.file_id,mailing_group_id:c},mailing_group_id:c})},this)}this.selectMailingGroupWindow.show()},scope:this})}a.tbar=new Ext.Toolbar({cls:"go-head-tb",items:b});a.border=false;GO.cms.MainPanel.superclass.constructor.call(this,a)};Ext.extend(GO.cms.MainPanel,Ext.Panel,{copyFolders:[],copyFile:[],checkChanges:function(c,b){var a=this.editorPanel.isDirty();if(a&&confirm(GO.cms.lang.saveChanges)){this.editorPanel.saveFile();this.editorPanel.on("save",c,b,{single:true})}else{c.call(b)}}});GO.moduleManager.addModule("cms",GO.cms.MainPanel,{title:GO.cms.lang.cms,iconCls:"go-tab-icon-cms"});